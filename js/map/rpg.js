function JsExtensions(){throw Error("This is not a class");}Number.prototype.clamp=function(a,b){return Math.min(Math.max(this,a),b)};Number.prototype.mod=function(a){return(this%a+a)%a};String.prototype.format=function(){var a=arguments;return this.replace(/%([0-9]+)/g,function(b,c){return a[Number(c)-1]})};String.prototype.padZero=function(a){for(var b=this;b.length<a;)b="0"+b;return b};Number.prototype.padZero=function(a){return String(this).padZero(a)};
Object.defineProperties(Array.prototype,{equals:{enumerable:!1,value:function(a){if(!a||this.length!==a.length)return!1;for(var b=0;b<this.length;b++)if(this[b]instanceof Array&&a[b]instanceof Array){if(!this[b].equals(a[b]))return!1}else if(this[b]!==a[b])return!1;return!0}},clone:{enumerable:!1,value:function(){return this.slice(0)}},contains:{enumerable:!1,value:function(a){return 0<=this.indexOf(a)}}});String.prototype.contains=function(a){return 0<=this.indexOf(a)};
Math.randomInt=function(a){return Math.floor(a*Math.random())};function Utils(){throw Error("This is a static class");}Utils.RPGMAKER_NAME="MV";Utils.RPGMAKER_VERSION="1.6.1";Utils.isOptionValid=function(a){return location.search.slice(1).split("&").contains(a)||"undefined"!==typeof nw&&0<nw.App.argv.length&&nw.App.argv[0].split("&").contains(a)?1:0};Utils.isNwjs=function(){return"function"===typeof require&&"object"===typeof process};Utils.isMobileDevice=function(){return!!navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)};
Utils.isMobileSafari=function(){var a=navigator.userAgent;return!(!a.match(/iPhone|iPad|iPod/)||!a.match(/AppleWebKit/)||a.match("CriOS"))};Utils.isAndroidChrome=function(){var a=navigator.userAgent;return!(!a.match(/Android/)||!a.match(/Chrome/))};Utils.canReadGameFiles=function(){var a=document.getElementsByTagName("script");a=a[a.length-1];var b=new XMLHttpRequest;try{return b.open("GET",a.src),b.overrideMimeType("text/javascript"),b.send(),!0}catch(c){return!1}};
Utils.rgbToCssColor=function(a,b,c){a=Math.round(a);b=Math.round(b);c=Math.round(c);return"rgb("+a+","+b+","+c+")"};Utils._id=1;Utils.generateRuntimeId=function(){return Utils._id++};Utils._supportPassiveEvent=null;Utils.isSupportPassiveEvent=function(){if("boolean"===typeof Utils._supportPassiveEvent)return Utils._supportPassiveEvent;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("test",null,b);return Utils._supportPassiveEvent=a};
function CacheEntry(a,b,c){this.cache=a;this.key=b;this.item=c;this.cached=!1;this.ttlSeconds=this.ttlTicks=this.touchSeconds=this.touchTicks=0;this.freedByTTL=!1}CacheEntry.prototype.free=function(a){this.freedByTTL=a||!1;this.cached&&(this.cached=!1,delete this.cache._inner[this.key])};CacheEntry.prototype.allocate=function(){this.cached||(this.cache._inner[this.key]=this,this.cached=!0);this.touch();return this};
CacheEntry.prototype.setTimeToLive=function(a,b){this.ttlTicks=a||0;this.ttlSeconds=b||0;return this};CacheEntry.prototype.isStillAlive=function(){var a=this.cache;return(0==this.ttlTicks||this.touchTicks+this.ttlTicks<a.updateTicks)&&(0==this.ttlSeconds||this.touchSeconds+this.ttlSeconds<a.updateSeconds)};
CacheEntry.prototype.touch=function(){var a=this.cache;this.cached?(this.touchTicks=a.updateTicks,this.touchSeconds=a.updateSeconds):this.freedByTTL&&(this.freedByTTL=!1,a._inner[this.key]||(a._inner[this.key]=this))};function CacheMap(a){this.manager=a;this._inner={};this._lastRemovedEntries={};this.lastCheckTTL=this.updateTicks=0;this.delayCheckTTL=100;this.updateSeconds=Date.now()}
CacheMap.prototype.checkTTL=function(){var a=this._inner,b=this._lastRemovedEntries;b||(this._lastRemovedEntries=b=[]);for(var c in a){var d=a[c];d.isStillAlive()||b.push(d)}for(a=0;a<b.length;a++)b[a].free(!0);b.length=0};CacheMap.prototype.getItem=function(a){return(a=this._inner[a])?a.item:null};CacheMap.prototype.clear=function(){for(var a=Object.keys(this._inner),b=0;b<a.length;b++)this._inner[a[b]].free()};CacheMap.prototype.setItem=function(a,b){return(new CacheEntry(this,a,b)).allocate()};
CacheMap.prototype.update=function(a,b){this.updateTicks+=a;this.updateSeconds+=b;this.updateSeconds>=this.delayCheckTTL+this.lastCheckTTL&&(this.lastCheckTTL=this.updateSeconds,this.checkTTL())};function ImageCache(){this.initialize.apply(this,arguments)}ImageCache.limit=1E7;ImageCache.prototype.initialize=function(){this._items={}};ImageCache.prototype.add=function(a,b){this._items[a]={bitmap:b,touch:Date.now(),key:a};this._truncateCache()};
ImageCache.prototype.get=function(a){return this._items[a]?(a=this._items[a],a.touch=Date.now(),a.bitmap):null};ImageCache.prototype.reserve=function(a,b,c){this._items[a]||(this._items[a]={bitmap:b,touch:Date.now(),key:a});this._items[a].reservationId=c};ImageCache.prototype.releaseReservation=function(a){var b=this._items;Object.keys(b).map(function(c){return b[c]}).forEach(function(c){c.reservationId===a&&delete c.reservationId})};
ImageCache.prototype._truncateCache=function(){var a=this._items,b=ImageCache.limit;Object.keys(a).map(function(c){return a[c]}).sort(function(c,d){return d.touch-c.touch}).forEach(function(c){0<b||this._mustBeHeld(c)?(c=c.bitmap,b-=c.width*c.height):delete a[c.key]}.bind(this))};ImageCache.prototype._mustBeHeld=function(a){return a.bitmap.isRequestOnly()?!1:a.reservationId||!a.bitmap.isReady()?!0:!1};
ImageCache.prototype.isReady=function(){var a=this._items;return!Object.keys(a).some(function(b){return!a[b].bitmap.isRequestOnly()&&!a[b].bitmap.isReady()})};ImageCache.prototype.getErrorBitmap=function(){var a=this._items,b=null;return Object.keys(a).some(function(c){return a[c].bitmap.isError()?(b=a[c].bitmap,!0):!1})?b:null};function RequestQueue(){this.initialize.apply(this,arguments)}RequestQueue.prototype.initialize=function(){this._queue=[]};
RequestQueue.prototype.enqueue=function(a,b){this._queue.push({key:a,value:b})};RequestQueue.prototype.update=function(){if(0!==this._queue.length){var a=this._queue[0];a.value.isRequestReady()?(this._queue.shift(),0!==this._queue.length&&this._queue[0].value.startRequest()):a.value.startRequest()}};RequestQueue.prototype.raisePriority=function(a){for(var b=0;b<this._queue.length;b++){var c=this._queue[b];if(c.key===a){this._queue.splice(b,1);this._queue.unshift(c);break}}};
RequestQueue.prototype.clear=function(){this._queue.splice(0)};function Point(){this.initialize.apply(this,arguments)}Point.prototype=Object.create(PIXI.Point.prototype);Point.prototype.constructor=Point;Point.prototype.initialize=function(a,b){PIXI.Point.call(this,a,b)};function Rectangle(){this.initialize.apply(this,arguments)}Rectangle.prototype=Object.create(PIXI.Rectangle.prototype);Rectangle.prototype.constructor=Rectangle;
Rectangle.prototype.initialize=function(a,b,c,d){PIXI.Rectangle.call(this,a,b,c,d)};Rectangle.emptyRectangle=new Rectangle(0,0,0,0);function Bitmap(){this.initialize.apply(this,arguments)}Bitmap._reuseImages=[];
Bitmap.prototype._createCanvas=function(a,b){this.__canvas=this.__canvas||document.createElement("canvas");this.__context=this.__canvas.getContext("2d");this.__canvas.width=Math.max(a||0,1);this.__canvas.height=Math.max(b||0,1);this._image&&(a=Math.max(this._image.height||0,1),this.__canvas.width=Math.max(this._image.width||0,1),this.__canvas.height=a,this._createBaseTexture(this._canvas),this.__context.drawImage(this._image,0,0));this._setDirty()};
Bitmap.prototype._createBaseTexture=function(a){this.__baseTexture=new PIXI.BaseTexture(a);this.__baseTexture.mipmap=!1;this.__baseTexture.width=a.width;this.__baseTexture.height=a.height;this._baseTexture.scaleMode=this._smooth?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST};Bitmap.prototype._clearImgInstance=function(){this._image.src="";this._image.onload=null;this._loadListener=this._errorListener=this._image.onerror=null;Bitmap._reuseImages.push(this._image);this._image=null};
Object.defineProperties(Bitmap.prototype,{_canvas:{get:function(){this.__canvas||this._createCanvas();return this.__canvas}},_context:{get:function(){this.__context||this._createCanvas();return this.__context}},_baseTexture:{get:function(){this.__baseTexture||this._createBaseTexture(this._image||this.__canvas);return this.__baseTexture}}});Bitmap.prototype._renewCanvas=function(){var a=this._image;a&&this.__canvas&&(this.__canvas.width<a.width||this.__canvas.height<a.height)&&this._createCanvas()};
Bitmap.prototype.initialize=function(a,b){this._defer||this._createCanvas(a,b);this._image=null;this._url="";this._paintOpacity=255;this._smooth=!1;this._loadListeners=[];this._loadingState="none";this._decodeAfterRequest=!1;this.cacheEntry=null;this.fontFace="GameFont";this.fontSize=28;this.fontItalic=!1;this.textColor="#ffffff";this.outlineColor="rgba(0, 0, 0, 0.5)";this.outlineWidth=4};
Bitmap.load=function(a){var b=Object.create(Bitmap.prototype);b._defer=!0;b.initialize();b._decodeAfterRequest=!0;b._requestImage(a);return b};Bitmap.snap=function(a){var b=Graphics.width,c=Graphics.height,d=new Bitmap(b,c),e=d._context;b=PIXI.RenderTexture.create(b,c);a&&(Graphics._renderer.render(a,b),a.worldTransform.identity(),a=Graphics.isWebGL()?Graphics._renderer.extract.canvas(b):b.baseTexture._canvasRenderTarget.canvas,e.drawImage(a,0,0));b.destroy({destroyBase:!0});d._setDirty();return d};
Bitmap.prototype.isReady=function(){return"loaded"===this._loadingState||"none"===this._loadingState};Bitmap.prototype.isError=function(){return"error"===this._loadingState};Bitmap.prototype.touch=function(){this.cacheEntry&&this.cacheEntry.touch()};Object.defineProperty(Bitmap.prototype,"url",{get:function(){return this._url},configurable:!0});Object.defineProperty(Bitmap.prototype,"baseTexture",{get:function(){return this._baseTexture},configurable:!0});
Object.defineProperty(Bitmap.prototype,"canvas",{get:function(){return this._canvas},configurable:!0});Object.defineProperty(Bitmap.prototype,"context",{get:function(){return this._context},configurable:!0});Object.defineProperty(Bitmap.prototype,"width",{get:function(){return this.isReady()?this._image?this._image.width:this._canvas.width:0},configurable:!0});
Object.defineProperty(Bitmap.prototype,"height",{get:function(){return this.isReady()?this._image?this._image.height:this._canvas.height:0},configurable:!0});Object.defineProperty(Bitmap.prototype,"rect",{get:function(){return new Rectangle(0,0,this.width,this.height)},configurable:!0});
Object.defineProperty(Bitmap.prototype,"smooth",{get:function(){return this._smooth},set:function(a){this._smooth!==a&&(this._smooth=a,this.__baseTexture&&(this._baseTexture.scaleMode=this._smooth?PIXI.SCALE_MODES.LINEAR:PIXI.SCALE_MODES.NEAREST))},configurable:!0});Object.defineProperty(Bitmap.prototype,"paintOpacity",{get:function(){return this._paintOpacity},set:function(a){this._paintOpacity!==a&&(this._paintOpacity=a,this._context.globalAlpha=this._paintOpacity/255)},configurable:!0});
Bitmap.prototype.resize=function(a,b){a=Math.max(a||0,1);b=Math.max(b||0,1);this._canvas.width=a;this._canvas.height=b;this._baseTexture.width=a;this._baseTexture.height=b};Bitmap.prototype.blt=function(a,b,c,d,e,f,g,h,k){h=h||d;k=k||e;0<=b&&0<=c&&0<d&&0<e&&0<h&&0<k&&b+d<=a.width&&c+e<=a.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(a._canvas,b,c,d,e,f,g,h,k),this._setDirty())};
Bitmap.prototype.bltImage=function(a,b,c,d,e,f,g,h,k){h=h||d;k=k||e;0<=b&&0<=c&&0<d&&0<e&&0<h&&0<k&&b+d<=a.width&&c+e<=a.height&&(this._context.globalCompositeOperation="source-over",this._context.drawImage(a._image,b,c,d,e,f,g,h,k),this._setDirty())};Bitmap.prototype.getPixel=function(a,b){a=this._context.getImageData(a,b,1,1).data;b="#";for(var c=0;3>c;c++)b+=a[c].toString(16).padZero(2);return b};Bitmap.prototype.getAlphaPixel=function(a,b){return this._context.getImageData(a,b,1,1).data[3]};
Bitmap.prototype.clearRect=function(a,b,c,d){this._context.clearRect(a,b,c,d);this._setDirty()};Bitmap.prototype.clear=function(){this.clearRect(0,0,this.width,this.height)};Bitmap.prototype.fillRect=function(a,b,c,d,e){var f=this._context;f.save();f.fillStyle=e;f.fillRect(a,b,c,d);f.restore();this._setDirty()};Bitmap.prototype.fillAll=function(a){this.fillRect(0,0,this.width,this.height,a)};
Bitmap.prototype.gradientFillRect=function(a,b,c,d,e,f,g){var h=this._context;g=g?h.createLinearGradient(a,b,a,b+d):h.createLinearGradient(a,b,a+c,b);g.addColorStop(0,e);g.addColorStop(1,f);h.save();h.fillStyle=g;h.fillRect(a,b,c,d);h.restore();this._setDirty()};Bitmap.prototype.drawCircle=function(a,b,c,d){var e=this._context;e.save();e.fillStyle=d;e.beginPath();e.arc(a,b,c,0,2*Math.PI,!1);e.fill();e.restore();this._setDirty()};
Bitmap.prototype.drawText=function(a,b,c,d,e,f){if(void 0!==a){c=c+e-(e-.7*this.fontSize)/2;e=this._context;var g=e.globalAlpha;d=d||4294967295;"center"===f&&(b+=d/2);"right"===f&&(b+=d);e.save();e.font=this._makeFontNameText();e.textAlign=f;e.textBaseline="alphabetic";e.globalAlpha=1;this._drawTextOutline(a,b,c,d);e.globalAlpha=g;this._drawTextBody(a,b,c,d);e.restore();this._setDirty()}};
Bitmap.prototype.measureTextWidth=function(a){var b=this._context;b.save();b.font=this._makeFontNameText();a=b.measureText(a).width;b.restore();return a};Bitmap.prototype.adjustTone=function(a,b,c){if((a||b||c)&&0<this.width&&0<this.height){for(var d=this._context,e=d.getImageData(0,0,this.width,this.height),f=e.data,g=0;g<f.length;g+=4)f[g+0]+=a,f[g+1]+=b,f[g+2]+=c;d.putImageData(e,0,0);this._setDirty()}};
Bitmap.prototype.rotateHue=function(a){function b(k,l,m){var n=Math.min(k,l,m),q=Math.max(k,l,m),p=0,u=0,t=(n+q)/2;n=q-n;0<n&&(p=k===q?((l-m)/n+6)%6*60:l===q?60*((m-k)/n+2):60*((k-l)/n+4),u=n/(255-Math.abs(2*t-255)));return[p,u,t]}function c(k,l,m){l*=255-Math.abs(2*m-255);m-=l/2;var n=l+m;l=l*(1-Math.abs(k/60%2-1))+m;return 60>k?[n,l,m]:120>k?[l,n,m]:180>k?[m,n,l]:240>k?[m,l,n]:300>k?[l,m,n]:[n,m,l]}if(a&&0<this.width&&0<this.height){a=(a%360+360)%360;for(var d=this._context,e=d.getImageData(0,0,
this.width,this.height),f=e.data,g=0;g<f.length;g+=4){var h=b(f[g+0],f[g+1],f[g+2]);h=c((h[0]+a)%360,h[1],h[2]);f[g+0]=h[0];f[g+1]=h[1];f[g+2]=h[2]}d.putImageData(e,0,0);this._setDirty()}};
Bitmap.prototype.blur=function(){for(var a=0;2>a;a++){var b=this.width,c=this.height,d=this._canvas,e=this._context,f=document.createElement("canvas"),g=f.getContext("2d");f.width=b+2;f.height=c+2;g.drawImage(d,0,0,b,c,1,1,b,c);g.drawImage(d,0,0,b,1,1,0,b,1);g.drawImage(d,0,0,1,c,0,1,1,c);g.drawImage(d,0,c-1,b,1,1,c+1,b,1);g.drawImage(d,b-1,0,1,c,b+1,1,1,c);e.save();e.fillStyle="black";e.fillRect(0,0,b,c);e.globalCompositeOperation="lighter";e.globalAlpha=1/9;for(d=0;3>d;d++)for(g=0;3>g;g++)e.drawImage(f,
g,d,b,c,0,0,b,c);e.restore()}this._setDirty()};Bitmap.prototype.addLoadListener=function(a){this.isReady()?a(this):this._loadListeners.push(a)};Bitmap.prototype._makeFontNameText=function(){return(this.fontItalic?"Italic ":"")+this.fontSize+"px "+this.fontFace};Bitmap.prototype._drawTextOutline=function(a,b,c,d){var e=this._context;e.strokeStyle=this.outlineColor;e.lineWidth=this.outlineWidth;e.lineJoin="round";e.strokeText(a,b,c,d)};
Bitmap.prototype._drawTextBody=function(a,b,c,d){var e=this._context;e.fillStyle=this.textColor;e.fillText(a,b,c,d)};
Bitmap.prototype._onLoad=function(){this._image.removeEventListener("load",this._loadListener);this._image.removeEventListener("error",this._errorListener);this._renewCanvas();switch(this._loadingState){case "requesting":this._loadingState="requestCompleted";this._decodeAfterRequest?this.decode():(this._loadingState="purged",this._clearImgInstance());break;case "decrypting":window.URL.revokeObjectURL(this._image.src),this._loadingState="decryptCompleted",this._decodeAfterRequest?this.decode():(this._loadingState=
"purged",this._clearImgInstance())}};
Bitmap.prototype.decode=function(){switch(this._loadingState){case "requestCompleted":case "decryptCompleted":this._loadingState="loaded";this.__canvas||this._createBaseTexture(this._image);this._setDirty();this._callLoadListeners();break;case "requesting":case "decrypting":this._decodeAfterRequest=!0;this._loader||(this._loader=ResourceHandler.createLoader(this._url,this._requestImage.bind(this,this._url),this._onError.bind(this)),this._image.removeEventListener("error",this._errorListener),this._image.addEventListener("error",
this._errorListener=this._loader));break;case "pending":case "purged":case "error":this._decodeAfterRequest=!0,this._requestImage(this._url)}};Bitmap.prototype._callLoadListeners=function(){for(;0<this._loadListeners.length;)this._loadListeners.shift()(this)};Bitmap.prototype._onError=function(){this._image.removeEventListener("load",this._loadListener);this._image.removeEventListener("error",this._errorListener);this._loadingState="error"};Bitmap.prototype._setDirty=function(){this._dirty=!0};
Bitmap.prototype.checkDirty=function(){this._dirty&&(this._baseTexture.update(),this._dirty=!1)};Bitmap.request=function(a){var b=Object.create(Bitmap.prototype);b._defer=!0;b.initialize();b._url=a;b._loadingState="pending";return b};
Bitmap.prototype._requestImage=function(a){this._image=0!==Bitmap._reuseImages.length?Bitmap._reuseImages.pop():new Image;this._decodeAfterRequest&&!this._loader&&(this._loader=ResourceHandler.createLoader(a,this._requestImage.bind(this,a),this._onError.bind(this)));this._image=new Image;this._url=a;this._loadingState="requesting";!Decrypter.checkImgIgnore(a)&&Decrypter.hasEncryptedImages?(this._loadingState="decrypting",Decrypter.decryptImg(a,this)):(this._image.src=a,this._image.addEventListener("load",
this._loadListener=Bitmap.prototype._onLoad.bind(this)),this._image.addEventListener("error",this._errorListener=this._loader||Bitmap.prototype._onError.bind(this)))};Bitmap.prototype.isRequestOnly=function(){return!(this._decodeAfterRequest||this.isReady())};Bitmap.prototype.isRequestReady=function(){return"pending"!==this._loadingState&&"requesting"!==this._loadingState&&"decrypting"!==this._loadingState};
Bitmap.prototype.startRequest=function(){"pending"===this._loadingState&&(this._decodeAfterRequest=!1,this._requestImage(this._url))};function Graphics(){throw Error("This is a static class");}Graphics._cssFontLoading=document.fonts&&document.fonts.ready;Graphics._fontLoaded=null;Graphics._videoVolume=1;
Graphics.initialize=function(a,b,c){this._width=a||800;this._height=b||600;this._rendererType=c||"auto";this._boxWidth=this._width;this._boxHeight=this._height;this._realScale=this._scale=1;this._errorShowed=!1;this._video=this._canvas=this._errorPrinter=null;this._videoLoading=this._videoUnlocked=!1;this._modeBox=this._fpsMeter=this._renderer=this._upperCanvas=null;this._skipCount=0;this._maxSkip=3;this._rendered=!1;this._loadingImage=null;this._loadingCount=0;this._fpsMeterToggled=!1;this._stretchEnabled=
this._defaultStretchMode();this._canUseSaturationBlend=this._canUseDifferenceBlend=!1;this._hiddenCanvas=null;this._testCanvasBlendModes();this._modifyExistingElements();this._updateRealScale();this._createAllElements();this._disableTextSelection();this._disableContextMenu();this._setupEventHandlers();this._setupCssFontLoading()};Graphics._setupCssFontLoading=function(){Graphics._cssFontLoading&&document.fonts.ready.then(function(a){Graphics._fontLoaded=a}).catch(function(a){SceneManager.onError(a)})};
Graphics.canUseCssFontLoading=function(){return!!this._cssFontLoading};Graphics.frameCount=0;Graphics.BLEND_NORMAL=0;Graphics.BLEND_ADD=1;Graphics.BLEND_MULTIPLY=2;Graphics.BLEND_SCREEN=3;Graphics.tickStart=function(){this._fpsMeter&&this._fpsMeter.tickStart()};Graphics.tickEnd=function(){this._fpsMeter&&this._rendered&&this._fpsMeter.tick()};
Graphics.render=function(a){if(0===this._skipCount){var b=Date.now();a&&(this._renderer.render(a),this._renderer.gl&&this._renderer.gl.flush&&this._renderer.gl.flush());a=Date.now();this._skipCount=Math.min(Math.floor((a-b)/15),this._maxSkip);this._rendered=!0}else this._skipCount--,this._rendered=!1;this.frameCount++};Graphics.isWebGL=function(){return this._renderer&&this._renderer.type===PIXI.RENDERER_TYPE.WEBGL};
Graphics.hasWebGL=function(){try{var a=document.createElement("canvas");return!(!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}};Graphics.canUseDifferenceBlend=function(){return this._canUseDifferenceBlend};Graphics.canUseSaturationBlend=function(){return this._canUseSaturationBlend};Graphics.setLoadingImage=function(a){this._loadingImage=new Image;this._loadingImage.src=a};Graphics.startLoading=function(){this._loadingCount=0};
Graphics.updateLoading=function(){this._loadingCount++;this._paintUpperCanvas();this._upperCanvas.style.opacity=1};Graphics.endLoading=function(){this._clearUpperCanvas();this._upperCanvas.style.opacity=0};
Graphics.printLoadingError=function(a){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML=this._makeErrorHtml("Loading Error","Failed to load: "+a),a=document.createElement("button"),a.innerHTML="Retry",a.style.fontSize="24px",a.style.color="#ffffff",a.style.backgroundColor="#000000",a.onmousedown=a.ontouchstart=function(b){ResourceHandler.retry();b.stopPropagation()},this._errorPrinter.appendChild(a),this._loadingCount=-Infinity)};
Graphics.eraseLoadingError=function(){this._errorPrinter&&!this._errorShowed&&(this._errorPrinter.innerHTML="",this.startLoading())};Graphics.printError=function(a,b){this._errorShowed=!0;this._errorPrinter&&(this._errorPrinter.innerHTML=this._makeErrorHtml(a,b));this._applyCanvasFilter();this._clearUpperCanvas()};Graphics.showFps=function(){this._fpsMeter&&(this._fpsMeter.show(),this._modeBox.style.opacity=1)};
Graphics.hideFps=function(){this._fpsMeter&&(this._fpsMeter.hide(),this._modeBox.style.opacity=0)};Graphics.loadFont=function(a,b){var c=document.createElement("style"),d=document.getElementsByTagName("head");b='@font-face { font-family: "'+a+'"; src: url("'+b+'"); }';c.type="text/css";d.item(0).appendChild(c);c.sheet.insertRule(b,0);this._createFontLoader(a)};
Graphics.isFontLoaded=function(a){if(Graphics._cssFontLoading)return Graphics._fontLoaded?Graphics._fontLoaded.check('10px "'+a+'"'):!1;this._hiddenCanvas||(this._hiddenCanvas=document.createElement("canvas"));var b=this._hiddenCanvas.getContext("2d");b.font="40px "+a+", sans-serif";a=b.measureText("abcdefghijklmnopqrstuvwxyz").width;b.font="40px sans-serif";b=b.measureText("abcdefghijklmnopqrstuvwxyz").width;return a!==b};
Graphics.playVideo=function(a){this._videoLoader=ResourceHandler.createLoader(null,this._playVideo.bind(this,a),this._onVideoError.bind(this));this._playVideo(a)};Graphics._playVideo=function(a){this._video.src=a;this._video.onloadeddata=this._onVideoLoad.bind(this);this._video.onerror=this._videoLoader;this._video.onended=this._onVideoEnd.bind(this);this._video.load();this._videoLoading=!0};Graphics.isVideoPlaying=function(){return this._videoLoading||this._isVideoVisible()};
Graphics.canPlayVideoType=function(a){return this._video&&this._video.canPlayType(a)};Graphics.setVideoVolume=function(a){this._videoVolume=a;this._video&&(this._video.volume=this._videoVolume)};Graphics.pageToCanvasX=function(a){return this._canvas?Math.round((a-this._canvas.offsetLeft)/this._realScale):0};Graphics.pageToCanvasY=function(a){return this._canvas?Math.round((a-this._canvas.offsetTop)/this._realScale):0};Graphics.isInsideCanvas=function(a,b){return 0<=a&&a<this._width&&0<=b&&b<this._height};
Graphics.callGC=function(){Graphics.isWebGL()&&Graphics._renderer.textureGC.run()};Object.defineProperty(Graphics,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._updateAllElements())},configurable:!0});Object.defineProperty(Graphics,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._updateAllElements())},configurable:!0});
Object.defineProperty(Graphics,"boxWidth",{get:function(){return this._boxWidth},set:function(a){this._boxWidth=a},configurable:!0});Object.defineProperty(Graphics,"boxHeight",{get:function(){return this._boxHeight},set:function(a){this._boxHeight=a},configurable:!0});Object.defineProperty(Graphics,"scale",{get:function(){return this._scale},set:function(a){this._scale!==a&&(this._scale=a,this._updateAllElements())},configurable:!0});
Graphics._createAllElements=function(){this._createErrorPrinter();this._createCanvas();this._createVideo();this._createUpperCanvas();this._createRenderer();this._createFPSMeter();this._createModeBox();this._createGameFontLoader()};Graphics._updateAllElements=function(){this._updateRealScale();this._updateErrorPrinter();this._updateCanvas();this._updateVideo();this._updateUpperCanvas();this._updateRenderer();this._paintUpperCanvas()};
Graphics._updateRealScale=function(){if(this._stretchEnabled){var a=window.innerWidth/this._width,b=window.innerHeight/this._height;1<=a&&1>=a-.01&&(a=1);1<=b&&1>=b-.01&&(b=1);this._realScale=Math.min(a,b)}else this._realScale=this._scale};Graphics._makeErrorHtml=function(a,b){return'<font color="yellow"><b>'+a+'</b></font><br><font color="white">'+b+"</font><br>"};Graphics._defaultStretchMode=function(){return Utils.isNwjs()||Utils.isMobileDevice()};
Graphics._testCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1;a.height=1;var b=a.getContext("2d");b.globalCompositeOperation="source-over";b.fillStyle="white";b.fillRect(0,0,1,1);b.globalCompositeOperation="difference";b.fillStyle="white";b.fillRect(0,0,1,1);a=b.getImageData(0,0,1,1);b.globalCompositeOperation="source-over";b.fillStyle="black";b.fillRect(0,0,1,1);b.globalCompositeOperation="saturation";b.fillStyle="white";b.fillRect(0,0,1,1);b=b.getImageData(0,0,1,1);
this._canUseDifferenceBlend=0===a.data[0];this._canUseSaturationBlend=0===b.data[0]};Graphics._modifyExistingElements=function(){for(var a=document.getElementsByTagName("*"),b=0;b<a.length;b++)0<a[b].style.zIndex&&(a[b].style.zIndex=0)};Graphics._createErrorPrinter=function(){this._errorPrinter=document.createElement("p");this._errorPrinter.id="ErrorPrinter";this._updateErrorPrinter();document.body.appendChild(this._errorPrinter)};
Graphics._updateErrorPrinter=function(){this._errorPrinter.width=.9*this._width;this._errorPrinter.height=40;this._errorPrinter.style.textAlign="center";this._errorPrinter.style.textShadow="1px 1px 3px #000";this._errorPrinter.style.fontSize="20px";this._errorPrinter.style.zIndex=99;this._centerElement(this._errorPrinter)};Graphics._createCanvas=function(){this._canvas=document.createElement("canvas");this._canvas.id="GameCanvas";this._updateCanvas();document.body.appendChild(this._canvas)};
Graphics._updateCanvas=function(){this._canvas.width=this._width;this._canvas.height=this._height;this._canvas.style.zIndex=1;this._centerElement(this._canvas)};Graphics._createVideo=function(){this._video=document.createElement("video");this._video.id="GameVideo";this._video.style.opacity=0;this._video.setAttribute("playsinline","");this._video.volume=this._videoVolume;this._updateVideo();makeVideoPlayableInline(this._video);document.body.appendChild(this._video)};
Graphics._updateVideo=function(){this._video.width=this._width;this._video.height=this._height;this._video.style.zIndex=2;this._centerElement(this._video)};Graphics._createUpperCanvas=function(){this._upperCanvas=document.createElement("canvas");this._upperCanvas.id="UpperCanvas";this._updateUpperCanvas();document.body.appendChild(this._upperCanvas)};Graphics._updateUpperCanvas=function(){this._upperCanvas.width=this._width;this._upperCanvas.height=this._height;this._upperCanvas.style.zIndex=3;this._centerElement(this._upperCanvas)};
Graphics._clearUpperCanvas=function(){this._upperCanvas.getContext("2d").clearRect(0,0,this._width,this._height)};Graphics._paintUpperCanvas=function(){this._clearUpperCanvas();if(this._loadingImage&&20<=this._loadingCount){var a=this._upperCanvas.getContext("2d"),b=(this._width-this._loadingImage.width)/2,c=(this._height-this._loadingImage.height)/2,d=((this._loadingCount-20)/30).clamp(0,1);a.save();a.globalAlpha=d;a.drawImage(this._loadingImage,b,c);a.restore()}};
Graphics._createRenderer=function(){PIXI.dontSayHello=!0;var a=this._width,b=this._height,c={view:this._canvas};try{switch(this._rendererType){case "canvas":this._renderer=new PIXI.CanvasRenderer(a,b,c);break;case "webgl":this._renderer=new PIXI.WebGLRenderer(a,b,c);break;default:this._renderer=PIXI.autoDetectRenderer(a,b,c)}this._renderer&&this._renderer.textureGC&&(this._renderer.textureGC.maxIdle=1)}catch(d){this._renderer=null}};
Graphics._updateRenderer=function(){this._renderer&&this._renderer.resize(this._width,this._height)};Graphics._createFPSMeter=function(){this._fpsMeter=new FPSMeter({graph:1,decimals:0,theme:"transparent",toggleOn:null});this._fpsMeter.hide()};
Graphics._createModeBox=function(){var a=document.createElement("div");a.id="modeTextBack";a.style.position="absolute";a.style.left="5px";a.style.top="5px";a.style.width="119px";a.style.height="58px";a.style.background="rgba(0,0,0,0.2)";a.style.zIndex=9;a.style.opacity=0;var b=document.createElement("div");b.id="modeText";b.style.position="absolute";b.style.left="0px";b.style.top="41px";b.style.width="119px";b.style.fontSize="12px";b.style.fontFamily="monospace";b.style.color="white";b.style.textAlign=
"center";b.style.textShadow="1px 1px 0 rgba(0,0,0,0.5)";b.innerHTML=this.isWebGL()?"WebGL mode":"Canvas mode";document.body.appendChild(a);a.appendChild(b);this._modeBox=a};Graphics._createGameFontLoader=function(){this._createFontLoader("GameFont")};
Graphics._createFontLoader=function(a){var b=document.createElement("div"),c=document.createTextNode(".");b.style.fontFamily=a;b.style.fontSize="0px";b.style.color="transparent";b.style.position="absolute";b.style.margin="auto";b.style.top="0px";b.style.left="0px";b.style.width="1px";b.style.height="1px";b.appendChild(c);document.body.appendChild(b)};
Graphics._centerElement=function(a){var b=a.width*this._realScale,c=a.height*this._realScale;a.style.position="absolute";a.style.margin="auto";a.style.top=0;a.style.left=0;a.style.right=0;a.style.bottom=0;a.style.width=b+"px";a.style.height=c+"px"};Graphics._disableTextSelection=function(){var a=document.body;a.style.userSelect="none";a.style.webkitUserSelect="none";a.style.msUserSelect="none";a.style.mozUserSelect="none"};
Graphics._disableContextMenu=function(){for(var a=document.body.getElementsByTagName("*"),b=function(){return!1},c=0;c<a.length;c++)a[c].oncontextmenu=b};Graphics._applyCanvasFilter=function(){this._canvas&&(this._canvas.style.opacity=.5,this._canvas.style.filter="blur(8px)",this._canvas.style.webkitFilter="blur(8px)")};Graphics._onVideoLoad=function(){this._video.play();this._updateVisibility(!0);this._videoLoading=!1};
Graphics._onVideoError=function(){this._updateVisibility(!1);this._videoLoading=!1};Graphics._onVideoEnd=function(){this._updateVisibility(!1)};Graphics._updateVisibility=function(a){this._video.style.opacity=a?1:0;this._canvas.style.opacity=a?0:1};Graphics._isVideoVisible=function(){return 0<this._video.style.opacity};
Graphics._setupEventHandlers=function(){window.addEventListener("resize",this._onWindowResize.bind(this));document.addEventListener("keydown",this._onKeyDown.bind(this));document.addEventListener("keydown",this._onTouchEnd.bind(this));document.addEventListener("mousedown",this._onTouchEnd.bind(this));document.addEventListener("touchend",this._onTouchEnd.bind(this))};Graphics._onWindowResize=function(){this._updateAllElements()};
Graphics._onKeyDown=function(a){if(!a.ctrlKey&&!a.altKey)switch(a.keyCode){case 113:a.preventDefault();this._switchFPSMeter();break;case 114:a.preventDefault();this._switchStretchMode();break;case 115:a.preventDefault(),this._switchFullScreen()}};Graphics._onTouchEnd=function(a){this._videoUnlocked||(this._video.play(),this._videoUnlocked=!0);this._isVideoVisible()&&this._video.paused&&this._video.play()};
Graphics._switchFPSMeter=function(){this._fpsMeter.isPaused?(this.showFps(),this._fpsMeter.showFps(),this._fpsMeterToggled=!1):this._fpsMeterToggled?this.hideFps():(this._fpsMeter.showDuration(),this._fpsMeterToggled=!0)};Graphics._switchStretchMode=function(){this._stretchEnabled=!this._stretchEnabled;this._updateAllElements()};Graphics._switchFullScreen=function(){this._isFullScreen()?this._requestFullScreen():this._cancelFullScreen()};
Graphics._isFullScreen=function(){return document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitFullscreenElement&&!document.msFullscreenElement};Graphics._requestFullScreen=function(){var a=document.body;a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.msRequestFullscreen&&a.msRequestFullscreen()};
Graphics._cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};function Input(){throw Error("This is a static class");}Input.initialize=function(){this.clear();this._wrapNwjsAlert();this._setupEventHandlers()};Input.keyRepeatWait=24;Input.keyRepeatInterval=6;
Input.keyMapper={9:"tab",13:"ok",16:"shift",17:"control",18:"control",27:"escape",32:"ok",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",45:"escape",81:"pageup",87:"pagedown",88:"escape",90:"ok",96:"escape",98:"down",100:"left",102:"right",104:"up",120:"debug"};Input.gamepadMapper={0:"ok",1:"cancel",2:"shift",3:"menu",4:"pageup",5:"pagedown",12:"up",13:"down",14:"left",15:"right"};
Input.clear=function(){this._currentState={};this._previousState={};this._gamepadStates=[];this._latestButton=null;this._dir8=this._dir4=this._pressedTime=0;this._preferredAxis="";this._date=0};
Input.update=function(){this._pollGamepads();this._currentState[this._latestButton]?this._pressedTime++:this._latestButton=null;for(var a in this._currentState)this._currentState[a]&&!this._previousState[a]&&(this._latestButton=a,this._pressedTime=0,this._date=Date.now()),this._previousState[a]=this._currentState[a];this._updateDirection()};Input.isPressed=function(a){return this._isEscapeCompatible(a)&&this.isPressed("escape")?!0:!!this._currentState[a]};
Input.isTriggered=function(a){return this._isEscapeCompatible(a)&&this.isTriggered("escape")?!0:this._latestButton===a&&0===this._pressedTime};Input.isRepeated=function(a){return this._isEscapeCompatible(a)&&this.isRepeated("escape")?!0:this._latestButton===a&&(0===this._pressedTime||this._pressedTime>=this.keyRepeatWait&&0===this._pressedTime%this.keyRepeatInterval)};
Input.isLongPressed=function(a){return this._isEscapeCompatible(a)&&this.isLongPressed("escape")?!0:this._latestButton===a&&this._pressedTime>=this.keyRepeatWait};Object.defineProperty(Input,"dir4",{get:function(){return this._dir4},configurable:!0});Object.defineProperty(Input,"dir8",{get:function(){return this._dir8},configurable:!0});Object.defineProperty(Input,"date",{get:function(){return this._date},configurable:!0});
Input._wrapNwjsAlert=function(){if(Utils.isNwjs()){var a=window.alert;window.alert=function(){var b=require("nw.gui").Window.get();a.apply(this,arguments);b.focus();Input.clear()}}};Input._setupEventHandlers=function(){document.addEventListener("keydown",this._onKeyDown.bind(this));document.addEventListener("keyup",this._onKeyUp.bind(this));window.addEventListener("blur",this._onLostFocus.bind(this))};
Input._onKeyDown=function(a){this._shouldPreventDefault(a.keyCode)&&a.preventDefault();144===a.keyCode&&this.clear();a=this.keyMapper[a.keyCode];ResourceHandler.exists()&&"ok"===a?ResourceHandler.retry():a&&(this._currentState[a]=!0)};Input._shouldPreventDefault=function(a){switch(a){case 8:case 33:case 34:case 37:case 38:case 39:case 40:return!0}return!1};Input._onKeyUp=function(a){var b=this.keyMapper[a.keyCode];b&&(this._currentState[b]=!1);0===a.keyCode&&this.clear()};Input._onLostFocus=function(){this.clear()};
Input._pollGamepads=function(){if(navigator.getGamepads){var a=navigator.getGamepads();if(a)for(var b=0;b<a.length;b++){var c=a[b];c&&c.connected&&this._updateGamepadState(c)}}};
Input._updateGamepadState=function(a){var b=this._gamepadStates[a.index]||[],c=[],d=a.buttons,e=a.axes;c[12]=!1;c[13]=!1;c[14]=!1;c[15]=!1;for(var f=0;f<d.length;f++)c[f]=d[f].pressed;-.5>e[1]?c[12]=!0:.5<e[1]&&(c[13]=!0);-.5>e[0]?c[14]=!0:.5<e[0]&&(c[15]=!0);for(d=0;d<c.length;d++)c[d]!==b[d]&&(e=this.gamepadMapper[d])&&(this._currentState[e]=c[d]);this._gamepadStates[a.index]=c};
Input._updateDirection=function(){var a=this._signX(),b=this._signY();this._dir8=this._makeNumpadDirection(a,b);0!==a&&0!==b?"x"===this._preferredAxis?b=0:a=0:0!==a?this._preferredAxis="y":0!==b&&(this._preferredAxis="x");this._dir4=this._makeNumpadDirection(a,b)};Input._signX=function(){var a=0;this.isPressed("left")&&a--;this.isPressed("right")&&a++;return a};Input._signY=function(){var a=0;this.isPressed("up")&&a--;this.isPressed("down")&&a++;return a};
Input._makeNumpadDirection=function(a,b){return 0!==a||0!==b?5-3*b+a:0};Input._isEscapeCompatible=function(a){return"cancel"===a||"menu"===a};function TouchInput(){throw Error("This is a static class");}TouchInput.initialize=function(){this.clear();this._setupEventHandlers()};TouchInput.keyRepeatWait=24;TouchInput.keyRepeatInterval=6;
TouchInput.clear=function(){this._screenPressed=this._mousePressed=!1;this._pressedTime=0;this._events={};this._events.triggered=!1;this._events.cancelled=!1;this._events.moved=!1;this._events.released=!1;this._events.wheelX=0;this._events.wheelY=0;this._released=this._moved=this._cancelled=this._triggered=!1;this._date=this._y=this._x=this._wheelY=this._wheelX=0};
TouchInput.update=function(){this._triggered=this._events.triggered;this._cancelled=this._events.cancelled;this._moved=this._events.moved;this._released=this._events.released;this._wheelX=this._events.wheelX;this._wheelY=this._events.wheelY;this._events.triggered=!1;this._events.cancelled=!1;this._events.moved=!1;this._events.released=!1;this._events.wheelX=0;this._events.wheelY=0;this.isPressed()&&this._pressedTime++};TouchInput.isPressed=function(){return this._mousePressed||this._screenPressed};
TouchInput.isTriggered=function(){return this._triggered};TouchInput.isRepeated=function(){return this.isPressed()&&(this._triggered||this._pressedTime>=this.keyRepeatWait&&0===this._pressedTime%this.keyRepeatInterval)};TouchInput.isLongPressed=function(){return this.isPressed()&&this._pressedTime>=this.keyRepeatWait};TouchInput.isCancelled=function(){return this._cancelled};TouchInput.isMoved=function(){return this._moved};TouchInput.isReleased=function(){return this._released};
Object.defineProperty(TouchInput,"wheelX",{get:function(){return this._wheelX},configurable:!0});Object.defineProperty(TouchInput,"wheelY",{get:function(){return this._wheelY},configurable:!0});Object.defineProperty(TouchInput,"x",{get:function(){return this._x},configurable:!0});Object.defineProperty(TouchInput,"y",{get:function(){return this._y},configurable:!0});Object.defineProperty(TouchInput,"date",{get:function(){return this._date},configurable:!0});
TouchInput._setupEventHandlers=function(){var a=Utils.isSupportPassiveEvent();document.addEventListener("mousedown",this._onMouseDown.bind(this));document.addEventListener("mousemove",this._onMouseMove.bind(this));document.addEventListener("mouseup",this._onMouseUp.bind(this));document.addEventListener("wheel",this._onWheel.bind(this));document.addEventListener("touchstart",this._onTouchStart.bind(this),a?{passive:!1}:!1);document.addEventListener("touchmove",this._onTouchMove.bind(this),a?{passive:!1}:
!1);document.addEventListener("touchend",this._onTouchEnd.bind(this));document.addEventListener("touchcancel",this._onTouchCancel.bind(this));document.addEventListener("pointerdown",this._onPointerDown.bind(this))};TouchInput._onMouseDown=function(a){0===a.button?this._onLeftButtonDown(a):1===a.button?this._onMiddleButtonDown(a):2===a.button&&this._onRightButtonDown(a)};
TouchInput._onLeftButtonDown=function(a){var b=Graphics.pageToCanvasX(a.pageX);a=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,a)&&(this._mousePressed=!0,this._pressedTime=0,this._onTrigger(b,a))};TouchInput._onMiddleButtonDown=function(a){};TouchInput._onRightButtonDown=function(a){var b=Graphics.pageToCanvasX(a.pageX);a=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,a)&&this._onCancel(b,a)};
TouchInput._onMouseMove=function(a){if(this._mousePressed){var b=Graphics.pageToCanvasX(a.pageX);a=Graphics.pageToCanvasY(a.pageY);this._onMove(b,a)}};TouchInput._onMouseUp=function(a){if(0===a.button){var b=Graphics.pageToCanvasX(a.pageX);a=Graphics.pageToCanvasY(a.pageY);this._mousePressed=!1;this._onRelease(b,a)}};TouchInput._onWheel=function(a){this._events.wheelX+=a.deltaX;this._events.wheelY+=a.deltaY;a.preventDefault()};
TouchInput._onTouchStart=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX);c=Graphics.pageToCanvasY(c.pageY);Graphics.isInsideCanvas(d,c)&&(this._screenPressed=!0,this._pressedTime=0,2<=a.touches.length?this._onCancel(d,c):this._onTrigger(d,c),a.preventDefault())}(window.cordova||window.navigator.standalone)&&a.preventDefault()};
TouchInput._onTouchMove=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX);c=Graphics.pageToCanvasY(c.pageY);this._onMove(d,c)}};TouchInput._onTouchEnd=function(a){for(var b=0;b<a.changedTouches.length;b++){var c=a.changedTouches[b],d=Graphics.pageToCanvasX(c.pageX);c=Graphics.pageToCanvasY(c.pageY);this._screenPressed=!1;this._onRelease(d,c)}};TouchInput._onTouchCancel=function(a){this._screenPressed=!1};
TouchInput._onPointerDown=function(a){if("touch"===a.pointerType&&!a.isPrimary){var b=Graphics.pageToCanvasX(a.pageX),c=Graphics.pageToCanvasY(a.pageY);Graphics.isInsideCanvas(b,c)&&(this._onCancel(b,c),a.preventDefault())}};TouchInput._onTrigger=function(a,b){this._events.triggered=!0;this._x=a;this._y=b;this._date=Date.now()};TouchInput._onCancel=function(a,b){this._events.cancelled=!0;this._x=a;this._y=b};TouchInput._onMove=function(a,b){this._events.moved=!0;this._x=a;this._y=b};
TouchInput._onRelease=function(a,b){this._events.released=!0;this._x=a;this._y=b};function Sprite(){this.initialize.apply(this,arguments)}Sprite.prototype=Object.create(PIXI.Sprite.prototype);Sprite.prototype.constructor=Sprite;Sprite.voidFilter=new PIXI.filters.VoidFilter;
Sprite.prototype.initialize=function(a){var b=new PIXI.Texture(new PIXI.BaseTexture);PIXI.Sprite.call(this,b);this._bitmap=null;this._frame=new Rectangle;this._realFrame=new Rectangle;this._blendColor=[0,0,0,0];this._colorTone=[0,0,0,0];this._tintTexture=this._context=this._canvas=null;this._isPicture=!1;this.spriteId=Sprite._counter++;this.opaque=!1;this.bitmap=a};Sprite._counter=0;
Object.defineProperty(Sprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(a){this._bitmap!==a&&((this._bitmap=a)?(this._refreshFrame=!0,a.addLoadListener(this._onBitmapLoad.bind(this))):(this._refreshFrame=!1,this.texture.frame=Rectangle.emptyRectangle))},configurable:!0});Object.defineProperty(Sprite.prototype,"width",{get:function(){return this._frame.width},set:function(a){this._frame.width=a;this._refresh()},configurable:!0});
Object.defineProperty(Sprite.prototype,"height",{get:function(){return this._frame.height},set:function(a){this._frame.height=a;this._refresh()},configurable:!0});Object.defineProperty(Sprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0});Sprite.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})};Sprite.prototype.move=function(a,b){this.x=a;this.y=b};
Sprite.prototype.setFrame=function(a,b,c,d){this._refreshFrame=!1;var e=this._frame;if(a!==e.x||b!==e.y||c!==e.width||d!==e.height)e.x=a,e.y=b,e.width=c,e.height=d,this._refresh()};Sprite.prototype.getBlendColor=function(){return this._blendColor.clone()};Sprite.prototype.setBlendColor=function(a){if(!(a instanceof Array))throw Error("Argument must be an array");this._blendColor.equals(a)||(this._blendColor=a.clone(),this._refresh())};Sprite.prototype.getColorTone=function(){return this._colorTone.clone()};
Sprite.prototype.setColorTone=function(a){if(!(a instanceof Array))throw Error("Argument must be an array");this._colorTone.equals(a)||(this._colorTone=a.clone(),this._refresh())};Sprite.prototype._onBitmapLoad=function(a){a===this._bitmap&&this._refreshFrame&&this._bitmap&&(this._refreshFrame=!1,this._frame.width=this._bitmap.width,this._frame.height=this._bitmap.height);this._refresh()};
Sprite.prototype._refresh=function(){var a=Math.floor(this._frame.x),b=Math.floor(this._frame.y),c=Math.floor(this._frame.width),d=Math.floor(this._frame.height),e=this._bitmap?this._bitmap.width:0,f=this._bitmap?this._bitmap.height:0,g=a.clamp(0,e),h=b.clamp(0,f);c=(c-g+a).clamp(0,e-g);d=(d-h+b).clamp(0,f-h);this._realFrame.x=g;this._realFrame.y=h;this._realFrame.width=c;this._realFrame.height=d;this.pivot.x=a-g;this.pivot.y=b-h;0<c&&0<d?this._needsTint()?(this._createTinter(c,d),this._executeTint(g,
h,c,d),this._tintTexture.update(),this.texture.baseTexture=this._tintTexture,this.texture.frame=new Rectangle(0,0,c,d)):(this._bitmap&&(this.texture.baseTexture=this._bitmap.baseTexture),this.texture.frame=this._realFrame):this._bitmap?this.texture.frame=Rectangle.emptyRectangle:(this.texture.baseTexture.width=Math.max(this.texture.baseTexture.width,this._frame.x+this._frame.width),this.texture.baseTexture.height=Math.max(this.texture.baseTexture.height,this._frame.y+this._frame.height),this.texture.frame=
this._frame);this.texture._updateID++};Sprite.prototype._isInBitmapRect=function(a,b,c,d){return this._bitmap&&0<a+c&&0<b+d&&a<this._bitmap.width&&b<this._bitmap.height};Sprite.prototype._needsTint=function(){var a=this._colorTone;return a[0]||a[1]||a[2]||a[3]||0<this._blendColor[3]};
Sprite.prototype._createTinter=function(a,b){this._canvas||(this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"));this._canvas.width=a;this._canvas.height=b;this._tintTexture||(this._tintTexture=new PIXI.BaseTexture(this._canvas));this._tintTexture.width=a;this._tintTexture.height=b;this._tintTexture.scaleMode=this._bitmap.baseTexture.scaleMode};
Sprite.prototype._executeTint=function(a,b,c,d){var e=this._context,f=this._colorTone,g=this._blendColor;e.globalCompositeOperation="copy";e.drawImage(this._bitmap.canvas,a,b,c,d,0,0,c,d);if(Graphics.canUseSaturationBlend()){var h=Math.max(0,f[3]);e.globalCompositeOperation="saturation";e.fillStyle="rgba(255,255,255,"+h/255+")";e.fillRect(0,0,c,d)}h=Math.max(0,f[0]);var k=Math.max(0,f[1]),l=Math.max(0,f[2]);e.globalCompositeOperation="lighter";e.fillStyle=Utils.rgbToCssColor(h,k,l);e.fillRect(0,0,
c,d);Graphics.canUseDifferenceBlend()&&(e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,c,d),h=Math.max(0,-f[0]),k=Math.max(0,-f[1]),f=Math.max(0,-f[2]),e.globalCompositeOperation="lighter",e.fillStyle=Utils.rgbToCssColor(h,k,f),e.fillRect(0,0,c,d),e.globalCompositeOperation="difference",e.fillStyle="white",e.fillRect(0,0,c,d));f=Math.max(0,g[0]);h=Math.max(0,g[1]);k=Math.max(0,g[2]);g=Math.max(0,g[3]);e.globalCompositeOperation="source-atop";e.fillStyle=Utils.rgbToCssColor(f,
h,k);e.globalAlpha=g/255;e.fillRect(0,0,c,d);e.globalCompositeOperation="destination-in";e.globalAlpha=1;e.drawImage(this._bitmap.canvas,a,b,c,d,0,0,c,d)};Sprite.prototype._renderCanvas_PIXI=PIXI.Sprite.prototype._renderCanvas;Sprite.prototype._renderWebGL_PIXI=PIXI.Sprite.prototype._renderWebGL;Sprite.prototype._renderCanvas=function(a){this.bitmap&&this.bitmap.touch();(!this.bitmap||this.bitmap.isReady())&&0<this.texture.frame.width&&0<this.texture.frame.height&&this._renderCanvas_PIXI(a)};
Sprite.prototype._speedUpCustomBlendModes=function(a){var b=a.plugins.picture,c=this.blendMode;if(a.renderingToScreen&&a._activeRenderTarget.root&&b.drawModes[c]){var d=a._lastObjectRendered;(a=d._filters)&&a[0]||setTimeout(function(){var e=d._filters;e&&e[0]||(d.filters=[Sprite.voidFilter],d.filterArea=new PIXI.Rectangle(0,0,Graphics.width,Graphics.height))},0)}};
Sprite.prototype._renderWebGL=function(a){this.bitmap&&this.bitmap.touch();(!this.bitmap||this.bitmap.isReady())&&0<this.texture.frame.width&&0<this.texture.frame.height&&(this._bitmap&&this._bitmap.checkDirty(),this.calculateVertices(),"sprite"===this.pluginName&&this._isPicture?(this._speedUpCustomBlendModes(a),a.setObjectRenderer(a.plugins.picture),a.plugins.picture.render(this)):(a.setObjectRenderer(a.plugins[this.pluginName]),a.plugins[this.pluginName].render(this)))};
function Tilemap(){this.initialize.apply(this,arguments)}Tilemap.prototype=Object.create(PIXI.Container.prototype);Tilemap.prototype.constructor=Tilemap;
Tilemap.prototype.initialize=function(){PIXI.Container.call(this);this._margin=20;this._width=Graphics.width+2*this._margin;this._height=Graphics.height+2*this._margin;this._tileHeight=this._tileWidth=48;this._mapHeight=this._mapWidth=0;this._mapData=null;this._layerHeight=this._layerWidth=0;this._lastTiles=[];this.bitmaps=[];this.origin=new Point;this.flags=[];this.animationCount=0;this.verticalWrap=this.horizontalWrap=!1;this._createLayers();this.refresh()};
Object.defineProperty(Tilemap.prototype,"width",{get:function(){return this._width},set:function(a){this._width!==a&&(this._width=a,this._createLayers())}});Object.defineProperty(Tilemap.prototype,"height",{get:function(){return this._height},set:function(a){this._height!==a&&(this._height=a,this._createLayers())}});Object.defineProperty(Tilemap.prototype,"tileWidth",{get:function(){return this._tileWidth},set:function(a){this._tileWidth!==a&&(this._tileWidth=a,this._createLayers())}});
Object.defineProperty(Tilemap.prototype,"tileHeight",{get:function(){return this._tileHeight},set:function(a){this._tileHeight!==a&&(this._tileHeight=a,this._createLayers())}});Tilemap.prototype.setData=function(a,b,c){this._mapWidth=a;this._mapHeight=b;this._mapData=c};Tilemap.prototype.isReady=function(){for(var a=0;a<this.bitmaps.length;a++)if(this.bitmaps[a]&&!this.bitmaps[a].isReady())return!1;return!0};
Tilemap.prototype.update=function(){this.animationCount++;this.animationFrame=Math.floor(this.animationCount/30);this.children.forEach(function(b){b.update&&b.update()});for(var a=0;a<this.bitmaps.length;a++)this.bitmaps[a]&&this.bitmaps[a].touch()};Tilemap.prototype.refresh=function(){this._lastTiles.length=0};Tilemap.prototype.refreshTileset=function(){};
Tilemap.prototype.updateTransform=function(){var a=Math.floor((Math.floor(this.origin.x)-this._margin)/this._tileWidth),b=Math.floor((Math.floor(this.origin.y)-this._margin)/this._tileHeight);this._updateLayerPositions(a,b);if(this._needsRepaint||this._lastAnimationFrame!==this.animationFrame||this._lastStartX!==a||this._lastStartY!==b)this._frameUpdated=this._lastAnimationFrame!==this.animationFrame,this._lastAnimationFrame=this.animationFrame,this._lastStartX=a,this._lastStartY=b,this._paintAllTiles(a,
b),this._needsRepaint=!1;this._sortChildren();PIXI.Container.prototype.updateTransform.call(this)};
Tilemap.prototype._createLayers=function(){var a=this._width,b=this._height,c=this._margin,d=(Math.ceil(a/this._tileWidth)+1)*this._tileWidth,e=(Math.ceil(b/this._tileHeight)+1)*this._tileHeight;this._lowerBitmap=new Bitmap(d,e);this._upperBitmap=new Bitmap(d,e);this._layerWidth=d;this._layerHeight=e;this._lowerLayer=new Sprite;this._lowerLayer.move(-c,-c,a,b);this._lowerLayer.z=0;this._upperLayer=new Sprite;this._upperLayer.move(-c,-c,a,b);this._upperLayer.z=4;for(a=0;4>a;a++)this._lowerLayer.addChild(new Sprite(this._lowerBitmap)),
this._upperLayer.addChild(new Sprite(this._upperBitmap));this.addChild(this._lowerLayer);this.addChild(this._upperLayer)};
Tilemap.prototype._updateLayerPositions=function(a,b){b=this._margin;var c=Math.floor(this.origin.y);a=(Math.floor(this.origin.x)-b).mod(this._layerWidth);b=(c-b).mod(this._layerHeight);c=this._layerWidth-a;for(var d=this._layerHeight-b,e=this._width-c,f=this._height-d,g=0;2>g;g++){var h=0===g?this._lowerLayer.children:this._upperLayer.children;h[0].move(0,0,c,d);h[0].setFrame(a,b,c,d);h[1].move(c,0,e,d);h[1].setFrame(0,b,e,d);h[2].move(0,d,c,f);h[2].setFrame(a,0,c,f);h[3].move(c,d,e,f);h[3].setFrame(0,
0,e,f)}};Tilemap.prototype._paintAllTiles=function(a,b){for(var c=Math.ceil(this._width/this._tileWidth)+1,d=Math.ceil(this._height/this._tileHeight)+1,e=0;e<d;e++)for(var f=0;f<c;f++)this._paintTiles(a,b,f,e)};
Tilemap.prototype._paintTiles=function(a,b,c,d){var e=a+c,f=b+d;b=(e*this._tileWidth).mod(this._layerWidth);d=(f*this._tileHeight).mod(this._layerHeight);a=b/this._tileWidth;c=d/this._tileHeight;var g=this._readMapData(e,f,0),h=this._readMapData(e,f,1),k=this._readMapData(e,f,2),l=this._readMapData(e,f,3),m=this._readMapData(e,f,4),n=this._readMapData(e,f-1,1),q=[],p=[];this._isHigherTile(g)?p.push(g):q.push(g);this._isHigherTile(h)?p.push(h):q.push(h);q.push(-m);this._isTableTile(n)&&!this._isTableTile(h)&&
(Tilemap.isShadowingTile(g)||q.push(1E4+n));this._isOverpassPosition(e,f)?(p.push(k),p.push(l)):(this._isHigherTile(k)?p.push(k):q.push(k),this._isHigherTile(l)?p.push(l):q.push(l));e=this._readLastTiles(0,a,c);if(!q.equals(e)||Tilemap.isTileA1(g)&&this._frameUpdated){this._lowerBitmap.clearRect(b,d,this._tileWidth,this._tileHeight);for(e=0;e<q.length;e++)g=q[e],0>g?this._drawShadow(this._lowerBitmap,m,b,d):1E4<=g?this._drawTableEdge(this._lowerBitmap,n,b,d):this._drawTile(this._lowerBitmap,g,b,d);
this._writeLastTiles(0,a,c,q)}m=this._readLastTiles(1,a,c);if(!p.equals(m)){this._upperBitmap.clearRect(b,d,this._tileWidth,this._tileHeight);for(m=0;m<p.length;m++)this._drawTile(this._upperBitmap,p[m],b,d);this._writeLastTiles(1,a,c,p)}};Tilemap.prototype._readLastTiles=function(a,b,c){if(a=this._lastTiles[a])if(c=a[c])if(b=c[b])return b;return[]};Tilemap.prototype._writeLastTiles=function(a,b,c,d){var e=this._lastTiles[a];e||=this._lastTiles[a]=[];(a=e[c])||(a=e[c]=[]);a[b]=d};
Tilemap.prototype._drawTile=function(a,b,c,d){Tilemap.isVisibleTile(b)&&(Tilemap.isAutotile(b)?this._drawAutotile(a,b,c,d):this._drawNormalTile(a,b,c,d))};Tilemap.prototype._drawNormalTile=function(a,b,c,d){var e=Tilemap.isTileA5(b)?4:5+Math.floor(b/256);var f=this._tileWidth,g=this._tileHeight,h=(Math.floor(b/128)%2*8+b%8)*f;b=Math.floor(b%256/8)%16*g;(e=this.bitmaps[e])&&a.bltImage(e,h,b,f,g,c,d,f,g)};
Tilemap.prototype._drawAutotile=function(a,b,c,d){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b),h=f%8,k=Math.floor(f/8),l=0,m=0,n=0,q=!1;Tilemap.isTileA1(b)?(b=[0,1,2,1][this.animationFrame%4],n=0,0===f?(l=2*b,m=0):1===f?(l=2*b,m=3):2===f?(l=6,m=0):3===f?(l=6,m=3):(l=8*Math.floor(h/4),m=6*k+Math.floor(h/2)%2*3,0===f%2?l+=2*b:(l+=6,e=Tilemap.WATERFALL_AUTOTILE_TABLE,m+=this.animationFrame%3))):Tilemap.isTileA2(b)?(n=1,l=2*h,m=3*(k-2),q=this._isTableTile(b)):
Tilemap.isTileA3(b)?(n=2,l=2*h,m=2*(k-6),e=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(b)&&(n=3,l=2*h,m=Math.floor(2.5*(k-10)+(1===k%2?.5:0)),1===k%2&&(e=Tilemap.WALL_AUTOTILE_TABLE));e=e[g];n=this.bitmaps[n];if(e&&n)for(f=this._tileWidth/2,g=this._tileHeight/2,h=0;4>h;h++){k=e[h][0];b=e[h][1];var p=(2*l+k)*f,u=(2*m+b)*g,t=c+h%2*f,v=d+Math.floor(h/2)*g;if(!q||1!==b&&5!==b)a.bltImage(n,p,u,f,g,t,v,f,g);else{var w=k;1===b&&(w=[0,3,2,1][k]);a.bltImage(n,(2*l+w)*f,(2*m+3)*g,f,g,t,v,f,g);v+=g/2;a.bltImage(n,
p,u,f,g/2,t,v,f,g/2)}}};Tilemap.prototype._drawTableEdge=function(a,b,c,d){if(Tilemap.isTileA2(b)){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b);b=f%8*2;f=3*(Math.floor(f/8)-2);if(e=e[g]){g=this.bitmaps[1];for(var h=this._tileWidth/2,k=this._tileHeight/2,l=0;2>l;l++)a.bltImage(g,(2*b+e[2+l][0])*h,(2*f+e[2+l][1])*k+k/2,h,k/2,c+l%2*h,d+Math.floor(l/2)*k,h,k/2)}}};
Tilemap.prototype._drawShadow=function(a,b,c,d){if(b&15)for(var e=this._tileWidth/2,f=this._tileHeight/2,g=0;4>g;g++)b&1<<g&&a.fillRect(c+g%2*e,d+Math.floor(g/2)*f,e,f,"rgba(0,0,0,0.5)")};Tilemap.prototype._readMapData=function(a,b,c){if(this._mapData){var d=this._mapWidth,e=this._mapHeight;this.horizontalWrap&&(a=a.mod(d));this.verticalWrap&&(b=b.mod(e));return 0<=a&&a<d&&0<=b&&b<e?this._mapData[(c*e+b)*d+a]||0:0}return 0};Tilemap.prototype._isHigherTile=function(a){return this.flags[a]&16};
Tilemap.prototype._isTableTile=function(a){return Tilemap.isTileA2(a)&&this.flags[a]&128};Tilemap.prototype._isOverpassPosition=function(a,b){return!1};Tilemap.prototype._sortChildren=function(){this.children.sort(this._compareChildOrder.bind(this))};Tilemap.prototype._compareChildOrder=function(a,b){return a.z!==b.z?a.z-b.z:a.y!==b.y?a.y-b.y:a.spriteId-b.spriteId};Tilemap.TILE_ID_B=0;Tilemap.TILE_ID_C=256;Tilemap.TILE_ID_D=512;Tilemap.TILE_ID_E=768;Tilemap.TILE_ID_A5=1536;Tilemap.TILE_ID_A1=2048;
Tilemap.TILE_ID_A2=2816;Tilemap.TILE_ID_A3=4352;Tilemap.TILE_ID_A4=5888;Tilemap.TILE_ID_MAX=8192;Tilemap.isVisibleTile=function(a){return 0<a&&a<this.TILE_ID_MAX};Tilemap.isAutotile=function(a){return a>=this.TILE_ID_A1};Tilemap.getAutotileKind=function(a){return Math.floor((a-this.TILE_ID_A1)/48)};Tilemap.getAutotileShape=function(a){return(a-this.TILE_ID_A1)%48};Tilemap.makeAutotileId=function(a,b){return this.TILE_ID_A1+48*a+b};
Tilemap.isSameKindTile=function(a,b){return this.isAutotile(a)&&this.isAutotile(b)?this.getAutotileKind(a)===this.getAutotileKind(b):a===b};Tilemap.isTileA1=function(a){return a>=this.TILE_ID_A1&&a<this.TILE_ID_A2};Tilemap.isTileA2=function(a){return a>=this.TILE_ID_A2&&a<this.TILE_ID_A3};Tilemap.isTileA3=function(a){return a>=this.TILE_ID_A3&&a<this.TILE_ID_A4};Tilemap.isTileA4=function(a){return a>=this.TILE_ID_A4&&a<this.TILE_ID_MAX};Tilemap.isTileA5=function(a){return a>=this.TILE_ID_A5&&a<this.TILE_ID_A1};
Tilemap.isWaterTile=function(a){return this.isTileA1(a)?!(a>=this.TILE_ID_A1+96&&a<this.TILE_ID_A1+192):!1};Tilemap.isWaterfallTile=function(a){return a>=this.TILE_ID_A1+192&&a<this.TILE_ID_A2?1===this.getAutotileKind(a)%2:!1};Tilemap.isGroundTile=function(a){return this.isTileA1(a)||this.isTileA2(a)||this.isTileA5(a)};Tilemap.isShadowingTile=function(a){return this.isTileA3(a)||this.isTileA4(a)};Tilemap.isRoofTile=function(a){return this.isTileA3(a)&&8>this.getAutotileKind(a)%16};
Tilemap.isWallTopTile=function(a){return this.isTileA4(a)&&8>this.getAutotileKind(a)%16};Tilemap.isWallSideTile=function(a){return(this.isTileA3(a)||this.isTileA4(a))&&8<=this.getAutotileKind(a)%16};Tilemap.isWallTile=function(a){return this.isWallTopTile(a)||this.isWallSideTile(a)};Tilemap.isFloorTypeAutotile=function(a){return this.isTileA1(a)&&!this.isWaterfallTile(a)||this.isTileA2(a)||this.isWallTopTile(a)};Tilemap.isWallTypeAutotile=function(a){return this.isRoofTile(a)||this.isWallSideTile(a)};
Tilemap.isWaterfallTypeAutotile=function(a){return this.isWaterfallTile(a)};
Tilemap.FLOOR_AUTOTILE_TABLE=[[[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],[[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],[[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],[[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],[[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],[[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],[[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],[[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],[[0,
4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],[[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],[[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],[[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],[[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],[[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],[[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],[[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],[[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],
[2,1],[3,3]],[[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],[[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],[[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],[[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],[[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]];
Tilemap.WALL_AUTOTILE_TABLE=[[[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],[[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],[[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],[[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],[[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]];
Tilemap.WATERFALL_AUTOTILE_TABLE=[[[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],[[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]];function ShaderTilemap(){Tilemap.apply(this,arguments);this.roundPixels=!0}ShaderTilemap.prototype=Object.create(Tilemap.prototype);ShaderTilemap.prototype.constructor=ShaderTilemap;PIXI.glCore.VertexArrayObject.FORCE_NATIVE=!0;PIXI.settings.GC_MODE=PIXI.GC_MODES.AUTO;PIXI.tilemap.TileRenderer.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;
PIXI.tilemap.TileRenderer.DO_CLEAR=!0;ShaderTilemap.prototype._hackRenderer=function(a){var b=this.animationFrame%4;3==b&&(b=1);a.plugins.tilemap.tileAnim[0]=b*this._tileWidth;a.plugins.tilemap.tileAnim[1]=this.animationFrame%3*this._tileHeight;return a};ShaderTilemap.prototype.renderCanvas=function(a){this._hackRenderer(a);PIXI.Container.prototype.renderCanvas.call(this,a)};ShaderTilemap.prototype.renderWebGL=function(a){this._hackRenderer(a);PIXI.Container.prototype.renderWebGL.call(this,a)};
ShaderTilemap.prototype.refresh=function(){this._lastBitmapLength!==this.bitmaps.length&&(this._lastBitmapLength=this.bitmaps.length,this.refreshTileset());this._needsRepaint=!0};ShaderTilemap.prototype.refreshTileset=function(){var a=this.bitmaps.map(function(b){return b._baseTexture?new PIXI.Texture(b._baseTexture):b});this.lowerLayer.setBitmaps(a);this.upperLayer.setBitmaps(a)};
ShaderTilemap.prototype.updateTransform=function(){if(this.roundPixels)var a=Math.floor(this.origin.x),b=Math.floor(this.origin.y);else a=this.origin.x,b=this.origin.y;a=Math.floor((a-this._margin)/this._tileWidth);b=Math.floor((b-this._margin)/this._tileHeight);this._updateLayerPositions(a,b);if(this._needsRepaint||this._lastStartX!==a||this._lastStartY!==b)this._lastStartX=a,this._lastStartY=b,this._paintAllTiles(a,b),this._needsRepaint=!1;this._sortChildren();PIXI.Container.prototype.updateTransform.call(this)};
ShaderTilemap.prototype._createLayers=function(){var a=Math.ceil(this._height/this._tileHeight)+1;this._layerWidth=(Math.ceil(this._width/this._tileWidth)+1)*this._tileWidth;this._layerHeight=a*this._tileHeight;this._needsRepaint=!0;this.lowerZLayer||(this.addChild(this.lowerZLayer=new PIXI.tilemap.ZLayer(this,0)),this.addChild(this.upperZLayer=new PIXI.tilemap.ZLayer(this,4)),a=PluginManager.parameters("ShaderTilemap"),a=Number(a.hasOwnProperty("squareShader")?a.squareShader:0),this.lowerZLayer.addChild(this.lowerLayer=
new PIXI.tilemap.CompositeRectTileLayer(0,[],a)),this.lowerLayer.shadowColor=new Float32Array([0,0,0,.5]),this.upperZLayer.addChild(this.upperLayer=new PIXI.tilemap.CompositeRectTileLayer(4,[],a)))};
ShaderTilemap.prototype._updateLayerPositions=function(a,b){if(this.roundPixels)var c=Math.floor(this.origin.x),d=Math.floor(this.origin.y);else c=this.origin.x,d=this.origin.y;this.lowerZLayer.position.x=a*this._tileWidth-c;this.lowerZLayer.position.y=b*this._tileHeight-d;this.upperZLayer.position.x=a*this._tileWidth-c;this.upperZLayer.position.y=b*this._tileHeight-d};
ShaderTilemap.prototype._paintAllTiles=function(a,b){this.lowerZLayer.clear();this.upperZLayer.clear();for(var c=Math.ceil(this._width/this._tileWidth)+1,d=Math.ceil(this._height/this._tileHeight)+1,e=0;e<d;e++)for(var f=0;f<c;f++)this._paintTiles(a,b,f,e)};
ShaderTilemap.prototype._paintTiles=function(a,b,c,d){a+=c;b+=d;c*=this._tileWidth;d*=this._tileHeight;var e=this._readMapData(a,b,0),f=this._readMapData(a,b,1),g=this._readMapData(a,b,2),h=this._readMapData(a,b,3),k=this._readMapData(a,b,4),l=this._readMapData(a,b-1,1),m=this.lowerLayer.children[0],n=this.upperLayer.children[0];this._isHigherTile(e)?this._drawTile(n,e,c,d):this._drawTile(m,e,c,d);this._isHigherTile(f)?this._drawTile(n,f,c,d):this._drawTile(m,f,c,d);this._drawShadow(m,k,c,d);this._isTableTile(l)&&
!this._isTableTile(f)&&(Tilemap.isShadowingTile(e)||this._drawTableEdge(m,l,c,d));this._isOverpassPosition(a,b)?(this._drawTile(n,g,c,d),this._drawTile(n,h,c,d)):(this._isHigherTile(g)?this._drawTile(n,g,c,d):this._drawTile(m,g,c,d),this._isHigherTile(h)?this._drawTile(n,h,c,d):this._drawTile(m,h,c,d))};ShaderTilemap.prototype._drawTile=function(a,b,c,d){Tilemap.isVisibleTile(b)&&(Tilemap.isAutotile(b)?this._drawAutotile(a,b,c,d):this._drawNormalTile(a,b,c,d))};
ShaderTilemap.prototype._drawNormalTile=function(a,b,c,d){var e=Tilemap.isTileA5(b)?4:5+Math.floor(b/256);var f=this._tileWidth,g=this._tileHeight;a.addRect(e,(Math.floor(b/128)%2*8+b%8)*f,Math.floor(b%256/8)%16*g,c,d,f,g)};
ShaderTilemap.prototype._drawAutotile=function(a,b,c,d){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b),h=f%8,k=Math.floor(f/8),l=0,m=0,n=0,q=!1,p=0,u=0;Tilemap.isTileA1(b)?(n=0,0===f?(p=2,m=0):1===f?(p=2,m=3):2===f?(l=6,m=0):3===f?(l=6,m=3):(l=8*Math.floor(h/4),m=6*k+Math.floor(h/2)%2*3,0===f%2?p=2:(l+=6,e=Tilemap.WATERFALL_AUTOTILE_TABLE,u=1))):Tilemap.isTileA2(b)?(n=1,l=2*h,m=3*(k-2),q=this._isTableTile(b)):Tilemap.isTileA3(b)?(n=2,l=2*h,m=2*(k-6),
e=Tilemap.WALL_AUTOTILE_TABLE):Tilemap.isTileA4(b)&&(n=3,l=2*h,m=Math.floor(2.5*(k-10)+(1===k%2?.5:0)),1===k%2&&(e=Tilemap.WALL_AUTOTILE_TABLE));b=e[g];e=this._tileWidth/2;f=this._tileHeight/2;for(g=0;4>g;g++){h=b[g][0];k=b[g][1];var t=(2*l+h)*e,v=(2*m+k)*f,w=c+g%2*e,r=d+Math.floor(g/2)*f;if(!q||1!==k&&5!==k)a.addRect(n,t,v,w,r,e,f,p,u);else{var x=h;1===k&&(x=(4-h)%4);a.addRect(n,(2*l+x)*e,(2*m+3)*f,w,r,e,f,p,u);a.addRect(n,t,v,w,r+f/2,e,f/2,p,u)}}};
ShaderTilemap.prototype._drawTableEdge=function(a,b,c,d){if(Tilemap.isTileA2(b)){var e=Tilemap.FLOOR_AUTOTILE_TABLE,f=Tilemap.getAutotileKind(b),g=Tilemap.getAutotileShape(b);b=f%8*2;f=3*(Math.floor(f/8)-2);e=e[g];g=this._tileWidth/2;for(var h=this._tileHeight/2,k=0;2>k;k++)a.addRect(1,(2*b+e[2+k][0])*g,(2*f+e[2+k][1])*h+h/2,c+k%2*g,d+Math.floor(k/2)*h,g,h/2)}};
ShaderTilemap.prototype._drawShadow=function(a,b,c,d){if(b&15)for(var e=this._tileWidth/2,f=this._tileHeight/2,g=0;4>g;g++)b&1<<g&&a.addRect(-1,0,0,c+g%2*e,d+Math.floor(g/2)*f,e,f)};function TilingSprite(){this.initialize.apply(this,arguments)}TilingSprite.prototype=Object.create(PIXI.extras.PictureTilingSprite.prototype);TilingSprite.prototype.constructor=TilingSprite;
TilingSprite.prototype.initialize=function(a){var b=new PIXI.Texture(new PIXI.BaseTexture);PIXI.extras.PictureTilingSprite.call(this,b);this._bitmap=null;this._height=this._width=0;this._frame=new Rectangle;this.spriteId=Sprite._counter++;this.origin=new Point;this.bitmap=a};TilingSprite.prototype._renderCanvas_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderCanvas;TilingSprite.prototype._renderWebGL_PIXI=PIXI.extras.PictureTilingSprite.prototype._renderWebGL;
TilingSprite.prototype._renderCanvas=function(a){this._bitmap&&this._bitmap.touch();0<this.texture.frame.width&&0<this.texture.frame.height&&this._renderCanvas_PIXI(a)};TilingSprite.prototype._renderWebGL=function(a){this._bitmap&&this._bitmap.touch();0<this.texture.frame.width&&0<this.texture.frame.height&&(this._bitmap&&this._bitmap.checkDirty(),this._renderWebGL_PIXI(a))};
Object.defineProperty(TilingSprite.prototype,"bitmap",{get:function(){return this._bitmap},set:function(a){this._bitmap!==a&&((this._bitmap=a)?this._bitmap.addLoadListener(this._onBitmapLoad.bind(this)):this.texture.frame=Rectangle.emptyRectangle)},configurable:!0});Object.defineProperty(TilingSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0});
TilingSprite.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})};TilingSprite.prototype.move=function(a,b,c,d){this.x=a||0;this.y=b||0;this._width=c||0;this._height=d||0};TilingSprite.prototype.setFrame=function(a,b,c,d){this._frame.x=a;this._frame.y=b;this._frame.width=c;this._frame.height=d;this._refresh()};TilingSprite.prototype.updateTransform=function(){this.tilePosition.x=Math.round(-this.origin.x);this.tilePosition.y=Math.round(-this.origin.y);this.updateTransformTS()};
TilingSprite.prototype.updateTransformTS=PIXI.extras.TilingSprite.prototype.updateTransform;TilingSprite.prototype._onBitmapLoad=function(){this.texture.baseTexture=this._bitmap.baseTexture;this._refresh()};TilingSprite.prototype._refresh=function(){var a=this._frame.clone();0===a.width&&0===a.height&&this._bitmap&&(a.width=this._bitmap.width,a.height=this._bitmap.height);this.texture.frame=a;this.texture._updateID++;this.tilingTexture=null};TilingSprite.prototype._speedUpCustomBlendModes=Sprite.prototype._speedUpCustomBlendModes;
TilingSprite.prototype._renderWebGL=function(a){this._bitmap&&(this._bitmap.touch(),this._bitmap.checkDirty());this._speedUpCustomBlendModes(a);this._renderWebGL_PIXI(a)};function ScreenSprite(){this.initialize.apply(this,arguments)}ScreenSprite.prototype=Object.create(PIXI.Container.prototype);ScreenSprite.prototype.constructor=ScreenSprite;
ScreenSprite.prototype.initialize=function(){PIXI.Container.call(this);this._graphics=new PIXI.Graphics;this.addChild(this._graphics);this.opacity=0;this._blue=this._green=this._red=-1;this._colorText="";this.setBlack()};Object.defineProperty(ScreenSprite.prototype,"opacity",{get:function(){return 255*this.alpha},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0});ScreenSprite.YEPWarned=!1;
ScreenSprite.warnYep=function(){ScreenSprite.YEPWarned||(console.log("Deprecation warning. Please update YEP_CoreEngine. ScreenSprite is not a sprite, it has graphics inside."),ScreenSprite.YEPWarned=!0)};Object.defineProperty(ScreenSprite.prototype,"anchor",{get:function(){ScreenSprite.warnYep();this.scale.x=1;this.scale.y=1;return{x:0,y:0}},set:function(a){this.alpha=a.clamp(0,255)/255},configurable:!0});
Object.defineProperty(ScreenSprite.prototype,"blendMode",{get:function(){return this._graphics.blendMode},set:function(a){this._graphics.blendMode=a},configurable:!0});ScreenSprite.prototype.setBlack=function(){this.setColor(0,0,0)};ScreenSprite.prototype.setWhite=function(){this.setColor(255,255,255)};
ScreenSprite.prototype.setColor=function(a,b,c){if(this._red!==a||this._green!==b||this._blue!==c){a=Math.round(a||0).clamp(0,255);b=Math.round(b||0).clamp(0,255);c=Math.round(c||0).clamp(0,255);this._red=a;this._green=b;this._blue=c;this._colorText=Utils.rgbToCssColor(a,b,c);var d=this._graphics;d.clear();d.beginFill(a<<16|b<<8|c,1);d.drawRect(5*-Graphics.width,5*-Graphics.height,10*Graphics.width,10*Graphics.height)}};function Window(){this.initialize.apply(this,arguments)}Window.prototype=Object.create(PIXI.Container.prototype);
Window.prototype.constructor=Window;
Window.prototype.initialize=function(){PIXI.Container.call(this);this._isWindow=!0;this._windowskin=null;this._height=this._width=0;this._cursorRect=new Rectangle;this._openness=255;this._animationCount=0;this._padding=18;this._margin=4;this._colorTone=[0,0,0];this._windowContentsSprite=this._windowFrameSprite=this._windowCursorSprite=this._windowBackSprite=this._windowSpriteContainer=null;this._windowArrowSprites=[];this._windowPauseSignSprite=null;this._createAllParts();this.origin=new Point;this.active=
!0;this.pause=this.upArrowVisible=this.downArrowVisible=!1};Object.defineProperty(Window.prototype,"windowskin",{get:function(){return this._windowskin},set:function(a){this._windowskin!==a&&(this._windowskin=a,this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this)))},configurable:!0});Object.defineProperty(Window.prototype,"contents",{get:function(){return this._windowContentsSprite.bitmap},set:function(a){this._windowContentsSprite.bitmap=a},configurable:!0});
Object.defineProperty(Window.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a;this._refreshAllParts()},configurable:!0});Object.defineProperty(Window.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a;this._refreshAllParts()},configurable:!0});Object.defineProperty(Window.prototype,"padding",{get:function(){return this._padding},set:function(a){this._padding=a;this._refreshAllParts()},configurable:!0});
Object.defineProperty(Window.prototype,"margin",{get:function(){return this._margin},set:function(a){this._margin=a;this._refreshAllParts()},configurable:!0});Object.defineProperty(Window.prototype,"opacity",{get:function(){return 255*this._windowSpriteContainer.alpha},set:function(a){this._windowSpriteContainer.alpha=a.clamp(0,255)/255},configurable:!0});
Object.defineProperty(Window.prototype,"backOpacity",{get:function(){return 255*this._windowBackSprite.alpha},set:function(a){this._windowBackSprite.alpha=a.clamp(0,255)/255},configurable:!0});Object.defineProperty(Window.prototype,"contentsOpacity",{get:function(){return 255*this._windowContentsSprite.alpha},set:function(a){this._windowContentsSprite.alpha=a.clamp(0,255)/255},configurable:!0});
Object.defineProperty(Window.prototype,"openness",{get:function(){return this._openness},set:function(a){this._openness!==a&&(this._openness=a.clamp(0,255),this._windowSpriteContainer.scale.y=this._openness/255,this._windowSpriteContainer.y=this.height/2*(1-this._openness/255))},configurable:!0});Window.prototype.update=function(){this.active&&this._animationCount++;this.children.forEach(function(a){a.update&&a.update()})};
Window.prototype.move=function(a,b,c,d){this.x=a||0;this.y=b||0;if(this._width!==c||this._height!==d)this._width=c||0,this._height=d||0,this._refreshAllParts()};Window.prototype.isOpen=function(){return 255<=this._openness};Window.prototype.isClosed=function(){return 0>=this._openness};
Window.prototype.setCursorRect=function(a,b,c,d){a=Math.floor(a||0);b=Math.floor(b||0);c=Math.floor(c||0);d=Math.floor(d||0);var e=this._cursorRect;if(e.x!==a||e.y!==b||e.width!==c||e.height!==d)this._cursorRect.x=a,this._cursorRect.y=b,this._cursorRect.width=c,this._cursorRect.height=d,this._refreshCursor()};Window.prototype.setTone=function(a,b,c){var d=this._colorTone;if(a!==d[0]||b!==d[1]||c!==d[2])this._colorTone=[a,b,c],this._refreshBack()};
Window.prototype.addChildToBack=function(a){var b=this.children.indexOf(this._windowSpriteContainer);return this.addChildAt(a,b+1)};Window.prototype.updateTransform=function(){this._updateCursor();this._updateArrows();this._updatePauseSign();this._updateContents();PIXI.Container.prototype.updateTransform.call(this)};
Window.prototype._createAllParts=function(){this._windowSpriteContainer=new PIXI.Container;this._windowBackSprite=new Sprite;this._windowCursorSprite=new Sprite;this._windowFrameSprite=new Sprite;this._windowContentsSprite=new Sprite;this._downArrowSprite=new Sprite;this._upArrowSprite=new Sprite;this._windowPauseSignSprite=new Sprite;this._windowBackSprite.bitmap=new Bitmap(1,1);this._windowBackSprite.alpha=192/255;this.addChild(this._windowSpriteContainer);this._windowSpriteContainer.addChild(this._windowBackSprite);
this._windowSpriteContainer.addChild(this._windowFrameSprite);this.addChild(this._windowCursorSprite);this.addChild(this._windowContentsSprite);this.addChild(this._downArrowSprite);this.addChild(this._upArrowSprite);this.addChild(this._windowPauseSignSprite)};Window.prototype._onWindowskinLoad=function(){this._refreshAllParts()};Window.prototype._refreshAllParts=function(){this._refreshBack();this._refreshFrame();this._refreshCursor();this._refreshContents();this._refreshArrows();this._refreshPauseSign()};
Window.prototype._refreshBack=function(){var a=this._margin,b=this._width-2*a,c=this._height-2*a,d=new Bitmap(b,c);this._windowBackSprite.bitmap=d;this._windowBackSprite.setFrame(0,0,b,c);this._windowBackSprite.move(a,a);if(0<b&&0<c&&this._windowskin){d.blt(this._windowskin,0,0,96,96,0,0,b,c);for(a=0;a<c;a+=96)for(var e=0;e<b;e+=96)d.blt(this._windowskin,0,96,96,96,e,a,96,96);b=this._colorTone;d.adjustTone(b[0],b[1],b[2])}};
Window.prototype._refreshFrame=function(){var a=this._width,b=this._height,c=new Bitmap(a,b);this._windowFrameSprite.bitmap=c;this._windowFrameSprite.setFrame(0,0,a,b);if(0<a&&0<b&&this._windowskin){var d=this._windowskin;c.blt(d,120,0,48,24,24,0,a-48,24);c.blt(d,120,72,48,24,24,b-24,a-48,24);c.blt(d,96,24,24,48,0,24,24,b-48);c.blt(d,168,24,24,48,a-24,24,24,b-48);c.blt(d,96,0,24,24,0,0,24,24);c.blt(d,168,0,24,24,a-24,0,24,24);c.blt(d,96,72,24,24,0,b-24,24,24);c.blt(d,168,72,24,24,a-24,b-24,24,24)}};
Window.prototype._refreshCursor=function(){var a=this._padding,b=this._cursorRect.x+a-this.origin.x,c=this._cursorRect.y+a-this.origin.y,d=this._cursorRect.width,e=this._cursorRect.height,f=Math.max(b,a),g=Math.max(c,a);b-=f;c-=g;var h=Math.min(d,this._width-a-f),k=Math.min(e,this._height-a-g);a=new Bitmap(h,k);this._windowCursorSprite.bitmap=a;this._windowCursorSprite.setFrame(0,0,h,k);this._windowCursorSprite.move(f,g);0<d&&0<e&&this._windowskin&&(f=this._windowskin,a.blt(f,100,100,40,40,b+4,c+
4,d-8,e-8),a.blt(f,100,96,40,4,b+4,c+0,d-8,4),a.blt(f,100,140,40,4,b+4,c+e-4,d-8,4),a.blt(f,96,100,4,40,b+0,c+4,4,e-8),a.blt(f,140,100,4,40,b+d-4,c+4,4,e-8),a.blt(f,96,96,4,4,b+0,c+0,4,4),a.blt(f,140,96,4,4,b+d-4,c+0,4,4),a.blt(f,96,140,4,4,b+0,c+e-4,4,4),a.blt(f,140,140,4,4,b+d-4,c+e-4,4,4))};Window.prototype._refreshContents=function(){this._windowContentsSprite.move(this.padding,this.padding)};
Window.prototype._refreshArrows=function(){var a=this._width,b=this._height;this._downArrowSprite.bitmap=this._windowskin;this._downArrowSprite.anchor.x=.5;this._downArrowSprite.anchor.y=.5;this._downArrowSprite.setFrame(132,60,24,12);this._downArrowSprite.move(a/2,b-12);this._upArrowSprite.bitmap=this._windowskin;this._upArrowSprite.anchor.x=.5;this._upArrowSprite.anchor.y=.5;this._upArrowSprite.setFrame(132,24,24,12);this._upArrowSprite.move(a/2,12)};
Window.prototype._refreshPauseSign=function(){this._windowPauseSignSprite.bitmap=this._windowskin;this._windowPauseSignSprite.anchor.x=.5;this._windowPauseSignSprite.anchor.y=1;this._windowPauseSignSprite.move(this._width/2,this._height);this._windowPauseSignSprite.setFrame(144,96,24,24);this._windowPauseSignSprite.alpha=0};
Window.prototype._updateCursor=function(){var a=this._animationCount%40,b=this.contentsOpacity;this.active&&(b=20>a?b-8*a:b-8*(40-a));this._windowCursorSprite.alpha=b/255;this._windowCursorSprite.visible=this.isOpen()};Window.prototype._updateContents=function(){var a=this._width-2*this._padding,b=this._height-2*this._padding;0<a&&0<b?(this._windowContentsSprite.setFrame(this.origin.x,this.origin.y,a,b),this._windowContentsSprite.visible=this.isOpen()):this._windowContentsSprite.visible=!1};
Window.prototype._updateArrows=function(){this._downArrowSprite.visible=this.isOpen()&&this.downArrowVisible;this._upArrowSprite.visible=this.isOpen()&&this.upArrowVisible};Window.prototype._updatePauseSign=function(){var a=this._windowPauseSignSprite,b=Math.floor(this._animationCount/16)%2,c=Math.floor(this._animationCount/16/2)%2;this.pause?1>a.alpha&&(a.alpha=Math.min(a.alpha+.1,1)):a.alpha=0;a.setFrame(144+24*b,96+24*c,24,24);a.visible=this.isOpen()};
function WindowLayer(){this.initialize.apply(this,arguments)}WindowLayer.prototype=Object.create(PIXI.Container.prototype);WindowLayer.prototype.constructor=WindowLayer;
WindowLayer.prototype.initialize=function(){PIXI.Container.call(this);this._height=this._width=0;this._tempCanvas=null;this._translationMatrix=[1,0,0,0,1,0,0,0,1];this._windowMask=new PIXI.Graphics;this._windowMask.beginFill(16777215,1);this._windowMask.drawRect(0,0,0,0);this._windowMask.endFill();this._windowRect=this._windowMask.graphicsData[0].shape;this._renderSprite=null;this.filterArea=new PIXI.Rectangle;this.filters=[WindowLayer.voidFilter];this.on("removed",this.onRemoveAsAChild)};
WindowLayer.prototype.onRemoveAsAChild=function(){this.removeChildren()};WindowLayer.voidFilter=new PIXI.filters.VoidFilter;Object.defineProperty(WindowLayer.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a},configurable:!0});Object.defineProperty(WindowLayer.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a},configurable:!0});WindowLayer.prototype.move=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};
WindowLayer.prototype.update=function(){this.children.forEach(function(a){a.update&&a.update()})};
WindowLayer.prototype.renderCanvas=function(a){if(this.visible&&this.renderable){this._tempCanvas||(this._tempCanvas=document.createElement("canvas"));this._tempCanvas.width=Graphics.width;this._tempCanvas.height=Graphics.height;var b=a.context,c=this._tempCanvas.getContext("2d");c.save();c.clearRect(0,0,Graphics.width,Graphics.height);c.beginPath();c.rect(this.x,this.y,this.width,this.height);c.closePath();c.clip();a.context=c;for(var d=0;d<this.children.length;d++){var e=this.children[d];e._isWindow&&
e.visible&&0<e.openness&&(this._canvasClearWindowRect(a,e),c.save(),e.renderCanvas(a),c.restore())}c.restore();a.context=b;a.context.setTransform(1,0,0,1,0,0);a.context.globalCompositeOperation="source-over";a.context.globalAlpha=1;a.context.drawImage(this._tempCanvas,0,0);for(b=0;b<this.children.length;b++)this.children[b]._isWindow||this.children[b].renderCanvas(a)}};
WindowLayer.prototype._canvasClearWindowRect=function(a,b){a.context.clearRect(this.x+b.x,this.y+b.y+b.height/2*(1-b._openness/255),b.width,b.height*b._openness/255)};
WindowLayer.prototype.renderWebGL=function(a){if(this.visible&&this.renderable&&0!=this.children.length){a.flush();this.filterArea.copy(this);a.filterManager.pushFilter(this,this.filters);a.currentRenderer.start();var b=new PIXI.Point,c=a._activeRenderTarget,d=c.projectionMatrix;b.x=Math.round((d.tx+1)/2*c.sourceFrame.width);b.y=Math.round((d.ty+1)/2*c.sourceFrame.height);for(c=0;c<this.children.length;c++)d=this.children[c],d._isWindow&&d.visible&&0<d.openness&&(this._maskWindow(d,b),a.maskManager.pushScissorMask(this,
this._windowMask),a.clear(),a.maskManager.popScissorMask(),a.currentRenderer.start(),d.renderWebGL(a),a.currentRenderer.flush());a.flush();a.filterManager.popFilter();a.maskManager.popScissorMask();for(b=0;b<this.children.length;b++)this.children[b]._isWindow||this.children[b].renderWebGL(a)}};
WindowLayer.prototype._maskWindow=function(a,b){this._windowMask._currentBounds=null;this._windowMask.boundsDirty=!0;var c=this._windowRect;c.x=this.x+b.x+a.x;c.y=this.x+b.y+a.y+a.height/2*(1-a._openness/255);c.width=a.width;c.height=a.height*a._openness/255};function Weather(){this.initialize.apply(this,arguments)}Weather.prototype=Object.create(PIXI.Container.prototype);Weather.prototype.constructor=Weather;
Weather.prototype.initialize=function(){PIXI.Container.call(this);this._width=Graphics.width;this._height=Graphics.height;this._sprites=[];this._createBitmaps();this._createDimmer();this.type="none";this.power=0;this.origin=new Point};Weather.prototype.update=function(){this._updateDimmer();this._updateAllSprites()};
Weather.prototype._createBitmaps=function(){this._rainBitmap=new Bitmap(1,60);this._rainBitmap.fillAll("white");this._stormBitmap=new Bitmap(2,100);this._stormBitmap.fillAll("white");this._snowBitmap=new Bitmap(9,9);this._snowBitmap.drawCircle(4,4,4,"white")};Weather.prototype._createDimmer=function(){this._dimmerSprite=new ScreenSprite;this._dimmerSprite.setColor(80,80,80);this.addChild(this._dimmerSprite)};Weather.prototype._updateDimmer=function(){this._dimmerSprite.opacity=Math.floor(6*this.power)};
Weather.prototype._updateAllSprites=function(){for(var a=Math.floor(10*this.power);this._sprites.length<a;)this._addSprite();for(;this._sprites.length>a;)this._removeSprite();this._sprites.forEach(function(b){this._updateSprite(b);b.x=b.ax-this.origin.x;b.y=b.ay-this.origin.y},this)};Weather.prototype._addSprite=function(){var a=new Sprite(this.viewport);a.opacity=0;this._sprites.push(a);this.addChild(a)};Weather.prototype._removeSprite=function(){this.removeChild(this._sprites.pop())};
Weather.prototype._updateSprite=function(a){switch(this.type){case "rain":this._updateRainSprite(a);break;case "storm":this._updateStormSprite(a);break;case "snow":this._updateSnowSprite(a)}40>a.opacity&&this._rebornSprite(a)};Weather.prototype._updateRainSprite=function(a){a.bitmap=this._rainBitmap;a.rotation=Math.PI/16;a.ax-=6*Math.sin(a.rotation);a.ay+=6*Math.cos(a.rotation);a.opacity-=6};
Weather.prototype._updateStormSprite=function(a){a.bitmap=this._stormBitmap;a.rotation=Math.PI/8;a.ax-=8*Math.sin(a.rotation);a.ay+=8*Math.cos(a.rotation);a.opacity-=8};Weather.prototype._updateSnowSprite=function(a){a.bitmap=this._snowBitmap;a.rotation=Math.PI/16;a.ax-=3*Math.sin(a.rotation);a.ay+=3*Math.cos(a.rotation);a.opacity-=3};
Weather.prototype._rebornSprite=function(a){a.ax=Math.randomInt(Graphics.width+100)-100+this.origin.x;a.ay=Math.randomInt(Graphics.height+200)-200+this.origin.y;a.opacity=160+Math.randomInt(60)};function ToneFilter(){PIXI.filters.ColorMatrixFilter.call(this)}ToneFilter.prototype=Object.create(PIXI.filters.ColorMatrixFilter.prototype);ToneFilter.prototype.constructor=ToneFilter;ToneFilter.prototype.adjustHue=function(a){this.hue(a,!0)};
ToneFilter.prototype.adjustSaturation=function(a){a=(a||0).clamp(-255,255)/255;this.saturate(a,!0)};ToneFilter.prototype.adjustTone=function(a,b,c){a=(a||0).clamp(-255,255)/255;b=(b||0).clamp(-255,255)/255;c=(c||0).clamp(-255,255)/255;0===a&&0===b&&0===c||this._loadMatrix([1,0,0,a,0,0,1,0,b,0,0,0,1,c,0,0,0,0,1,0],!0)};function ToneSprite(){this.initialize.apply(this,arguments)}ToneSprite.prototype=Object.create(PIXI.Container.prototype);ToneSprite.prototype.constructor=ToneSprite;
ToneSprite.prototype.initialize=function(){PIXI.Container.call(this);this.clear()};ToneSprite.prototype.clear=function(){this._gray=this._blue=this._green=this._red=0};ToneSprite.prototype.setTone=function(a,b,c,d){this._red=Math.round(a||0).clamp(-255,255);this._green=Math.round(b||0).clamp(-255,255);this._blue=Math.round(c||0).clamp(-255,255);this._gray=Math.round(d||0).clamp(0,255)};
ToneSprite.prototype._renderCanvas=function(a){if(this.visible){var b=a.context,c=this.worldTransform,d=a.resolution;a=Graphics.width;var e=Graphics.height;b.save();b.setTransform(c.a,c.b,c.c,c.d,c.tx*d,c.ty*d);Graphics.canUseSaturationBlend()&&0<this._gray&&(b.globalCompositeOperation="saturation",b.globalAlpha=this._gray/255,b.fillStyle="#ffffff",b.fillRect(0,0,a,e));b.globalAlpha=1;c=Math.max(0,this._red);d=Math.max(0,this._green);var f=Math.max(0,this._blue);if(c||d||f)b.globalCompositeOperation=
"lighter",b.fillStyle=Utils.rgbToCssColor(c,d,f),b.fillRect(0,0,a,e);Graphics.canUseDifferenceBlend()&&(c=Math.max(0,-this._red),d=Math.max(0,-this._green),f=Math.max(0,-this._blue),c||d||f)&&(b.globalCompositeOperation="difference",b.fillStyle="#ffffff",b.fillRect(0,0,a,e),b.globalCompositeOperation="lighter",b.fillStyle=Utils.rgbToCssColor(c,d,f),b.fillRect(0,0,a,e),b.globalCompositeOperation="difference",b.fillStyle="#ffffff",b.fillRect(0,0,a,e));b.restore()}};
ToneSprite.prototype._renderWebGL=function(a){};function Stage(){this.initialize.apply(this,arguments)}Stage.prototype=Object.create(PIXI.Container.prototype);Stage.prototype.constructor=Stage;Stage.prototype.initialize=function(){PIXI.Container.call(this);this.interactive=!1};function WebAudio(){this.initialize.apply(this,arguments)}WebAudio._standAlone=function(a){return!a.ResourceHandler}(this);
WebAudio.prototype.initialize=function(a){WebAudio._initialized||WebAudio.initialize();this.clear();WebAudio._standAlone||(this._loader=ResourceHandler.createLoader(a,this._load.bind(this,a),function(){this._hasError=!0}.bind(this)));this._load(a);this._url=a};WebAudio._masterVolume=1;WebAudio._context=null;WebAudio._masterGainNode=null;WebAudio._initialized=!1;WebAudio._unlocked=!1;
WebAudio.initialize=function(a){this._initialized||(a||(this._createContext(),this._detectCodecs(),this._createMasterGainNode(),this._setupEventHandlers()),this._initialized=!0);return!!this._context};WebAudio.canPlayOgg=function(){this._initialized||this.initialize();return!!this._canPlayOgg};WebAudio.canPlayM4a=function(){this._initialized||this.initialize();return!!this._canPlayM4a};
WebAudio.setMasterVolume=function(a){this._masterVolume=a;this._masterGainNode&&this._masterGainNode.gain.setValueAtTime(this._masterVolume,this._context.currentTime)};WebAudio._createContext=function(){try{"undefined"!==typeof AudioContext?this._context=new AudioContext:"undefined"!==typeof webkitAudioContext&&(this._context=new webkitAudioContext)}catch(a){this._context=null}};
WebAudio._detectCodecs=function(){var a=document.createElement("audio");a.canPlayType&&(this._canPlayOgg=a.canPlayType("audio/ogg"),this._canPlayM4a=a.canPlayType("audio/mp4"))};WebAudio._createMasterGainNode=function(){var a=WebAudio._context;a&&(this._masterGainNode=a.createGain(),this._masterGainNode.gain.setValueAtTime(this._masterVolume,a.currentTime),this._masterGainNode.connect(a.destination))};
WebAudio._setupEventHandlers=function(){var a=function(){var b=WebAudio._context;b&&"suspended"===b.state&&"function"===typeof b.resume?b.resume().then(function(){WebAudio._onTouchStart()}):WebAudio._onTouchStart()};document.addEventListener("keydown",a);document.addEventListener("mousedown",a);document.addEventListener("touchend",a);document.addEventListener("touchstart",this._onTouchStart.bind(this));document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this))};
WebAudio._onTouchStart=function(){var a=WebAudio._context;a&&!this._unlocked&&(a.createBufferSource().start(0),this._unlocked=!0)};WebAudio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()};WebAudio._onHide=function(){this._shouldMuteOnHide()&&this._fadeOut(1)};WebAudio._onShow=function(){this._shouldMuteOnHide()&&this._fadeIn(.5)};WebAudio._shouldMuteOnHide=function(){return Utils.isMobileDevice()};
WebAudio._fadeIn=function(a){if(this._masterGainNode){var b=this._masterGainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(0,c);b.linearRampToValueAtTime(this._masterVolume,c+a)}};WebAudio._fadeOut=function(a){if(this._masterGainNode){var b=this._masterGainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(this._masterVolume,c);b.linearRampToValueAtTime(0,c+a)}};
WebAudio.prototype.clear=function(){this.stop();this._pannerNode=this._gainNode=this._sourceNode=this._buffer=null;this._startTime=this._loopLength=this._loopStart=this._sampleRate=this._totalTime=0;this._pitch=this._volume=1;this._pan=0;this._endTimer=null;this._loadListeners=[];this._stopListeners=[];this._autoPlay=this._hasError=!1};Object.defineProperty(WebAudio.prototype,"url",{get:function(){return this._url},configurable:!0});
Object.defineProperty(WebAudio.prototype,"volume",{get:function(){return this._volume},set:function(a){this._volume=a;this._gainNode&&this._gainNode.gain.setValueAtTime(this._volume,WebAudio._context.currentTime)},configurable:!0});Object.defineProperty(WebAudio.prototype,"pitch",{get:function(){return this._pitch},set:function(a){this._pitch!==a&&(this._pitch=a,this.isPlaying()&&this.play(this._sourceNode.loop,0))},configurable:!0});
Object.defineProperty(WebAudio.prototype,"pan",{get:function(){return this._pan},set:function(a){this._pan=a;this._updatePanner()},configurable:!0});WebAudio.prototype.isReady=function(){return!!this._buffer};WebAudio.prototype.isError=function(){return this._hasError};WebAudio.prototype.isPlaying=function(){return!!this._sourceNode};
WebAudio.prototype.play=function(a,b){this.isReady()?(b=b||0,this._startPlaying(a,b)):WebAudio._context&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&this.play(a,b)}.bind(this)))};WebAudio.prototype.stop=function(){this._autoPlay=!1;this._removeEndTimer();this._removeNodes();if(this._stopListeners)for(;0<this._stopListeners.length;)this._stopListeners.shift()()};
WebAudio.prototype.fadeIn=function(a){if(this.isReady()){if(this._gainNode){var b=this._gainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(0,c);b.linearRampToValueAtTime(this._volume,c+a)}}else this._autoPlay&&this.addLoadListener(function(){this.fadeIn(a)}.bind(this))};WebAudio.prototype.fadeOut=function(a){if(this._gainNode){var b=this._gainNode.gain,c=WebAudio._context.currentTime;b.setValueAtTime(this._volume,c);b.linearRampToValueAtTime(0,c+a)}this._autoPlay=!1};
WebAudio.prototype.seek=function(){if(WebAudio._context){var a=(WebAudio._context.currentTime-this._startTime)*this._pitch;if(0<this._loopLength)for(;a>=this._loopStart+this._loopLength;)a-=this._loopLength;return a}return 0};WebAudio.prototype.addLoadListener=function(a){this._loadListeners.push(a)};WebAudio.prototype.addStopListener=function(a){this._stopListeners.push(a)};
WebAudio.prototype._load=function(a){if(WebAudio._context){var b=new XMLHttpRequest;Decrypter.hasEncryptedAudio&&(a=Decrypter.extToEncryptExt(a));b.open("GET",a);b.responseType="arraybuffer";b.onload=function(){400>b.status&&this._onXhrLoad(b)}.bind(this);b.onerror=this._loader||function(){this._hasError=!0}.bind(this);b.send()}};
WebAudio.prototype._onXhrLoad=function(a){a=a.response;Decrypter.hasEncryptedAudio&&(a=Decrypter.decryptArrayBuffer(a));this._readLoopComments(new Uint8Array(a));WebAudio._context.decodeAudioData(a,function(b){this._buffer=b;this._totalTime=b.duration;0<this._loopLength&&0<this._sampleRate?(this._loopStart/=this._sampleRate,this._loopLength/=this._sampleRate):(this._loopStart=0,this._loopLength=this._totalTime);this._onLoad()}.bind(this))};
WebAudio.prototype._startPlaying=function(a,b){if(0<this._loopLength)for(;b>=this._loopStart+this._loopLength;)b-=this._loopLength;this._removeEndTimer();this._removeNodes();this._createNodes();this._connectNodes();this._sourceNode.loop=a;this._sourceNode.start(0,b);this._startTime=WebAudio._context.currentTime-b/this._pitch;this._createEndTimer()};
WebAudio.prototype._createNodes=function(){var a=WebAudio._context;this._sourceNode=a.createBufferSource();this._sourceNode.buffer=this._buffer;this._sourceNode.loopStart=this._loopStart;this._sourceNode.loopEnd=this._loopStart+this._loopLength;this._sourceNode.playbackRate.setValueAtTime(this._pitch,a.currentTime);this._gainNode=a.createGain();this._gainNode.gain.setValueAtTime(this._volume,a.currentTime);this._pannerNode=a.createPanner();this._pannerNode.panningModel="equalpower";this._updatePanner()};
WebAudio.prototype._connectNodes=function(){this._sourceNode.connect(this._gainNode);this._gainNode.connect(this._pannerNode);this._pannerNode.connect(WebAudio._masterGainNode)};WebAudio.prototype._removeNodes=function(){this._sourceNode&&(this._sourceNode.stop(0),this._pannerNode=this._gainNode=this._sourceNode=null)};
WebAudio.prototype._createEndTimer=function(){if(this._sourceNode&&!this._sourceNode.loop){var a=this._startTime+this._totalTime/this._pitch-WebAudio._context.currentTime;this._endTimer=setTimeout(function(){this.stop()}.bind(this),1E3*a)}};WebAudio.prototype._removeEndTimer=function(){this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null)};WebAudio.prototype._updatePanner=function(){if(this._pannerNode){var a=this._pan;this._pannerNode.setPosition(a,0,1-Math.abs(a))}};
WebAudio.prototype._onLoad=function(){for(;0<this._loadListeners.length;)this._loadListeners.shift()()};WebAudio.prototype._readLoopComments=function(a){this._readOgg(a);this._readMp4(a)};
WebAudio.prototype._readOgg=function(a){for(var b=0;b<a.length;)if("OggS"===this._readFourCharacters(a,b)){b+=26;for(var c=!1,d=a[b++],e=[],f=0;f<d;f++)e.push(a[b++]);for(f=0;f<d;f++)"vorb"===this._readFourCharacters(a,b+1)&&(c=a[b],1===c?this._sampleRate=this._readLittleEndian(a,b+12):3===c&&this._readMetaData(a,b,e[f]),c=!0),b+=e[f];if(!c)break}else break};
WebAudio.prototype._readMp4=function(a){if("ftyp"===this._readFourCharacters(a,4))for(var b=0;b<a.length;){var c=this._readBigEndian(a,b),d=this._readFourCharacters(a,b+4);if("moov"===d)b+=8;else if("mvhd"===d&&(this._sampleRate=this._readBigEndian(a,b+20)),"udta"!==d&&"meta"!==d||this._readMetaData(a,b,c),b+=c,1>=c)break}};
WebAudio.prototype._readMetaData=function(a,b,c){for(var d=b;d<b+c-10;d++)if("LOOP"===this._readFourCharacters(a,d)){for(var e="";0<a[d];)e+=String.fromCharCode(a[d++]);e.match(/LOOPSTART=([0-9]+)/)&&(this._loopStart=parseInt(RegExp.$1));e.match(/LOOPLENGTH=([0-9]+)/)&&(this._loopLength=parseInt(RegExp.$1));if("LOOPSTART"==e||"LOOPLENGTH"==e){var f="";for(d+=16;0<a[d];)f+=String.fromCharCode(a[d++]);"LOOPSTART"==e?this._loopStart=parseInt(f):this._loopLength=parseInt(f)}}};
WebAudio.prototype._readLittleEndian=function(a,b){return 16777216*a[b+3]+65536*a[b+2]+256*a[b+1]+a[b+0]};WebAudio.prototype._readBigEndian=function(a,b){return 16777216*a[b+0]+65536*a[b+1]+256*a[b+2]+a[b+3]};WebAudio.prototype._readFourCharacters=function(a,b){for(var c="",d=0;4>d;d++)c+=String.fromCharCode(a[b+d]);return c};function Html5Audio(){throw Error("This is a static class");}Html5Audio._initialized=!1;Html5Audio._unlocked=!1;Html5Audio._audioElement=null;Html5Audio._gainTweenInterval=null;
Html5Audio._tweenGain=0;Html5Audio._tweenTargetGain=0;Html5Audio._tweenGainStep=0;Html5Audio._staticSePath=null;Html5Audio.setup=function(a){this._initialized||this.initialize();this.clear();Decrypter.hasEncryptedAudio&&this._audioElement.src&&window.URL.revokeObjectURL(this._audioElement.src);this._url=a};
Html5Audio.initialize=function(){if(!this._initialized){if(!this._audioElement)try{this._audioElement=new Audio}catch(a){this._audioElement=null}this._audioElement&&this._setupEventHandlers();this._initialized=!0}return!!this._audioElement};
Html5Audio._setupEventHandlers=function(){document.addEventListener("touchstart",this._onTouchStart.bind(this));document.addEventListener("visibilitychange",this._onVisibilityChange.bind(this));this._audioElement.addEventListener("loadeddata",this._onLoadedData.bind(this));this._audioElement.addEventListener("error",this._onError.bind(this));this._audioElement.addEventListener("ended",this._onEnded.bind(this))};
Html5Audio._onTouchStart=function(){this._audioElement&&!this._unlocked&&(this._isLoading?(this._load(this._url),this._unlocked=!0):this._staticSePath&&(this._audioElement.src=this._staticSePath,this._audioElement.volume=0,this._audioElement.loop=!1,this._audioElement.play(),this._unlocked=!0))};Html5Audio._onVisibilityChange=function(){"hidden"===document.visibilityState?this._onHide():this._onShow()};Html5Audio._onLoadedData=function(){this._buffered=!0;this._unlocked&&this._onLoad()};
Html5Audio._onError=function(){this._hasError=!0};Html5Audio._onEnded=function(){this._audioElement.loop||this.stop()};Html5Audio._onHide=function(){this._tweenGain=this._audioElement.volume=0};Html5Audio._onShow=function(){this.fadeIn(.5)};Html5Audio.clear=function(){this.stop();this._volume=1;this._loadListeners=[];this._buffered=this._isLoading=this._autoPlay=this._hasError=!1};Html5Audio.setStaticSe=function(a){this._initialized||(this.initialize(),this.clear());this._staticSePath=a};
Object.defineProperty(Html5Audio,"url",{get:function(){return Html5Audio._url},configurable:!0});Object.defineProperty(Html5Audio,"volume",{get:function(){return Html5Audio._volume}.bind(this),set:function(a){Html5Audio._volume=a;Html5Audio._audioElement&&(Html5Audio._audioElement.volume=this._volume)},configurable:!0});Html5Audio.isReady=function(){return this._buffered};Html5Audio.isError=function(){return this._hasError};Html5Audio.isPlaying=function(){return!this._audioElement.paused};
Html5Audio.play=function(a,b){this.isReady()?(b=b||0,this._startPlaying(a,b)):Html5Audio._audioElement&&(this._autoPlay=!0,this.addLoadListener(function(){this._autoPlay&&(this.play(a,b),this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null))}.bind(this)),this._isLoading||this._load(this._url))};
Html5Audio.stop=function(){this._audioElement&&this._audioElement.pause();this._autoPlay=!1;this._tweenInterval&&(clearInterval(this._tweenInterval),this._tweenInterval=null,this._audioElement.volume=0)};Html5Audio.fadeIn=function(a){this.isReady()?this._audioElement&&(this._tweenTargetGain=this._volume,this._tweenGain=0,this._startGainTween(a)):this._autoPlay&&this.addLoadListener(function(){this.fadeIn(a)}.bind(this))};
Html5Audio.fadeOut=function(a){this._audioElement&&(this._tweenTargetGain=0,this._tweenGain=this._volume,this._startGainTween(a))};Html5Audio.seek=function(){return this._audioElement?this._audioElement.currentTime:0};Html5Audio.addLoadListener=function(a){this._loadListeners.push(a)};Html5Audio._load=function(a){this._audioElement&&(this._isLoading=!0,this._audioElement.src=a,this._audioElement.load())};
Html5Audio._startPlaying=function(a,b){this._audioElement.loop=a;this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null);this._audioElement&&(this._audioElement.volume=this._volume,this._audioElement.currentTime=b,this._audioElement.play())};Html5Audio._onLoad=function(){for(this._isLoading=!1;0<this._loadListeners.length;)this._loadListeners.shift()()};
Html5Audio._startGainTween=function(a){this._audioElement.volume=this._tweenGain;this._gainTweenInterval&&(clearInterval(this._gainTweenInterval),this._gainTweenInterval=null);this._tweenGainStep=(this._tweenTargetGain-this._tweenGain)/(60*a);this._gainTweenInterval=setInterval(function(){Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain)},1E3/60)};
Html5Audio._applyTweenValue=function(a){Html5Audio._tweenGain+=Html5Audio._tweenGainStep;0>Html5Audio._tweenGain&&0>Html5Audio._tweenGainStep?Html5Audio._tweenGain=0:Html5Audio._tweenGain>a&&0<Html5Audio._tweenGainStep&&(Html5Audio._tweenGain=a);.01>Math.abs(Html5Audio._tweenTargetGain-Html5Audio._tweenGain)&&(Html5Audio._tweenGain=Html5Audio._tweenTargetGain,clearInterval(Html5Audio._gainTweenInterval),Html5Audio._gainTweenInterval=null);Html5Audio._audioElement.volume=Html5Audio._tweenGain};
function JsonEx(){throw Error("This is a static class");}JsonEx.maxDepth=100;JsonEx._id=1;JsonEx._generateId=function(){return JsonEx._id++};JsonEx.stringify=function(a){var b=[];JsonEx._id=1;var c=JSON.stringify(this._encode(a,b,0));this._cleanMetadata(a);this._restoreCircularReference(b);return c};JsonEx._restoreCircularReference=function(a){a.forEach(function(b){b[1][b[0]]=b[2]})};
JsonEx.parse=function(a){var b=[],c={};a=this._decode(JSON.parse(a),b,c);this._cleanMetadata(a);this._linkCircularReference(a,b,c);return a};JsonEx._linkCircularReference=function(a,b,c){b.forEach(function(d){d[1][d[0]]=c[d[2]]})};JsonEx._cleanMetadata=function(a){a&&(delete a["@"],delete a["@c"],"object"===typeof a&&Object.keys(a).forEach(function(b){b=a[b];"object"===typeof b&&JsonEx._cleanMetadata(b)}))};JsonEx.makeDeepCopy=function(a){return this.parse(this.stringify(a))};
JsonEx._encode=function(a,b,c){c=c||0;if(++c>=this.maxDepth)throw Error("Object too deep");var d=Object.prototype.toString.call(a);if("[object Object]"===d||"[object Array]"===d){a["@c"]=JsonEx._generateId();d=this._getConstructorName(a);"Object"!==d&&"Array"!==d&&(a["@"]=d);for(var e in a)a.hasOwnProperty(e)&&!e.match(/^@./)&&(a[e]&&"object"===typeof a[e]?a[e]["@c"]?(b.push([e,a,a[e]]),a[e]={"@r":a[e]["@c"]}):(a[e]=this._encode(a[e],b,c+1),a[e]instanceof Array&&(b.push([e,a,a[e]]),a[e]={"@c":a[e]["@c"],
"@a":a[e]})):a[e]=this._encode(a[e],b,c+1))}return a};JsonEx._decode=function(a,b,c){var d=Object.prototype.toString.call(a);if("[object Object]"===d||"[object Array]"===d){c[a["@c"]]=a;a["@"]&&(d=window[a["@"]])&&(a=this._resetPrototype(a,d.prototype));for(var e in a)a.hasOwnProperty(e)&&(a[e]&&a[e]["@a"]&&(d=a[e]["@a"],d["@c"]=a[e]["@c"],a[e]=d),a[e]&&a[e]["@r"]&&b.push([e,a,a[e]["@r"]]),a[e]=this._decode(a[e],b,c))}return a};
JsonEx._getConstructorName=function(a){var b=a.constructor.name;void 0===b&&(b=/^\s*function\s*([A-Za-z0-9_$]*)/.exec(a.constructor)[1]);return b};JsonEx._resetPrototype=function(a,b){if(void 0!==Object.setPrototypeOf)Object.setPrototypeOf(a,b);else if("__proto__"in a)a.__proto__=b;else{b=Object.create(b);for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);a=b}return a};function Decrypter(){throw Error("This is a static class");}Decrypter.hasEncryptedImages=!1;Decrypter.hasEncryptedAudio=!1;
Decrypter._requestImgFile=[];Decrypter._headerlength=16;Decrypter._xhrOk=400;Decrypter._encryptionKey="";Decrypter._ignoreList=["img/system/Window.png"];Decrypter.SIGNATURE="5250474d56000000";Decrypter.VER="000301";Decrypter.REMAIN="0000000000";Decrypter.checkImgIgnore=function(a){for(var b=0;b<this._ignoreList.length;b++)if(a===this._ignoreList[b])return!0;return!1};
Decrypter.decryptImg=function(a,b){a=this.extToEncryptExt(a);var c=new XMLHttpRequest;c.open("GET",a);c.responseType="arraybuffer";c.send();c.onload=function(){if(this.status<Decrypter._xhrOk){var d=Decrypter.decryptArrayBuffer(c.response);b._image.src=Decrypter.createBlobUrl(d);b._image.addEventListener("load",b._loadListener=Bitmap.prototype._onLoad.bind(b));b._image.addEventListener("error",b._errorListener=b._loader||Bitmap.prototype._onError.bind(b))}};c.onerror=function(){b._loader?b._loader():
b._onError()}};Decrypter.decryptHTML5Audio=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a);d.responseType="arraybuffer";d.send();d.onload=function(){if(this.status<Decrypter._xhrOk){var e=Decrypter.decryptArrayBuffer(d.response);e=Decrypter.createBlobUrl(e);AudioManager.createDecryptBuffer(e,b,c)}}};Decrypter.cutArrayHeader=function(a,b){return a.slice(b)};
Decrypter.decryptArrayBuffer=function(a){if(!a)return null;var b=new Uint8Array(a,0,this._headerlength),c,d=this.SIGNATURE+this.VER+this.REMAIN,e=new Uint8Array(16);for(c=0;c<this._headerlength;c++)e[c]=parseInt("0x"+d.substr(2*c,2),16);for(c=0;c<this._headerlength;c++)if(b[c]!==e[c])throw Error("Header is wrong");a=this.cutArrayHeader(a,Decrypter._headerlength);b=new DataView(a);this.readEncryptionkey();if(a)for(d=new Uint8Array(a),c=0;c<this._headerlength;c++)d[c]^=parseInt(Decrypter._encryptionKey[c],
16),b.setUint8(c,d[c]);return a};Decrypter.createBlobUrl=function(a){a=new Blob([a]);return window.URL.createObjectURL(a)};Decrypter.extToEncryptExt=function(a){var b=a.split(".").pop();var c="ogg"===b?".rpgmvo":"m4a"===b?".rpgmvm":"png"===b?".rpgmvp":b;return a.slice(0,a.lastIndexOf(b)-1)+c};Decrypter.readEncryptionkey=function(){this._encryptionKey=$dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean)};function ResourceHandler(){throw Error("This is a static class");}
ResourceHandler._reloaders=[];ResourceHandler._defaultRetryInterval=[500,1E3,3E3];ResourceHandler.createLoader=function(a,b,c,d){d=d||this._defaultRetryInterval;var e=this._reloaders,f=0;return function(){f<d.length?(setTimeout(b,d[f]),f++):(c&&c(),a&&(0===e.length&&(Graphics.printLoadingError(a),SceneManager.stop()),e.push(function(){f=0;b()})))}};ResourceHandler.exists=function(){return 0<this._reloaders.length};
ResourceHandler.retry=function(){0<this._reloaders.length&&(Graphics.eraseLoadingError(),SceneManager.resume(),this._reloaders.forEach(function(a){a()}),this._reloaders.length=0)};function DataManager(){throw Error("This is a static class");}
var $dataActors=null,$dataClasses=null,$dataSkills=null,$dataItems=null,$dataWeapons=null,$dataArmors=null,$dataEnemies=null,$dataTroops=null,$dataStates=null,$dataAnimations=null,$dataTilesets=null,$dataCommonEvents=null,$dataSystem=null,$dataMapInfos=null,$dataMap=null,$gameTemp=null,$gameSystem=null,$gameScreen=null,$gameTimer=null,$gameMessage=null,$gameSwitches=null,$gameVariables=null,$gameSelfSwitches=null,$gameActors=null,$gameParty=null,$gameTroop=null,$gameMap=null,$gamePlayer=null,$testEvent=
null;DataManager._globalId="RPGMV";DataManager._lastAccessedId=1;DataManager._errorUrl=null;
DataManager._databaseFiles=[{name:"$dataActors",src:"Actors.json"},{name:"$dataClasses",src:"Classes.json"},{name:"$dataSkills",src:"Skills.json"},{name:"$dataItems",src:"Items.json"},{name:"$dataWeapons",src:"Weapons.json"},{name:"$dataArmors",src:"Armors.json"},{name:"$dataEnemies",src:"Enemies.json"},{name:"$dataTroops",src:"Troops.json"},{name:"$dataStates",src:"States.json"},{name:"$dataAnimations",src:"Animations.json"},{name:"$dataTilesets",src:"Tilesets.json"},{name:"$dataCommonEvents",src:"CommonEvents.json"},
{name:"$dataSystem",src:"System.json"},{name:"$dataMapInfos",src:"MapInfos.json"}];DataManager.loadDatabase=function(){for(var a=this.isBattleTest()||this.isEventTest()?"Test_":"",b=0;b<this._databaseFiles.length;b++)this.loadDataFile(this._databaseFiles[b].name,a+this._databaseFiles[b].src);this.isEventTest()&&this.loadDataFile("$testEvent",a+"Event.json")};
DataManager.loadDataFile=function(a,b){var c=new XMLHttpRequest,d="data/"+b;c.open("GET",d);c.overrideMimeType("application/json");c.onload=function(){400>c.status&&(window[a]=JSON.parse(c.responseText),DataManager.onLoad(window[a]))};c.onerror=this._mapLoader||function(){DataManager._errorUrl=DataManager._errorUrl||d};window[a]=null;c.send()};DataManager.isDatabaseLoaded=function(){this.checkError();for(var a=0;a<this._databaseFiles.length;a++)if(!window[this._databaseFiles[a].name])return!1;return!0};
DataManager.loadMapData=function(a){0<a?(a="Map%1.json".format(a.padZero(3)),this._mapLoader=ResourceHandler.createLoader("data/"+a,this.loadDataFile.bind(this,"$dataMap",a)),this.loadDataFile("$dataMap",a)):this.makeEmptyMap()};DataManager.makeEmptyMap=function(){$dataMap={data:[],events:[],width:100,height:100,scrollType:3}};DataManager.isMapLoaded=function(){this.checkError();return!!$dataMap};
DataManager.onLoad=function(a){if(a===$dataMap){this.extractMetadata(a);var b=a.events}else b=a;if(Array.isArray(b))for(var c=0;c<b.length;c++){var d=b[c];d&&void 0!==d.note&&this.extractMetadata(d)}a===$dataSystem&&(Decrypter.hasEncryptedImages=!!a.hasEncryptedImages,Decrypter.hasEncryptedAudio=!!a.hasEncryptedAudio,Scene_Boot.loadSystemImages())};DataManager.extractMetadata=function(a){var b=/<([^<>:]+)(:?)([^>]*)>/g;for(a.meta={};;){var c=b.exec(a.note);if(c)a.meta[c[1]]=":"===c[2]?c[3]:!0;else break}};
DataManager.checkError=function(){if(DataManager._errorUrl)throw Error("Failed to load: "+DataManager._errorUrl);};DataManager.isBattleTest=function(){return Utils.isOptionValid("btest")};DataManager.isEventTest=function(){return Utils.isOptionValid("etest")};DataManager.isSkill=function(a){return a&&$dataSkills.contains(a)};DataManager.isItem=function(a){return a&&$dataItems.contains(a)};DataManager.isWeapon=function(a){return a&&$dataWeapons.contains(a)};
DataManager.isArmor=function(a){return a&&$dataArmors.contains(a)};DataManager.createGameObjects=function(){$gameTemp=new Game_Temp;$gameSystem=new Game_System;$gameScreen=new Game_Screen;$gameTimer=new Game_Timer;$gameMessage=new Game_Message;$gameSwitches=new Game_Switches;$gameVariables=new Game_Variables;$gameSelfSwitches=new Game_SelfSwitches;$gameActors=new Game_Actors;$gameParty=new Game_Party;$gameTroop=new Game_Troop;$gameMap=new Game_Map;$gamePlayer=new Game_Player};
DataManager.setupNewGame=function(){this.createGameObjects();this.selectSavefileForNewGame();$gameParty.setupStartingMembers();$gamePlayer.reserveTransfer($dataSystem.startMapId,$dataSystem.startX,$dataSystem.startY);Graphics.frameCount=0};DataManager.setupBattleTest=function(){this.createGameObjects();$gameParty.setupBattleTest();BattleManager.setup($dataSystem.testTroopId,!0,!1);BattleManager.setBattleTest(!0);BattleManager.playBattleBgm()};
DataManager.setupEventTest=function(){this.createGameObjects();this.selectSavefileForNewGame();$gameParty.setupStartingMembers();$gamePlayer.reserveTransfer(-1,8,6);$gamePlayer.setTransparent(!1)};DataManager.loadGlobalInfo=function(){try{var a=StorageManager.load(0)}catch(c){return console.error(c),[]}if(a){a=JSON.parse(a);for(var b=1;b<=this.maxSavefiles();b++)StorageManager.exists(b)||delete a[b];return a}return[]};DataManager.saveGlobalInfo=function(a){StorageManager.save(0,JSON.stringify(a))};
DataManager.isThisGameFile=function(a){var b=this.loadGlobalInfo();if(b&&b[a]){if(StorageManager.isLocalMode())return!0;a=b[a];return a.globalId===this._globalId&&a.title===$dataSystem.gameTitle}return!1};DataManager.isAnySavefileExists=function(){var a=this.loadGlobalInfo();if(a)for(var b=1;b<a.length;b++)if(this.isThisGameFile(b))return!0;return!1};
DataManager.latestSavefileId=function(){var a=this.loadGlobalInfo(),b=1,c=0;if(a)for(var d=1;d<a.length;d++)this.isThisGameFile(d)&&a[d].timestamp>c&&(c=a[d].timestamp,b=d);return b};DataManager.loadAllSavefileImages=function(){var a=this.loadGlobalInfo();if(a)for(var b=1;b<a.length;b++)this.isThisGameFile(b)&&this.loadSavefileImages(a[b])};
DataManager.loadSavefileImages=function(a){if(a.characters)for(var b=0;b<a.characters.length;b++)ImageManager.reserveCharacter(a.characters[b][0]);if(a.faces)for(b=0;b<a.faces.length;b++)ImageManager.reserveFace(a.faces[b][0])};DataManager.maxSavefiles=function(){return 20};DataManager.saveGame=function(a){try{return StorageManager.backup(a),this.saveGameWithoutRescue(a)}catch(b){console.error(b);try{StorageManager.remove(a),StorageManager.restoreBackup(a)}catch(c){}return!1}};
DataManager.loadGame=function(a){try{return this.loadGameWithoutRescue(a)}catch(b){return console.error(b),!1}};DataManager.loadSavefileInfo=function(a){var b=this.loadGlobalInfo();return b&&b[a]?b[a]:null};DataManager.lastAccessedSavefileId=function(){return this._lastAccessedId};
DataManager.saveGameWithoutRescue=function(a){var b=JsonEx.stringify(this.makeSaveContents());2E5<=b.length&&console.warn("Save data too big!");StorageManager.save(a,b);this._lastAccessedId=a;b=this.loadGlobalInfo()||[];b[a]=this.makeSavefileInfo();this.saveGlobalInfo(b);return!0};DataManager.loadGameWithoutRescue=function(a){this.loadGlobalInfo();if(this.isThisGameFile(a)){var b=StorageManager.load(a);this.createGameObjects();this.extractSaveContents(JsonEx.parse(b));this._lastAccessedId=a;return!0}return!1};
DataManager.selectSavefileForNewGame=function(){var a=this.loadGlobalInfo();this._lastAccessedId=1;if(a){var b=Math.max(0,a.length-1);if(b<this.maxSavefiles())this._lastAccessedId=b+1;else{b=Number.MAX_VALUE;for(var c=1;c<a.length;c++){if(!a[c]){this._lastAccessedId=c;break}a[c].timestamp<b&&(b=a[c].timestamp,this._lastAccessedId=c)}}}};
DataManager.makeSavefileInfo=function(){var a={};a.globalId=this._globalId;a.title=$dataSystem.gameTitle;a.characters=$gameParty.charactersForSavefile();a.faces=$gameParty.facesForSavefile();a.playtime=$gameSystem.playtimeText();a.timestamp=Date.now();return a};
DataManager.makeSaveContents=function(){var a={};a.system=$gameSystem;a.screen=$gameScreen;a.timer=$gameTimer;a.switches=$gameSwitches;a.variables=$gameVariables;a.selfSwitches=$gameSelfSwitches;a.actors=$gameActors;a.party=$gameParty;a.map=$gameMap;a.player=$gamePlayer;return a};
DataManager.extractSaveContents=function(a){$gameSystem=a.system;$gameScreen=a.screen;$gameTimer=a.timer;$gameSwitches=a.switches;$gameVariables=a.variables;$gameSelfSwitches=a.selfSwitches;$gameActors=a.actors;$gameParty=a.party;$gameMap=a.map;$gamePlayer=a.player};function ConfigManager(){throw Error("This is a static class");}ConfigManager.alwaysDash=!1;ConfigManager.commandRemember=!1;
Object.defineProperty(ConfigManager,"bgmVolume",{get:function(){return AudioManager._bgmVolume},set:function(a){AudioManager.bgmVolume=a},configurable:!0});Object.defineProperty(ConfigManager,"bgsVolume",{get:function(){return AudioManager.bgsVolume},set:function(a){AudioManager.bgsVolume=a},configurable:!0});Object.defineProperty(ConfigManager,"meVolume",{get:function(){return AudioManager.meVolume},set:function(a){AudioManager.meVolume=a},configurable:!0});
Object.defineProperty(ConfigManager,"seVolume",{get:function(){return AudioManager.seVolume},set:function(a){AudioManager.seVolume=a},configurable:!0});ConfigManager.load=function(){var a={};try{var b=StorageManager.load(-1)}catch(c){console.error(c)}b&&(a=JSON.parse(b));this.applyData(a)};ConfigManager.save=function(){StorageManager.save(-1,JSON.stringify(this.makeData()))};
ConfigManager.makeData=function(){var a={};a.alwaysDash=this.alwaysDash;a.commandRemember=this.commandRemember;a.bgmVolume=this.bgmVolume;a.bgsVolume=this.bgsVolume;a.meVolume=this.meVolume;a.seVolume=this.seVolume;return a};
ConfigManager.applyData=function(a){this.alwaysDash=this.readFlag(a,"alwaysDash");this.commandRemember=this.readFlag(a,"commandRemember");this.bgmVolume=this.readVolume(a,"bgmVolume");this.bgsVolume=this.readVolume(a,"bgsVolume");this.meVolume=this.readVolume(a,"meVolume");this.seVolume=this.readVolume(a,"seVolume")};ConfigManager.readFlag=function(a,b){return!!a[b]};ConfigManager.readVolume=function(a,b){a=a[b];return void 0!==a?Number(a).clamp(0,100):100};
function StorageManager(){throw Error("This is a static class");}StorageManager.save=function(a,b){this.isLocalMode()?this.saveToLocalFile(a,b):this.saveToWebStorage(a,b)};StorageManager.load=function(a){return this.isLocalMode()?this.loadFromLocalFile(a):this.loadFromWebStorage(a)};StorageManager.exists=function(a){return this.isLocalMode()?this.localFileExists(a):this.webStorageExists(a)};StorageManager.remove=function(a){this.isLocalMode()?this.removeLocalFile(a):this.removeWebStorage(a)};
StorageManager.backup=function(a){if(this.exists(a))if(this.isLocalMode()){var b=this.loadFromLocalFile(a);b=LZString.compressToBase64(b);var c=require("fs"),d=this.localFileDirectoryPath();a=this.localFilePath(a)+".bak";c.existsSync(d)||c.mkdirSync(d);c.writeFileSync(a,b)}else b=this.loadFromWebStorage(a),b=LZString.compressToBase64(b),a=this.webStorageKey(a)+"bak",localStorage.setItem(a,b)};StorageManager.backupExists=function(a){return this.isLocalMode()?this.localFileBackupExists(a):this.webStorageBackupExists(a)};
StorageManager.cleanBackup=function(a){if(this.backupExists(a))if(this.isLocalMode()){var b=require("fs");this.localFileDirectoryPath();a=this.localFilePath(a);b.unlinkSync(a+".bak")}else b=this.webStorageKey(a),localStorage.removeItem(b+"bak")};
StorageManager.restoreBackup=function(a){if(this.backupExists(a))if(this.isLocalMode()){var b=this.loadFromLocalBackupFile(a);b=LZString.compressToBase64(b);var c=require("fs"),d=this.localFileDirectoryPath();a=this.localFilePath(a);c.existsSync(d)||c.mkdirSync(d);c.writeFileSync(a,b);c.unlinkSync(a+".bak")}else b=this.loadFromWebStorageBackup(a),b=LZString.compressToBase64(b),a=this.webStorageKey(a),localStorage.setItem(a,b),localStorage.removeItem(a+"bak")};StorageManager.isLocalMode=function(){return Utils.isNwjs()};
StorageManager.saveToLocalFile=function(a,b){b=LZString.compressToBase64(b);var c=require("fs"),d=this.localFileDirectoryPath();a=this.localFilePath(a);c.existsSync(d)||c.mkdirSync(d);c.writeFileSync(a,b)};StorageManager.loadFromLocalFile=function(a){var b=null,c=require("fs");a=this.localFilePath(a);c.existsSync(a)&&(b=c.readFileSync(a,{encoding:"utf8"}));return LZString.decompressFromBase64(b)};
StorageManager.loadFromLocalBackupFile=function(a){var b=null,c=require("fs");a=this.localFilePath(a)+".bak";c.existsSync(a)&&(b=c.readFileSync(a,{encoding:"utf8"}));return LZString.decompressFromBase64(b)};StorageManager.localFileBackupExists=function(a){return require("fs").existsSync(this.localFilePath(a)+".bak")};StorageManager.localFileExists=function(a){return require("fs").existsSync(this.localFilePath(a))};
StorageManager.removeLocalFile=function(a){var b=require("fs");a=this.localFilePath(a);b.existsSync(a)&&b.unlinkSync(a)};StorageManager.saveToWebStorage=function(a,b){a=this.webStorageKey(a);b=LZString.compressToBase64(b);localStorage.setItem(a,b)};StorageManager.loadFromWebStorage=function(a){a=this.webStorageKey(a);a=localStorage.getItem(a);return LZString.decompressFromBase64(a)};StorageManager.loadFromWebStorageBackup=function(a){a=this.webStorageKey(a)+"bak";a=localStorage.getItem(a);return LZString.decompressFromBase64(a)};
StorageManager.webStorageBackupExists=function(a){a=this.webStorageKey(a)+"bak";return!!localStorage.getItem(a)};StorageManager.webStorageExists=function(a){a=this.webStorageKey(a);return!!localStorage.getItem(a)};StorageManager.removeWebStorage=function(a){a=this.webStorageKey(a);localStorage.removeItem(a)};StorageManager.localFileDirectoryPath=function(){var a=require("path"),b=a.dirname(process.mainModule.filename);return a.join(b,"save/")};
StorageManager.localFilePath=function(a){a=0>a?"config.rpgsave":0===a?"global.rpgsave":"file%1.rpgsave".format(a);return this.localFileDirectoryPath()+a};StorageManager.webStorageKey=function(a){return 0>a?"RPG Config":0===a?"RPG Global":"RPG File%1".format(a)};function ImageManager(){throw Error("This is a static class");}ImageManager.cache=new CacheMap(ImageManager);ImageManager._imageCache=new ImageCache;ImageManager._requestQueue=new RequestQueue;ImageManager._systemReservationId=Utils.generateRuntimeId();
ImageManager._generateCacheKey=function(a,b){return a+":"+b};ImageManager.loadAnimation=function(a,b){return this.loadBitmap("img/animations/",a,b,!0)};ImageManager.loadBattleback1=function(a,b){return this.loadBitmap("img/battlebacks1/",a,b,!0)};ImageManager.loadBattleback2=function(a,b){return this.loadBitmap("img/battlebacks2/",a,b,!0)};ImageManager.loadEnemy=function(a,b){return this.loadBitmap("img/enemies/",a,b,!0)};
ImageManager.loadCharacter=function(a,b){return this.loadBitmap("img/characters/",a,b,!1)};ImageManager.loadFace=function(a,b){return this.loadBitmap("img/faces/",a,b,!0)};ImageManager.loadParallax=function(a,b){return this.loadBitmap("img/parallaxes/",a,b,!0)};ImageManager.loadPicture=function(a,b){return this.loadBitmap("img/pictures/",a,b,!0)};ImageManager.loadSvActor=function(a,b){return this.loadBitmap("img/sv_actors/",a,b,!1)};
ImageManager.loadSvEnemy=function(a,b){return this.loadBitmap("img/sv_enemies/",a,b,!0)};ImageManager.loadSystem=function(a,b){return this.loadBitmap("img/system/",a,b,!1)};ImageManager.loadTileset=function(a,b){return this.loadBitmap("img/tilesets/",a,b,!1)};ImageManager.loadTitle1=function(a,b){return this.loadBitmap("img/titles1/",a,b,!0)};ImageManager.loadTitle2=function(a,b){return this.loadBitmap("img/titles2/",a,b,!0)};
ImageManager.loadBitmap=function(a,b,c,d){return b?(a=a+encodeURIComponent(b)+".png",c=this.loadNormalBitmap(a,c||0),c.smooth=d,c):this.loadEmptyBitmap()};ImageManager.loadEmptyBitmap=function(){var a=this._imageCache.get("empty");a||(a=new Bitmap,this._imageCache.add("empty",a),this._imageCache.reserve("empty",a,this._systemReservationId));return a};
ImageManager.loadNormalBitmap=function(a,b){var c=this._generateCacheKey(a,b),d=this._imageCache.get(c);d?d.isReady()||d.decode():(d=Bitmap.load(decodeURIComponent(a)),d.addLoadListener(function(){d.rotateHue(b)}),this._imageCache.add(c,d));return d};ImageManager.clear=function(){this._imageCache=new ImageCache};ImageManager.isReady=function(){return this._imageCache.isReady()};ImageManager.isObjectCharacter=function(a){return(a=a.match(/^[!\$]+/))&&a[0].contains("!")};
ImageManager.isBigCharacter=function(a){return(a=a.match(/^[!\$]+/))&&a[0].contains("$")};ImageManager.isZeroParallax=function(a){return"!"===a.charAt(0)};ImageManager.reserveAnimation=function(a,b,c){return this.reserveBitmap("img/animations/",a,b,!0,c)};ImageManager.reserveBattleback1=function(a,b,c){return this.reserveBitmap("img/battlebacks1/",a,b,!0,c)};ImageManager.reserveBattleback2=function(a,b,c){return this.reserveBitmap("img/battlebacks2/",a,b,!0,c)};
ImageManager.reserveEnemy=function(a,b,c){return this.reserveBitmap("img/enemies/",a,b,!0,c)};ImageManager.reserveCharacter=function(a,b,c){return this.reserveBitmap("img/characters/",a,b,!1,c)};ImageManager.reserveFace=function(a,b,c){return this.reserveBitmap("img/faces/",a,b,!0,c)};ImageManager.reserveParallax=function(a,b,c){return this.reserveBitmap("img/parallaxes/",a,b,!0,c)};ImageManager.reservePicture=function(a,b,c){return this.reserveBitmap("img/pictures/",a,b,!0,c)};
ImageManager.reserveSvActor=function(a,b,c){return this.reserveBitmap("img/sv_actors/",a,b,!1,c)};ImageManager.reserveSvEnemy=function(a,b,c){return this.reserveBitmap("img/sv_enemies/",a,b,!0,c)};ImageManager.reserveSystem=function(a,b,c){return this.reserveBitmap("img/system/",a,b,!1,c||this._systemReservationId)};ImageManager.reserveTileset=function(a,b,c){return this.reserveBitmap("img/tilesets/",a,b,!1,c)};
ImageManager.reserveTitle1=function(a,b,c){return this.reserveBitmap("img/titles1/",a,b,!0,c)};ImageManager.reserveTitle2=function(a,b,c){return this.reserveBitmap("img/titles2/",a,b,!0,c)};ImageManager.reserveBitmap=function(a,b,c,d,e){return b?(a=a+encodeURIComponent(b)+".png",c=this.reserveNormalBitmap(a,c||0,e||this._defaultReservationId),c.smooth=d,c):this.loadEmptyBitmap()};
ImageManager.reserveNormalBitmap=function(a,b,c){var d=this.loadNormalBitmap(a,b);this._imageCache.reserve(this._generateCacheKey(a,b),d,c);return d};ImageManager.releaseReservation=function(a){this._imageCache.releaseReservation(a)};ImageManager.setDefaultReservationId=function(a){this._defaultReservationId=a};ImageManager.requestAnimation=function(a,b){return this.requestBitmap("img/animations/",a,b,!0)};
ImageManager.requestBattleback1=function(a,b){return this.requestBitmap("img/battlebacks1/",a,b,!0)};ImageManager.requestBattleback2=function(a,b){return this.requestBitmap("img/battlebacks2/",a,b,!0)};ImageManager.requestEnemy=function(a,b){return this.requestBitmap("img/enemies/",a,b,!0)};ImageManager.requestCharacter=function(a,b){return this.requestBitmap("img/characters/",a,b,!1)};ImageManager.requestFace=function(a,b){return this.requestBitmap("img/faces/",a,b,!0)};
ImageManager.requestParallax=function(a,b){return this.requestBitmap("img/parallaxes/",a,b,!0)};ImageManager.requestPicture=function(a,b){return this.requestBitmap("img/pictures/",a,b,!0)};ImageManager.requestSvActor=function(a,b){return this.requestBitmap("img/sv_actors/",a,b,!1)};ImageManager.requestSvEnemy=function(a,b){return this.requestBitmap("img/sv_enemies/",a,b,!0)};ImageManager.requestSystem=function(a,b){return this.requestBitmap("img/system/",a,b,!1)};
ImageManager.requestTileset=function(a,b){return this.requestBitmap("img/tilesets/",a,b,!1)};ImageManager.requestTitle1=function(a,b){return this.requestBitmap("img/titles1/",a,b,!0)};ImageManager.requestTitle2=function(a,b){return this.requestBitmap("img/titles2/",a,b,!0)};ImageManager.requestBitmap=function(a,b,c,d){return b?(a=a+encodeURIComponent(b)+".png",c=this.requestNormalBitmap(a,c||0),c.smooth=d,c):this.loadEmptyBitmap()};
ImageManager.requestNormalBitmap=function(a,b){var c=this._generateCacheKey(a,b),d=this._imageCache.get(c);d?this._requestQueue.raisePriority(c):(d=Bitmap.request(a),d.addLoadListener(function(){d.rotateHue(b)}),this._imageCache.add(c,d),this._requestQueue.enqueue(c,d));return d};ImageManager.update=function(){this._requestQueue.update()};ImageManager.clearRequest=function(){this._requestQueue.clear()};function AudioManager(){throw Error("This is a static class");}AudioManager._masterVolume=1;
AudioManager._bgmVolume=100;AudioManager._bgsVolume=100;AudioManager._meVolume=100;AudioManager._seVolume=100;AudioManager._currentBgm=null;AudioManager._currentBgs=null;AudioManager._bgmBuffer=null;AudioManager._bgsBuffer=null;AudioManager._meBuffer=null;AudioManager._seBuffers=[];AudioManager._staticBuffers=[];AudioManager._replayFadeTime=.5;AudioManager._path="audio/";AudioManager._blobUrl=null;
Object.defineProperty(AudioManager,"masterVolume",{get:function(){return this._masterVolume},set:function(a){this._masterVolume=a;WebAudio.setMasterVolume(this._masterVolume);Graphics.setVideoVolume(this._masterVolume)},configurable:!0});Object.defineProperty(AudioManager,"bgmVolume",{get:function(){return this._bgmVolume},set:function(a){this._bgmVolume=a;this.updateBgmParameters(this._currentBgm)},configurable:!0});
Object.defineProperty(AudioManager,"bgsVolume",{get:function(){return this._bgsVolume},set:function(a){this._bgsVolume=a;this.updateBgsParameters(this._currentBgs)},configurable:!0});Object.defineProperty(AudioManager,"meVolume",{get:function(){return this._meVolume},set:function(a){this._meVolume=a;this.updateMeParameters(this._currentMe)},configurable:!0});Object.defineProperty(AudioManager,"seVolume",{get:function(){return this._seVolume},set:function(a){this._seVolume=a},configurable:!0});
AudioManager.playBgm=function(a,b){this.isCurrentBgm(a)?this.updateBgmParameters(a):(this.stopBgm(),a.name&&(Decrypter.hasEncryptedAudio&&this.shouldUseHtml5Audio()?this.playEncryptedBgm(a,b):(this._bgmBuffer=this.createBuffer("bgm",a.name),this.updateBgmParameters(a),this._meBuffer||this._bgmBuffer.play(!0,b||0))));this.updateCurrentBgm(a,b)};
AudioManager.playEncryptedBgm=function(a,b){var c=this.audioFileExt();c=this._path+"bgm/"+encodeURIComponent(a.name)+c;c=Decrypter.extToEncryptExt(c);Decrypter.decryptHTML5Audio(c,a,b)};AudioManager.createDecryptBuffer=function(a,b,c){this._blobUrl=a;this._bgmBuffer=this.createBuffer("bgm",b.name);this.updateBgmParameters(b);this._meBuffer||this._bgmBuffer.play(!0,c||0);this.updateCurrentBgm(b,c)};
AudioManager.replayBgm=function(a){this.isCurrentBgm(a)?this.updateBgmParameters(a):(this.playBgm(a,a.pos),this._bgmBuffer&&this._bgmBuffer.fadeIn(this._replayFadeTime))};AudioManager.isCurrentBgm=function(a){return this._currentBgm&&this._bgmBuffer&&this._currentBgm.name===a.name};AudioManager.updateBgmParameters=function(a){this.updateBufferParameters(this._bgmBuffer,this._bgmVolume,a)};
AudioManager.updateCurrentBgm=function(a,b){this._currentBgm={name:a.name,volume:a.volume,pitch:a.pitch,pan:a.pan,pos:b}};AudioManager.stopBgm=function(){this._bgmBuffer&&(this._bgmBuffer.stop(),this._currentBgm=this._bgmBuffer=null)};AudioManager.fadeOutBgm=function(a){this._bgmBuffer&&this._currentBgm&&(this._bgmBuffer.fadeOut(a),this._currentBgm=null)};AudioManager.fadeInBgm=function(a){this._bgmBuffer&&this._currentBgm&&this._bgmBuffer.fadeIn(a)};
AudioManager.playBgs=function(a,b){this.isCurrentBgs(a)?this.updateBgsParameters(a):(this.stopBgs(),a.name&&(this._bgsBuffer=this.createBuffer("bgs",a.name),this.updateBgsParameters(a),this._bgsBuffer.play(!0,b||0)));this.updateCurrentBgs(a,b)};AudioManager.replayBgs=function(a){this.isCurrentBgs(a)?this.updateBgsParameters(a):(this.playBgs(a,a.pos),this._bgsBuffer&&this._bgsBuffer.fadeIn(this._replayFadeTime))};
AudioManager.isCurrentBgs=function(a){return this._currentBgs&&this._bgsBuffer&&this._currentBgs.name===a.name};AudioManager.updateBgsParameters=function(a){this.updateBufferParameters(this._bgsBuffer,this._bgsVolume,a)};AudioManager.updateCurrentBgs=function(a,b){this._currentBgs={name:a.name,volume:a.volume,pitch:a.pitch,pan:a.pan,pos:b}};AudioManager.stopBgs=function(){this._bgsBuffer&&(this._bgsBuffer.stop(),this._currentBgs=this._bgsBuffer=null)};
AudioManager.fadeOutBgs=function(a){this._bgsBuffer&&this._currentBgs&&(this._bgsBuffer.fadeOut(a),this._currentBgs=null)};AudioManager.fadeInBgs=function(a){this._bgsBuffer&&this._currentBgs&&this._bgsBuffer.fadeIn(a)};AudioManager.playMe=function(a){this.stopMe();a.name&&(this._bgmBuffer&&this._currentBgm&&(this._currentBgm.pos=this._bgmBuffer.seek(),this._bgmBuffer.stop()),this._meBuffer=this.createBuffer("me",a.name),this.updateMeParameters(a),this._meBuffer.play(!1),this._meBuffer.addStopListener(this.stopMe.bind(this)))};
AudioManager.updateMeParameters=function(a){this.updateBufferParameters(this._meBuffer,this._meVolume,a)};AudioManager.fadeOutMe=function(a){this._meBuffer&&this._meBuffer.fadeOut(a)};AudioManager.stopMe=function(){this._meBuffer&&(this._meBuffer.stop(),this._meBuffer=null,this._bgmBuffer&&this._currentBgm&&!this._bgmBuffer.isPlaying()&&(this._bgmBuffer.play(!0,this._currentBgm.pos),this._bgmBuffer.fadeIn(this._replayFadeTime)))};
AudioManager.playSe=function(a){if(a.name){this._seBuffers=this._seBuffers.filter(function(c){return c.isPlaying()});var b=this.createBuffer("se",a.name);this.updateSeParameters(b,a);b.play(!1);this._seBuffers.push(b)}};AudioManager.updateSeParameters=function(a,b){this.updateBufferParameters(a,this._seVolume,b)};AudioManager.stopSe=function(){this._seBuffers.forEach(function(a){a.stop()});this._seBuffers=[]};
AudioManager.playStaticSe=function(a){if(a.name){this.loadStaticSe(a);for(var b=0;b<this._staticBuffers.length;b++){var c=this._staticBuffers[b];if(c._reservedSeName===a.name){c.stop();this.updateSeParameters(c,a);c.play(!1);break}}}};AudioManager.loadStaticSe=function(a){if(a.name&&!this.isStaticSe(a)){var b=this.createBuffer("se",a.name);b._reservedSeName=a.name;this._staticBuffers.push(b);this.shouldUseHtml5Audio()&&Html5Audio.setStaticSe(b._url)}};
AudioManager.isStaticSe=function(a){for(var b=0;b<this._staticBuffers.length;b++)if(this._staticBuffers[b]._reservedSeName===a.name)return!0;return!1};AudioManager.stopAll=function(){this.stopMe();this.stopBgm();this.stopBgs();this.stopSe()};AudioManager.saveBgm=function(){if(this._currentBgm){var a=this._currentBgm;return{name:a.name,volume:a.volume,pitch:a.pitch,pan:a.pan,pos:this._bgmBuffer?this._bgmBuffer.seek():0}}return this.makeEmptyAudioObject()};
AudioManager.saveBgs=function(){if(this._currentBgs){var a=this._currentBgs;return{name:a.name,volume:a.volume,pitch:a.pitch,pan:a.pan,pos:this._bgsBuffer?this._bgsBuffer.seek():0}}return this.makeEmptyAudioObject()};AudioManager.makeEmptyAudioObject=function(){return{name:"",volume:0,pitch:0}};
AudioManager.createBuffer=function(a,b){var c=this.audioFileExt();b=this._path+a+"/"+encodeURIComponent(b)+c;return this.shouldUseHtml5Audio()&&"bgm"===a?(this._blobUrl?Html5Audio.setup(this._blobUrl):Html5Audio.setup(b),Html5Audio):new WebAudio(b)};AudioManager.updateBufferParameters=function(a,b,c){a&&c&&(a.volume=b*(c.volume||0)/1E4,a.pitch=(c.pitch||0)/100,a.pan=(c.pan||0)/100)};AudioManager.audioFileExt=function(){return WebAudio.canPlayOgg()&&!Utils.isMobileDevice()?".ogg":".m4a"};
AudioManager.shouldUseHtml5Audio=function(){return!1};AudioManager.checkErrors=function(){this.checkWebAudioError(this._bgmBuffer);this.checkWebAudioError(this._bgsBuffer);this.checkWebAudioError(this._meBuffer);this._seBuffers.forEach(function(a){this.checkWebAudioError(a)}.bind(this));this._staticBuffers.forEach(function(a){this.checkWebAudioError(a)}.bind(this))};AudioManager.checkWebAudioError=function(a){if(a&&a.isError())throw Error("Failed to load: "+a.url);};
function SoundManager(){throw Error("This is a static class");}SoundManager.preloadImportantSounds=function(){this.loadSystemSound(0);this.loadSystemSound(1);this.loadSystemSound(2);this.loadSystemSound(3)};SoundManager.loadSystemSound=function(a){$dataSystem&&AudioManager.loadStaticSe($dataSystem.sounds[a])};SoundManager.playSystemSound=function(a){$dataSystem&&AudioManager.playStaticSe($dataSystem.sounds[a])};SoundManager.playCursor=function(){this.playSystemSound(0)};SoundManager.playOk=function(){this.playSystemSound(1)};
SoundManager.playCancel=function(){this.playSystemSound(2)};SoundManager.playBuzzer=function(){this.playSystemSound(3)};SoundManager.playEquip=function(){this.playSystemSound(4)};SoundManager.playSave=function(){this.playSystemSound(5)};SoundManager.playLoad=function(){this.playSystemSound(6)};SoundManager.playBattleStart=function(){this.playSystemSound(7)};SoundManager.playEscape=function(){this.playSystemSound(8)};SoundManager.playEnemyAttack=function(){this.playSystemSound(9)};
SoundManager.playEnemyDamage=function(){this.playSystemSound(10)};SoundManager.playEnemyCollapse=function(){this.playSystemSound(11)};SoundManager.playBossCollapse1=function(){this.playSystemSound(12)};SoundManager.playBossCollapse2=function(){this.playSystemSound(13)};SoundManager.playActorDamage=function(){this.playSystemSound(14)};SoundManager.playActorCollapse=function(){this.playSystemSound(15)};SoundManager.playRecovery=function(){this.playSystemSound(16)};SoundManager.playMiss=function(){this.playSystemSound(17)};
SoundManager.playEvasion=function(){this.playSystemSound(18)};SoundManager.playMagicEvasion=function(){this.playSystemSound(19)};SoundManager.playReflection=function(){this.playSystemSound(20)};SoundManager.playShop=function(){this.playSystemSound(21)};SoundManager.playUseItem=function(){this.playSystemSound(22)};SoundManager.playUseSkill=function(){this.playSystemSound(23)};function TextManager(){throw Error("This is a static class");}
TextManager.basic=function(a){return $dataSystem.terms.basic[a]||""};TextManager.param=function(a){return $dataSystem.terms.params[a]||""};TextManager.command=function(a){return $dataSystem.terms.commands[a]||""};TextManager.message=function(a){return $dataSystem.terms.messages[a]||""};TextManager.getter=function(a,b){return{get:function(){return this[a](b)},configurable:!0}};Object.defineProperty(TextManager,"currencyUnit",{get:function(){return $dataSystem.currencyUnit},configurable:!0});
Object.defineProperties(TextManager,{level:TextManager.getter("basic",0),levelA:TextManager.getter("basic",1),hp:TextManager.getter("basic",2),hpA:TextManager.getter("basic",3),mp:TextManager.getter("basic",4),mpA:TextManager.getter("basic",5),tp:TextManager.getter("basic",6),tpA:TextManager.getter("basic",7),exp:TextManager.getter("basic",8),expA:TextManager.getter("basic",9),fight:TextManager.getter("command",0),escape:TextManager.getter("command",1),attack:TextManager.getter("command",2),guard:TextManager.getter("command",
3),item:TextManager.getter("command",4),skill:TextManager.getter("command",5),equip:TextManager.getter("command",6),status:TextManager.getter("command",7),formation:TextManager.getter("command",8),save:TextManager.getter("command",9),gameEnd:TextManager.getter("command",10),options:TextManager.getter("command",11),weapon:TextManager.getter("command",12),armor:TextManager.getter("command",13),keyItem:TextManager.getter("command",14),equip2:TextManager.getter("command",15),optimize:TextManager.getter("command",
16),clear:TextManager.getter("command",17),newGame:TextManager.getter("command",18),continue_:TextManager.getter("command",19),toTitle:TextManager.getter("command",21),cancel:TextManager.getter("command",22),buy:TextManager.getter("command",24),sell:TextManager.getter("command",25),alwaysDash:TextManager.getter("message","alwaysDash"),commandRemember:TextManager.getter("message","commandRemember"),bgmVolume:TextManager.getter("message","bgmVolume"),bgsVolume:TextManager.getter("message","bgsVolume"),
meVolume:TextManager.getter("message","meVolume"),seVolume:TextManager.getter("message","seVolume"),possession:TextManager.getter("message","possession"),expTotal:TextManager.getter("message","expTotal"),expNext:TextManager.getter("message","expNext"),saveMessage:TextManager.getter("message","saveMessage"),loadMessage:TextManager.getter("message","loadMessage"),file:TextManager.getter("message","file"),partyName:TextManager.getter("message","partyName"),emerge:TextManager.getter("message","emerge"),
preemptive:TextManager.getter("message","preemptive"),surprise:TextManager.getter("message","surprise"),escapeStart:TextManager.getter("message","escapeStart"),escapeFailure:TextManager.getter("message","escapeFailure"),victory:TextManager.getter("message","victory"),defeat:TextManager.getter("message","defeat"),obtainExp:TextManager.getter("message","obtainExp"),obtainGold:TextManager.getter("message","obtainGold"),obtainItem:TextManager.getter("message","obtainItem"),levelUp:TextManager.getter("message",
"levelUp"),obtainSkill:TextManager.getter("message","obtainSkill"),useItem:TextManager.getter("message","useItem"),criticalToEnemy:TextManager.getter("message","criticalToEnemy"),criticalToActor:TextManager.getter("message","criticalToActor"),actorDamage:TextManager.getter("message","actorDamage"),actorRecovery:TextManager.getter("message","actorRecovery"),actorGain:TextManager.getter("message","actorGain"),actorLoss:TextManager.getter("message","actorLoss"),actorDrain:TextManager.getter("message",
"actorDrain"),actorNoDamage:TextManager.getter("message","actorNoDamage"),actorNoHit:TextManager.getter("message","actorNoHit"),enemyDamage:TextManager.getter("message","enemyDamage"),enemyRecovery:TextManager.getter("message","enemyRecovery"),enemyGain:TextManager.getter("message","enemyGain"),enemyLoss:TextManager.getter("message","enemyLoss"),enemyDrain:TextManager.getter("message","enemyDrain"),enemyNoDamage:TextManager.getter("message","enemyNoDamage"),enemyNoHit:TextManager.getter("message",
"enemyNoHit"),evasion:TextManager.getter("message","evasion"),magicEvasion:TextManager.getter("message","magicEvasion"),magicReflection:TextManager.getter("message","magicReflection"),counterAttack:TextManager.getter("message","counterAttack"),substitute:TextManager.getter("message","substitute"),buffAdd:TextManager.getter("message","buffAdd"),debuffAdd:TextManager.getter("message","debuffAdd"),buffRemove:TextManager.getter("message","buffRemove"),actionFailure:TextManager.getter("message","actionFailure")});
function SceneManager(){throw Error("This is a static class");}SceneManager._getTimeInMsWithoutMobileSafari=function(){return performance.now()};SceneManager._scene=null;SceneManager._nextScene=null;SceneManager._stack=[];SceneManager._stopped=!1;SceneManager._sceneStarted=!1;SceneManager._exiting=!1;SceneManager._previousClass=null;SceneManager._backgroundBitmap=null;SceneManager._screenWidth=816;SceneManager._screenHeight=624;SceneManager._boxWidth=816;SceneManager._boxHeight=624;
SceneManager._deltaTime=1/60;Utils.isMobileSafari()||(SceneManager._currentTime=SceneManager._getTimeInMsWithoutMobileSafari());SceneManager._accumulator=0;SceneManager.run=function(a){try{this.initialize(),this.goto(a),this.requestUpdate()}catch(b){this.catchException(b)}};SceneManager.initialize=function(){this.initGraphics();this.checkFileAccess();this.initAudio();this.initInput();this.initNwjs();this.checkPluginErrors();this.setupErrorHandlers()};
SceneManager.initGraphics=function(){var a=this.preferableRendererType();Graphics.initialize(this._screenWidth,this._screenHeight,a);Graphics.boxWidth=this._boxWidth;Graphics.boxHeight=this._boxHeight;Graphics.setLoadingImage("img/system/Loading.png");Utils.isOptionValid("showfps")&&Graphics.showFps();"webgl"===a&&this.checkWebGL()};SceneManager.preferableRendererType=function(){return Utils.isOptionValid("canvas")?"canvas":Utils.isOptionValid("webgl")?"webgl":"auto"};
SceneManager.shouldUseCanvasRenderer=function(){return Utils.isMobileDevice()};SceneManager.checkWebGL=function(){if(!Graphics.hasWebGL())throw Error("Your browser does not support WebGL.");};SceneManager.checkFileAccess=function(){if(!Utils.canReadGameFiles())throw Error("Your browser does not allow to read local files.");};SceneManager.initAudio=function(){var a=Utils.isOptionValid("noaudio");if(!WebAudio.initialize(a)&&!a)throw Error("Your browser does not support Web Audio API.");};
SceneManager.initInput=function(){Input.initialize();TouchInput.initialize()};SceneManager.initNwjs=function(){if(Utils.isNwjs()){var a=require("nw.gui"),b=a.Window.get();"darwin"!==process.platform||b.menu||(a=new a.Menu({type:"menubar"}),a.createMacBuiltin("Game",{hideEdit:!0,hideWindow:!0}),b.menu=a)}};SceneManager.checkPluginErrors=function(){PluginManager.checkErrors()};
SceneManager.setupErrorHandlers=function(){window.addEventListener("error",this.onError.bind(this));document.addEventListener("keydown",this.onKeyDown.bind(this))};SceneManager.requestUpdate=function(){this._stopped||requestAnimationFrame(this.update.bind(this))};SceneManager.update=function(){try{this.tickStart(),Utils.isMobileSafari()&&this.updateInputData(),this.updateManagers(),this.updateMain(),this.tickEnd()}catch(a){this.catchException(a)}};SceneManager.terminate=function(){window.close()};
SceneManager.onError=function(a){console.error(a.message);console.error(a.filename,a.lineno);try{this.stop(),Graphics.printError("Error",a.message),AudioManager.stopAll()}catch(b){}};SceneManager.onKeyDown=function(a){if(!a.ctrlKey&&!a.altKey)switch(a.keyCode){case 116:Utils.isNwjs()&&location.reload();break;case 119:Utils.isNwjs()&&Utils.isOptionValid("test")&&require("nw.gui").Window.get().showDevTools()}};
SceneManager.catchException=function(a){a instanceof Error?(Graphics.printError(a.name,a.message),console.error(a.stack)):Graphics.printError("UnknownError",a);AudioManager.stopAll();this.stop()};SceneManager.tickStart=function(){Graphics.tickStart()};SceneManager.tickEnd=function(){Graphics.tickEnd()};SceneManager.updateInputData=function(){Input.update();TouchInput.update()};
SceneManager.updateMain=function(){if(Utils.isMobileSafari())this.changeScene(),this.updateScene();else{var a=this._getTimeInMsWithoutMobileSafari(),b=(a-this._currentTime)/1E3;.25<b&&(b=.25);this._currentTime=a;for(this._accumulator+=b;this._accumulator>=this._deltaTime;)this.updateInputData(),this.changeScene(),this.updateScene(),this._accumulator-=this._deltaTime}this.renderScene();this.requestUpdate()};SceneManager.updateManagers=function(){ImageManager.update()};
SceneManager.changeScene=function(){if(this.isSceneChanging()&&!this.isCurrentSceneBusy()){this._scene&&(this._scene.terminate(),this._scene.detachReservation(),this._previousClass=this._scene.constructor);if(this._scene=this._nextScene)this._scene.attachReservation(),this._scene.create(),this._nextScene=null,this._sceneStarted=!1,this.onSceneCreate();this._exiting&&this.terminate()}};
SceneManager.updateScene=function(){this._scene&&(!this._sceneStarted&&this._scene.isReady()&&(this._scene.start(),this._sceneStarted=!0,this.onSceneStart()),this.isCurrentSceneStarted()&&this._scene.update())};SceneManager.renderScene=function(){if(this.isCurrentSceneStarted())Graphics.render(this._scene);else if(this._scene)this.onSceneLoading()};SceneManager.onSceneCreate=function(){Graphics.startLoading()};SceneManager.onSceneStart=function(){Graphics.endLoading()};
SceneManager.onSceneLoading=function(){Graphics.updateLoading()};SceneManager.isSceneChanging=function(){return this._exiting||!!this._nextScene};SceneManager.isCurrentSceneBusy=function(){return this._scene&&this._scene.isBusy()};SceneManager.isCurrentSceneStarted=function(){return this._scene&&this._sceneStarted};SceneManager.isNextScene=function(a){return this._nextScene&&this._nextScene.constructor===a};SceneManager.isPreviousScene=function(a){return this._previousClass===a};
SceneManager.goto=function(a){a&&(this._nextScene=new a);this._scene&&this._scene.stop()};SceneManager.push=function(a){this._stack.push(this._scene.constructor);this.goto(a)};SceneManager.pop=function(){0<this._stack.length?this.goto(this._stack.pop()):this.exit()};SceneManager.exit=function(){this.goto(null);this._exiting=!0};SceneManager.clearStack=function(){this._stack=[]};SceneManager.stop=function(){this._stopped=!0};
SceneManager.prepareNextScene=function(){this._nextScene.prepare.apply(this._nextScene,arguments)};SceneManager.snap=function(){return Bitmap.snap(this._scene)};SceneManager.snapForBackground=function(){this._backgroundBitmap=this.snap();this._backgroundBitmap.blur()};SceneManager.backgroundBitmap=function(){return this._backgroundBitmap};
SceneManager.resume=function(){this._stopped=!1;this.requestUpdate();Utils.isMobileSafari()||(this._currentTime=this._getTimeInMsWithoutMobileSafari(),this._accumulator=0)};function BattleManager(){throw Error("This is a static class");}BattleManager.setup=function(a,b,c){this.initMembers();this._canEscape=b;this._canLose=c;$gameTroop.setup(a);$gameScreen.onBattleStart();this.makeEscapeRatio()};
BattleManager.initMembers=function(){this._phase="init";this._battleTest=this._canLose=this._canEscape=!1;this._eventCallback=null;this._surprise=this._preemptive=!1;this._actorIndex=-1;this._mapBgs=this._mapBgm=this._actionForcedBattler=null;this._actionBattlers=[];this._action=this._subject=null;this._targets=[];this._spriteset=this._statusWindow=this._logWindow=null;this._escapeRatio=0;this._escaped=!1;this._rewards={};this._turnForced=!1};BattleManager.isBattleTest=function(){return this._battleTest};
BattleManager.setBattleTest=function(a){this._battleTest=a};BattleManager.setEventCallback=function(a){this._eventCallback=a};BattleManager.setLogWindow=function(a){this._logWindow=a};BattleManager.setStatusWindow=function(a){this._statusWindow=a};BattleManager.setSpriteset=function(a){this._spriteset=a};BattleManager.onEncounter=function(){this._preemptive=Math.random()<this.ratePreemptive();this._surprise=Math.random()<this.rateSurprise()&&!this._preemptive};BattleManager.ratePreemptive=function(){return $gameParty.ratePreemptive($gameTroop.agility())};
BattleManager.rateSurprise=function(){return $gameParty.rateSurprise($gameTroop.agility())};BattleManager.saveBgmAndBgs=function(){this._mapBgm=AudioManager.saveBgm();this._mapBgs=AudioManager.saveBgs()};BattleManager.playBattleBgm=function(){AudioManager.playBgm($gameSystem.battleBgm());AudioManager.stopBgs()};BattleManager.playVictoryMe=function(){AudioManager.playMe($gameSystem.victoryMe())};BattleManager.playDefeatMe=function(){AudioManager.playMe($gameSystem.defeatMe())};
BattleManager.replayBgmAndBgs=function(){this._mapBgm?AudioManager.replayBgm(this._mapBgm):AudioManager.stopBgm();this._mapBgs&&AudioManager.replayBgs(this._mapBgs)};BattleManager.makeEscapeRatio=function(){this._escapeRatio=.5*$gameParty.agility()/$gameTroop.agility()};
BattleManager.update=function(){if(!this.isBusy()&&!this.updateEvent())switch(this._phase){case "start":this.startInput();break;case "turn":this.updateTurn();break;case "action":this.updateAction();break;case "turnEnd":this.updateTurnEnd();break;case "battleEnd":this.updateBattleEnd()}};BattleManager.updateEvent=function(){switch(this._phase){case "start":case "turn":case "turnEnd":return this.isActionForced()?(this.processForcedAction(),!0):this.updateEventMain()}return this.checkAbort()};
BattleManager.updateEventMain=function(){$gameTroop.updateInterpreter();$gameParty.requestMotionRefresh();if($gameTroop.isEventRunning()||this.checkBattleEnd())return!0;$gameTroop.setupBattleEvent();return $gameTroop.isEventRunning()||SceneManager.isSceneChanging()?!0:!1};BattleManager.isBusy=function(){return $gameMessage.isBusy()||this._spriteset.isBusy()||this._logWindow.isBusy()};BattleManager.isInputting=function(){return"input"===this._phase};
BattleManager.isInTurn=function(){return"turn"===this._phase};BattleManager.isTurnEnd=function(){return"turnEnd"===this._phase};BattleManager.isAborting=function(){return"aborting"===this._phase};BattleManager.isBattleEnd=function(){return"battleEnd"===this._phase};BattleManager.canEscape=function(){return this._canEscape};BattleManager.canLose=function(){return this._canLose};BattleManager.isEscaped=function(){return this._escaped};
BattleManager.actor=function(){return 0<=this._actorIndex?$gameParty.members()[this._actorIndex]:null};BattleManager.clearActor=function(){this.changeActor(-1,"")};BattleManager.changeActor=function(a,b){var c=this.actor();this._actorIndex=a;a=this.actor();c&&c.setActionState(b);a&&a.setActionState("inputting")};BattleManager.startBattle=function(){this._phase="start";$gameSystem.onBattleStart();$gameParty.onBattleStart();$gameTroop.onBattleStart();this.displayStartMessages()};
BattleManager.displayStartMessages=function(){$gameTroop.enemyNames().forEach(function(a){$gameMessage.add(TextManager.emerge.format(a))});this._preemptive?$gameMessage.add(TextManager.preemptive.format($gameParty.name())):this._surprise&&$gameMessage.add(TextManager.surprise.format($gameParty.name()))};BattleManager.startInput=function(){this._phase="input";$gameParty.makeActions();$gameTroop.makeActions();this.clearActor();!this._surprise&&$gameParty.canInput()||this.startTurn()};
BattleManager.inputtingAction=function(){return this.actor()?this.actor().inputtingAction():null};BattleManager.selectNextCommand=function(){do if(!this.actor()||!this.actor().selectNextCommand())if(this.changeActor(this._actorIndex+1,"waiting"),this._actorIndex>=$gameParty.size()){this.startTurn();break}while(!this.actor().canInput())};
BattleManager.selectPreviousCommand=function(){do if(!this.actor()||!this.actor().selectPreviousCommand())if(this.changeActor(this._actorIndex-1,"undecided"),0>this._actorIndex)break;while(!this.actor().canInput())};BattleManager.refreshStatus=function(){this._statusWindow.refresh()};BattleManager.startTurn=function(){this._phase="turn";this.clearActor();$gameTroop.increaseTurn();this.makeActionOrders();$gameParty.requestMotionRefresh();this._logWindow.startTurn()};
BattleManager.updateTurn=function(){$gameParty.requestMotionRefresh();this._subject||(this._subject=this.getNextSubject());this._subject?this.processTurn():this.endTurn()};BattleManager.processTurn=function(){var a=this._subject,b=a.currentAction();b?(b.prepare(),b.isValid()&&this.startAction(),a.removeCurrentAction()):(a.onAllActionsEnd(),this.refreshStatus(),this._logWindow.displayAutoAffectedStatus(a),this._logWindow.displayCurrentState(a),this._logWindow.displayRegeneration(a),this._subject=this.getNextSubject())};
BattleManager.endTurn=function(){this._phase="turnEnd";this._surprise=this._preemptive=!1;this.allBattleMembers().forEach(function(a){a.onTurnEnd();this.refreshStatus();this._logWindow.displayAutoAffectedStatus(a);this._logWindow.displayRegeneration(a)},this);this.isForcedTurn()&&(this._turnForced=!1)};BattleManager.isForcedTurn=function(){return this._turnForced};BattleManager.updateTurnEnd=function(){this.startInput()};
BattleManager.getNextSubject=function(){for(;;){var a=this._actionBattlers.shift();if(!a)return null;if(a.isBattleMember()&&a.isAlive())return a}};BattleManager.allBattleMembers=function(){return $gameParty.members().concat($gameTroop.members())};
BattleManager.makeActionOrders=function(){var a=[];this._surprise||(a=a.concat($gameParty.members()));this._preemptive||(a=a.concat($gameTroop.members()));a.forEach(function(b){b.makeSpeed()});a.sort(function(b,c){return c.speed()-b.speed()});this._actionBattlers=a};
BattleManager.startAction=function(){var a=this._subject,b=a.currentAction(),c=b.makeTargets();this._phase="action";this._action=b;this._targets=c;a.useItem(b.item());this._action.applyGlobal();this.refreshStatus();this._logWindow.startAction(a,b,c)};BattleManager.updateAction=function(){var a=this._targets.shift();a?this.invokeAction(this._subject,a):this.endAction()};BattleManager.endAction=function(){this._logWindow.endAction(this._subject);this._phase="turn"};
BattleManager.invokeAction=function(a,b){this._logWindow.push("pushBaseLine");Math.random()<this._action.itemCnt(b)?this.invokeCounterAttack(a,b):Math.random()<this._action.itemMrf(b)?this.invokeMagicReflection(a,b):this.invokeNormalAction(a,b);a.setLastTarget(b);this._logWindow.push("popBaseLine");this.refreshStatus()};BattleManager.invokeNormalAction=function(a,b){b=this.applySubstitute(b);this._action.apply(b);this._logWindow.displayActionResults(a,b)};
BattleManager.invokeCounterAttack=function(a,b){var c=new Game_Action(b);c.setAttack();c.apply(a);this._logWindow.displayCounter(b);this._logWindow.displayActionResults(b,a)};BattleManager.invokeMagicReflection=function(a,b){this._action._reflectionTarget=b;this._logWindow.displayReflection(b);this._action.apply(a);this._logWindow.displayActionResults(b,a)};
BattleManager.applySubstitute=function(a){if(this.checkSubstitute(a)){var b=a.friendsUnit().substituteBattler();if(b&&a!==b)return this._logWindow.displaySubstitute(b,a),b}return a};BattleManager.checkSubstitute=function(a){return a.isDying()&&!this._action.isCertainHit()};BattleManager.isActionForced=function(){return!!this._actionForcedBattler};BattleManager.forceAction=function(a){this._actionForcedBattler=a;a=this._actionBattlers.indexOf(a);0<=a&&this._actionBattlers.splice(a,1)};
BattleManager.processForcedAction=function(){this._actionForcedBattler&&(this._turnForced=!0,this._subject=this._actionForcedBattler,this._actionForcedBattler=null,this.startAction(),this._subject.removeCurrentAction())};BattleManager.abort=function(){this._phase="aborting"};BattleManager.checkBattleEnd=function(){if(this._phase){if(this.checkAbort())return!0;if($gameParty.isAllDead())return this.processDefeat(),!0;if($gameTroop.isAllDead())return this.processVictory(),!0}return!1};
BattleManager.checkAbort=function(){if($gameParty.isEmpty()||this.isAborting())SoundManager.playEscape(),this._escaped=!0,this.processAbort();return!1};BattleManager.processVictory=function(){$gameParty.removeBattleStates();$gameParty.performVictory();this.playVictoryMe();this.replayBgmAndBgs();this.makeRewards();this.displayVictoryMessage();this.displayRewards();this.gainRewards();this.endBattle(0)};
BattleManager.processEscape=function(){$gameParty.performEscape();SoundManager.playEscape();var a=this._preemptive?!0:Math.random()<this._escapeRatio;a?(this.displayEscapeSuccessMessage(),this._escaped=!0,this.processAbort()):(this.displayEscapeFailureMessage(),this._escapeRatio+=.1,$gameParty.clearActions(),this.startTurn());return a};BattleManager.processAbort=function(){$gameParty.removeBattleStates();this.replayBgmAndBgs();this.endBattle(1)};
BattleManager.processDefeat=function(){this.displayDefeatMessage();this.playDefeatMe();this._canLose?this.replayBgmAndBgs():AudioManager.stopBgm();this.endBattle(2)};BattleManager.endBattle=function(a){this._phase="battleEnd";this._eventCallback&&this._eventCallback(a);if(0===a)$gameSystem.onBattleWin();else if(this._escaped)$gameSystem.onBattleEscape()};
BattleManager.updateBattleEnd=function(){this.isBattleTest()?(AudioManager.stopBgm(),SceneManager.exit()):!this._escaped&&$gameParty.isAllDead()?this._canLose?($gameParty.reviveBattleMembers(),SceneManager.pop()):SceneManager.goto(Scene_Gameover):SceneManager.pop();this._phase=null};BattleManager.makeRewards=function(){this._rewards={};this._rewards.gold=$gameTroop.goldTotal();this._rewards.exp=$gameTroop.expTotal();this._rewards.items=$gameTroop.makeDropItems()};
BattleManager.displayVictoryMessage=function(){$gameMessage.add(TextManager.victory.format($gameParty.name()))};BattleManager.displayDefeatMessage=function(){$gameMessage.add(TextManager.defeat.format($gameParty.name()))};BattleManager.displayEscapeSuccessMessage=function(){$gameMessage.add(TextManager.escapeStart.format($gameParty.name()))};BattleManager.displayEscapeFailureMessage=function(){$gameMessage.add(TextManager.escapeStart.format($gameParty.name()));$gameMessage.add("\\."+TextManager.escapeFailure)};
BattleManager.displayRewards=function(){this.displayExp();this.displayGold();this.displayDropItems()};BattleManager.displayExp=function(){var a=this._rewards.exp;0<a&&(a=TextManager.obtainExp.format(a,TextManager.exp),$gameMessage.add("\\."+a))};BattleManager.displayGold=function(){var a=this._rewards.gold;0<a&&$gameMessage.add("\\."+TextManager.obtainGold.format(a))};BattleManager.displayDropItems=function(){var a=this._rewards.items;0<a.length&&($gameMessage.newPage(),a.forEach(function(b){$gameMessage.add(TextManager.obtainItem.format(b.name))}))};
BattleManager.gainRewards=function(){this.gainExp();this.gainGold();this.gainDropItems()};BattleManager.gainExp=function(){var a=this._rewards.exp;$gameParty.allMembers().forEach(function(b){b.gainExp(a)})};BattleManager.gainGold=function(){$gameParty.gainGold(this._rewards.gold)};BattleManager.gainDropItems=function(){this._rewards.items.forEach(function(a){$gameParty.gainItem(a,1)})};function PluginManager(){throw Error("This is a static class");}PluginManager._path="js/plugins/";
PluginManager._scripts=[];PluginManager._errorUrls=[];PluginManager._parameters={};PluginManager.setup=function(a){a.forEach(function(b){b.status&&!this._scripts.contains(b.name)&&(this.setParameters(b.name,b.parameters),this.loadScript(b.name+".js"),this._scripts.push(b.name))},this)};PluginManager.checkErrors=function(){var a=this._errorUrls.shift();if(a)throw Error("Failed to load: "+a);};PluginManager.parameters=function(a){return this._parameters[a.toLowerCase()]||{}};
PluginManager.setParameters=function(a,b){this._parameters[a.toLowerCase()]=b};PluginManager.loadScript=function(a){a=this._path+a;var b=document.createElement("script");b.type="text/javascript";b.src=a;b.async=!1;b.onerror=this.onError.bind(this);b._url=a;document.body.appendChild(b)};PluginManager.onError=function(a){this._errorUrls.push(a.target._url)};function Game_Temp(){this.initialize.apply(this,arguments)}Game_Temp.prototype.initialize=function(){this._isPlaytest=Utils.isOptionValid("test");this._commonEventId=0;this._destinationY=this._destinationX=null};Game_Temp.prototype.isPlaytest=function(){return this._isPlaytest};Game_Temp.prototype.reserveCommonEvent=function(a){this._commonEventId=a};Game_Temp.prototype.clearCommonEvent=function(){this._commonEventId=0};Game_Temp.prototype.isCommonEventReserved=function(){return 0<this._commonEventId};
Game_Temp.prototype.reservedCommonEvent=function(){return $dataCommonEvents[this._commonEventId]};Game_Temp.prototype.setDestination=function(a,b){this._destinationX=a;this._destinationY=b};Game_Temp.prototype.clearDestination=function(){this._destinationY=this._destinationX=null};Game_Temp.prototype.isDestinationValid=function(){return null!==this._destinationX};Game_Temp.prototype.destinationX=function(){return this._destinationX};Game_Temp.prototype.destinationY=function(){return this._destinationY};
function Game_System(){this.initialize.apply(this,arguments)}Game_System.prototype.initialize=function(){this._formationEnabled=this._encounterEnabled=this._menuEnabled=this._saveEnabled=!0;this._framesOnSave=this._versionId=this._saveCount=this._escapeCount=this._winCount=this._battleCount=0;this._walkingBgm=this._savedBgm=this._defeatMe=this._victoryMe=this._battleBgm=this._windowTone=this._bgsOnSave=this._bgmOnSave=null};Game_System.prototype.isJapanese=function(){return $dataSystem.locale.match(/^ja/)};
Game_System.prototype.isChinese=function(){return $dataSystem.locale.match(/^zh/)};Game_System.prototype.isKorean=function(){return $dataSystem.locale.match(/^ko/)};Game_System.prototype.isCJK=function(){return $dataSystem.locale.match(/^(ja|zh|ko)/)};Game_System.prototype.isRussian=function(){return $dataSystem.locale.match(/^ru/)};Game_System.prototype.isSideView=function(){return $dataSystem.optSideView};Game_System.prototype.isSaveEnabled=function(){return this._saveEnabled};
Game_System.prototype.disableSave=function(){this._saveEnabled=!1};Game_System.prototype.enableSave=function(){this._saveEnabled=!0};Game_System.prototype.isMenuEnabled=function(){return this._menuEnabled};Game_System.prototype.disableMenu=function(){this._menuEnabled=!1};Game_System.prototype.enableMenu=function(){this._menuEnabled=!0};Game_System.prototype.isEncounterEnabled=function(){return this._encounterEnabled};Game_System.prototype.disableEncounter=function(){this._encounterEnabled=!1};
Game_System.prototype.enableEncounter=function(){this._encounterEnabled=!0};Game_System.prototype.isFormationEnabled=function(){return this._formationEnabled};Game_System.prototype.disableFormation=function(){this._formationEnabled=!1};Game_System.prototype.enableFormation=function(){this._formationEnabled=!0};Game_System.prototype.battleCount=function(){return this._battleCount};Game_System.prototype.winCount=function(){return this._winCount};Game_System.prototype.escapeCount=function(){return this._escapeCount};
Game_System.prototype.saveCount=function(){return this._saveCount};Game_System.prototype.versionId=function(){return this._versionId};Game_System.prototype.windowTone=function(){return this._windowTone||$dataSystem.windowTone};Game_System.prototype.setWindowTone=function(a){this._windowTone=a};Game_System.prototype.battleBgm=function(){return this._battleBgm||$dataSystem.battleBgm};Game_System.prototype.setBattleBgm=function(a){this._battleBgm=a};
Game_System.prototype.victoryMe=function(){return this._victoryMe||$dataSystem.victoryMe};Game_System.prototype.setVictoryMe=function(a){this._victoryMe=a};Game_System.prototype.defeatMe=function(){return this._defeatMe||$dataSystem.defeatMe};Game_System.prototype.setDefeatMe=function(a){this._defeatMe=a};Game_System.prototype.onBattleStart=function(){this._battleCount++};Game_System.prototype.onBattleWin=function(){this._winCount++};Game_System.prototype.onBattleEscape=function(){this._escapeCount++};
Game_System.prototype.onBeforeSave=function(){this._saveCount++;this._versionId=$dataSystem.versionId;this._framesOnSave=Graphics.frameCount;this._bgmOnSave=AudioManager.saveBgm();this._bgsOnSave=AudioManager.saveBgs()};Game_System.prototype.onAfterLoad=function(){Graphics.frameCount=this._framesOnSave;AudioManager.playBgm(this._bgmOnSave);AudioManager.playBgs(this._bgsOnSave)};Game_System.prototype.playtime=function(){return Math.floor(Graphics.frameCount/60)};
Game_System.prototype.playtimeText=function(){var a=Math.floor(this.playtime()/60/60),b=Math.floor(this.playtime()/60)%60,c=this.playtime()%60;return a.padZero(2)+":"+b.padZero(2)+":"+c.padZero(2)};Game_System.prototype.saveBgm=function(){this._savedBgm=AudioManager.saveBgm()};Game_System.prototype.replayBgm=function(){this._savedBgm&&AudioManager.replayBgm(this._savedBgm)};Game_System.prototype.saveWalkingBgm=function(){this._walkingBgm=AudioManager.saveBgm()};
Game_System.prototype.replayWalkingBgm=function(){this._walkingBgm&&AudioManager.playBgm(this._walkingBgm)};Game_System.prototype.saveWalkingBgm2=function(){this._walkingBgm=$dataMap.bgm};function Game_Timer(){this.initialize.apply(this,arguments)}Game_Timer.prototype.initialize=function(){this._frames=0;this._working=!1};Game_Timer.prototype.update=function(a){if(a&&this._working&&0<this._frames&&(this._frames--,0===this._frames))this.onExpire()};
Game_Timer.prototype.start=function(a){this._frames=a;this._working=!0};Game_Timer.prototype.stop=function(){this._working=!1};Game_Timer.prototype.isWorking=function(){return this._working};Game_Timer.prototype.seconds=function(){return Math.floor(this._frames/60)};Game_Timer.prototype.onExpire=function(){BattleManager.abort()};function Game_Message(){this.initialize.apply(this,arguments)}Game_Message.prototype.initialize=function(){this.clear()};
Game_Message.prototype.clear=function(){this._texts=[];this._choices=[];this._faceName="";this._background=this._faceIndex=0;this._positionType=2;this._choiceBackground=this._choiceCancelType=this._choiceDefaultType=0;this._choicePositionType=2;this._itemChoiceItypeId=this._itemChoiceVariableId=this._numInputMaxDigits=this._numInputVariableId=0;this._scrollMode=!1;this._scrollSpeed=2;this._scrollNoFast=!1;this._choiceCallback=null};Game_Message.prototype.choices=function(){return this._choices};
Game_Message.prototype.faceName=function(){return this._faceName};Game_Message.prototype.faceIndex=function(){return this._faceIndex};Game_Message.prototype.background=function(){return this._background};Game_Message.prototype.positionType=function(){return this._positionType};Game_Message.prototype.choiceDefaultType=function(){return this._choiceDefaultType};Game_Message.prototype.choiceCancelType=function(){return this._choiceCancelType};Game_Message.prototype.choiceBackground=function(){return this._choiceBackground};
Game_Message.prototype.choicePositionType=function(){return this._choicePositionType};Game_Message.prototype.numInputVariableId=function(){return this._numInputVariableId};Game_Message.prototype.numInputMaxDigits=function(){return this._numInputMaxDigits};Game_Message.prototype.itemChoiceVariableId=function(){return this._itemChoiceVariableId};Game_Message.prototype.itemChoiceItypeId=function(){return this._itemChoiceItypeId};Game_Message.prototype.scrollMode=function(){return this._scrollMode};
Game_Message.prototype.scrollSpeed=function(){return this._scrollSpeed};Game_Message.prototype.scrollNoFast=function(){return this._scrollNoFast};Game_Message.prototype.add=function(a){this._texts.push(a)};Game_Message.prototype.setFaceImage=function(a,b){this._faceName=a;this._faceIndex=b};Game_Message.prototype.setBackground=function(a){this._background=a};Game_Message.prototype.setPositionType=function(a){this._positionType=a};
Game_Message.prototype.setChoices=function(a,b,c){this._choices=a;this._choiceDefaultType=b;this._choiceCancelType=c};Game_Message.prototype.setChoiceBackground=function(a){this._choiceBackground=a};Game_Message.prototype.setChoicePositionType=function(a){this._choicePositionType=a};Game_Message.prototype.setNumberInput=function(a,b){this._numInputVariableId=a;this._numInputMaxDigits=b};Game_Message.prototype.setItemChoice=function(a,b){this._itemChoiceVariableId=a;this._itemChoiceItypeId=b};
Game_Message.prototype.setScroll=function(a,b){this._scrollMode=!0;this._scrollSpeed=a;this._scrollNoFast=b};Game_Message.prototype.setChoiceCallback=function(a){this._choiceCallback=a};Game_Message.prototype.onChoice=function(a){this._choiceCallback&&(this._choiceCallback(a),this._choiceCallback=null)};Game_Message.prototype.hasText=function(){return 0<this._texts.length};Game_Message.prototype.isChoice=function(){return 0<this._choices.length};
Game_Message.prototype.isNumberInput=function(){return 0<this._numInputVariableId};Game_Message.prototype.isItemChoice=function(){return 0<this._itemChoiceVariableId};Game_Message.prototype.isBusy=function(){return this.hasText()||this.isChoice()||this.isNumberInput()||this.isItemChoice()};Game_Message.prototype.newPage=function(){0<this._texts.length&&(this._texts[this._texts.length-1]+="\f")};Game_Message.prototype.allText=function(){return this._texts.join("\n")};
function Game_Switches(){this.initialize.apply(this,arguments)}Game_Switches.prototype.initialize=function(){this.clear()};Game_Switches.prototype.clear=function(){this._data=[]};Game_Switches.prototype.value=function(a){return!!this._data[a]};Game_Switches.prototype.setValue=function(a,b){0<a&&a<$dataSystem.switches.length&&(this._data[a]=b,this.onChange())};Game_Switches.prototype.onChange=function(){$gameMap.requestRefresh()};function Game_Variables(){this.initialize.apply(this,arguments)}
Game_Variables.prototype.initialize=function(){this.clear()};Game_Variables.prototype.clear=function(){this._data=[]};Game_Variables.prototype.value=function(a){return this._data[a]||0};Game_Variables.prototype.setValue=function(a,b){0<a&&a<$dataSystem.variables.length&&("number"===typeof b&&(b=Math.floor(b)),this._data[a]=b,this.onChange())};Game_Variables.prototype.onChange=function(){$gameMap.requestRefresh()};function Game_SelfSwitches(){this.initialize.apply(this,arguments)}
Game_SelfSwitches.prototype.initialize=function(){this.clear()};Game_SelfSwitches.prototype.clear=function(){this._data={}};Game_SelfSwitches.prototype.value=function(a){return!!this._data[a]};Game_SelfSwitches.prototype.setValue=function(a,b){b?this._data[a]=!0:delete this._data[a];this.onChange()};Game_SelfSwitches.prototype.onChange=function(){$gameMap.requestRefresh()};function Game_Screen(){this.initialize.apply(this,arguments)}Game_Screen.prototype.initialize=function(){this.clear()};
Game_Screen.prototype.clear=function(){this.clearFade();this.clearTone();this.clearFlash();this.clearShake();this.clearZoom();this.clearWeather();this.clearPictures()};Game_Screen.prototype.onBattleStart=function(){this.clearFade();this.clearFlash();this.clearShake();this.clearZoom();this.eraseBattlePictures()};Game_Screen.prototype.brightness=function(){return this._brightness};Game_Screen.prototype.tone=function(){return this._tone};Game_Screen.prototype.flashColor=function(){return this._flashColor};
Game_Screen.prototype.shake=function(){return this._shake};Game_Screen.prototype.zoomX=function(){return this._zoomX};Game_Screen.prototype.zoomY=function(){return this._zoomY};Game_Screen.prototype.zoomScale=function(){return this._zoomScale};Game_Screen.prototype.weatherType=function(){return this._weatherType};Game_Screen.prototype.weatherPower=function(){return this._weatherPower};Game_Screen.prototype.picture=function(a){a=this.realPictureId(a);return this._pictures[a]};
Game_Screen.prototype.realPictureId=function(a){return $gameParty.inBattle()?a+this.maxPictures():a};Game_Screen.prototype.clearFade=function(){this._brightness=255;this._fadeInDuration=this._fadeOutDuration=0};Game_Screen.prototype.clearTone=function(){this._tone=[0,0,0,0];this._toneTarget=[0,0,0,0];this._toneDuration=0};Game_Screen.prototype.clearFlash=function(){this._flashColor=[0,0,0,0];this._flashDuration=0};
Game_Screen.prototype.clearShake=function(){this._shakeDuration=this._shakeSpeed=this._shakePower=0;this._shakeDirection=1;this._shake=0};Game_Screen.prototype.clearZoom=function(){this._zoomY=this._zoomX=0;this._zoomScaleTarget=this._zoomScale=1;this._zoomDuration=0};Game_Screen.prototype.clearWeather=function(){this._weatherType="none";this._weatherDuration=this._weatherPowerTarget=this._weatherPower=0};Game_Screen.prototype.clearPictures=function(){this._pictures=[]};
Game_Screen.prototype.eraseBattlePictures=function(){this._pictures=this._pictures.slice(0,this.maxPictures()+1)};Game_Screen.prototype.maxPictures=function(){return 100};Game_Screen.prototype.startFadeOut=function(a){this._fadeOutDuration=a;this._fadeInDuration=0};Game_Screen.prototype.startFadeIn=function(a){this._fadeInDuration=a;this._fadeOutDuration=0};Game_Screen.prototype.startTint=function(a,b){this._toneTarget=a.clone();this._toneDuration=b;0===this._toneDuration&&(this._tone=this._toneTarget.clone())};
Game_Screen.prototype.startFlash=function(a,b){this._flashColor=a.clone();this._flashDuration=b};Game_Screen.prototype.startShake=function(a,b,c){this._shakePower=a;this._shakeSpeed=b;this._shakeDuration=c};Game_Screen.prototype.startZoom=function(a,b,c,d){this._zoomX=a;this._zoomY=b;this._zoomScaleTarget=c;this._zoomDuration=d};Game_Screen.prototype.setZoom=function(a,b,c){this._zoomX=a;this._zoomY=b;this._zoomScale=c};
Game_Screen.prototype.changeWeather=function(a,b,c){if("none"!==a||0===c)this._weatherType=a;this._weatherPowerTarget="none"===a?0:b;this._weatherDuration=c;0===c&&(this._weatherPower=this._weatherPowerTarget)};Game_Screen.prototype.update=function(){this.updateFadeOut();this.updateFadeIn();this.updateTone();this.updateFlash();this.updateShake();this.updateZoom();this.updateWeather();this.updatePictures()};
Game_Screen.prototype.updateFadeOut=function(){if(0<this._fadeOutDuration){var a=this._fadeOutDuration;this._brightness=this._brightness*(a-1)/a;this._fadeOutDuration--}};Game_Screen.prototype.updateFadeIn=function(){if(0<this._fadeInDuration){var a=this._fadeInDuration;this._brightness=(this._brightness*(a-1)+255)/a;this._fadeInDuration--}};
Game_Screen.prototype.updateTone=function(){if(0<this._toneDuration){for(var a=this._toneDuration,b=0;4>b;b++)this._tone[b]=(this._tone[b]*(a-1)+this._toneTarget[b])/a;this._toneDuration--}};Game_Screen.prototype.updateFlash=function(){if(0<this._flashDuration){var a=this._flashDuration;this._flashColor[3]*=(a-1)/a;this._flashDuration--}};
Game_Screen.prototype.updateShake=function(){if(0<this._shakeDuration||0!==this._shake){var a=this._shakePower*this._shakeSpeed*this._shakeDirection/10;this._shake=1>=this._shakeDuration&&0>this._shake*(this._shake+a)?0:this._shake+a;this._shake>2*this._shakePower&&(this._shakeDirection=-1);this._shake<2*-this._shakePower&&(this._shakeDirection=1);this._shakeDuration--}};
Game_Screen.prototype.updateZoom=function(){if(0<this._zoomDuration){var a=this._zoomDuration;this._zoomScale=(this._zoomScale*(a-1)+this._zoomScaleTarget)/a;this._zoomDuration--}};Game_Screen.prototype.updateWeather=function(){if(0<this._weatherDuration){var a=this._weatherDuration;this._weatherPower=(this._weatherPower*(a-1)+this._weatherPowerTarget)/a;this._weatherDuration--;0===this._weatherDuration&&0===this._weatherPowerTarget&&(this._weatherType="none")}};
Game_Screen.prototype.updatePictures=function(){this._pictures.forEach(function(a){a&&a.update()})};Game_Screen.prototype.startFlashForDamage=function(){this.startFlash([255,0,0,128],8)};Game_Screen.prototype.showPicture=function(a,b,c,d,e,f,g,h,k){a=this.realPictureId(a);var l=new Game_Picture;l.show(b,c,d,e,f,g,h,k);this._pictures[a]=l};Game_Screen.prototype.movePicture=function(a,b,c,d,e,f,g,h,k){(a=this.picture(a))&&a.move(b,c,d,e,f,g,h,k)};
Game_Screen.prototype.rotatePicture=function(a,b){(a=this.picture(a))&&a.rotate(b)};Game_Screen.prototype.tintPicture=function(a,b,c){(a=this.picture(a))&&a.tint(b,c)};Game_Screen.prototype.erasePicture=function(a){a=this.realPictureId(a);this._pictures[a]=null};function Game_Picture(){this.initialize.apply(this,arguments)}Game_Picture.prototype.initialize=function(){this.initBasic();this.initTarget();this.initTone();this.initRotation()};Game_Picture.prototype.name=function(){return this._name};
Game_Picture.prototype.origin=function(){return this._origin};Game_Picture.prototype.x=function(){return this._x};Game_Picture.prototype.y=function(){return this._y};Game_Picture.prototype.scaleX=function(){return this._scaleX};Game_Picture.prototype.scaleY=function(){return this._scaleY};Game_Picture.prototype.opacity=function(){return this._opacity};Game_Picture.prototype.blendMode=function(){return this._blendMode};Game_Picture.prototype.tone=function(){return this._tone};
Game_Picture.prototype.angle=function(){return this._angle};Game_Picture.prototype.initBasic=function(){this._name="";this._y=this._x=this._origin=0;this._scaleY=this._scaleX=100;this._opacity=255;this._blendMode=0};Game_Picture.prototype.initTarget=function(){this._targetX=this._x;this._targetY=this._y;this._targetScaleX=this._scaleX;this._targetScaleY=this._scaleY;this._targetOpacity=this._opacity;this._duration=0};
Game_Picture.prototype.initTone=function(){this._toneTarget=this._tone=null;this._toneDuration=0};Game_Picture.prototype.initRotation=function(){this._rotationSpeed=this._angle=0};Game_Picture.prototype.show=function(a,b,c,d,e,f,g,h){this._name=a;this._origin=b;this._x=c;this._y=d;this._scaleX=e;this._scaleY=f;this._opacity=g;this._blendMode=h;this.initTarget();this.initTone();this.initRotation()};
Game_Picture.prototype.move=function(a,b,c,d,e,f,g,h){this._origin=a;this._targetX=b;this._targetY=c;this._targetScaleX=d;this._targetScaleY=e;this._targetOpacity=f;this._blendMode=g;this._duration=h};Game_Picture.prototype.rotate=function(a){this._rotationSpeed=a};Game_Picture.prototype.tint=function(a,b){this._tone||(this._tone=[0,0,0,0]);this._toneTarget=a.clone();this._toneDuration=b;0===this._toneDuration&&(this._tone=this._toneTarget.clone())};
Game_Picture.prototype.erase=function(){this._name="";this._origin=0;this.initTarget();this.initTone();this.initRotation()};Game_Picture.prototype.update=function(){this.updateMove();this.updateTone();this.updateRotation()};
Game_Picture.prototype.updateMove=function(){if(0<this._duration){var a=this._duration;this._x=(this._x*(a-1)+this._targetX)/a;this._y=(this._y*(a-1)+this._targetY)/a;this._scaleX=(this._scaleX*(a-1)+this._targetScaleX)/a;this._scaleY=(this._scaleY*(a-1)+this._targetScaleY)/a;this._opacity=(this._opacity*(a-1)+this._targetOpacity)/a;this._duration--}};
Game_Picture.prototype.updateTone=function(){if(0<this._toneDuration){for(var a=this._toneDuration,b=0;4>b;b++)this._tone[b]=(this._tone[b]*(a-1)+this._toneTarget[b])/a;this._toneDuration--}};Game_Picture.prototype.updateRotation=function(){0!==this._rotationSpeed&&(this._angle+=this._rotationSpeed/2)};function Game_Item(){this.initialize.apply(this,arguments)}Game_Item.prototype.initialize=function(a){this._dataClass="";this._itemId=0;a&&this.setObject(a)};
Game_Item.prototype.isSkill=function(){return"skill"===this._dataClass};Game_Item.prototype.isItem=function(){return"item"===this._dataClass};Game_Item.prototype.isUsableItem=function(){return this.isSkill()||this.isItem()};Game_Item.prototype.isWeapon=function(){return"weapon"===this._dataClass};Game_Item.prototype.isArmor=function(){return"armor"===this._dataClass};Game_Item.prototype.isEquipItem=function(){return this.isWeapon()||this.isArmor()};
Game_Item.prototype.isNull=function(){return""===this._dataClass};Game_Item.prototype.itemId=function(){return this._itemId};Game_Item.prototype.object=function(){return this.isSkill()?$dataSkills[this._itemId]:this.isItem()?$dataItems[this._itemId]:this.isWeapon()?$dataWeapons[this._itemId]:this.isArmor()?$dataArmors[this._itemId]:null};
Game_Item.prototype.setObject=function(a){DataManager.isSkill(a)?this._dataClass="skill":DataManager.isItem(a)?this._dataClass="item":DataManager.isWeapon(a)?this._dataClass="weapon":DataManager.isArmor(a)?this._dataClass="armor":this._dataClass="";this._itemId=a?a.id:0};Game_Item.prototype.setEquip=function(a,b){this._dataClass=a?"weapon":"armor";this._itemId=b};function Game_Action(){this.initialize.apply(this,arguments)}Game_Action.EFFECT_RECOVER_HP=11;Game_Action.EFFECT_RECOVER_MP=12;
Game_Action.EFFECT_GAIN_TP=13;Game_Action.EFFECT_ADD_STATE=21;Game_Action.EFFECT_REMOVE_STATE=22;Game_Action.EFFECT_ADD_BUFF=31;Game_Action.EFFECT_ADD_DEBUFF=32;Game_Action.EFFECT_REMOVE_BUFF=33;Game_Action.EFFECT_REMOVE_DEBUFF=34;Game_Action.EFFECT_SPECIAL=41;Game_Action.EFFECT_GROW=42;Game_Action.EFFECT_LEARN_SKILL=43;Game_Action.EFFECT_COMMON_EVENT=44;Game_Action.SPECIAL_EFFECT_ESCAPE=0;Game_Action.HITTYPE_CERTAIN=0;Game_Action.HITTYPE_PHYSICAL=1;Game_Action.HITTYPE_MAGICAL=2;
Game_Action.prototype.initialize=function(a,b){this._subjectActorId=0;this._subjectEnemyIndex=-1;this._forcing=b||!1;this.setSubject(a);this.clear()};Game_Action.prototype.clear=function(){this._item=new Game_Item;this._targetIndex=-1};Game_Action.prototype.setSubject=function(a){a.isActor()?(this._subjectActorId=a.actorId(),this._subjectEnemyIndex=-1):(this._subjectEnemyIndex=a.index(),this._subjectActorId=0)};
Game_Action.prototype.subject=function(){return 0<this._subjectActorId?$gameActors.actor(this._subjectActorId):$gameTroop.members()[this._subjectEnemyIndex]};Game_Action.prototype.friendsUnit=function(){return this.subject().friendsUnit()};Game_Action.prototype.opponentsUnit=function(){return this.subject().opponentsUnit()};Game_Action.prototype.setEnemyAction=function(a){a?this.setSkill(a.skillId):this.clear()};Game_Action.prototype.setAttack=function(){this.setSkill(this.subject().attackSkillId())};
Game_Action.prototype.setGuard=function(){this.setSkill(this.subject().guardSkillId())};Game_Action.prototype.setSkill=function(a){this._item.setObject($dataSkills[a])};Game_Action.prototype.setItem=function(a){this._item.setObject($dataItems[a])};Game_Action.prototype.setItemObject=function(a){this._item.setObject(a)};Game_Action.prototype.setTarget=function(a){this._targetIndex=a};Game_Action.prototype.item=function(){return this._item.object()};Game_Action.prototype.isSkill=function(){return this._item.isSkill()};
Game_Action.prototype.isItem=function(){return this._item.isItem()};Game_Action.prototype.numRepeats=function(){var a=this.item().repeats;this.isAttack()&&(a+=this.subject().attackTimesAdd());return Math.floor(a)};Game_Action.prototype.checkItemScope=function(a){return a.contains(this.item().scope)};Game_Action.prototype.isForOpponent=function(){return this.checkItemScope([1,2,3,4,5,6])};Game_Action.prototype.isForFriend=function(){return this.checkItemScope([7,8,9,10,11])};
Game_Action.prototype.isForDeadFriend=function(){return this.checkItemScope([9,10])};Game_Action.prototype.isForUser=function(){return this.checkItemScope([11])};Game_Action.prototype.isForOne=function(){return this.checkItemScope([1,3,7,9,11])};Game_Action.prototype.isForRandom=function(){return this.checkItemScope([3,4,5,6])};Game_Action.prototype.isForAll=function(){return this.checkItemScope([2,8,10])};Game_Action.prototype.needsSelection=function(){return this.checkItemScope([1,7,9])};
Game_Action.prototype.numTargets=function(){return this.isForRandom()?this.item().scope-2:0};Game_Action.prototype.checkDamageType=function(a){return a.contains(this.item().damage.type)};Game_Action.prototype.isHpEffect=function(){return this.checkDamageType([1,3,5])};Game_Action.prototype.isMpEffect=function(){return this.checkDamageType([2,4,6])};Game_Action.prototype.isDamage=function(){return this.checkDamageType([1,2])};
Game_Action.prototype.isRecover=function(){return this.checkDamageType([3,4])};Game_Action.prototype.isDrain=function(){return this.checkDamageType([5,6])};Game_Action.prototype.isHpRecover=function(){return this.checkDamageType([3])};Game_Action.prototype.isMpRecover=function(){return this.checkDamageType([4])};Game_Action.prototype.isCertainHit=function(){return this.item().hitType===Game_Action.HITTYPE_CERTAIN};Game_Action.prototype.isPhysical=function(){return this.item().hitType===Game_Action.HITTYPE_PHYSICAL};
Game_Action.prototype.isMagical=function(){return this.item().hitType===Game_Action.HITTYPE_MAGICAL};Game_Action.prototype.isAttack=function(){return this.item()===$dataSkills[this.subject().attackSkillId()]};Game_Action.prototype.isGuard=function(){return this.item()===$dataSkills[this.subject().guardSkillId()]};Game_Action.prototype.isMagicSkill=function(){return this.isSkill()?$dataSystem.magicSkills.contains(this.item().stypeId):!1};
Game_Action.prototype.decideRandomTarget=function(){var a;(a=this.isForDeadFriend()?this.friendsUnit().randomDeadTarget():this.isForFriend()?this.friendsUnit().randomTarget():this.opponentsUnit().randomTarget())?this._targetIndex=a.index():this.clear()};Game_Action.prototype.setConfusion=function(){this.setAttack()};Game_Action.prototype.prepare=function(){this.subject().isConfused()&&!this._forcing&&this.setConfusion()};
Game_Action.prototype.isValid=function(){return this._forcing&&this.item()||this.subject().canUse(this.item())};Game_Action.prototype.speed=function(){var a=this.subject().agi;a+=Math.randomInt(Math.floor(5+a/4));this.item()&&(a+=this.item().speed);this.isAttack()&&(a+=this.subject().attackSpeed());return a};
Game_Action.prototype.makeTargets=function(){var a=[];!this._forcing&&this.subject().isConfused()?a=[this.confusionTarget()]:this.isForOpponent()?a=this.targetsForOpponents():this.isForFriend()&&(a=this.targetsForFriends());return this.repeatTargets(a)};Game_Action.prototype.repeatTargets=function(a){for(var b=[],c=this.numRepeats(),d=0;d<a.length;d++){var e=a[d];if(e)for(var f=0;f<c;f++)b.push(e)}return b};
Game_Action.prototype.confusionTarget=function(){switch(this.subject().confusionLevel()){case 1:return this.opponentsUnit().randomTarget();case 2:return 0===Math.randomInt(2)?this.opponentsUnit().randomTarget():this.friendsUnit().randomTarget();default:return this.friendsUnit().randomTarget()}};
Game_Action.prototype.targetsForOpponents=function(){var a=[],b=this.opponentsUnit();if(this.isForRandom())for(var c=0;c<this.numTargets();c++)a.push(b.randomTarget());else this.isForOne()?0>this._targetIndex?a.push(b.randomTarget()):a.push(b.smoothTarget(this._targetIndex)):a=b.aliveMembers();return a};
Game_Action.prototype.targetsForFriends=function(){var a=[],b=this.friendsUnit();if(this.isForUser())return[this.subject()];this.isForDeadFriend()?this.isForOne()?a.push(b.smoothDeadTarget(this._targetIndex)):a=b.deadMembers():this.isForOne()?0>this._targetIndex?a.push(b.randomTarget()):a.push(b.smoothTarget(this._targetIndex)):a=b.aliveMembers();return a};
Game_Action.prototype.evaluate=function(){var a=0;this.itemTargetCandidates().forEach(function(b){var c=this.evaluateWithTarget(b);this.isForAll()?a+=c:c>a&&(a=c,this._targetIndex=b.index())},this);a*=this.numRepeats();0<a&&(a+=Math.random());return a};
Game_Action.prototype.itemTargetCandidates=function(){return this.isValid()?this.isForOpponent()?this.opponentsUnit().aliveMembers():this.isForUser()?[this.subject()]:this.isForDeadFriend()?this.friendsUnit().deadMembers():this.friendsUnit().aliveMembers():[]};Game_Action.prototype.evaluateWithTarget=function(a){if(this.isHpEffect()){var b=this.makeDamageValue(a,!1);return this.isForOpponent()?b/Math.max(a.hp,1):Math.min(-b,a.mhp-a.hp)/a.mhp}};
Game_Action.prototype.testApply=function(a){return this.isForDeadFriend()===a.isDead()&&($gameParty.inBattle()||this.isForOpponent()||this.isHpRecover()&&a.hp<a.mhp||this.isMpRecover()&&a.mp<a.mmp||this.hasItemAnyValidEffects(a))};Game_Action.prototype.hasItemAnyValidEffects=function(a){return this.item().effects.some(function(b){return this.testItemEffect(a,b)},this)};
Game_Action.prototype.testItemEffect=function(a,b){switch(b.code){case Game_Action.EFFECT_RECOVER_HP:return a.hp<a.mhp||0>b.value1||0>b.value2;case Game_Action.EFFECT_RECOVER_MP:return a.mp<a.mmp||0>b.value1||0>b.value2;case Game_Action.EFFECT_ADD_STATE:return!a.isStateAffected(b.dataId);case Game_Action.EFFECT_REMOVE_STATE:return a.isStateAffected(b.dataId);case Game_Action.EFFECT_ADD_BUFF:return!a.isMaxBuffAffected(b.dataId);case Game_Action.EFFECT_ADD_DEBUFF:return!a.isMaxDebuffAffected(b.dataId);
case Game_Action.EFFECT_REMOVE_BUFF:return a.isBuffAffected(b.dataId);case Game_Action.EFFECT_REMOVE_DEBUFF:return a.isDebuffAffected(b.dataId);case Game_Action.EFFECT_LEARN_SKILL:return a.isActor()&&!a.isLearnedSkill(b.dataId);default:return!0}};Game_Action.prototype.itemCnt=function(a){return this.isPhysical()&&a.canMove()?a.cnt:0};Game_Action.prototype.itemMrf=function(a){return this.isMagical()?a.mrf:0};
Game_Action.prototype.itemHit=function(a){return this.isPhysical()?.01*this.item().successRate*this.subject().hit:.01*this.item().successRate};Game_Action.prototype.itemEva=function(a){return this.isPhysical()?a.eva:this.isMagical()?a.mev:0};Game_Action.prototype.itemCri=function(a){return this.item().damage.critical?this.subject().cri*(1-a.cev):0};
Game_Action.prototype.apply=function(a){var b=a.result();this.subject().clearResult();b.clear();b.used=this.testApply(a);b.missed=b.used&&Math.random()>=this.itemHit(a);b.evaded=!b.missed&&Math.random()<this.itemEva(a);b.physical=this.isPhysical();b.drain=this.isDrain();b.isHit()&&(0<this.item().damage.type&&(b.critical=Math.random()<this.itemCri(a),b=this.makeDamageValue(a,b.critical),this.executeDamage(a,b)),this.item().effects.forEach(function(c){this.applyItemEffect(a,c)},this),this.applyItemUserEffect(a))};
Game_Action.prototype.makeDamageValue=function(a,b){var c=this.item(),d=this.evalDamageFormula(a),e=d*this.calcElementRate(a);this.isPhysical()&&(e*=a.pdr);this.isMagical()&&(e*=a.mdr);0>d&&(e*=a.rec);b&&(e=this.applyCritical(e));e=this.applyVariance(e,c.damage.variance);e=this.applyGuard(e,a);return e=Math.round(e)};
Game_Action.prototype.evalDamageFormula=function(a){try{var b=this.item();this.subject();var c=[3,4].contains(b.damage.type)?-1:1,d=Math.max(eval(b.damage.formula),0)*c;isNaN(d)&&(d=0);return d}catch(e){return 0}};Game_Action.prototype.calcElementRate=function(a){return 0>this.item().damage.elementId?this.elementsMaxRate(a,this.subject().attackElements()):a.elementRate(this.item().damage.elementId)};
Game_Action.prototype.elementsMaxRate=function(a,b){return 0<b.length?Math.max.apply(null,b.map(function(c){return a.elementRate(c)},this)):1};Game_Action.prototype.applyCritical=function(a){return 3*a};Game_Action.prototype.applyVariance=function(a,b){b=Math.floor(Math.max(Math.abs(a)*b/100,0));b=Math.randomInt(b+1)+Math.randomInt(b+1)-b;return 0<=a?a+b:a-b};Game_Action.prototype.applyGuard=function(a,b){return a/(0<a&&b.isGuard()?2*b.grd:1)};
Game_Action.prototype.executeDamage=function(a,b){var c=a.result();0===b&&(c.critical=!1);this.isHpEffect()&&this.executeHpDamage(a,b);this.isMpEffect()&&this.executeMpDamage(a,b)};Game_Action.prototype.executeHpDamage=function(a,b){this.isDrain()&&(b=Math.min(a.hp,b));this.makeSuccess(a);a.gainHp(-b);if(0<b)a.onDamage(b);this.gainDrainedHp(b)};Game_Action.prototype.executeMpDamage=function(a,b){this.isMpRecover()||(b=Math.min(a.mp,b));0!==b&&this.makeSuccess(a);a.gainMp(-b);this.gainDrainedMp(b)};
Game_Action.prototype.gainDrainedHp=function(a){if(this.isDrain()){var b=this.subject();void 0!==this._reflectionTarget&&(b=this._reflectionTarget);b.gainHp(a)}};Game_Action.prototype.gainDrainedMp=function(a){if(this.isDrain()){var b=this.subject();void 0!==this._reflectionTarget&&(b=this._reflectionTarget);b.gainMp(a)}};
Game_Action.prototype.applyItemEffect=function(a,b){switch(b.code){case Game_Action.EFFECT_RECOVER_HP:this.itemEffectRecoverHp(a,b);break;case Game_Action.EFFECT_RECOVER_MP:this.itemEffectRecoverMp(a,b);break;case Game_Action.EFFECT_GAIN_TP:this.itemEffectGainTp(a,b);break;case Game_Action.EFFECT_ADD_STATE:this.itemEffectAddState(a,b);break;case Game_Action.EFFECT_REMOVE_STATE:this.itemEffectRemoveState(a,b);break;case Game_Action.EFFECT_ADD_BUFF:this.itemEffectAddBuff(a,b);break;case Game_Action.EFFECT_ADD_DEBUFF:this.itemEffectAddDebuff(a,
b);break;case Game_Action.EFFECT_REMOVE_BUFF:this.itemEffectRemoveBuff(a,b);break;case Game_Action.EFFECT_REMOVE_DEBUFF:this.itemEffectRemoveDebuff(a,b);break;case Game_Action.EFFECT_SPECIAL:this.itemEffectSpecial(a,b);break;case Game_Action.EFFECT_GROW:this.itemEffectGrow(a,b);break;case Game_Action.EFFECT_LEARN_SKILL:this.itemEffectLearnSkill(a,b);break;case Game_Action.EFFECT_COMMON_EVENT:this.itemEffectCommonEvent(a,b)}};
Game_Action.prototype.itemEffectRecoverHp=function(a,b){b=(a.mhp*b.value1+b.value2)*a.rec;this.isItem()&&(b*=this.subject().pha);b=Math.floor(b);0!==b&&(a.gainHp(b),this.makeSuccess(a))};Game_Action.prototype.itemEffectRecoverMp=function(a,b){b=(a.mmp*b.value1+b.value2)*a.rec;this.isItem()&&(b*=this.subject().pha);b=Math.floor(b);0!==b&&(a.gainMp(b),this.makeSuccess(a))};Game_Action.prototype.itemEffectGainTp=function(a,b){b=Math.floor(b.value1);0!==b&&(a.gainTp(b),this.makeSuccess(a))};
Game_Action.prototype.itemEffectAddState=function(a,b){0===b.dataId?this.itemEffectAddAttackState(a,b):this.itemEffectAddNormalState(a,b)};Game_Action.prototype.itemEffectAddAttackState=function(a,b){this.subject().attackStates().forEach(function(c){var d=b.value1;d*=a.stateRate(c);d*=this.subject().attackStatesRate(c);d*=this.lukEffectRate(a);Math.random()<d&&(a.addState(c),this.makeSuccess(a))}.bind(this),a)};
Game_Action.prototype.itemEffectAddNormalState=function(a,b){var c=b.value1;this.isCertainHit()||(c*=a.stateRate(b.dataId),c*=this.lukEffectRate(a));Math.random()<c&&(a.addState(b.dataId),this.makeSuccess(a))};Game_Action.prototype.itemEffectRemoveState=function(a,b){Math.random()<b.value1&&(a.removeState(b.dataId),this.makeSuccess(a))};Game_Action.prototype.itemEffectAddBuff=function(a,b){a.addBuff(b.dataId,b.value1);this.makeSuccess(a)};
Game_Action.prototype.itemEffectAddDebuff=function(a,b){var c=a.debuffRate(b.dataId)*this.lukEffectRate(a);Math.random()<c&&(a.addDebuff(b.dataId,b.value1),this.makeSuccess(a))};Game_Action.prototype.itemEffectRemoveBuff=function(a,b){a.isBuffAffected(b.dataId)&&(a.removeBuff(b.dataId),this.makeSuccess(a))};Game_Action.prototype.itemEffectRemoveDebuff=function(a,b){a.isDebuffAffected(b.dataId)&&(a.removeBuff(b.dataId),this.makeSuccess(a))};
Game_Action.prototype.itemEffectSpecial=function(a,b){b.dataId===Game_Action.SPECIAL_EFFECT_ESCAPE&&(a.escape(),this.makeSuccess(a))};Game_Action.prototype.itemEffectGrow=function(a,b){a.addParam(b.dataId,Math.floor(b.value1));this.makeSuccess(a)};Game_Action.prototype.itemEffectLearnSkill=function(a,b){a.isActor()&&(a.learnSkill(b.dataId),this.makeSuccess(a))};Game_Action.prototype.itemEffectCommonEvent=function(a,b){};Game_Action.prototype.makeSuccess=function(a){a.result().success=!0};
Game_Action.prototype.applyItemUserEffect=function(a){a=Math.floor(this.item().tpGain*this.subject().tcr);this.subject().gainSilentTp(a)};Game_Action.prototype.lukEffectRate=function(a){return Math.max(1+.001*(this.subject().luk-a.luk),0)};Game_Action.prototype.applyGlobal=function(){this.item().effects.forEach(function(a){a.code===Game_Action.EFFECT_COMMON_EVENT&&$gameTemp.reserveCommonEvent(a.dataId)},this)};function Game_ActionResult(){this.initialize.apply(this,arguments)}
Game_ActionResult.prototype.initialize=function(){this.clear()};Game_ActionResult.prototype.clear=function(){this.hpAffected=this.success=this.critical=this.drain=this.physical=this.evaded=this.missed=this.used=!1;this.tpDamage=this.mpDamage=this.hpDamage=0;this.addedStates=[];this.removedStates=[];this.addedBuffs=[];this.addedDebuffs=[];this.removedBuffs=[]};Game_ActionResult.prototype.addedStateObjects=function(){return this.addedStates.map(function(a){return $dataStates[a]})};
Game_ActionResult.prototype.removedStateObjects=function(){return this.removedStates.map(function(a){return $dataStates[a]})};Game_ActionResult.prototype.isStatusAffected=function(){return 0<this.addedStates.length||0<this.removedStates.length||0<this.addedBuffs.length||0<this.addedDebuffs.length||0<this.removedBuffs.length};Game_ActionResult.prototype.isHit=function(){return this.used&&!this.missed&&!this.evaded};Game_ActionResult.prototype.isStateAdded=function(a){return this.addedStates.contains(a)};
Game_ActionResult.prototype.pushAddedState=function(a){this.isStateAdded(a)||this.addedStates.push(a)};Game_ActionResult.prototype.isStateRemoved=function(a){return this.removedStates.contains(a)};Game_ActionResult.prototype.pushRemovedState=function(a){this.isStateRemoved(a)||this.removedStates.push(a)};Game_ActionResult.prototype.isBuffAdded=function(a){return this.addedBuffs.contains(a)};Game_ActionResult.prototype.pushAddedBuff=function(a){this.isBuffAdded(a)||this.addedBuffs.push(a)};
Game_ActionResult.prototype.isDebuffAdded=function(a){return this.addedDebuffs.contains(a)};Game_ActionResult.prototype.pushAddedDebuff=function(a){this.isDebuffAdded(a)||this.addedDebuffs.push(a)};Game_ActionResult.prototype.isBuffRemoved=function(a){return this.removedBuffs.contains(a)};Game_ActionResult.prototype.pushRemovedBuff=function(a){this.isBuffRemoved(a)||this.removedBuffs.push(a)};function Game_BattlerBase(){this.initialize.apply(this,arguments)}Game_BattlerBase.TRAIT_ELEMENT_RATE=11;
Game_BattlerBase.TRAIT_DEBUFF_RATE=12;Game_BattlerBase.TRAIT_STATE_RATE=13;Game_BattlerBase.TRAIT_STATE_RESIST=14;Game_BattlerBase.TRAIT_PARAM=21;Game_BattlerBase.TRAIT_XPARAM=22;Game_BattlerBase.TRAIT_SPARAM=23;Game_BattlerBase.TRAIT_ATTACK_ELEMENT=31;Game_BattlerBase.TRAIT_ATTACK_STATE=32;Game_BattlerBase.TRAIT_ATTACK_SPEED=33;Game_BattlerBase.TRAIT_ATTACK_TIMES=34;Game_BattlerBase.TRAIT_STYPE_ADD=41;Game_BattlerBase.TRAIT_STYPE_SEAL=42;Game_BattlerBase.TRAIT_SKILL_ADD=43;
Game_BattlerBase.TRAIT_SKILL_SEAL=44;Game_BattlerBase.TRAIT_EQUIP_WTYPE=51;Game_BattlerBase.TRAIT_EQUIP_ATYPE=52;Game_BattlerBase.TRAIT_EQUIP_LOCK=53;Game_BattlerBase.TRAIT_EQUIP_SEAL=54;Game_BattlerBase.TRAIT_SLOT_TYPE=55;Game_BattlerBase.TRAIT_ACTION_PLUS=61;Game_BattlerBase.TRAIT_SPECIAL_FLAG=62;Game_BattlerBase.TRAIT_COLLAPSE_TYPE=63;Game_BattlerBase.TRAIT_PARTY_ABILITY=64;Game_BattlerBase.FLAG_ID_AUTO_BATTLE=0;Game_BattlerBase.FLAG_ID_GUARD=1;Game_BattlerBase.FLAG_ID_SUBSTITUTE=2;
Game_BattlerBase.FLAG_ID_PRESERVE_TP=3;Game_BattlerBase.ICON_BUFF_START=32;Game_BattlerBase.ICON_DEBUFF_START=48;
Object.defineProperties(Game_BattlerBase.prototype,{hp:{get:function(){return this._hp},configurable:!0},mp:{get:function(){return this._mp},configurable:!0},tp:{get:function(){return this._tp},configurable:!0},mhp:{get:function(){return this.param(0)},configurable:!0},mmp:{get:function(){return this.param(1)},configurable:!0},atk:{get:function(){return this.param(2)},configurable:!0},def:{get:function(){return this.param(3)},configurable:!0},mat:{get:function(){return this.param(4)},configurable:!0},
mdf:{get:function(){return this.param(5)},configurable:!0},agi:{get:function(){return this.param(6)},configurable:!0},luk:{get:function(){return this.param(7)},configurable:!0},hit:{get:function(){return this.xparam(0)},configurable:!0},eva:{get:function(){return this.xparam(1)},configurable:!0},cri:{get:function(){return this.xparam(2)},configurable:!0},cev:{get:function(){return this.xparam(3)},configurable:!0},mev:{get:function(){return this.xparam(4)},configurable:!0},mrf:{get:function(){return this.xparam(5)},
configurable:!0},cnt:{get:function(){return this.xparam(6)},configurable:!0},hrg:{get:function(){return this.xparam(7)},configurable:!0},mrg:{get:function(){return this.xparam(8)},configurable:!0},trg:{get:function(){return this.xparam(9)},configurable:!0},tgr:{get:function(){return this.sparam(0)},configurable:!0},grd:{get:function(){return this.sparam(1)},configurable:!0},rec:{get:function(){return this.sparam(2)},configurable:!0},pha:{get:function(){return this.sparam(3)},configurable:!0},mcr:{get:function(){return this.sparam(4)},
configurable:!0},tcr:{get:function(){return this.sparam(5)},configurable:!0},pdr:{get:function(){return this.sparam(6)},configurable:!0},mdr:{get:function(){return this.sparam(7)},configurable:!0},fdr:{get:function(){return this.sparam(8)},configurable:!0},exr:{get:function(){return this.sparam(9)},configurable:!0}});Game_BattlerBase.prototype.initialize=function(){this.initMembers()};
Game_BattlerBase.prototype.initMembers=function(){this._hp=1;this._tp=this._mp=0;this._hidden=!1;this.clearParamPlus();this.clearStates();this.clearBuffs()};Game_BattlerBase.prototype.clearParamPlus=function(){this._paramPlus=[0,0,0,0,0,0,0,0]};Game_BattlerBase.prototype.clearStates=function(){this._states=[];this._stateTurns={}};Game_BattlerBase.prototype.eraseState=function(a){var b=this._states.indexOf(a);0<=b&&this._states.splice(b,1);delete this._stateTurns[a]};
Game_BattlerBase.prototype.isStateAffected=function(a){return this._states.contains(a)};Game_BattlerBase.prototype.isDeathStateAffected=function(){return this.isStateAffected(this.deathStateId())};Game_BattlerBase.prototype.deathStateId=function(){return 1};Game_BattlerBase.prototype.resetStateCounts=function(a){var b=$dataStates[a];this._stateTurns[a]=b.minTurns+Math.randomInt(1+Math.max(b.maxTurns-b.minTurns,0))};Game_BattlerBase.prototype.isStateExpired=function(a){return 0===this._stateTurns[a]};
Game_BattlerBase.prototype.updateStateTurns=function(){this._states.forEach(function(a){0<this._stateTurns[a]&&this._stateTurns[a]--},this)};Game_BattlerBase.prototype.clearBuffs=function(){this._buffs=[0,0,0,0,0,0,0,0];this._buffTurns=[0,0,0,0,0,0,0,0]};Game_BattlerBase.prototype.eraseBuff=function(a){this._buffs[a]=0;this._buffTurns[a]=0};Game_BattlerBase.prototype.buffLength=function(){return this._buffs.length};Game_BattlerBase.prototype.buff=function(a){return this._buffs[a]};
Game_BattlerBase.prototype.isBuffAffected=function(a){return 0<this._buffs[a]};Game_BattlerBase.prototype.isDebuffAffected=function(a){return 0>this._buffs[a]};Game_BattlerBase.prototype.isBuffOrDebuffAffected=function(a){return 0!==this._buffs[a]};Game_BattlerBase.prototype.isMaxBuffAffected=function(a){return 2===this._buffs[a]};Game_BattlerBase.prototype.isMaxDebuffAffected=function(a){return-2===this._buffs[a]};Game_BattlerBase.prototype.increaseBuff=function(a){this.isMaxBuffAffected(a)||this._buffs[a]++};
Game_BattlerBase.prototype.decreaseBuff=function(a){this.isMaxDebuffAffected(a)||this._buffs[a]--};Game_BattlerBase.prototype.overwriteBuffTurns=function(a,b){this._buffTurns[a]<b&&(this._buffTurns[a]=b)};Game_BattlerBase.prototype.isBuffExpired=function(a){return 0===this._buffTurns[a]};Game_BattlerBase.prototype.updateBuffTurns=function(){for(var a=0;a<this._buffTurns.length;a++)0<this._buffTurns[a]&&this._buffTurns[a]--};Game_BattlerBase.prototype.die=function(){this._hp=0;this.clearStates();this.clearBuffs()};
Game_BattlerBase.prototype.revive=function(){0===this._hp&&(this._hp=1)};Game_BattlerBase.prototype.states=function(){return this._states.map(function(a){return $dataStates[a]})};Game_BattlerBase.prototype.stateIcons=function(){return this.states().map(function(a){return a.iconIndex}).filter(function(a){return 0<a})};Game_BattlerBase.prototype.buffIcons=function(){for(var a=[],b=0;b<this._buffs.length;b++)0!==this._buffs[b]&&a.push(this.buffIconIndex(this._buffs[b],b));return a};
Game_BattlerBase.prototype.buffIconIndex=function(a,b){return 0<a?Game_BattlerBase.ICON_BUFF_START+8*(a-1)+b:0>a?Game_BattlerBase.ICON_DEBUFF_START+8*(-a-1)+b:0};Game_BattlerBase.prototype.allIcons=function(){return this.stateIcons().concat(this.buffIcons())};Game_BattlerBase.prototype.traitObjects=function(){return this.states()};Game_BattlerBase.prototype.allTraits=function(){return this.traitObjects().reduce(function(a,b){return a.concat(b.traits)},[])};
Game_BattlerBase.prototype.traits=function(a){return this.allTraits().filter(function(b){return b.code===a})};Game_BattlerBase.prototype.traitsWithId=function(a,b){return this.allTraits().filter(function(c){return c.code===a&&c.dataId===b})};Game_BattlerBase.prototype.traitsPi=function(a,b){return this.traitsWithId(a,b).reduce(function(c,d){return c*d.value},1)};Game_BattlerBase.prototype.traitsSum=function(a,b){return this.traitsWithId(a,b).reduce(function(c,d){return c+d.value},0)};
Game_BattlerBase.prototype.traitsSumAll=function(a){return this.traits(a).reduce(function(b,c){return b+c.value},0)};Game_BattlerBase.prototype.traitsSet=function(a){return this.traits(a).reduce(function(b,c){return b.concat(c.dataId)},[])};Game_BattlerBase.prototype.paramBase=function(a){return 0};Game_BattlerBase.prototype.paramPlus=function(a){return this._paramPlus[a]};Game_BattlerBase.prototype.paramMin=function(a){return 1===a?0:1};
Game_BattlerBase.prototype.paramMax=function(a){return 0===a?999999:1===a?9999:999};Game_BattlerBase.prototype.paramRate=function(a){return this.traitsPi(Game_BattlerBase.TRAIT_PARAM,a)};Game_BattlerBase.prototype.paramBuffRate=function(a){return.25*this._buffs[a]+1};Game_BattlerBase.prototype.param=function(a){var b=this.paramBase(a)+this.paramPlus(a);b*=this.paramRate(a)*this.paramBuffRate(a);var c=this.paramMax(a);a=this.paramMin(a);return Math.round(b.clamp(a,c))};
Game_BattlerBase.prototype.xparam=function(a){return this.traitsSum(Game_BattlerBase.TRAIT_XPARAM,a)};Game_BattlerBase.prototype.sparam=function(a){return this.traitsPi(Game_BattlerBase.TRAIT_SPARAM,a)};Game_BattlerBase.prototype.elementRate=function(a){return this.traitsPi(Game_BattlerBase.TRAIT_ELEMENT_RATE,a)};Game_BattlerBase.prototype.debuffRate=function(a){return this.traitsPi(Game_BattlerBase.TRAIT_DEBUFF_RATE,a)};
Game_BattlerBase.prototype.stateRate=function(a){return this.traitsPi(Game_BattlerBase.TRAIT_STATE_RATE,a)};Game_BattlerBase.prototype.stateResistSet=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STATE_RESIST)};Game_BattlerBase.prototype.isStateResist=function(a){return this.stateResistSet().contains(a)};Game_BattlerBase.prototype.attackElements=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_ELEMENT)};Game_BattlerBase.prototype.attackStates=function(){return this.traitsSet(Game_BattlerBase.TRAIT_ATTACK_STATE)};
Game_BattlerBase.prototype.attackStatesRate=function(a){return this.traitsSum(Game_BattlerBase.TRAIT_ATTACK_STATE,a)};Game_BattlerBase.prototype.attackSpeed=function(){return this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_SPEED)};Game_BattlerBase.prototype.attackTimesAdd=function(){return Math.max(this.traitsSumAll(Game_BattlerBase.TRAIT_ATTACK_TIMES),0)};Game_BattlerBase.prototype.addedSkillTypes=function(){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_ADD)};
Game_BattlerBase.prototype.isSkillTypeSealed=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_STYPE_SEAL).contains(a)};Game_BattlerBase.prototype.addedSkills=function(){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_ADD)};Game_BattlerBase.prototype.isSkillSealed=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_SKILL_SEAL).contains(a)};Game_BattlerBase.prototype.isEquipWtypeOk=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_WTYPE).contains(a)};
Game_BattlerBase.prototype.isEquipAtypeOk=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_ATYPE).contains(a)};Game_BattlerBase.prototype.isEquipTypeLocked=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_LOCK).contains(a)};Game_BattlerBase.prototype.isEquipTypeSealed=function(a){return this.traitsSet(Game_BattlerBase.TRAIT_EQUIP_SEAL).contains(a)};
Game_BattlerBase.prototype.slotType=function(){var a=this.traitsSet(Game_BattlerBase.TRAIT_SLOT_TYPE);return 0<a.length?Math.max.apply(null,a):0};Game_BattlerBase.prototype.isDualWield=function(){return 1===this.slotType()};Game_BattlerBase.prototype.actionPlusSet=function(){return this.traits(Game_BattlerBase.TRAIT_ACTION_PLUS).map(function(a){return a.value})};
Game_BattlerBase.prototype.specialFlag=function(a){return this.traits(Game_BattlerBase.TRAIT_SPECIAL_FLAG).some(function(b){return b.dataId===a})};Game_BattlerBase.prototype.collapseType=function(){var a=this.traitsSet(Game_BattlerBase.TRAIT_COLLAPSE_TYPE);return 0<a.length?Math.max.apply(null,a):0};Game_BattlerBase.prototype.partyAbility=function(a){return this.traits(Game_BattlerBase.TRAIT_PARTY_ABILITY).some(function(b){return b.dataId===a})};Game_BattlerBase.prototype.isAutoBattle=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_AUTO_BATTLE)};
Game_BattlerBase.prototype.isGuard=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_GUARD)&&this.canMove()};Game_BattlerBase.prototype.isSubstitute=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_SUBSTITUTE)&&this.canMove()};Game_BattlerBase.prototype.isPreserveTp=function(){return this.specialFlag(Game_BattlerBase.FLAG_ID_PRESERVE_TP)};Game_BattlerBase.prototype.addParam=function(a,b){this._paramPlus[a]+=b;this.refresh()};
Game_BattlerBase.prototype.setHp=function(a){this._hp=a;this.refresh()};Game_BattlerBase.prototype.setMp=function(a){this._mp=a;this.refresh()};Game_BattlerBase.prototype.setTp=function(a){this._tp=a;this.refresh()};Game_BattlerBase.prototype.maxTp=function(){return 100};Game_BattlerBase.prototype.refresh=function(){this.stateResistSet().forEach(function(a){this.eraseState(a)},this);this._hp=this._hp.clamp(0,this.mhp);this._mp=this._mp.clamp(0,this.mmp);this._tp=this._tp.clamp(0,this.maxTp())};
Game_BattlerBase.prototype.recoverAll=function(){this.clearStates();this._hp=this.mhp;this._mp=this.mmp};Game_BattlerBase.prototype.hpRate=function(){return this.hp/this.mhp};Game_BattlerBase.prototype.mpRate=function(){return 0<this.mmp?this.mp/this.mmp:0};Game_BattlerBase.prototype.tpRate=function(){return this.tp/this.maxTp()};Game_BattlerBase.prototype.hide=function(){this._hidden=!0};Game_BattlerBase.prototype.appear=function(){this._hidden=!1};Game_BattlerBase.prototype.isHidden=function(){return this._hidden};
Game_BattlerBase.prototype.isAppeared=function(){return!this.isHidden()};Game_BattlerBase.prototype.isDead=function(){return this.isAppeared()&&this.isDeathStateAffected()};Game_BattlerBase.prototype.isAlive=function(){return this.isAppeared()&&!this.isDeathStateAffected()};Game_BattlerBase.prototype.isDying=function(){return this.isAlive()&&this._hp<this.mhp/4};Game_BattlerBase.prototype.isRestricted=function(){return this.isAppeared()&&0<this.restriction()};
Game_BattlerBase.prototype.canInput=function(){return this.isAppeared()&&!this.isRestricted()&&!this.isAutoBattle()};Game_BattlerBase.prototype.canMove=function(){return this.isAppeared()&&4>this.restriction()};Game_BattlerBase.prototype.isConfused=function(){return this.isAppeared()&&1<=this.restriction()&&3>=this.restriction()};Game_BattlerBase.prototype.confusionLevel=function(){return this.isConfused()?this.restriction():0};Game_BattlerBase.prototype.isActor=function(){return!1};
Game_BattlerBase.prototype.isEnemy=function(){return!1};Game_BattlerBase.prototype.sortStates=function(){this._states.sort(function(a,b){var c=$dataStates[a].priority,d=$dataStates[b].priority;return c!==d?d-c:a-b})};Game_BattlerBase.prototype.restriction=function(){return Math.max.apply(null,this.states().map(function(a){return a.restriction}).concat(0))};
Game_BattlerBase.prototype.addNewState=function(a){a===this.deathStateId()&&this.die();var b=this.isRestricted();this._states.push(a);this.sortStates();if(!b&&this.isRestricted())this.onRestrict()};Game_BattlerBase.prototype.onRestrict=function(){};Game_BattlerBase.prototype.mostImportantStateText=function(){for(var a=this.states(),b=0;b<a.length;b++)if(a[b].message3)return a[b].message3;return""};
Game_BattlerBase.prototype.stateMotionIndex=function(){var a=this.states();return 0<a.length?a[0].motion:0};Game_BattlerBase.prototype.stateOverlayIndex=function(){var a=this.states();return 0<a.length?a[0].overlay:0};Game_BattlerBase.prototype.isSkillWtypeOk=function(a){return!0};Game_BattlerBase.prototype.skillMpCost=function(a){return Math.floor(a.mpCost*this.mcr)};Game_BattlerBase.prototype.skillTpCost=function(a){return a.tpCost};
Game_BattlerBase.prototype.canPaySkillCost=function(a){return this._tp>=this.skillTpCost(a)&&this._mp>=this.skillMpCost(a)};Game_BattlerBase.prototype.paySkillCost=function(a){this._mp-=this.skillMpCost(a);this._tp-=this.skillTpCost(a)};Game_BattlerBase.prototype.isOccasionOk=function(a){return $gameParty.inBattle()?0===a.occasion||1===a.occasion:0===a.occasion||2===a.occasion};Game_BattlerBase.prototype.meetsUsableItemConditions=function(a){return this.canMove()&&this.isOccasionOk(a)};
Game_BattlerBase.prototype.meetsSkillConditions=function(a){return this.meetsUsableItemConditions(a)&&this.isSkillWtypeOk(a)&&this.canPaySkillCost(a)&&!this.isSkillSealed(a.id)&&!this.isSkillTypeSealed(a.stypeId)};Game_BattlerBase.prototype.meetsItemConditions=function(a){return this.meetsUsableItemConditions(a)&&$gameParty.hasItem(a)};Game_BattlerBase.prototype.canUse=function(a){return a?DataManager.isSkill(a)?this.meetsSkillConditions(a):DataManager.isItem(a)?this.meetsItemConditions(a):!1:!1};
Game_BattlerBase.prototype.canEquip=function(a){return a?DataManager.isWeapon(a)?this.canEquipWeapon(a):DataManager.isArmor(a)?this.canEquipArmor(a):!1:!1};Game_BattlerBase.prototype.canEquipWeapon=function(a){return this.isEquipWtypeOk(a.wtypeId)&&!this.isEquipTypeSealed(a.etypeId)};Game_BattlerBase.prototype.canEquipArmor=function(a){return this.isEquipAtypeOk(a.atypeId)&&!this.isEquipTypeSealed(a.etypeId)};Game_BattlerBase.prototype.attackSkillId=function(){return 1};
Game_BattlerBase.prototype.guardSkillId=function(){return 2};Game_BattlerBase.prototype.canAttack=function(){return this.canUse($dataSkills[this.attackSkillId()])};Game_BattlerBase.prototype.canGuard=function(){return this.canUse($dataSkills[this.guardSkillId()])};function Game_Battler(){this.initialize.apply(this,arguments)}Game_Battler.prototype=Object.create(Game_BattlerBase.prototype);Game_Battler.prototype.constructor=Game_Battler;Game_Battler.prototype.initialize=function(){Game_BattlerBase.prototype.initialize.call(this)};
Game_Battler.prototype.initMembers=function(){Game_BattlerBase.prototype.initMembers.call(this);this._actions=[];this._speed=0;this._result=new Game_ActionResult;this._actionState="";this._lastTargetIndex=0;this._animations=[];this._damagePopup=!1;this._motionType=this._effectType=null;this._weaponImageId=0;this._selected=this._motionRefresh=!1};Game_Battler.prototype.clearAnimations=function(){this._animations=[]};Game_Battler.prototype.clearDamagePopup=function(){this._damagePopup=!1};
Game_Battler.prototype.clearWeaponAnimation=function(){this._weaponImageId=0};Game_Battler.prototype.clearEffect=function(){this._effectType=null};Game_Battler.prototype.clearMotion=function(){this._motionType=null;this._motionRefresh=!1};Game_Battler.prototype.requestEffect=function(a){this._effectType=a};Game_Battler.prototype.requestMotion=function(a){this._motionType=a};Game_Battler.prototype.requestMotionRefresh=function(){this._motionRefresh=!0};
Game_Battler.prototype.select=function(){this._selected=!0};Game_Battler.prototype.deselect=function(){this._selected=!1};Game_Battler.prototype.isAnimationRequested=function(){return 0<this._animations.length};Game_Battler.prototype.isDamagePopupRequested=function(){return this._damagePopup};Game_Battler.prototype.isEffectRequested=function(){return!!this._effectType};Game_Battler.prototype.isMotionRequested=function(){return!!this._motionType};
Game_Battler.prototype.isWeaponAnimationRequested=function(){return 0<this._weaponImageId};Game_Battler.prototype.isMotionRefreshRequested=function(){return this._motionRefresh};Game_Battler.prototype.isSelected=function(){return this._selected};Game_Battler.prototype.effectType=function(){return this._effectType};Game_Battler.prototype.motionType=function(){return this._motionType};Game_Battler.prototype.weaponImageId=function(){return this._weaponImageId};Game_Battler.prototype.shiftAnimation=function(){return this._animations.shift()};
Game_Battler.prototype.startAnimation=function(a,b,c){this._animations.push({animationId:a,mirror:b,delay:c})};Game_Battler.prototype.startDamagePopup=function(){this._damagePopup=!0};Game_Battler.prototype.startWeaponAnimation=function(a){this._weaponImageId=a};Game_Battler.prototype.action=function(a){return this._actions[a]};Game_Battler.prototype.setAction=function(a,b){this._actions[a]=b};Game_Battler.prototype.numActions=function(){return this._actions.length};
Game_Battler.prototype.clearActions=function(){this._actions=[]};Game_Battler.prototype.result=function(){return this._result};Game_Battler.prototype.clearResult=function(){this._result.clear()};Game_Battler.prototype.refresh=function(){Game_BattlerBase.prototype.refresh.call(this);0===this.hp?this.addState(this.deathStateId()):this.removeState(this.deathStateId())};
Game_Battler.prototype.addState=function(a){this.isStateAddable(a)&&(this.isStateAffected(a)||(this.addNewState(a),this.refresh()),this.resetStateCounts(a),this._result.pushAddedState(a))};Game_Battler.prototype.isStateAddable=function(a){return this.isAlive()&&$dataStates[a]&&!this.isStateResist(a)&&!this._result.isStateRemoved(a)&&!this.isStateRestrict(a)};Game_Battler.prototype.isStateRestrict=function(a){return $dataStates[a].removeByRestriction&&this.isRestricted()};
Game_Battler.prototype.onRestrict=function(){Game_BattlerBase.prototype.onRestrict.call(this);this.clearActions();this.states().forEach(function(a){a.removeByRestriction&&this.removeState(a.id)},this)};Game_Battler.prototype.removeState=function(a){this.isStateAffected(a)&&(a===this.deathStateId()&&this.revive(),this.eraseState(a),this.refresh(),this._result.pushRemovedState(a))};Game_Battler.prototype.escape=function(){$gameParty.inBattle()&&this.hide();this.clearActions();this.clearStates();SoundManager.playEscape()};
Game_Battler.prototype.addBuff=function(a,b){this.isAlive()&&(this.increaseBuff(a),this.isBuffAffected(a)&&this.overwriteBuffTurns(a,b),this._result.pushAddedBuff(a),this.refresh())};Game_Battler.prototype.addDebuff=function(a,b){this.isAlive()&&(this.decreaseBuff(a),this.isDebuffAffected(a)&&this.overwriteBuffTurns(a,b),this._result.pushAddedDebuff(a),this.refresh())};
Game_Battler.prototype.removeBuff=function(a){this.isAlive()&&this.isBuffOrDebuffAffected(a)&&(this.eraseBuff(a),this._result.pushRemovedBuff(a),this.refresh())};Game_Battler.prototype.removeBattleStates=function(){this.states().forEach(function(a){a.removeAtBattleEnd&&this.removeState(a.id)},this)};Game_Battler.prototype.removeAllBuffs=function(){for(var a=0;a<this.buffLength();a++)this.removeBuff(a)};
Game_Battler.prototype.removeStatesAuto=function(a){this.states().forEach(function(b){this.isStateExpired(b.id)&&b.autoRemovalTiming===a&&this.removeState(b.id)},this)};Game_Battler.prototype.removeBuffsAuto=function(){for(var a=0;a<this.buffLength();a++)this.isBuffExpired(a)&&this.removeBuff(a)};Game_Battler.prototype.removeStatesByDamage=function(){this.states().forEach(function(a){a.removeByDamage&&Math.randomInt(100)<a.chanceByDamage&&this.removeState(a.id)},this)};
Game_Battler.prototype.makeActionTimes=function(){return this.actionPlusSet().reduce(function(a,b){return Math.random()<b?a+1:a},1)};Game_Battler.prototype.makeActions=function(){this.clearActions();if(this.canMove()){var a=this.makeActionTimes();this._actions=[];for(var b=0;b<a;b++)this._actions.push(new Game_Action(this))}};Game_Battler.prototype.speed=function(){return this._speed};
Game_Battler.prototype.makeSpeed=function(){this._speed=Math.min.apply(null,this._actions.map(function(a){return a.speed()}))||0};Game_Battler.prototype.currentAction=function(){return this._actions[0]};Game_Battler.prototype.removeCurrentAction=function(){this._actions.shift()};Game_Battler.prototype.setLastTarget=function(a){this._lastTargetIndex=a?a.index():0};
Game_Battler.prototype.forceAction=function(a,b){this.clearActions();var c=new Game_Action(this,!0);c.setSkill(a);-2===b?c.setTarget(this._lastTargetIndex):-1===b?c.decideRandomTarget():c.setTarget(b);this._actions.push(c)};Game_Battler.prototype.useItem=function(a){DataManager.isSkill(a)?this.paySkillCost(a):DataManager.isItem(a)&&this.consumeItem(a)};Game_Battler.prototype.consumeItem=function(a){$gameParty.consumeItem(a)};
Game_Battler.prototype.gainHp=function(a){this._result.hpDamage=-a;this._result.hpAffected=!0;this.setHp(this.hp+a)};Game_Battler.prototype.gainMp=function(a){this._result.mpDamage=-a;this.setMp(this.mp+a)};Game_Battler.prototype.gainTp=function(a){this._result.tpDamage=-a;this.setTp(this.tp+a)};Game_Battler.prototype.gainSilentTp=function(a){this.setTp(this.tp+a)};Game_Battler.prototype.initTp=function(){this.setTp(Math.randomInt(25))};Game_Battler.prototype.clearTp=function(){this.setTp(0)};
Game_Battler.prototype.chargeTpByDamage=function(a){this.gainSilentTp(Math.floor(50*a*this.tcr))};Game_Battler.prototype.regenerateHp=function(){var a=Math.floor(this.mhp*this.hrg);a=Math.max(a,-this.maxSlipDamage());0!==a&&this.gainHp(a)};Game_Battler.prototype.maxSlipDamage=function(){return $dataSystem.optSlipDeath?this.hp:Math.max(this.hp-1,0)};Game_Battler.prototype.regenerateMp=function(){var a=Math.floor(this.mmp*this.mrg);0!==a&&this.gainMp(a)};
Game_Battler.prototype.regenerateTp=function(){this.gainSilentTp(Math.floor(100*this.trg))};Game_Battler.prototype.regenerateAll=function(){this.isAlive()&&(this.regenerateHp(),this.regenerateMp(),this.regenerateTp())};Game_Battler.prototype.onBattleStart=function(){this.setActionState("undecided");this.clearMotion();this.isPreserveTp()||this.initTp()};Game_Battler.prototype.onAllActionsEnd=function(){this.clearResult();this.removeStatesAuto(1);this.removeBuffsAuto()};
Game_Battler.prototype.onTurnEnd=function(){this.clearResult();this.regenerateAll();BattleManager.isForcedTurn()||(this.updateStateTurns(),this.updateBuffTurns());this.removeStatesAuto(2)};Game_Battler.prototype.onBattleEnd=function(){this.clearResult();this.removeBattleStates();this.removeAllBuffs();this.clearActions();this.isPreserveTp()||this.clearTp();this.appear()};Game_Battler.prototype.onDamage=function(a){this.removeStatesByDamage();this.chargeTpByDamage(a/this.mhp)};
Game_Battler.prototype.setActionState=function(a){this._actionState=a;this.requestMotionRefresh()};Game_Battler.prototype.isUndecided=function(){return"undecided"===this._actionState};Game_Battler.prototype.isInputting=function(){return"inputting"===this._actionState};Game_Battler.prototype.isWaiting=function(){return"waiting"===this._actionState};Game_Battler.prototype.isActing=function(){return"acting"===this._actionState};
Game_Battler.prototype.isChanting=function(){return this.isWaiting()?this._actions.some(function(a){return a.isMagicSkill()}):!1};Game_Battler.prototype.isGuardWaiting=function(){return this.isWaiting()?this._actions.some(function(a){return a.isGuard()}):!1};Game_Battler.prototype.performActionStart=function(a){a.isGuard()||this.setActionState("acting")};Game_Battler.prototype.performAction=function(a){};Game_Battler.prototype.performActionEnd=function(){this.setActionState("done")};
Game_Battler.prototype.performDamage=function(){};Game_Battler.prototype.performMiss=function(){SoundManager.playMiss()};Game_Battler.prototype.performRecovery=function(){SoundManager.playRecovery()};Game_Battler.prototype.performEvasion=function(){SoundManager.playEvasion()};Game_Battler.prototype.performMagicEvasion=function(){SoundManager.playMagicEvasion()};Game_Battler.prototype.performCounter=function(){SoundManager.playEvasion()};Game_Battler.prototype.performReflection=function(){SoundManager.playReflection()};
Game_Battler.prototype.performSubstitute=function(a){};Game_Battler.prototype.performCollapse=function(){};function Game_Actor(){this.initialize.apply(this,arguments)}Game_Actor.prototype=Object.create(Game_Battler.prototype);Game_Actor.prototype.constructor=Game_Actor;Object.defineProperty(Game_Actor.prototype,"level",{get:function(){return this._level},configurable:!0});Game_Actor.prototype.initialize=function(a){Game_Battler.prototype.initialize.call(this);this.setup(a)};
Game_Actor.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this);this._actorId=0;this._nickname=this._name="";this._level=this._classId=0;this._characterName="";this._characterIndex=0;this._faceName="";this._faceIndex=0;this._battlerName="";this._exp={};this._skills=[];this._equips=[];this._actionInputIndex=0;this._lastMenuSkill=new Game_Item;this._lastBattleSkill=new Game_Item;this._lastCommandSymbol=""};
Game_Actor.prototype.setup=function(a){var b=$dataActors[a];this._actorId=a;this._name=b.name;this._nickname=b.nickname;this._profile=b.profile;this._classId=b.classId;this._level=b.initialLevel;this.initImages();this.initExp();this.initSkills();this.initEquips(b.equips);this.clearParamPlus();this.recoverAll()};Game_Actor.prototype.actorId=function(){return this._actorId};Game_Actor.prototype.actor=function(){return $dataActors[this._actorId]};Game_Actor.prototype.name=function(){return this._name};
Game_Actor.prototype.setName=function(a){this._name=a};Game_Actor.prototype.nickname=function(){return this._nickname};Game_Actor.prototype.setNickname=function(a){this._nickname=a};Game_Actor.prototype.profile=function(){return this._profile};Game_Actor.prototype.setProfile=function(a){this._profile=a};Game_Actor.prototype.characterName=function(){return this._characterName};Game_Actor.prototype.characterIndex=function(){return this._characterIndex};Game_Actor.prototype.faceName=function(){return this._faceName};
Game_Actor.prototype.faceIndex=function(){return this._faceIndex};Game_Actor.prototype.battlerName=function(){return this._battlerName};Game_Actor.prototype.clearStates=function(){Game_Battler.prototype.clearStates.call(this);this._stateSteps={}};Game_Actor.prototype.eraseState=function(a){Game_Battler.prototype.eraseState.call(this,a);delete this._stateSteps[a]};Game_Actor.prototype.resetStateCounts=function(a){Game_Battler.prototype.resetStateCounts.call(this,a);this._stateSteps[a]=$dataStates[a].stepsToRemove};
Game_Actor.prototype.initImages=function(){var a=this.actor();this._characterName=a.characterName;this._characterIndex=a.characterIndex;this._faceName=a.faceName;this._faceIndex=a.faceIndex;this._battlerName=a.battlerName};Game_Actor.prototype.expForLevel=function(a){var b=this.currentClass();return Math.round(b.expParams[0]*Math.pow(a-1,.9+b.expParams[2]/250)*a*(a+1)/(6+Math.pow(a,2)/50/b.expParams[3])+(a-1)*b.expParams[1])};Game_Actor.prototype.initExp=function(){this._exp[this._classId]=this.currentLevelExp()};
Game_Actor.prototype.currentExp=function(){return this._exp[this._classId]};Game_Actor.prototype.currentLevelExp=function(){return this.expForLevel(this._level)};Game_Actor.prototype.nextLevelExp=function(){return this.expForLevel(this._level+1)};Game_Actor.prototype.nextRequiredExp=function(){return this.nextLevelExp()-this.currentExp()};Game_Actor.prototype.maxLevel=function(){return this.actor().maxLevel};Game_Actor.prototype.isMaxLevel=function(){return this._level>=this.maxLevel()};
Game_Actor.prototype.initSkills=function(){this._skills=[];this.currentClass().learnings.forEach(function(a){a.level<=this._level&&this.learnSkill(a.skillId)},this)};Game_Actor.prototype.initEquips=function(a){var b=this.equipSlots(),c=b.length;this._equips=[];for(var d=0;d<c;d++)this._equips[d]=new Game_Item;for(d=0;d<a.length;d++)d<c&&this._equips[d].setEquip(1===b[d],a[d]);this.releaseUnequippableItems(!0);this.refresh()};
Game_Actor.prototype.equipSlots=function(){for(var a=[],b=1;b<$dataSystem.equipTypes.length;b++)a.push(b);2<=a.length&&this.isDualWield()&&(a[1]=1);return a};Game_Actor.prototype.equips=function(){return this._equips.map(function(a){return a.object()})};Game_Actor.prototype.weapons=function(){return this.equips().filter(function(a){return a&&DataManager.isWeapon(a)})};Game_Actor.prototype.armors=function(){return this.equips().filter(function(a){return a&&DataManager.isArmor(a)})};
Game_Actor.prototype.hasWeapon=function(a){return this.weapons().contains(a)};Game_Actor.prototype.hasArmor=function(a){return this.armors().contains(a)};Game_Actor.prototype.isEquipChangeOk=function(a){return!this.isEquipTypeLocked(this.equipSlots()[a])&&!this.isEquipTypeSealed(this.equipSlots()[a])};Game_Actor.prototype.changeEquip=function(a,b){!this.tradeItemWithParty(b,this.equips()[a])||b&&this.equipSlots()[a]!==b.etypeId||(this._equips[a].setObject(b),this.refresh())};
Game_Actor.prototype.forceChangeEquip=function(a,b){this._equips[a].setObject(b);this.releaseUnequippableItems(!0);this.refresh()};Game_Actor.prototype.tradeItemWithParty=function(a,b){if(a&&!$gameParty.hasItem(a))return!1;$gameParty.gainItem(b,1);$gameParty.loseItem(a,1);return!0};Game_Actor.prototype.changeEquipById=function(a,b){--a;1===this.equipSlots()[a]?this.changeEquip(a,$dataWeapons[b]):this.changeEquip(a,$dataArmors[b])};Game_Actor.prototype.isEquipped=function(a){return this.equips().contains(a)};
Game_Actor.prototype.discardEquip=function(a){a=this.equips().indexOf(a);0<=a&&this._equips[a].setObject(null)};Game_Actor.prototype.releaseUnequippableItems=function(a){for(;;){for(var b=this.equipSlots(),c=this.equips(),d=!1,e=0;e<c.length;e++){var f=c[e];!f||this.canEquip(f)&&f.etypeId===b[e]||(a||this.tradeItemWithParty(null,f),this._equips[e].setObject(null),d=!0)}if(!d)break}};
Game_Actor.prototype.clearEquipments=function(){for(var a=this.equipSlots().length,b=0;b<a;b++)this.isEquipChangeOk(b)&&this.changeEquip(b,null)};Game_Actor.prototype.optimizeEquipments=function(){var a=this.equipSlots().length;this.clearEquipments();for(var b=0;b<a;b++)this.isEquipChangeOk(b)&&this.changeEquip(b,this.bestEquipItem(b))};
Game_Actor.prototype.bestEquipItem=function(a){var b=this.equipSlots()[a];a=$gameParty.equipItems().filter(function(g){return g.etypeId===b&&this.canEquip(g)},this);for(var c=null,d=-1E3,e=0;e<a.length;e++){var f=this.calcEquipItemPerformance(a[e]);f>d&&(d=f,c=a[e])}return c};Game_Actor.prototype.calcEquipItemPerformance=function(a){return a.params.reduce(function(b,c){return b+c})};
Game_Actor.prototype.isSkillWtypeOk=function(a){var b=a.requiredWtypeId1;a=a.requiredWtypeId2;return 0===b&&0===a||0<b&&this.isWtypeEquipped(b)||0<a&&this.isWtypeEquipped(a)?!0:!1};Game_Actor.prototype.isWtypeEquipped=function(a){return this.weapons().some(function(b){return b.wtypeId===a})};Game_Actor.prototype.refresh=function(){this.releaseUnequippableItems(!1);Game_Battler.prototype.refresh.call(this)};Game_Actor.prototype.isActor=function(){return!0};Game_Actor.prototype.friendsUnit=function(){return $gameParty};
Game_Actor.prototype.opponentsUnit=function(){return $gameTroop};Game_Actor.prototype.index=function(){return $gameParty.members().indexOf(this)};Game_Actor.prototype.isBattleMember=function(){return $gameParty.battleMembers().contains(this)};Game_Actor.prototype.isFormationChangeOk=function(){return!0};Game_Actor.prototype.currentClass=function(){return $dataClasses[this._classId]};Game_Actor.prototype.isClass=function(a){return a&&this._classId===a.id};
Game_Actor.prototype.skills=function(){var a=[];this._skills.concat(this.addedSkills()).forEach(function(b){a.contains($dataSkills[b])||a.push($dataSkills[b])});return a};Game_Actor.prototype.usableSkills=function(){return this.skills().filter(function(a){return this.canUse(a)},this)};Game_Actor.prototype.traitObjects=function(){var a=Game_Battler.prototype.traitObjects.call(this);a=a.concat([this.actor(),this.currentClass()]);for(var b=this.equips(),c=0;c<b.length;c++){var d=b[c];d&&a.push(d)}return a};
Game_Actor.prototype.attackElements=function(){var a=Game_Battler.prototype.attackElements.call(this);this.hasNoWeapons()&&!a.contains(this.bareHandsElementId())&&a.push(this.bareHandsElementId());return a};Game_Actor.prototype.hasNoWeapons=function(){return 0===this.weapons().length};Game_Actor.prototype.bareHandsElementId=function(){return 1};Game_Actor.prototype.paramMax=function(a){return 0===a?9999:Game_Battler.prototype.paramMax.call(this,a)};Game_Actor.prototype.paramBase=function(a){return this.currentClass().params[a][this._level]};
Game_Actor.prototype.paramPlus=function(a){for(var b=Game_Battler.prototype.paramPlus.call(this,a),c=this.equips(),d=0;d<c.length;d++){var e=c[d];e&&(b+=e.params[a])}return b};Game_Actor.prototype.attackAnimationId1=function(){if(this.hasNoWeapons())return this.bareHandsAnimationId();var a=this.weapons();return a[0]?a[0].animationId:0};Game_Actor.prototype.attackAnimationId2=function(){var a=this.weapons();return a[1]?a[1].animationId:0};Game_Actor.prototype.bareHandsAnimationId=function(){return 1};
Game_Actor.prototype.changeExp=function(a,b){this._exp[this._classId]=Math.max(a,0);a=this._level;for(var c=this.skills();!this.isMaxLevel()&&this.currentExp()>=this.nextLevelExp();)this.levelUp();for(;this.currentExp()<this.currentLevelExp();)this.levelDown();b&&this._level>a&&this.displayLevelUp(this.findNewSkills(c));this.refresh()};Game_Actor.prototype.levelUp=function(){this._level++;this.currentClass().learnings.forEach(function(a){a.level===this._level&&this.learnSkill(a.skillId)},this)};
Game_Actor.prototype.levelDown=function(){this._level--};Game_Actor.prototype.findNewSkills=function(a){for(var b=this.skills(),c=0;c<a.length;c++){var d=b.indexOf(a[c]);0<=d&&b.splice(d,1)}return b};Game_Actor.prototype.displayLevelUp=function(a){var b=TextManager.levelUp.format(this._name,TextManager.level,this._level);$gameMessage.newPage();$gameMessage.add(b);a.forEach(function(c){$gameMessage.add(TextManager.obtainSkill.format(c.name))})};
Game_Actor.prototype.gainExp=function(a){a=this.currentExp()+Math.round(a*this.finalExpRate());this.changeExp(a,this.shouldDisplayLevelUp())};Game_Actor.prototype.finalExpRate=function(){return this.exr*(this.isBattleMember()?1:this.benchMembersExpRate())};Game_Actor.prototype.benchMembersExpRate=function(){return $dataSystem.optExtraExp?1:0};Game_Actor.prototype.shouldDisplayLevelUp=function(){return!0};
Game_Actor.prototype.changeLevel=function(a,b){a=a.clamp(1,this.maxLevel());this.changeExp(this.expForLevel(a),b)};Game_Actor.prototype.learnSkill=function(a){this.isLearnedSkill(a)||(this._skills.push(a),this._skills.sort(function(b,c){return b-c}))};Game_Actor.prototype.forgetSkill=function(a){a=this._skills.indexOf(a);0<=a&&this._skills.splice(a,1)};Game_Actor.prototype.isLearnedSkill=function(a){return this._skills.contains(a)};Game_Actor.prototype.hasSkill=function(a){return this.skills().contains($dataSkills[a])};
Game_Actor.prototype.changeClass=function(a,b){b&&(this._exp[a]=this.currentExp());this._classId=a;this.changeExp(this._exp[this._classId]||0,!1);this.refresh()};Game_Actor.prototype.setCharacterImage=function(a,b){this._characterName=a;this._characterIndex=b};Game_Actor.prototype.setFaceImage=function(a,b){this._faceName=a;this._faceIndex=b};Game_Actor.prototype.setBattlerImage=function(a){this._battlerName=a};Game_Actor.prototype.isSpriteVisible=function(){return $gameSystem.isSideView()};
Game_Actor.prototype.startAnimation=function(a,b,c){Game_Battler.prototype.startAnimation.call(this,a,!b,c)};Game_Actor.prototype.performActionStart=function(a){Game_Battler.prototype.performActionStart.call(this,a)};Game_Actor.prototype.performAction=function(a){Game_Battler.prototype.performAction.call(this,a);a.isAttack()?this.performAttack():a.isGuard()?this.requestMotion("guard"):a.isMagicSkill()?this.requestMotion("spell"):a.isSkill()?this.requestMotion("skill"):a.isItem()&&this.requestMotion("item")};
Game_Actor.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)};Game_Actor.prototype.performAttack=function(){var a=this.weapons();if(a=$dataSystem.attackMotions[a[0]?a[0].wtypeId:0])0===a.type?this.requestMotion("thrust"):1===a.type?this.requestMotion("swing"):2===a.type&&this.requestMotion("missile"),this.startWeaponAnimation(a.weaponImageId)};
Game_Actor.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this);this.isSpriteVisible()?this.requestMotion("damage"):$gameScreen.startShake(5,5,10);SoundManager.playActorDamage()};Game_Actor.prototype.performEvasion=function(){Game_Battler.prototype.performEvasion.call(this);this.requestMotion("evade")};Game_Actor.prototype.performMagicEvasion=function(){Game_Battler.prototype.performMagicEvasion.call(this);this.requestMotion("evade")};
Game_Actor.prototype.performCounter=function(){Game_Battler.prototype.performCounter.call(this);this.performAttack()};Game_Actor.prototype.performCollapse=function(){Game_Battler.prototype.performCollapse.call(this);$gameParty.inBattle()&&SoundManager.playActorCollapse()};Game_Actor.prototype.performVictory=function(){this.canMove()&&this.requestMotion("victory")};Game_Actor.prototype.performEscape=function(){this.canMove()&&this.requestMotion("escape")};
Game_Actor.prototype.makeActionList=function(){var a=[],b=new Game_Action(this);b.setAttack();a.push(b);this.usableSkills().forEach(function(c){b=new Game_Action(this);b.setSkill(c.id);a.push(b)},this);return a};Game_Actor.prototype.makeAutoBattleActions=function(){for(var a=0;a<this.numActions();a++)for(var b=this.makeActionList(),c=Number.MIN_VALUE,d=0;d<b.length;d++){var e=b[d].evaluate();e>c&&(c=e,this.setAction(a,b[d]))}this.setActionState("waiting")};
Game_Actor.prototype.makeConfusionActions=function(){for(var a=0;a<this.numActions();a++)this.action(a).setConfusion();this.setActionState("waiting")};Game_Actor.prototype.makeActions=function(){Game_Battler.prototype.makeActions.call(this);0<this.numActions()?this.setActionState("undecided"):this.setActionState("waiting");this.isAutoBattle()?this.makeAutoBattleActions():this.isConfused()&&this.makeConfusionActions()};
Game_Actor.prototype.onPlayerWalk=function(){this.clearResult();this.checkFloorEffect();$gamePlayer.isNormal()&&(this.turnEndOnMap(),this.states().forEach(function(a){this.updateStateSteps(a)},this),this.showAddedStates(),this.showRemovedStates())};Game_Actor.prototype.updateStateSteps=function(a){a.removeByWalking&&0<this._stateSteps[a.id]&&0===--this._stateSteps[a.id]&&this.removeState(a.id)};
Game_Actor.prototype.showAddedStates=function(){this.result().addedStateObjects().forEach(function(a){a.message1&&$gameMessage.add(this._name+a.message1)},this)};Game_Actor.prototype.showRemovedStates=function(){this.result().removedStateObjects().forEach(function(a){a.message4&&$gameMessage.add(this._name+a.message4)},this)};Game_Actor.prototype.stepsForTurn=function(){return 20};
Game_Actor.prototype.turnEndOnMap=function(){0===$gameParty.steps()%this.stepsForTurn()&&(this.onTurnEnd(),0<this.result().hpDamage&&this.performMapDamage())};Game_Actor.prototype.checkFloorEffect=function(){$gamePlayer.isOnDamageFloor()&&this.executeFloorDamage()};Game_Actor.prototype.executeFloorDamage=function(){var a=Math.floor(this.basicFloorDamage()*this.fdr);a=Math.min(a,this.maxFloorDamage());this.gainHp(-a);0<a&&this.performMapDamage()};Game_Actor.prototype.basicFloorDamage=function(){return 10};
Game_Actor.prototype.maxFloorDamage=function(){return $dataSystem.optFloorDeath?this.hp:Math.max(this.hp-1,0)};Game_Actor.prototype.performMapDamage=function(){$gameParty.inBattle()||$gameScreen.startFlashForDamage()};Game_Actor.prototype.clearActions=function(){Game_Battler.prototype.clearActions.call(this);this._actionInputIndex=0};Game_Actor.prototype.inputtingAction=function(){return this.action(this._actionInputIndex)};
Game_Actor.prototype.selectNextCommand=function(){return this._actionInputIndex<this.numActions()-1?(this._actionInputIndex++,!0):!1};Game_Actor.prototype.selectPreviousCommand=function(){return 0<this._actionInputIndex?(this._actionInputIndex--,!0):!1};Game_Actor.prototype.lastMenuSkill=function(){return this._lastMenuSkill.object()};Game_Actor.prototype.setLastMenuSkill=function(a){this._lastMenuSkill.setObject(a)};Game_Actor.prototype.lastBattleSkill=function(){return this._lastBattleSkill.object()};
Game_Actor.prototype.setLastBattleSkill=function(a){this._lastBattleSkill.setObject(a)};Game_Actor.prototype.lastCommandSymbol=function(){return this._lastCommandSymbol};Game_Actor.prototype.setLastCommandSymbol=function(a){this._lastCommandSymbol=a};Game_Actor.prototype.testEscape=function(a){return a.effects.some(function(b,c,d){return b&&b.code===Game_Action.EFFECT_SPECIAL})};
Game_Actor.prototype.meetsUsableItemConditions=function(a){return $gameParty.inBattle()&&!BattleManager.canEscape()&&this.testEscape(a)?!1:Game_BattlerBase.prototype.meetsUsableItemConditions.call(this,a)};function Game_Enemy(){this.initialize.apply(this,arguments)}Game_Enemy.prototype=Object.create(Game_Battler.prototype);Game_Enemy.prototype.constructor=Game_Enemy;Game_Enemy.prototype.initialize=function(a,b,c){Game_Battler.prototype.initialize.call(this);this.setup(a,b,c)};
Game_Enemy.prototype.initMembers=function(){Game_Battler.prototype.initMembers.call(this);this._enemyId=0;this._letter="";this._plural=!1;this._screenY=this._screenX=0};Game_Enemy.prototype.setup=function(a,b,c){this._enemyId=a;this._screenX=b;this._screenY=c;this.recoverAll()};Game_Enemy.prototype.isEnemy=function(){return!0};Game_Enemy.prototype.friendsUnit=function(){return $gameTroop};Game_Enemy.prototype.opponentsUnit=function(){return $gameParty};Game_Enemy.prototype.index=function(){return $gameTroop.members().indexOf(this)};
Game_Enemy.prototype.isBattleMember=function(){return 0<=this.index()};Game_Enemy.prototype.enemyId=function(){return this._enemyId};Game_Enemy.prototype.enemy=function(){return $dataEnemies[this._enemyId]};Game_Enemy.prototype.traitObjects=function(){return Game_Battler.prototype.traitObjects.call(this).concat(this.enemy())};Game_Enemy.prototype.paramBase=function(a){return this.enemy().params[a]};Game_Enemy.prototype.exp=function(){return this.enemy().exp};Game_Enemy.prototype.gold=function(){return this.enemy().gold};
Game_Enemy.prototype.makeDropItems=function(){return this.enemy().dropItems.reduce(function(a,b){return 0<b.kind&&Math.random()*b.denominator<this.dropItemRate()?a.concat(this.itemObject(b.kind,b.dataId)):a}.bind(this),[])};Game_Enemy.prototype.dropItemRate=function(){return $gameParty.hasDropItemDouble()?2:1};Game_Enemy.prototype.itemObject=function(a,b){return 1===a?$dataItems[b]:2===a?$dataWeapons[b]:3===a?$dataArmors[b]:null};Game_Enemy.prototype.isSpriteVisible=function(){return!0};
Game_Enemy.prototype.screenX=function(){return this._screenX};Game_Enemy.prototype.screenY=function(){return this._screenY};Game_Enemy.prototype.battlerName=function(){return this.enemy().battlerName};Game_Enemy.prototype.battlerHue=function(){return this.enemy().battlerHue};Game_Enemy.prototype.originalName=function(){return this.enemy().name};Game_Enemy.prototype.name=function(){return this.originalName()+(this._plural?this._letter:"")};Game_Enemy.prototype.isLetterEmpty=function(){return""===this._letter};
Game_Enemy.prototype.setLetter=function(a){this._letter=a};Game_Enemy.prototype.setPlural=function(a){this._plural=a};Game_Enemy.prototype.performActionStart=function(a){Game_Battler.prototype.performActionStart.call(this,a);this.requestEffect("whiten")};Game_Enemy.prototype.performAction=function(a){Game_Battler.prototype.performAction.call(this,a)};Game_Enemy.prototype.performActionEnd=function(){Game_Battler.prototype.performActionEnd.call(this)};
Game_Enemy.prototype.performDamage=function(){Game_Battler.prototype.performDamage.call(this);SoundManager.playEnemyDamage();this.requestEffect("blink")};Game_Enemy.prototype.performCollapse=function(){Game_Battler.prototype.performCollapse.call(this);switch(this.collapseType()){case 0:this.requestEffect("collapse");SoundManager.playEnemyCollapse();break;case 1:this.requestEffect("bossCollapse");SoundManager.playBossCollapse1();break;case 2:this.requestEffect("instantCollapse")}};
Game_Enemy.prototype.transform=function(a){var b=this.originalName();this._enemyId=a;this.originalName()!==b&&(this._letter="",this._plural=!1);this.refresh();0<this.numActions()&&this.makeActions()};
Game_Enemy.prototype.meetsCondition=function(a){var b=a.conditionParam1,c=a.conditionParam2;switch(a.conditionType){case 1:return this.meetsTurnCondition(b,c);case 2:return this.meetsHpCondition(b,c);case 3:return this.meetsMpCondition(b,c);case 4:return this.meetsStateCondition(b);case 5:return this.meetsPartyLevelCondition(b);case 6:return this.meetsSwitchCondition(b);default:return!0}};
Game_Enemy.prototype.meetsTurnCondition=function(a,b){var c=$gameTroop.turnCount();return 0===b?c===a:0<c&&c>=a&&c%b===a%b};Game_Enemy.prototype.meetsHpCondition=function(a,b){return this.hpRate()>=a&&this.hpRate()<=b};Game_Enemy.prototype.meetsMpCondition=function(a,b){return this.mpRate()>=a&&this.mpRate()<=b};Game_Enemy.prototype.meetsStateCondition=function(a){return this.isStateAffected(a)};Game_Enemy.prototype.meetsPartyLevelCondition=function(a){return $gameParty.highestLevel()>=a};
Game_Enemy.prototype.meetsSwitchCondition=function(a){return $gameSwitches.value(a)};Game_Enemy.prototype.isActionValid=function(a){return this.meetsCondition(a)&&this.canUse($dataSkills[a.skillId])};Game_Enemy.prototype.selectAction=function(a,b){var c=a.reduce(function(f,g){return f+g.rating-b},0);if(0<c){c=Math.randomInt(c);for(var d=0;d<a.length;d++){var e=a[d];c-=e.rating-b;if(0>c)return e}}else return null};
Game_Enemy.prototype.selectAllActions=function(a){var b=Math.max.apply(null,a.map(function(d){return d.rating}))-3;a=a.filter(function(d){return d.rating>b});for(var c=0;c<this.numActions();c++)this.action(c).setEnemyAction(this.selectAction(a,b))};Game_Enemy.prototype.makeActions=function(){Game_Battler.prototype.makeActions.call(this);if(0<this.numActions()){var a=this.enemy().actions.filter(function(b){return this.isActionValid(b)},this);0<a.length&&this.selectAllActions(a)}this.setActionState("waiting")};
function Game_Actors(){this.initialize.apply(this,arguments)}Game_Actors.prototype.initialize=function(){this._data=[]};Game_Actors.prototype.actor=function(a){return $dataActors[a]?(this._data[a]||(this._data[a]=new Game_Actor(a)),this._data[a]):null};function Game_Unit(){this.initialize.apply(this,arguments)}Game_Unit.prototype.initialize=function(){this._inBattle=!1};Game_Unit.prototype.inBattle=function(){return this._inBattle};Game_Unit.prototype.members=function(){return[]};
Game_Unit.prototype.aliveMembers=function(){return this.members().filter(function(a){return a.isAlive()})};Game_Unit.prototype.deadMembers=function(){return this.members().filter(function(a){return a.isDead()})};Game_Unit.prototype.movableMembers=function(){return this.members().filter(function(a){return a.canMove()})};Game_Unit.prototype.clearActions=function(){return this.members().forEach(function(a){return a.clearActions()})};
Game_Unit.prototype.agility=function(){var a=this.members();return 0===a.length?1:a.reduce(function(b,c){return b+c.agi},0)/a.length};Game_Unit.prototype.tgrSum=function(){return this.aliveMembers().reduce(function(a,b){return a+b.tgr},0)};Game_Unit.prototype.randomTarget=function(){var a=Math.random()*this.tgrSum(),b=null;this.aliveMembers().forEach(function(c){a-=c.tgr;0>=a&&!b&&(b=c)});return b};
Game_Unit.prototype.randomDeadTarget=function(){var a=this.deadMembers();return 0===a.length?null:a[Math.floor(Math.random()*a.length)]};Game_Unit.prototype.smoothTarget=function(a){0>a&&(a=0);return(a=this.members()[a])&&a.isAlive()?a:this.aliveMembers()[0]};Game_Unit.prototype.smoothDeadTarget=function(a){0>a&&(a=0);return(a=this.members()[a])&&a.isDead()?a:this.deadMembers()[0]};Game_Unit.prototype.clearResults=function(){this.members().forEach(function(a){a.clearResult()})};
Game_Unit.prototype.onBattleStart=function(){this.members().forEach(function(a){a.onBattleStart()});this._inBattle=!0};Game_Unit.prototype.onBattleEnd=function(){this._inBattle=!1;this.members().forEach(function(a){a.onBattleEnd()})};Game_Unit.prototype.makeActions=function(){this.members().forEach(function(a){a.makeActions()})};Game_Unit.prototype.select=function(a){this.members().forEach(function(b){b===a?b.select():b.deselect()})};Game_Unit.prototype.isAllDead=function(){return 0===this.aliveMembers().length};
Game_Unit.prototype.substituteBattler=function(){for(var a=this.members(),b=0;b<a.length;b++)if(a[b].isSubstitute())return a[b]};function Game_Party(){this.initialize.apply(this,arguments)}Game_Party.prototype=Object.create(Game_Unit.prototype);Game_Party.prototype.constructor=Game_Party;Game_Party.ABILITY_ENCOUNTER_HALF=0;Game_Party.ABILITY_ENCOUNTER_NONE=1;Game_Party.ABILITY_CANCEL_SURPRISE=2;Game_Party.ABILITY_RAISE_PREEMPTIVE=3;Game_Party.ABILITY_GOLD_DOUBLE=4;
Game_Party.ABILITY_DROP_ITEM_DOUBLE=5;Game_Party.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this);this._steps=this._gold=0;this._lastItem=new Game_Item;this._targetActorId=this._menuActorId=0;this._actors=[];this.initAllItems()};Game_Party.prototype.initAllItems=function(){this._items={};this._weapons={};this._armors={}};Game_Party.prototype.exists=function(){return 0<this._actors.length};Game_Party.prototype.size=function(){return this.members().length};
Game_Party.prototype.isEmpty=function(){return 0===this.size()};Game_Party.prototype.members=function(){return this.inBattle()?this.battleMembers():this.allMembers()};Game_Party.prototype.allMembers=function(){return this._actors.map(function(a){return $gameActors.actor(a)})};Game_Party.prototype.battleMembers=function(){return this.allMembers().slice(0,this.maxBattleMembers()).filter(function(a){return a.isAppeared()})};Game_Party.prototype.maxBattleMembers=function(){return 4};
Game_Party.prototype.leader=function(){return this.battleMembers()[0]};Game_Party.prototype.reviveBattleMembers=function(){this.battleMembers().forEach(function(a){a.isDead()&&a.setHp(1)})};Game_Party.prototype.items=function(){var a=[],b;for(b in this._items)a.push($dataItems[b]);return a};Game_Party.prototype.weapons=function(){var a=[],b;for(b in this._weapons)a.push($dataWeapons[b]);return a};Game_Party.prototype.armors=function(){var a=[],b;for(b in this._armors)a.push($dataArmors[b]);return a};
Game_Party.prototype.equipItems=function(){return this.weapons().concat(this.armors())};Game_Party.prototype.allItems=function(){return this.items().concat(this.equipItems())};Game_Party.prototype.itemContainer=function(a){return a?DataManager.isItem(a)?this._items:DataManager.isWeapon(a)?this._weapons:DataManager.isArmor(a)?this._armors:null:null};
Game_Party.prototype.setupStartingMembers=function(){this._actors=[];$dataSystem.partyMembers.forEach(function(a){$gameActors.actor(a)&&this._actors.push(a)},this)};Game_Party.prototype.name=function(){var a=this.battleMembers().length;return 0===a?"":1===a?this.leader().name():TextManager.partyName.format(this.leader().name())};Game_Party.prototype.setupBattleTest=function(){this.setupBattleTestMembers();this.setupBattleTestItems()};
Game_Party.prototype.setupBattleTestMembers=function(){$dataSystem.testBattlers.forEach(function(a){var b=$gameActors.actor(a.actorId);b&&(b.changeLevel(a.level,!1),b.initEquips(a.equips),b.recoverAll(),this.addActor(a.actorId))},this)};Game_Party.prototype.setupBattleTestItems=function(){$dataItems.forEach(function(a){a&&0<a.name.length&&this.gainItem(a,this.maxItems(a))},this)};Game_Party.prototype.highestLevel=function(){return Math.max.apply(null,this.members().map(function(a){return a.level}))};
Game_Party.prototype.addActor=function(a){this._actors.contains(a)||(this._actors.push(a),$gamePlayer.refresh(),$gameMap.requestRefresh())};Game_Party.prototype.removeActor=function(a){this._actors.contains(a)&&(this._actors.splice(this._actors.indexOf(a),1),$gamePlayer.refresh(),$gameMap.requestRefresh())};Game_Party.prototype.gold=function(){return this._gold};Game_Party.prototype.gainGold=function(a){this._gold=(this._gold+a).clamp(0,this.maxGold())};Game_Party.prototype.loseGold=function(a){this.gainGold(-a)};
Game_Party.prototype.maxGold=function(){return 99999999};Game_Party.prototype.steps=function(){return this._steps};Game_Party.prototype.increaseSteps=function(){this._steps++};Game_Party.prototype.numItems=function(a){var b=this.itemContainer(a);return b?b[a.id]||0:0};Game_Party.prototype.maxItems=function(a){return 99};Game_Party.prototype.hasMaxItems=function(a){return this.numItems(a)>=this.maxItems(a)};
Game_Party.prototype.hasItem=function(a,b){void 0===b&&(b=!1);return 0<this.numItems(a)?!0:b&&this.isAnyMemberEquipped(a)?!0:!1};Game_Party.prototype.isAnyMemberEquipped=function(a){return this.members().some(function(b){return b.equips().contains(a)})};Game_Party.prototype.gainItem=function(a,b,c){var d=this.itemContainer(a);d&&(b=this.numItems(a)+b,d[a.id]=b.clamp(0,this.maxItems(a)),0===d[a.id]&&delete d[a.id],c&&0>b&&this.discardMembersEquip(a,-b),$gameMap.requestRefresh())};
Game_Party.prototype.discardMembersEquip=function(a,b){var c=b;this.members().forEach(function(d){for(;0<c&&d.isEquipped(a);)d.discardEquip(a),c--})};Game_Party.prototype.loseItem=function(a,b,c){this.gainItem(a,-b,c)};Game_Party.prototype.consumeItem=function(a){DataManager.isItem(a)&&a.consumable&&this.loseItem(a,1)};Game_Party.prototype.canUse=function(a){return this.members().some(function(b){return b.canUse(a)})};Game_Party.prototype.canInput=function(){return this.members().some(function(a){return a.canInput()})};
Game_Party.prototype.isAllDead=function(){return Game_Unit.prototype.isAllDead.call(this)?this.inBattle()||!this.isEmpty():!1};Game_Party.prototype.onPlayerWalk=function(){this.members().forEach(function(a){return a.onPlayerWalk()})};Game_Party.prototype.menuActor=function(){var a=$gameActors.actor(this._menuActorId);this.members().contains(a)||(a=this.members()[0]);return a};Game_Party.prototype.setMenuActor=function(a){this._menuActorId=a.actorId()};
Game_Party.prototype.makeMenuActorNext=function(){var a=this.members().indexOf(this.menuActor());0<=a?(a=(a+1)%this.members().length,this.setMenuActor(this.members()[a])):this.setMenuActor(this.members()[0])};Game_Party.prototype.makeMenuActorPrevious=function(){var a=this.members().indexOf(this.menuActor());0<=a?(a=(a+this.members().length-1)%this.members().length,this.setMenuActor(this.members()[a])):this.setMenuActor(this.members()[0])};
Game_Party.prototype.targetActor=function(){var a=$gameActors.actor(this._targetActorId);this.members().contains(a)||(a=this.members()[0]);return a};Game_Party.prototype.setTargetActor=function(a){this._targetActorId=a.actorId()};Game_Party.prototype.lastItem=function(){return this._lastItem.object()};Game_Party.prototype.setLastItem=function(a){this._lastItem.setObject(a)};Game_Party.prototype.swapOrder=function(a,b){var c=this._actors[a];this._actors[a]=this._actors[b];this._actors[b]=c;$gamePlayer.refresh()};
Game_Party.prototype.charactersForSavefile=function(){return this.battleMembers().map(function(a){return[a.characterName(),a.characterIndex()]})};Game_Party.prototype.facesForSavefile=function(){return this.battleMembers().map(function(a){return[a.faceName(),a.faceIndex()]})};Game_Party.prototype.partyAbility=function(a){return this.battleMembers().some(function(b){return b.partyAbility(a)})};Game_Party.prototype.hasEncounterHalf=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_HALF)};
Game_Party.prototype.hasEncounterNone=function(){return this.partyAbility(Game_Party.ABILITY_ENCOUNTER_NONE)};Game_Party.prototype.hasCancelSurprise=function(){return this.partyAbility(Game_Party.ABILITY_CANCEL_SURPRISE)};Game_Party.prototype.hasRaisePreemptive=function(){return this.partyAbility(Game_Party.ABILITY_RAISE_PREEMPTIVE)};Game_Party.prototype.hasGoldDouble=function(){return this.partyAbility(Game_Party.ABILITY_GOLD_DOUBLE)};Game_Party.prototype.hasDropItemDouble=function(){return this.partyAbility(Game_Party.ABILITY_DROP_ITEM_DOUBLE)};
Game_Party.prototype.ratePreemptive=function(a){a=this.agility()>=a?.05:.03;this.hasRaisePreemptive()&&(a*=4);return a};Game_Party.prototype.rateSurprise=function(a){a=this.agility()>=a?.03:.05;this.hasCancelSurprise()&&(a=0);return a};Game_Party.prototype.performVictory=function(){this.members().forEach(function(a){a.performVictory()})};Game_Party.prototype.performEscape=function(){this.members().forEach(function(a){a.performEscape()})};Game_Party.prototype.removeBattleStates=function(){this.members().forEach(function(a){a.removeBattleStates()})};
Game_Party.prototype.requestMotionRefresh=function(){this.members().forEach(function(a){a.requestMotionRefresh()})};function Game_Troop(){this.initialize.apply(this,arguments)}Game_Troop.prototype=Object.create(Game_Unit.prototype);Game_Troop.prototype.constructor=Game_Troop;Game_Troop.LETTER_TABLE_HALF=" A; B; C; D; E; F; G; H; I; J; K; L; M; N; O; P; Q; R; S; T; U; V; W; X; Y; Z".split(";");Game_Troop.LETTER_TABLE_FULL="\uff21\uff22\uff23\uff24\uff25\uff26\uff27\uff28\uff29\uff2a\uff2b\uff2c\uff2d\uff2e\uff2f\uff30\uff31\uff32\uff33\uff34\uff35\uff36\uff37\uff38\uff39\uff3a".split("");
Game_Troop.prototype.initialize=function(){Game_Unit.prototype.initialize.call(this);this._interpreter=new Game_Interpreter;this.clear()};Game_Troop.prototype.isEventRunning=function(){return this._interpreter.isRunning()};Game_Troop.prototype.updateInterpreter=function(){this._interpreter.update()};Game_Troop.prototype.turnCount=function(){return this._turnCount};Game_Troop.prototype.members=function(){return this._enemies};
Game_Troop.prototype.clear=function(){this._interpreter.clear();this._troopId=0;this._eventFlags={};this._enemies=[];this._turnCount=0;this._namesCount={}};Game_Troop.prototype.troop=function(){return $dataTroops[this._troopId]};Game_Troop.prototype.setup=function(a){this.clear();this._troopId=a;this._enemies=[];this.troop().members.forEach(function(b){if($dataEnemies[b.enemyId]){var c=new Game_Enemy(b.enemyId,b.x,b.y);b.hidden&&c.hide();this._enemies.push(c)}},this);this.makeUniqueNames()};
Game_Troop.prototype.makeUniqueNames=function(){var a=this.letterTable();this.members().forEach(function(b){if(b.isAlive()&&b.isLetterEmpty()){var c=b.originalName(),d=this._namesCount[c]||0;b.setLetter(a[d%a.length]);this._namesCount[c]=d+1}},this);this.members().forEach(function(b){var c=b.originalName();2<=this._namesCount[c]&&b.setPlural(!0)},this)};Game_Troop.prototype.letterTable=function(){return $gameSystem.isCJK()?Game_Troop.LETTER_TABLE_FULL:Game_Troop.LETTER_TABLE_HALF};
Game_Troop.prototype.enemyNames=function(){var a=[];this.members().forEach(function(b){var c=b.originalName();b.isAlive()&&!a.contains(c)&&a.push(c)});return a};
Game_Troop.prototype.meetsConditions=function(a){a=a.conditions;if(!(a.turnEnding||a.turnValid||a.enemyValid||a.actorValid||a.switchValid)||a.turnEnding&&!BattleManager.isTurnEnd())return!1;if(a.turnValid){var b=this._turnCount,c=a.turnA,d=a.turnB;if(0===d&&b!==c||0<d&&(1>b||b<c||b%d!==c%d))return!1}return a.enemyValid&&(b=$gameTroop.members()[a.enemyIndex],!b||100*b.hpRate()>a.enemyHp)||a.actorValid&&(b=$gameActors.actor(a.actorId),!b||100*b.hpRate()>a.actorHp)?!1:a.switchValid&&!$gameSwitches.value(a.switchId)?
!1:!0};Game_Troop.prototype.setupBattleEvent=function(){if(!this._interpreter.isRunning()&&!this._interpreter.setupReservedCommonEvent())for(var a=this.troop().pages,b=0;b<a.length;b++){var c=a[b];if(this.meetsConditions(c)&&!this._eventFlags[b]){this._interpreter.setup(c.list);1>=c.span&&(this._eventFlags[b]=!0);break}}};Game_Troop.prototype.increaseTurn=function(){for(var a=this.troop().pages,b=0;b<a.length;b++)1===a[b].span&&(this._eventFlags[b]=!1);this._turnCount++};
Game_Troop.prototype.expTotal=function(){return this.deadMembers().reduce(function(a,b){return a+b.exp()},0)};Game_Troop.prototype.goldTotal=function(){return this.deadMembers().reduce(function(a,b){return a+b.gold()},0)*this.goldRate()};Game_Troop.prototype.goldRate=function(){return $gameParty.hasGoldDouble()?2:1};Game_Troop.prototype.makeDropItems=function(){return this.deadMembers().reduce(function(a,b){return a.concat(b.makeDropItems())},[])};
function Game_Map(){this.initialize.apply(this,arguments)}
Game_Map.prototype.initialize=function(){this._interpreter=new Game_Interpreter;this._tilesetId=this._mapId=0;this._events=[];this._commonEvents=[];this._vehicles=[];this._displayY=this._displayX=0;this._nameDisplay=!0;this._scrollDirection=2;this._scrollRest=0;this._scrollSpeed=4;this._parallaxName="";this._parallaxLoopY=this._parallaxLoopX=this._parallaxZero=!1;this._parallaxY=this._parallaxX=this._parallaxSy=this._parallaxSx=0;this._battleback2Name=this._battleback1Name=null;this.createVehicles()};
Game_Map.prototype.setup=function(a){if(!$dataMap)throw Error("The map data is not available");this._mapId=a;this._tilesetId=$dataMap.tilesetId;this._displayY=this._displayX=0;this.refereshVehicles();this.setupEvents();this.setupScroll();this.setupParallax();this.setupBattleback();this._needsRefresh=!1};Game_Map.prototype.isEventRunning=function(){return this._interpreter.isRunning()||this.isAnyEventStarting()};Game_Map.prototype.tileWidth=function(){return 48};Game_Map.prototype.tileHeight=function(){return 48};
Game_Map.prototype.mapId=function(){return this._mapId};Game_Map.prototype.tilesetId=function(){return this._tilesetId};Game_Map.prototype.displayX=function(){return this._displayX};Game_Map.prototype.displayY=function(){return this._displayY};Game_Map.prototype.parallaxName=function(){return this._parallaxName};Game_Map.prototype.battleback1Name=function(){return this._battleback1Name};Game_Map.prototype.battleback2Name=function(){return this._battleback2Name};
Game_Map.prototype.requestRefresh=function(a){this._needsRefresh=!0};Game_Map.prototype.isNameDisplayEnabled=function(){return this._nameDisplay};Game_Map.prototype.disableNameDisplay=function(){this._nameDisplay=!1};Game_Map.prototype.enableNameDisplay=function(){this._nameDisplay=!0};Game_Map.prototype.createVehicles=function(){this._vehicles=[];this._vehicles[0]=new Game_Vehicle("boat");this._vehicles[1]=new Game_Vehicle("ship");this._vehicles[2]=new Game_Vehicle("airship")};
Game_Map.prototype.refereshVehicles=function(){this._vehicles.forEach(function(a){a.refresh()})};Game_Map.prototype.vehicles=function(){return this._vehicles};Game_Map.prototype.vehicle=function(a){return 0===a||"boat"===a?this.boat():1===a||"ship"===a?this.ship():2===a||"airship"===a?this.airship():null};Game_Map.prototype.boat=function(){return this._vehicles[0]};Game_Map.prototype.ship=function(){return this._vehicles[1]};Game_Map.prototype.airship=function(){return this._vehicles[2]};
Game_Map.prototype.setupEvents=function(){this._events=[];for(var a=0;a<$dataMap.events.length;a++)$dataMap.events[a]&&(this._events[a]=new Game_Event(this._mapId,a));this._commonEvents=this.parallelCommonEvents().map(function(b){return new Game_CommonEvent(b.id)});this.refreshTileEvents()};Game_Map.prototype.events=function(){return this._events.filter(function(a){return!!a})};Game_Map.prototype.event=function(a){return this._events[a]};Game_Map.prototype.eraseEvent=function(a){this._events[a].erase()};
Game_Map.prototype.parallelCommonEvents=function(){return $dataCommonEvents.filter(function(a){return a&&2===a.trigger})};Game_Map.prototype.setupScroll=function(){this._scrollDirection=2;this._scrollRest=0;this._scrollSpeed=4};
Game_Map.prototype.setupParallax=function(){this._parallaxName=$dataMap.parallaxName||"";this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName);this._parallaxLoopX=$dataMap.parallaxLoopX;this._parallaxLoopY=$dataMap.parallaxLoopY;this._parallaxSx=$dataMap.parallaxSx;this._parallaxSy=$dataMap.parallaxSy;this._parallaxY=this._parallaxX=0};
Game_Map.prototype.setupBattleback=function(){$dataMap.specifyBattleback?(this._battleback1Name=$dataMap.battleback1Name,this._battleback2Name=$dataMap.battleback2Name):this._battleback2Name=this._battleback1Name=null};
Game_Map.prototype.setDisplayPos=function(a,b){if(this.isLoopHorizontal())this._displayX=a.mod(this.width()),this._parallaxX=a;else{var c=this.width()-this.screenTileX();this._parallaxX=this._displayX=0>c?c/2:a.clamp(0,c)}this.isLoopVertical()?(this._displayY=b.mod(this.height()),this._parallaxY=b):(a=this.height()-this.screenTileY(),this._parallaxY=this._displayY=0>a?a/2:b.clamp(0,a))};
Game_Map.prototype.parallaxOx=function(){return this._parallaxZero?this._parallaxX*this.tileWidth():this._parallaxLoopX?this._parallaxX*this.tileWidth()/2:0};Game_Map.prototype.parallaxOy=function(){return this._parallaxZero?this._parallaxY*this.tileHeight():this._parallaxLoopY?this._parallaxY*this.tileHeight()/2:0};Game_Map.prototype.tileset=function(){return $dataTilesets[this._tilesetId]};Game_Map.prototype.tilesetFlags=function(){var a=this.tileset();return a?a.flags:[]};
Game_Map.prototype.displayName=function(){return $dataMap.displayName};Game_Map.prototype.width=function(){return $dataMap.width};Game_Map.prototype.height=function(){return $dataMap.height};Game_Map.prototype.data=function(){return $dataMap.data};Game_Map.prototype.isLoopHorizontal=function(){return 2===$dataMap.scrollType||3===$dataMap.scrollType};Game_Map.prototype.isLoopVertical=function(){return 1===$dataMap.scrollType||3===$dataMap.scrollType};Game_Map.prototype.isDashDisabled=function(){return $dataMap.disableDashing};
Game_Map.prototype.encounterList=function(){return $dataMap.encounterList};Game_Map.prototype.encounterStep=function(){return $dataMap.encounterStep};Game_Map.prototype.isOverworld=function(){return this.tileset()&&0===this.tileset().mode};Game_Map.prototype.screenTileX=function(){return Graphics.width/this.tileWidth()};Game_Map.prototype.screenTileY=function(){return Graphics.height/this.tileHeight()};
Game_Map.prototype.adjustX=function(a){return this.isLoopHorizontal()&&a<this._displayX-(this.width()-this.screenTileX())/2?a-this._displayX+$dataMap.width:a-this._displayX};Game_Map.prototype.adjustY=function(a){return this.isLoopVertical()&&a<this._displayY-(this.height()-this.screenTileY())/2?a-this._displayY+$dataMap.height:a-this._displayY};Game_Map.prototype.roundX=function(a){return this.isLoopHorizontal()?a.mod(this.width()):a};
Game_Map.prototype.roundY=function(a){return this.isLoopVertical()?a.mod(this.height()):a};Game_Map.prototype.xWithDirection=function(a,b){return a+(6===b?1:4===b?-1:0)};Game_Map.prototype.yWithDirection=function(a,b){return a+(2===b?1:8===b?-1:0)};Game_Map.prototype.roundXWithDirection=function(a,b){return this.roundX(a+(6===b?1:4===b?-1:0))};Game_Map.prototype.roundYWithDirection=function(a,b){return this.roundY(a+(2===b?1:8===b?-1:0))};
Game_Map.prototype.deltaX=function(a,b){a-=b;this.isLoopHorizontal()&&Math.abs(a)>this.width()/2&&(a=0>a?a+this.width():a-this.width());return a};Game_Map.prototype.deltaY=function(a,b){a-=b;this.isLoopVertical()&&Math.abs(a)>this.height()/2&&(a=0>a?a+this.height():a-this.height());return a};Game_Map.prototype.distance=function(a,b,c,d){return Math.abs(this.deltaX(a,c))+Math.abs(this.deltaY(b,d))};
Game_Map.prototype.canvasToMapX=function(a){var b=this.tileWidth();return this.roundX(Math.floor((this._displayX*b+a)/b))};Game_Map.prototype.canvasToMapY=function(a){var b=this.tileHeight();return this.roundY(Math.floor((this._displayY*b+a)/b))};Game_Map.prototype.autoplay=function(){$dataMap.autoplayBgm&&($gamePlayer.isInVehicle()?$gameSystem.saveWalkingBgm2():AudioManager.playBgm($dataMap.bgm));$dataMap.autoplayBgs&&AudioManager.playBgs($dataMap.bgs)};
Game_Map.prototype.refreshIfNeeded=function(){this._needsRefresh&&this.refresh()};Game_Map.prototype.refresh=function(){this.events().forEach(function(a){a.refresh()});this._commonEvents.forEach(function(a){a.refresh()});this.refreshTileEvents();this._needsRefresh=!1};Game_Map.prototype.refreshTileEvents=function(){this.tileEvents=this.events().filter(function(a){return a.isTile()})};Game_Map.prototype.eventsXy=function(a,b){return this.events().filter(function(c){return c.pos(a,b)})};
Game_Map.prototype.eventsXyNt=function(a,b){return this.events().filter(function(c){return c.posNt(a,b)})};Game_Map.prototype.tileEventsXy=function(a,b){return this.tileEvents.filter(function(c){return c.posNt(a,b)})};Game_Map.prototype.eventIdXy=function(a,b){a=this.eventsXy(a,b);return 0===a.length?0:a[0].eventId()};
Game_Map.prototype.scrollDown=function(a){if(this.isLoopVertical())this._displayY+=a,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY+=a);else if(this.height()>=this.screenTileY()){var b=this._displayY;this._displayY=Math.min(this._displayY+a,this.height()-this.screenTileY());this._parallaxY+=this._displayY-b}};
Game_Map.prototype.scrollLeft=function(a){if(this.isLoopHorizontal())this._displayX+=$dataMap.width-a,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX-=a);else if(this.width()>=this.screenTileX()){var b=this._displayX;this._displayX=Math.max(this._displayX-a,0);this._parallaxX+=this._displayX-b}};
Game_Map.prototype.scrollRight=function(a){if(this.isLoopHorizontal())this._displayX+=a,this._displayX%=$dataMap.width,this._parallaxLoopX&&(this._parallaxX+=a);else if(this.width()>=this.screenTileX()){var b=this._displayX;this._displayX=Math.min(this._displayX+a,this.width()-this.screenTileX());this._parallaxX+=this._displayX-b}};
Game_Map.prototype.scrollUp=function(a){if(this.isLoopVertical())this._displayY+=$dataMap.height-a,this._displayY%=$dataMap.height,this._parallaxLoopY&&(this._parallaxY-=a);else if(this.height()>=this.screenTileY()){var b=this._displayY;this._displayY=Math.max(this._displayY-a,0);this._parallaxY+=this._displayY-b}};Game_Map.prototype.isValid=function(a,b){return 0<=a&&a<this.width()&&0<=b&&b<this.height()};
Game_Map.prototype.checkPassage=function(a,b,c){var d=this.tilesetFlags();a=this.allTiles(a,b);for(b=0;b<a.length;b++){var e=d[a[b]];if(0===(e&16)){if(0===(e&c))return!0;if((e&c)===c)break}}return!1};Game_Map.prototype.tileId=function(a,b,c){return $dataMap.data[(c*$dataMap.height+b)*$dataMap.width+a]||0};Game_Map.prototype.layeredTiles=function(a,b){for(var c=[],d=0;4>d;d++)c.push(this.tileId(a,b,3-d));return c};
Game_Map.prototype.allTiles=function(a,b){return this.tileEventsXy(a,b).map(function(c){return c.tileId()}).concat(this.layeredTiles(a,b))};Game_Map.prototype.autotileType=function(a,b,c){a=this.tileId(a,b,c);return 2048<=a?Math.floor((a-2048)/48):-1};Game_Map.prototype.isPassable=function(a,b,c){return this.checkPassage(a,b,1<<c/2-1&15)};Game_Map.prototype.isBoatPassable=function(a,b){return this.checkPassage(a,b,512)};
Game_Map.prototype.isShipPassable=function(a,b){return this.checkPassage(a,b,1024)};Game_Map.prototype.isAirshipLandOk=function(a,b){return this.checkPassage(a,b,2048)&&this.checkPassage(a,b,15)};Game_Map.prototype.checkLayeredTilesFlags=function(a,b,c){var d=this.tilesetFlags();return this.layeredTiles(a,b).some(function(e){return 0!==(d[e]&c)})};Game_Map.prototype.isLadder=function(a,b){return this.isValid(a,b)&&this.checkLayeredTilesFlags(a,b,32)};
Game_Map.prototype.isBush=function(a,b){return this.isValid(a,b)&&this.checkLayeredTilesFlags(a,b,64)};Game_Map.prototype.isCounter=function(a,b){return this.isValid(a,b)&&this.checkLayeredTilesFlags(a,b,128)};Game_Map.prototype.isDamageFloor=function(a,b){return this.isValid(a,b)&&this.checkLayeredTilesFlags(a,b,256)};Game_Map.prototype.terrainTag=function(a,b){if(this.isValid(a,b)){var c=this.tilesetFlags();a=this.layeredTiles(a,b);for(b=0;b<a.length;b++){var d=c[a[b]]>>12;if(0<d)return d}}return 0};
Game_Map.prototype.regionId=function(a,b){return this.isValid(a,b)?this.tileId(a,b,5):0};Game_Map.prototype.startScroll=function(a,b,c){this._scrollDirection=a;this._scrollRest=b;this._scrollSpeed=c};Game_Map.prototype.isScrolling=function(){return 0<this._scrollRest};Game_Map.prototype.update=function(a){this.refreshIfNeeded();a&&this.updateInterpreter();this.updateScroll();this.updateEvents();this.updateVehicles();this.updateParallax()};
Game_Map.prototype.updateScroll=function(){if(this.isScrolling()){var a=this._displayX,b=this._displayY;this.doScroll(this._scrollDirection,this.scrollDistance());this._scrollRest=this._displayX===a&&this._displayY===b?0:this._scrollRest-this.scrollDistance()}};Game_Map.prototype.scrollDistance=function(){return Math.pow(2,this._scrollSpeed)/256};Game_Map.prototype.doScroll=function(a,b){switch(a){case 2:this.scrollDown(b);break;case 4:this.scrollLeft(b);break;case 6:this.scrollRight(b);break;case 8:this.scrollUp(b)}};
Game_Map.prototype.updateEvents=function(){this.events().forEach(function(a){a.update()});this._commonEvents.forEach(function(a){a.update()})};Game_Map.prototype.updateVehicles=function(){this._vehicles.forEach(function(a){a.update()})};Game_Map.prototype.updateParallax=function(){this._parallaxLoopX&&(this._parallaxX+=this._parallaxSx/this.tileWidth()/2);this._parallaxLoopY&&(this._parallaxY+=this._parallaxSy/this.tileHeight()/2)};Game_Map.prototype.changeTileset=function(a){this._tilesetId=a;this.refresh()};
Game_Map.prototype.changeBattleback=function(a,b){this._battleback1Name=a;this._battleback2Name=b};Game_Map.prototype.changeParallax=function(a,b,c,d,e){this._parallaxName=a;this._parallaxZero=ImageManager.isZeroParallax(this._parallaxName);this._parallaxLoopX&&!b&&(this._parallaxX=0);this._parallaxLoopY&&!c&&(this._parallaxY=0);this._parallaxLoopX=b;this._parallaxLoopY=c;this._parallaxSx=d;this._parallaxSy=e};
Game_Map.prototype.updateInterpreter=function(){for(;;){this._interpreter.update();if(this._interpreter.isRunning())break;0<this._interpreter.eventId()&&(this.unlockEvent(this._interpreter.eventId()),this._interpreter.clear());if(!this.setupStartingEvent())break}};Game_Map.prototype.unlockEvent=function(a){this._events[a]&&this._events[a].unlock()};
Game_Map.prototype.setupStartingEvent=function(){this.refreshIfNeeded();return this._interpreter.setupReservedCommonEvent()||this.setupTestEvent()||this.setupStartingMapEvent()||this.setupAutorunCommonEvent()?!0:!1};Game_Map.prototype.setupTestEvent=function(){return $testEvent?(this._interpreter.setup($testEvent,0),$testEvent=null,!0):!1};
Game_Map.prototype.setupStartingMapEvent=function(){for(var a=this.events(),b=0;b<a.length;b++){var c=a[b];if(c.isStarting())return c.clearStartingFlag(),this._interpreter.setup(c.list(),c.eventId()),!0}return!1};Game_Map.prototype.setupAutorunCommonEvent=function(){for(var a=0;a<$dataCommonEvents.length;a++){var b=$dataCommonEvents[a];if(b&&1===b.trigger&&$gameSwitches.value(b.switchId))return this._interpreter.setup(b.list),!0}return!1};Game_Map.prototype.isAnyEventStarting=function(){return this.events().some(function(a){return a.isStarting()})};
function Game_CommonEvent(){this.initialize.apply(this,arguments)}Game_CommonEvent.prototype.initialize=function(a){this._commonEventId=a;this.refresh()};Game_CommonEvent.prototype.event=function(){return $dataCommonEvents[this._commonEventId]};Game_CommonEvent.prototype.list=function(){return this.event().list};Game_CommonEvent.prototype.refresh=function(){this.isActive()?this._interpreter||(this._interpreter=new Game_Interpreter):this._interpreter=null};
Game_CommonEvent.prototype.isActive=function(){var a=this.event();return 2===a.trigger&&$gameSwitches.value(a.switchId)};Game_CommonEvent.prototype.update=function(){this._interpreter&&(this._interpreter.isRunning()||this._interpreter.setup(this.list()),this._interpreter.update())};function Game_CharacterBase(){this.initialize.apply(this,arguments)}Object.defineProperties(Game_CharacterBase.prototype,{x:{get:function(){return this._x},configurable:!0},y:{get:function(){return this._y},configurable:!0}});
Game_CharacterBase.prototype.initialize=function(){this.initMembers()};
Game_CharacterBase.prototype.initMembers=function(){this._realY=this._realX=this._y=this._x=0;this._moveSpeed=4;this._moveFrequency=6;this._opacity=255;this._blendMode=0;this._direction=2;this._priorityType=this._pattern=1;this._tileId=0;this._characterName="";this._characterIndex=0;this._isObjectCharacter=!1;this._walkAnime=!0;this._transparent=this._through=this._directionFix=this._stepAnime=!1;this._balloonId=this._animationId=this._bushDepth=0;this._balloonPlaying=this._animationPlaying=!1;this._jumpPeak=
this._jumpCount=this._stopCount=this._animationCount=0;this._movementSuccess=!0};Game_CharacterBase.prototype.pos=function(a,b){return this._x===a&&this._y===b};Game_CharacterBase.prototype.posNt=function(a,b){return this.pos(a,b)&&!this.isThrough()};Game_CharacterBase.prototype.moveSpeed=function(){return this._moveSpeed};Game_CharacterBase.prototype.setMoveSpeed=function(a){this._moveSpeed=a};Game_CharacterBase.prototype.moveFrequency=function(){return this._moveFrequency};
Game_CharacterBase.prototype.setMoveFrequency=function(a){this._moveFrequency=a};Game_CharacterBase.prototype.opacity=function(){return this._opacity};Game_CharacterBase.prototype.setOpacity=function(a){this._opacity=a};Game_CharacterBase.prototype.blendMode=function(){return this._blendMode};Game_CharacterBase.prototype.setBlendMode=function(a){this._blendMode=a};Game_CharacterBase.prototype.isNormalPriority=function(){return 1===this._priorityType};
Game_CharacterBase.prototype.setPriorityType=function(a){this._priorityType=a};Game_CharacterBase.prototype.isMoving=function(){return this._realX!==this._x||this._realY!==this._y};Game_CharacterBase.prototype.isJumping=function(){return 0<this._jumpCount};Game_CharacterBase.prototype.jumpHeight=function(){return(this._jumpPeak*this._jumpPeak-Math.pow(Math.abs(this._jumpCount-this._jumpPeak),2))/2};Game_CharacterBase.prototype.isStopping=function(){return!this.isMoving()&&!this.isJumping()};
Game_CharacterBase.prototype.checkStop=function(a){return this._stopCount>a};Game_CharacterBase.prototype.resetStopCount=function(){this._stopCount=0};Game_CharacterBase.prototype.realMoveSpeed=function(){return this._moveSpeed+(this.isDashing()?1:0)};Game_CharacterBase.prototype.distancePerFrame=function(){return Math.pow(2,this.realMoveSpeed())/256};Game_CharacterBase.prototype.isDashing=function(){return!1};Game_CharacterBase.prototype.isDebugThrough=function(){return!1};
Game_CharacterBase.prototype.straighten=function(){if(this.hasWalkAnime()||this.hasStepAnime())this._pattern=1;this._animationCount=0};Game_CharacterBase.prototype.reverseDir=function(a){return 10-a};Game_CharacterBase.prototype.canPass=function(a,b,c){var d=$gameMap.roundXWithDirection(a,c),e=$gameMap.roundYWithDirection(b,c);return $gameMap.isValid(d,e)?this.isThrough()||this.isDebugThrough()?!0:!this.isMapPassable(a,b,c)||this.isCollidedWithCharacters(d,e)?!1:!0:!1};
Game_CharacterBase.prototype.canPassDiagonally=function(a,b,c,d){var e=$gameMap.roundXWithDirection(a,c),f=$gameMap.roundYWithDirection(b,d);return this.canPass(a,b,d)&&this.canPass(a,f,c)||this.canPass(a,b,c)&&this.canPass(e,b,d)?!0:!1};Game_CharacterBase.prototype.isMapPassable=function(a,b,c){var d=$gameMap.roundXWithDirection(a,c),e=$gameMap.roundYWithDirection(b,c),f=this.reverseDir(c);return $gameMap.isPassable(a,b,c)&&$gameMap.isPassable(d,e,f)};
Game_CharacterBase.prototype.isCollidedWithCharacters=function(a,b){return this.isCollidedWithEvents(a,b)||this.isCollidedWithVehicles(a,b)};Game_CharacterBase.prototype.isCollidedWithEvents=function(a,b){return $gameMap.eventsXyNt(a,b).some(function(c){return c.isNormalPriority()})};Game_CharacterBase.prototype.isCollidedWithVehicles=function(a,b){return $gameMap.boat().posNt(a,b)||$gameMap.ship().posNt(a,b)};
Game_CharacterBase.prototype.setPosition=function(a,b){this._x=Math.round(a);this._y=Math.round(b);this._realX=a;this._realY=b};Game_CharacterBase.prototype.copyPosition=function(a){this._x=a._x;this._y=a._y;this._realX=a._realX;this._realY=a._realY;this._direction=a._direction};Game_CharacterBase.prototype.locate=function(a,b){this.setPosition(a,b);this.straighten();this.refreshBushDepth()};Game_CharacterBase.prototype.direction=function(){return this._direction};
Game_CharacterBase.prototype.setDirection=function(a){!this.isDirectionFixed()&&a&&(this._direction=a);this.resetStopCount()};Game_CharacterBase.prototype.isTile=function(){return 0<this._tileId&&0===this._priorityType};Game_CharacterBase.prototype.isObjectCharacter=function(){return this._isObjectCharacter};Game_CharacterBase.prototype.shiftY=function(){return this.isObjectCharacter()?0:6};Game_CharacterBase.prototype.scrolledX=function(){return $gameMap.adjustX(this._realX)};
Game_CharacterBase.prototype.scrolledY=function(){return $gameMap.adjustY(this._realY)};Game_CharacterBase.prototype.screenX=function(){var a=$gameMap.tileWidth();return Math.round(this.scrolledX()*a+a/2)};Game_CharacterBase.prototype.screenY=function(){var a=$gameMap.tileHeight();return Math.round(this.scrolledY()*a+a-this.shiftY()-this.jumpHeight())};Game_CharacterBase.prototype.screenZ=function(){return 2*this._priorityType+1};
Game_CharacterBase.prototype.isNearTheScreen=function(){var a=Graphics.width,b=Graphics.height,c=$gameMap.tileWidth(),d=$gameMap.tileHeight();c=this.scrolledX()*c+c/2-a/2;d=this.scrolledY()*d+d/2-b/2;return c>=-a&&c<=a&&d>=-b&&d<=b};Game_CharacterBase.prototype.update=function(){this.isStopping()&&this.updateStop();this.isJumping()?this.updateJump():this.isMoving()&&this.updateMove();this.updateAnimation()};Game_CharacterBase.prototype.updateStop=function(){this._stopCount++};
Game_CharacterBase.prototype.updateJump=function(){this._jumpCount--;this._realX=(this._realX*this._jumpCount+this._x)/(this._jumpCount+1);this._realY=(this._realY*this._jumpCount+this._y)/(this._jumpCount+1);this.refreshBushDepth();0===this._jumpCount&&(this._realX=this._x=$gameMap.roundX(this._x),this._realY=this._y=$gameMap.roundY(this._y))};
Game_CharacterBase.prototype.updateMove=function(){this._x<this._realX&&(this._realX=Math.max(this._realX-this.distancePerFrame(),this._x));this._x>this._realX&&(this._realX=Math.min(this._realX+this.distancePerFrame(),this._x));this._y<this._realY&&(this._realY=Math.max(this._realY-this.distancePerFrame(),this._y));this._y>this._realY&&(this._realY=Math.min(this._realY+this.distancePerFrame(),this._y));this.isMoving()||this.refreshBushDepth()};
Game_CharacterBase.prototype.updateAnimation=function(){this.updateAnimationCount();this._animationCount>=this.animationWait()&&(this.updatePattern(),this._animationCount=0)};Game_CharacterBase.prototype.animationWait=function(){return 3*(9-this.realMoveSpeed())};Game_CharacterBase.prototype.updateAnimationCount=function(){this.isMoving()&&this.hasWalkAnime()?this._animationCount+=1.5:(this.hasStepAnime()||!this.isOriginalPattern())&&this._animationCount++};
Game_CharacterBase.prototype.updatePattern=function(){!this.hasStepAnime()&&0<this._stopCount?this.resetPattern():this._pattern=(this._pattern+1)%this.maxPattern()};Game_CharacterBase.prototype.maxPattern=function(){return 4};Game_CharacterBase.prototype.pattern=function(){return 3>this._pattern?this._pattern:1};Game_CharacterBase.prototype.setPattern=function(a){this._pattern=a};Game_CharacterBase.prototype.isOriginalPattern=function(){return 1===this.pattern()};
Game_CharacterBase.prototype.resetPattern=function(){this.setPattern(1)};Game_CharacterBase.prototype.refreshBushDepth=function(){this.isNormalPriority()&&!this.isObjectCharacter()&&this.isOnBush()&&!this.isJumping()?this.isMoving()||(this._bushDepth=12):this._bushDepth=0};Game_CharacterBase.prototype.isOnLadder=function(){return $gameMap.isLadder(this._x,this._y)};Game_CharacterBase.prototype.isOnBush=function(){return $gameMap.isBush(this._x,this._y)};
Game_CharacterBase.prototype.terrainTag=function(){return $gameMap.terrainTag(this._x,this._y)};Game_CharacterBase.prototype.regionId=function(){return $gameMap.regionId(this._x,this._y)};Game_CharacterBase.prototype.increaseSteps=function(){this.isOnLadder()&&this.setDirection(8);this.resetStopCount();this.refreshBushDepth()};Game_CharacterBase.prototype.tileId=function(){return this._tileId};Game_CharacterBase.prototype.characterName=function(){return this._characterName};
Game_CharacterBase.prototype.characterIndex=function(){return this._characterIndex};Game_CharacterBase.prototype.setImage=function(a,b){this._tileId=0;this._characterName=a;this._characterIndex=b;this._isObjectCharacter=ImageManager.isObjectCharacter(a)};Game_CharacterBase.prototype.setTileImage=function(a){this._tileId=a;this._characterName="";this._characterIndex=0;this._isObjectCharacter=!0};
Game_CharacterBase.prototype.checkEventTriggerTouchFront=function(a){var b=$gameMap.roundXWithDirection(this._x,a);a=$gameMap.roundYWithDirection(this._y,a);this.checkEventTriggerTouch(b,a)};Game_CharacterBase.prototype.checkEventTriggerTouch=function(a,b){return!1};Game_CharacterBase.prototype.isMovementSucceeded=function(a,b){return this._movementSuccess};Game_CharacterBase.prototype.setMovementSuccess=function(a){this._movementSuccess=a};
Game_CharacterBase.prototype.moveStraight=function(a){this.setMovementSuccess(this.canPass(this._x,this._y,a));this.isMovementSucceeded()?(this.setDirection(a),this._x=$gameMap.roundXWithDirection(this._x,a),this._y=$gameMap.roundYWithDirection(this._y,a),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(a)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(a)),this.increaseSteps()):(this.setDirection(a),this.checkEventTriggerTouchFront(a))};
Game_CharacterBase.prototype.moveDiagonally=function(a,b){this.setMovementSuccess(this.canPassDiagonally(this._x,this._y,a,b));this.isMovementSucceeded()&&(this._x=$gameMap.roundXWithDirection(this._x,a),this._y=$gameMap.roundYWithDirection(this._y,b),this._realX=$gameMap.xWithDirection(this._x,this.reverseDir(a)),this._realY=$gameMap.yWithDirection(this._y,this.reverseDir(b)),this.increaseSteps());this._direction===this.reverseDir(a)&&this.setDirection(a);this._direction===this.reverseDir(b)&&this.setDirection(b)};
Game_CharacterBase.prototype.jump=function(a,b){Math.abs(a)>Math.abs(b)?0!==a&&this.setDirection(0>a?4:6):0!==b&&this.setDirection(0>b?8:2);this._x+=a;this._y+=b;this._jumpPeak=10+Math.round(Math.sqrt(a*a+b*b))-this._moveSpeed;this._jumpCount=2*this._jumpPeak;this.resetStopCount();this.straighten()};Game_CharacterBase.prototype.hasWalkAnime=function(){return this._walkAnime};Game_CharacterBase.prototype.setWalkAnime=function(a){this._walkAnime=a};Game_CharacterBase.prototype.hasStepAnime=function(){return this._stepAnime};
Game_CharacterBase.prototype.setStepAnime=function(a){this._stepAnime=a};Game_CharacterBase.prototype.isDirectionFixed=function(){return this._directionFix};Game_CharacterBase.prototype.setDirectionFix=function(a){this._directionFix=a};Game_CharacterBase.prototype.isThrough=function(){return this._through};Game_CharacterBase.prototype.setThrough=function(a){this._through=a};Game_CharacterBase.prototype.isTransparent=function(){return this._transparent};Game_CharacterBase.prototype.bushDepth=function(){return this._bushDepth};
Game_CharacterBase.prototype.setTransparent=function(a){this._transparent=a};Game_CharacterBase.prototype.requestAnimation=function(a){this._animationId=a};Game_CharacterBase.prototype.requestBalloon=function(a){this._balloonId=a};Game_CharacterBase.prototype.animationId=function(){return this._animationId};Game_CharacterBase.prototype.balloonId=function(){return this._balloonId};Game_CharacterBase.prototype.startAnimation=function(){this._animationId=0;this._animationPlaying=!0};
Game_CharacterBase.prototype.startBalloon=function(){this._balloonId=0;this._balloonPlaying=!0};Game_CharacterBase.prototype.isAnimationPlaying=function(){return 0<this._animationId||this._animationPlaying};Game_CharacterBase.prototype.isBalloonPlaying=function(){return 0<this._balloonId||this._balloonPlaying};Game_CharacterBase.prototype.endAnimation=function(){this._animationPlaying=!1};Game_CharacterBase.prototype.endBalloon=function(){this._balloonPlaying=!1};
function Game_Character(){this.initialize.apply(this,arguments)}Game_Character.prototype=Object.create(Game_CharacterBase.prototype);Game_Character.prototype.constructor=Game_Character;Game_Character.ROUTE_END=0;Game_Character.ROUTE_MOVE_DOWN=1;Game_Character.ROUTE_MOVE_LEFT=2;Game_Character.ROUTE_MOVE_RIGHT=3;Game_Character.ROUTE_MOVE_UP=4;Game_Character.ROUTE_MOVE_LOWER_L=5;Game_Character.ROUTE_MOVE_LOWER_R=6;Game_Character.ROUTE_MOVE_UPPER_L=7;Game_Character.ROUTE_MOVE_UPPER_R=8;
Game_Character.ROUTE_MOVE_RANDOM=9;Game_Character.ROUTE_MOVE_TOWARD=10;Game_Character.ROUTE_MOVE_AWAY=11;Game_Character.ROUTE_MOVE_FORWARD=12;Game_Character.ROUTE_MOVE_BACKWARD=13;Game_Character.ROUTE_JUMP=14;Game_Character.ROUTE_WAIT=15;Game_Character.ROUTE_TURN_DOWN=16;Game_Character.ROUTE_TURN_LEFT=17;Game_Character.ROUTE_TURN_RIGHT=18;Game_Character.ROUTE_TURN_UP=19;Game_Character.ROUTE_TURN_90D_R=20;Game_Character.ROUTE_TURN_90D_L=21;Game_Character.ROUTE_TURN_180D=22;
Game_Character.ROUTE_TURN_90D_R_L=23;Game_Character.ROUTE_TURN_RANDOM=24;Game_Character.ROUTE_TURN_TOWARD=25;Game_Character.ROUTE_TURN_AWAY=26;Game_Character.ROUTE_SWITCH_ON=27;Game_Character.ROUTE_SWITCH_OFF=28;Game_Character.ROUTE_CHANGE_SPEED=29;Game_Character.ROUTE_CHANGE_FREQ=30;Game_Character.ROUTE_WALK_ANIME_ON=31;Game_Character.ROUTE_WALK_ANIME_OFF=32;Game_Character.ROUTE_STEP_ANIME_ON=33;Game_Character.ROUTE_STEP_ANIME_OFF=34;Game_Character.ROUTE_DIR_FIX_ON=35;
Game_Character.ROUTE_DIR_FIX_OFF=36;Game_Character.ROUTE_THROUGH_ON=37;Game_Character.ROUTE_THROUGH_OFF=38;Game_Character.ROUTE_TRANSPARENT_ON=39;Game_Character.ROUTE_TRANSPARENT_OFF=40;Game_Character.ROUTE_CHANGE_IMAGE=41;Game_Character.ROUTE_CHANGE_OPACITY=42;Game_Character.ROUTE_CHANGE_BLEND_MODE=43;Game_Character.ROUTE_PLAY_SE=44;Game_Character.ROUTE_SCRIPT=45;Game_Character.prototype.initialize=function(){Game_CharacterBase.prototype.initialize.call(this)};
Game_Character.prototype.initMembers=function(){Game_CharacterBase.prototype.initMembers.call(this);this._moveRouteForcing=!1;this._moveRoute=null;this._moveRouteIndex=0;this._originalMoveRoute=null;this._waitCount=this._originalMoveRouteIndex=0};Game_Character.prototype.memorizeMoveRoute=function(){this._originalMoveRoute=this._moveRoute;this._originalMoveRouteIndex=this._moveRouteIndex};
Game_Character.prototype.restoreMoveRoute=function(){this._moveRoute=this._originalMoveRoute;this._moveRouteIndex=this._originalMoveRouteIndex;this._originalMoveRoute=null};Game_Character.prototype.isMoveRouteForcing=function(){return this._moveRouteForcing};Game_Character.prototype.setMoveRoute=function(a){this._moveRoute=a;this._moveRouteIndex=0;this._moveRouteForcing=!1};
Game_Character.prototype.forceMoveRoute=function(a){this._originalMoveRoute||this.memorizeMoveRoute();this._moveRoute=a;this._moveRouteIndex=0;this._moveRouteForcing=!0;this._waitCount=0};Game_Character.prototype.updateStop=function(){Game_CharacterBase.prototype.updateStop.call(this);this._moveRouteForcing&&this.updateRoutineMove()};
Game_Character.prototype.updateRoutineMove=function(){if(0<this._waitCount)this._waitCount--;else{this.setMovementSuccess(!0);var a=this._moveRoute.list[this._moveRouteIndex];a&&(this.processMoveCommand(a),this.advanceMoveRouteIndex())}};
Game_Character.prototype.processMoveCommand=function(a){var b=Game_Character,c=a.parameters;switch(a.code){case b.ROUTE_END:this.processRouteEnd();break;case b.ROUTE_MOVE_DOWN:this.moveStraight(2);break;case b.ROUTE_MOVE_LEFT:this.moveStraight(4);break;case b.ROUTE_MOVE_RIGHT:this.moveStraight(6);break;case b.ROUTE_MOVE_UP:this.moveStraight(8);break;case b.ROUTE_MOVE_LOWER_L:this.moveDiagonally(4,2);break;case b.ROUTE_MOVE_LOWER_R:this.moveDiagonally(6,2);break;case b.ROUTE_MOVE_UPPER_L:this.moveDiagonally(4,
8);break;case b.ROUTE_MOVE_UPPER_R:this.moveDiagonally(6,8);break;case b.ROUTE_MOVE_RANDOM:this.moveRandom();break;case b.ROUTE_MOVE_TOWARD:this.moveTowardPlayer();break;case b.ROUTE_MOVE_AWAY:this.moveAwayFromPlayer();break;case b.ROUTE_MOVE_FORWARD:this.moveForward();break;case b.ROUTE_MOVE_BACKWARD:this.moveBackward();break;case b.ROUTE_JUMP:this.jump(c[0],c[1]);break;case b.ROUTE_WAIT:this._waitCount=c[0]-1;break;case b.ROUTE_TURN_DOWN:this.setDirection(2);break;case b.ROUTE_TURN_LEFT:this.setDirection(4);
break;case b.ROUTE_TURN_RIGHT:this.setDirection(6);break;case b.ROUTE_TURN_UP:this.setDirection(8);break;case b.ROUTE_TURN_90D_R:this.turnRight90();break;case b.ROUTE_TURN_90D_L:this.turnLeft90();break;case b.ROUTE_TURN_180D:this.turn180();break;case b.ROUTE_TURN_90D_R_L:this.turnRightOrLeft90();break;case b.ROUTE_TURN_RANDOM:this.turnRandom();break;case b.ROUTE_TURN_TOWARD:this.turnTowardPlayer();break;case b.ROUTE_TURN_AWAY:this.turnAwayFromPlayer();break;case b.ROUTE_SWITCH_ON:$gameSwitches.setValue(c[0],
!0);break;case b.ROUTE_SWITCH_OFF:$gameSwitches.setValue(c[0],!1);break;case b.ROUTE_CHANGE_SPEED:this.setMoveSpeed(c[0]);break;case b.ROUTE_CHANGE_FREQ:this.setMoveFrequency(c[0]);break;case b.ROUTE_WALK_ANIME_ON:this.setWalkAnime(!0);break;case b.ROUTE_WALK_ANIME_OFF:this.setWalkAnime(!1);break;case b.ROUTE_STEP_ANIME_ON:this.setStepAnime(!0);break;case b.ROUTE_STEP_ANIME_OFF:this.setStepAnime(!1);break;case b.ROUTE_DIR_FIX_ON:this.setDirectionFix(!0);break;case b.ROUTE_DIR_FIX_OFF:this.setDirectionFix(!1);
break;case b.ROUTE_THROUGH_ON:this.setThrough(!0);break;case b.ROUTE_THROUGH_OFF:this.setThrough(!1);break;case b.ROUTE_TRANSPARENT_ON:this.setTransparent(!0);break;case b.ROUTE_TRANSPARENT_OFF:this.setTransparent(!1);break;case b.ROUTE_CHANGE_IMAGE:this.setImage(c[0],c[1]);break;case b.ROUTE_CHANGE_OPACITY:this.setOpacity(c[0]);break;case b.ROUTE_CHANGE_BLEND_MODE:this.setBlendMode(c[0]);break;case b.ROUTE_PLAY_SE:AudioManager.playSe(c[0]);break;case b.ROUTE_SCRIPT:eval(c[0])}};
Game_Character.prototype.deltaXFrom=function(a){return $gameMap.deltaX(this.x,a)};Game_Character.prototype.deltaYFrom=function(a){return $gameMap.deltaY(this.y,a)};Game_Character.prototype.moveRandom=function(){var a=2+2*Math.randomInt(4);this.canPass(this.x,this.y,a)&&this.moveStraight(a)};
Game_Character.prototype.moveTowardCharacter=function(a){var b=this.deltaXFrom(a.x);a=this.deltaYFrom(a.y);Math.abs(b)>Math.abs(a)?(this.moveStraight(0<b?4:6),this.isMovementSucceeded()||0===a||this.moveStraight(0<a?8:2)):0!==a&&(this.moveStraight(0<a?8:2),this.isMovementSucceeded()||0===b||this.moveStraight(0<b?4:6))};
Game_Character.prototype.moveAwayFromCharacter=function(a){var b=this.deltaXFrom(a.x);a=this.deltaYFrom(a.y);Math.abs(b)>Math.abs(a)?(this.moveStraight(0<b?6:4),this.isMovementSucceeded()||0===a||this.moveStraight(0<a?2:8)):0!==a&&(this.moveStraight(0<a?2:8),this.isMovementSucceeded()||0===b||this.moveStraight(0<b?6:4))};
Game_Character.prototype.turnTowardCharacter=function(a){var b=this.deltaXFrom(a.x);a=this.deltaYFrom(a.y);Math.abs(b)>Math.abs(a)?this.setDirection(0<b?4:6):0!==a&&this.setDirection(0<a?8:2)};Game_Character.prototype.turnAwayFromCharacter=function(a){var b=this.deltaXFrom(a.x);a=this.deltaYFrom(a.y);Math.abs(b)>Math.abs(a)?this.setDirection(0<b?6:4):0!==a&&this.setDirection(0<a?2:8)};Game_Character.prototype.turnTowardPlayer=function(){this.turnTowardCharacter($gamePlayer)};
Game_Character.prototype.turnAwayFromPlayer=function(){this.turnAwayFromCharacter($gamePlayer)};Game_Character.prototype.moveTowardPlayer=function(){this.moveTowardCharacter($gamePlayer)};Game_Character.prototype.moveAwayFromPlayer=function(){this.moveAwayFromCharacter($gamePlayer)};Game_Character.prototype.moveForward=function(){this.moveStraight(this.direction())};
Game_Character.prototype.moveBackward=function(){var a=this.isDirectionFixed();this.setDirectionFix(!0);this.moveStraight(this.reverseDir(this.direction()));this.setDirectionFix(a)};Game_Character.prototype.processRouteEnd=function(){this._moveRoute.repeat?this._moveRouteIndex=-1:this._moveRouteForcing&&(this._moveRouteForcing=!1,this.restoreMoveRoute())};
Game_Character.prototype.advanceMoveRouteIndex=function(){var a=this._moveRoute;if(a&&(this.isMovementSucceeded()||a.skippable)){var b=a.list.length-1;this._moveRouteIndex++;a.repeat&&this._moveRouteIndex>=b&&(this._moveRouteIndex=0)}};Game_Character.prototype.turnRight90=function(){switch(this.direction()){case 2:this.setDirection(4);break;case 4:this.setDirection(8);break;case 6:this.setDirection(2);break;case 8:this.setDirection(6)}};
Game_Character.prototype.turnLeft90=function(){switch(this.direction()){case 2:this.setDirection(6);break;case 4:this.setDirection(2);break;case 6:this.setDirection(8);break;case 8:this.setDirection(4)}};Game_Character.prototype.turn180=function(){this.setDirection(this.reverseDir(this.direction()))};Game_Character.prototype.turnRightOrLeft90=function(){switch(Math.randomInt(2)){case 0:this.turnRight90();break;case 1:this.turnLeft90()}};
Game_Character.prototype.turnRandom=function(){this.setDirection(2+2*Math.randomInt(4))};Game_Character.prototype.swap=function(a){var b=a.x,c=a.y;a.locate(this.x,this.y);this.locate(b,c)};
Game_Character.prototype.findDirectionTo=function(a,b){var c=this.searchLimit(),d=$gameMap.width(),e=[],f=[],g=[],h={},k=h;if(this.x===a&&this.y===b)return 0;h.parent=null;h.x=this.x;h.y=this.y;h.g=0;h.f=$gameMap.distance(h.x,h.y,a,b);e.push(h);for(f.push(h.y*d+h.x);0<e.length;){for(var l=0,m=0;m<e.length;m++)e[m].f<e[l].f&&(l=m);m=e[l];var n=m.x,q=m.y,p=q*d+n,u=m.g;e.splice(l,1);f.splice(f.indexOf(p),1);g.push(p);if(m.x===a&&m.y===b){k=m;break}if(!(u>=c))for(l=0;4>l;l++){var t=2+2*l;p=$gameMap.roundXWithDirection(n,
t);var v=$gameMap.roundYWithDirection(q,t),w=v*d+p;if(!g.contains(w)&&this.canPass(n,q,t)){t=u+1;var r=f.indexOf(w);if(0>r||t<e[r].g)if(0<=r?r=e[r]:(r={},e.push(r),f.push(w)),r.parent=m,r.x=p,r.y=v,r.g=t,r.f=t+$gameMap.distance(p,v,a,b),!k||r.f-r.g<k.f-k.g)k=r}}}for(d=k;d.parent&&d.parent!==h;)d=d.parent;c=$gameMap.deltaX(d.x,h.x);h=$gameMap.deltaY(d.y,h.y);if(0<h)return 2;if(0>c)return 4;if(0<c)return 6;if(0>h)return 8;a=this.deltaXFrom(a);b=this.deltaYFrom(b);return Math.abs(a)>Math.abs(b)?0<a?
4:6:0!==b?0<b?8:2:0};Game_Character.prototype.searchLimit=function(){return 12};function Game_Player(){this.initialize.apply(this,arguments)}Game_Player.prototype=Object.create(Game_Character.prototype);Game_Player.prototype.constructor=Game_Player;Game_Player.prototype.initialize=function(){Game_Character.prototype.initialize.call(this);this.setTransparent($dataSystem.optTransparent)};
Game_Player.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this);this._vehicleType="walk";this._transferring=this._needsMapReload=this._dashing=this._vehicleGettingOff=this._vehicleGettingOn=!1;this._fadeType=this._newDirection=this._newY=this._newX=this._newMapId=0;this._followers=new Game_Followers;this._encounterCount=0};Game_Player.prototype.clearTransferInfo=function(){this._transferring=!1;this._newDirection=this._newY=this._newX=this._newMapId=0};
Game_Player.prototype.followers=function(){return this._followers};Game_Player.prototype.refresh=function(){var a=$gameParty.leader(),b=a?a.characterName():"";a=a?a.characterIndex():0;this.setImage(b,a);this._followers.refresh()};Game_Player.prototype.isStopping=function(){return this._vehicleGettingOn||this._vehicleGettingOff?!1:Game_Character.prototype.isStopping.call(this)};
Game_Player.prototype.reserveTransfer=function(a,b,c,d,e){this._transferring=!0;this._newMapId=a;this._newX=b;this._newY=c;this._newDirection=d;this._fadeType=e};Game_Player.prototype.requestMapReload=function(){this._needsMapReload=!0};Game_Player.prototype.isTransferring=function(){return this._transferring};Game_Player.prototype.newMapId=function(){return this._newMapId};Game_Player.prototype.fadeType=function(){return this._fadeType};
Game_Player.prototype.performTransfer=function(){if(this.isTransferring()){this.setDirection(this._newDirection);if(this._newMapId!==$gameMap.mapId()||this._needsMapReload)$gameMap.setup(this._newMapId),this._needsMapReload=!1;this.locate(this._newX,this._newY);this.refresh();this.clearTransferInfo()}};Game_Player.prototype.isMapPassable=function(a,b,c){var d=this.vehicle();return d?d.isMapPassable(a,b,c):Game_Character.prototype.isMapPassable.call(this,a,b,c)};Game_Player.prototype.vehicle=function(){return $gameMap.vehicle(this._vehicleType)};
Game_Player.prototype.isInBoat=function(){return"boat"===this._vehicleType};Game_Player.prototype.isInShip=function(){return"ship"===this._vehicleType};Game_Player.prototype.isInAirship=function(){return"airship"===this._vehicleType};Game_Player.prototype.isInVehicle=function(){return this.isInBoat()||this.isInShip()||this.isInAirship()};Game_Player.prototype.isNormal=function(){return"walk"===this._vehicleType&&!this.isMoveRouteForcing()};Game_Player.prototype.isDashing=function(){return this._dashing};
Game_Player.prototype.isDebugThrough=function(){return Input.isPressed("control")&&$gameTemp.isPlaytest()};Game_Player.prototype.isCollided=function(a,b){return this.isThrough()?!1:this.pos(a,b)||this._followers.isSomeoneCollided(a,b)};Game_Player.prototype.centerX=function(){return(Graphics.width/$gameMap.tileWidth()-1)/2};Game_Player.prototype.centerY=function(){return(Graphics.height/$gameMap.tileHeight()-1)/2};
Game_Player.prototype.center=function(a,b){return $gameMap.setDisplayPos(a-this.centerX(),b-this.centerY())};Game_Player.prototype.locate=function(a,b){Game_Character.prototype.locate.call(this,a,b);this.center(a,b);this.makeEncounterCount();this.isInVehicle()&&this.vehicle().refresh();this._followers.synchronize(a,b,this.direction())};Game_Player.prototype.increaseSteps=function(){Game_Character.prototype.increaseSteps.call(this);this.isNormal()&&$gameParty.increaseSteps()};
Game_Player.prototype.makeEncounterCount=function(){var a=$gameMap.encounterStep();this._encounterCount=Math.randomInt(a)+Math.randomInt(a)+1};Game_Player.prototype.makeEncounterTroopId=function(){var a=[],b=0;$gameMap.encounterList().forEach(function(e){this.meetsEncounterConditions(e)&&(a.push(e),b+=e.weight)},this);if(0<b)for(var c=Math.randomInt(b),d=0;d<a.length;d++)if(c-=a[d].weight,0>c)return a[d].troopId;return 0};
Game_Player.prototype.meetsEncounterConditions=function(a){return 0===a.regionSet.length||a.regionSet.contains(this.regionId())};Game_Player.prototype.executeEncounter=function(){if(!$gameMap.isEventRunning()&&0>=this._encounterCount){this.makeEncounterCount();var a=this.makeEncounterTroopId();if($dataTroops[a])return BattleManager.setup(a,!0,!1),BattleManager.onEncounter(),!0}return!1};
Game_Player.prototype.startMapEvent=function(a,b,c,d){$gameMap.isEventRunning()||$gameMap.eventsXy(a,b).forEach(function(e){e.isTriggerIn(c)&&e.isNormalPriority()===d&&e.start()})};Game_Player.prototype.moveByInput=function(){if(!this.isMoving()&&this.canMove()){var a=this.getInputDirection();if(0<a)$gameTemp.clearDestination();else if($gameTemp.isDestinationValid()){a=$gameTemp.destinationX();var b=$gameTemp.destinationY();a=this.findDirectionTo(a,b)}0<a&&this.executeMove(a)}};
Game_Player.prototype.canMove=function(){return $gameMap.isEventRunning()||$gameMessage.isBusy()||this.isMoveRouteForcing()||this.areFollowersGathering()||this._vehicleGettingOn||this._vehicleGettingOff||this.isInVehicle()&&!this.vehicle().canMove()?!1:!0};Game_Player.prototype.getInputDirection=function(){return Input.dir4};Game_Player.prototype.executeMove=function(a){this.moveStraight(a)};
Game_Player.prototype.update=function(a){var b=this.scrolledX(),c=this.scrolledY(),d=this.isMoving();this.updateDashing();a&&this.moveByInput();Game_Character.prototype.update.call(this);this.updateScroll(b,c);this.updateVehicle();this.isMoving()||this.updateNonmoving(d);this._followers.update()};Game_Player.prototype.updateDashing=function(){this.isMoving()||(!this.canMove()||this.isInVehicle()||$gameMap.isDashDisabled()?this._dashing=!1:this._dashing=this.isDashButtonPressed()||$gameTemp.isDestinationValid())};
Game_Player.prototype.isDashButtonPressed=function(){var a=Input.isPressed("shift");return ConfigManager.alwaysDash?!a:a};Game_Player.prototype.updateScroll=function(a,b){var c=this.scrolledX(),d=this.scrolledY();d>b&&d>this.centerY()&&$gameMap.scrollDown(d-b);c<a&&c<this.centerX()&&$gameMap.scrollLeft(a-c);c>a&&c>this.centerX()&&$gameMap.scrollRight(c-a);d<b&&d<this.centerY()&&$gameMap.scrollUp(b-d)};
Game_Player.prototype.updateVehicle=function(){this.isInVehicle()&&!this.areFollowersGathering()&&(this._vehicleGettingOn?this.updateVehicleGetOn():this._vehicleGettingOff?this.updateVehicleGetOff():this.vehicle().syncWithPlayer())};
Game_Player.prototype.updateVehicleGetOn=function(){this.areFollowersGathering()||this.isMoving()||(this.setDirection(this.vehicle().direction()),this.setMoveSpeed(this.vehicle().moveSpeed()),this._vehicleGettingOn=!1,this.setTransparent(!0),this.isInAirship()&&this.setThrough(!0),this.vehicle().getOn())};Game_Player.prototype.updateVehicleGetOff=function(){!this.areFollowersGathering()&&this.vehicle().isLowest()&&(this._vehicleGettingOff=!1,this._vehicleType="walk",this.setTransparent(!1))};
Game_Player.prototype.updateNonmoving=function(a){if(!$gameMap.isEventRunning()){if(a&&($gameParty.onPlayerWalk(),this.checkEventTriggerHere([1,2]),$gameMap.setupStartingEvent()))return;this.triggerAction()||(a?this.updateEncounterCount():$gameTemp.clearDestination())}};Game_Player.prototype.triggerAction=function(){return this.canMove()&&(this.triggerButtonAction()||this.triggerTouchAction())?!0:!1};
Game_Player.prototype.triggerButtonAction=function(){if(Input.isTriggered("ok")){if(this.getOnOffVehicle())return!0;this.checkEventTriggerHere([0]);if($gameMap.setupStartingEvent())return!0;this.checkEventTriggerThere([0,1,2]);if($gameMap.setupStartingEvent())return!0}return!1};
Game_Player.prototype.triggerTouchAction=function(){if($gameTemp.isDestinationValid()){var a=this.direction(),b=this.x,c=this.y,d=$gameMap.roundXWithDirection(b,a),e=$gameMap.roundYWithDirection(c,a),f=$gameMap.roundXWithDirection(d,a);a=$gameMap.roundYWithDirection(e,a);var g=$gameTemp.destinationX(),h=$gameTemp.destinationY();if(g===b&&h===c)return this.triggerTouchActionD1(b,c);if(g===d&&h===e)return this.triggerTouchActionD2(d,e);if(g===f&&h===a)return this.triggerTouchActionD3(d,e)}return!1};
Game_Player.prototype.triggerTouchActionD1=function(a,b){if($gameMap.airship().pos(a,b)&&TouchInput.isTriggered()&&this.getOnOffVehicle())return!0;this.checkEventTriggerHere([0]);return $gameMap.setupStartingEvent()};
Game_Player.prototype.triggerTouchActionD2=function(a,b){if(($gameMap.boat().pos(a,b)||$gameMap.ship().pos(a,b))&&TouchInput.isTriggered()&&this.getOnVehicle()||(this.isInBoat()||this.isInShip())&&TouchInput.isTriggered()&&this.getOffVehicle())return!0;this.checkEventTriggerThere([0,1,2]);return $gameMap.setupStartingEvent()};Game_Player.prototype.triggerTouchActionD3=function(a,b){$gameMap.isCounter(a,b)&&this.checkEventTriggerThere([0,1,2]);return $gameMap.setupStartingEvent()};
Game_Player.prototype.updateEncounterCount=function(){this.canEncounter()&&(this._encounterCount-=this.encounterProgressValue())};Game_Player.prototype.canEncounter=function(){return!$gameParty.hasEncounterNone()&&$gameSystem.isEncounterEnabled()&&!this.isInAirship()&&!this.isMoveRouteForcing()&&!this.isDebugThrough()};Game_Player.prototype.encounterProgressValue=function(){var a=$gameMap.isBush(this.x,this.y)?2:1;$gameParty.hasEncounterHalf()&&(a*=.5);this.isInShip()&&(a*=.5);return a};
Game_Player.prototype.checkEventTriggerHere=function(a){this.canStartLocalEvents()&&this.startMapEvent(this.x,this.y,a,!1)};
Game_Player.prototype.checkEventTriggerThere=function(a){if(this.canStartLocalEvents()){var b=this.direction(),c=this.y,d=$gameMap.roundXWithDirection(this.x,b);c=$gameMap.roundYWithDirection(c,b);this.startMapEvent(d,c,a,!0);!$gameMap.isAnyEventStarting()&&$gameMap.isCounter(d,c)&&(d=$gameMap.roundXWithDirection(d,b),b=$gameMap.roundYWithDirection(c,b),this.startMapEvent(d,b,a,!0))}};
Game_Player.prototype.checkEventTriggerTouch=function(a,b){this.canStartLocalEvents()&&this.startMapEvent(a,b,[1,2],!0)};Game_Player.prototype.canStartLocalEvents=function(){return!this.isInAirship()};Game_Player.prototype.getOnOffVehicle=function(){return this.isInVehicle()?this.getOffVehicle():this.getOnVehicle()};
Game_Player.prototype.getOnVehicle=function(){var a=this.direction(),b=this.x,c=this.y,d=$gameMap.roundXWithDirection(b,a);a=$gameMap.roundYWithDirection(c,a);$gameMap.airship().pos(b,c)?this._vehicleType="airship":$gameMap.ship().pos(d,a)?this._vehicleType="ship":$gameMap.boat().pos(d,a)&&(this._vehicleType="boat");this.isInVehicle()&&(this._vehicleGettingOn=!0,this.isInAirship()||this.forceMoveForward(),this.gatherFollowers());return this._vehicleGettingOn};
Game_Player.prototype.getOffVehicle=function(){this.vehicle().isLandOk(this.x,this.y,this.direction())&&(this.isInAirship()&&this.setDirection(2),this._followers.synchronize(this.x,this.y,this.direction()),this.vehicle().getOff(),this.isInAirship()||(this.forceMoveForward(),this.setTransparent(!1)),this._vehicleGettingOff=!0,this.setMoveSpeed(4),this.setThrough(!1),this.makeEncounterCount(),this.gatherFollowers());return this._vehicleGettingOff};
Game_Player.prototype.forceMoveForward=function(){this.setThrough(!0);this.moveForward();this.setThrough(!1)};Game_Player.prototype.isOnDamageFloor=function(){return $gameMap.isDamageFloor(this.x,this.y)&&!this.isInAirship()};Game_Player.prototype.moveStraight=function(a){this.canPass(this.x,this.y,a)&&this._followers.updateMove();Game_Character.prototype.moveStraight.call(this,a)};
Game_Player.prototype.moveDiagonally=function(a,b){this.canPassDiagonally(this.x,this.y,a,b)&&this._followers.updateMove();Game_Character.prototype.moveDiagonally.call(this,a,b)};Game_Player.prototype.jump=function(a,b){Game_Character.prototype.jump.call(this,a,b);this._followers.jumpAll()};Game_Player.prototype.showFollowers=function(){this._followers.show()};Game_Player.prototype.hideFollowers=function(){this._followers.hide()};Game_Player.prototype.gatherFollowers=function(){this._followers.gather()};
Game_Player.prototype.areFollowersGathering=function(){return this._followers.areGathering()};Game_Player.prototype.areFollowersGathered=function(){return this._followers.areGathered()};function Game_Follower(){this.initialize.apply(this,arguments)}Game_Follower.prototype=Object.create(Game_Character.prototype);Game_Follower.prototype.constructor=Game_Follower;
Game_Follower.prototype.initialize=function(a){Game_Character.prototype.initialize.call(this);this._memberIndex=a;this.setTransparent($dataSystem.optTransparent);this.setThrough(!0)};Game_Follower.prototype.refresh=function(){var a=this.isVisible()?this.actor().characterName():"",b=this.isVisible()?this.actor().characterIndex():0;this.setImage(a,b)};Game_Follower.prototype.actor=function(){return $gameParty.battleMembers()[this._memberIndex]};
Game_Follower.prototype.isVisible=function(){return this.actor()&&$gamePlayer.followers().isVisible()};Game_Follower.prototype.update=function(){Game_Character.prototype.update.call(this);this.setMoveSpeed($gamePlayer.realMoveSpeed());this.setOpacity($gamePlayer.opacity());this.setBlendMode($gamePlayer.blendMode());this.setWalkAnime($gamePlayer.hasWalkAnime());this.setStepAnime($gamePlayer.hasStepAnime());this.setDirectionFix($gamePlayer.isDirectionFixed());this.setTransparent($gamePlayer.isTransparent())};
Game_Follower.prototype.chaseCharacter=function(a){var b=this.deltaXFrom(a.x);a=this.deltaYFrom(a.y);0!==b&&0!==a?this.moveDiagonally(0<b?4:6,0<a?8:2):0!==b?this.moveStraight(0<b?4:6):0!==a&&this.moveStraight(0<a?8:2);this.setMoveSpeed($gamePlayer.realMoveSpeed())};function Game_Followers(){this.initialize.apply(this,arguments)}Game_Followers.prototype.initialize=function(){this._visible=$dataSystem.optFollowers;this._gathering=!1;this._data=[];for(var a=1;a<$gameParty.maxBattleMembers();a++)this._data.push(new Game_Follower(a))};
Game_Followers.prototype.isVisible=function(){return this._visible};Game_Followers.prototype.show=function(){this._visible=!0};Game_Followers.prototype.hide=function(){this._visible=!1};Game_Followers.prototype.follower=function(a){return this._data[a]};Game_Followers.prototype.forEach=function(a,b){this._data.forEach(a,b)};Game_Followers.prototype.reverseEach=function(a,b){this._data.reverse();this._data.forEach(a,b);this._data.reverse()};
Game_Followers.prototype.refresh=function(){this.forEach(function(a){return a.refresh()},this)};Game_Followers.prototype.update=function(){this.areGathering()&&(this.areMoving()||this.updateMove(),this.areGathered()&&(this._gathering=!1));this.forEach(function(a){a.update()},this)};Game_Followers.prototype.updateMove=function(){for(var a=this._data.length-1;0<=a;a--)this._data[a].chaseCharacter(0<a?this._data[a-1]:$gamePlayer)};
Game_Followers.prototype.jumpAll=function(){if($gamePlayer.isJumping())for(var a=0;a<this._data.length;a++){var b=this._data[a],c=$gamePlayer.deltaXFrom(b.x),d=$gamePlayer.deltaYFrom(b.y);b.jump(c,d)}};Game_Followers.prototype.synchronize=function(a,b,c){this.forEach(function(d){d.locate(a,b);d.setDirection(c)},this)};Game_Followers.prototype.gather=function(){this._gathering=!0};Game_Followers.prototype.areGathering=function(){return this._gathering};
Game_Followers.prototype.visibleFollowers=function(){return this._data.filter(function(a){return a.isVisible()},this)};Game_Followers.prototype.areMoving=function(){return this.visibleFollowers().some(function(a){return a.isMoving()},this)};Game_Followers.prototype.areGathered=function(){return this.visibleFollowers().every(function(a){return!a.isMoving()&&a.pos($gamePlayer.x,$gamePlayer.y)},this)};
Game_Followers.prototype.isSomeoneCollided=function(a,b){return this.visibleFollowers().some(function(c){return c.pos(a,b)},this)};function Game_Vehicle(){this.initialize.apply(this,arguments)}Game_Vehicle.prototype=Object.create(Game_Character.prototype);Game_Vehicle.prototype.constructor=Game_Vehicle;Game_Vehicle.prototype.initialize=function(a){Game_Character.prototype.initialize.call(this);this._type=a;this.resetDirection();this.initMoveSpeed();this.loadSystemSettings()};
Game_Vehicle.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this);this._type="";this._altitude=this._mapId=0;this._driving=!1;this._bgm=null};Game_Vehicle.prototype.isBoat=function(){return"boat"===this._type};Game_Vehicle.prototype.isShip=function(){return"ship"===this._type};Game_Vehicle.prototype.isAirship=function(){return"airship"===this._type};Game_Vehicle.prototype.resetDirection=function(){this.setDirection(4)};
Game_Vehicle.prototype.initMoveSpeed=function(){this.isBoat()?this.setMoveSpeed(4):this.isShip()?this.setMoveSpeed(5):this.isAirship()&&this.setMoveSpeed(6)};Game_Vehicle.prototype.vehicle=function(){return this.isBoat()?$dataSystem.boat:this.isShip()?$dataSystem.ship:this.isAirship()?$dataSystem.airship:null};Game_Vehicle.prototype.loadSystemSettings=function(){var a=this.vehicle();this._mapId=a.startMapId;this.setPosition(a.startX,a.startY);this.setImage(a.characterName,a.characterIndex)};
Game_Vehicle.prototype.refresh=function(){this._driving?(this._mapId=$gameMap.mapId(),this.syncWithPlayer()):this._mapId===$gameMap.mapId()&&this.locate(this.x,this.y);this.isAirship()?this.setPriorityType(this._driving?2:0):this.setPriorityType(1);this.setWalkAnime(this._driving);this.setStepAnime(this._driving);this.setTransparent(this._mapId!==$gameMap.mapId())};Game_Vehicle.prototype.setLocation=function(a,b,c){this._mapId=a;this.setPosition(b,c);this.refresh()};
Game_Vehicle.prototype.pos=function(a,b){return this._mapId===$gameMap.mapId()?Game_Character.prototype.pos.call(this,a,b):!1};Game_Vehicle.prototype.isMapPassable=function(a,b,c){a=$gameMap.roundXWithDirection(a,c);b=$gameMap.roundYWithDirection(b,c);return this.isBoat()?$gameMap.isBoatPassable(a,b):this.isShip()?$gameMap.isShipPassable(a,b):this.isAirship()?!0:!1};Game_Vehicle.prototype.getOn=function(){this._driving=!0;this.setWalkAnime(!0);this.setStepAnime(!0);$gameSystem.saveWalkingBgm();this.playBgm()};
Game_Vehicle.prototype.getOff=function(){this._driving=!1;this.setWalkAnime(!1);this.setStepAnime(!1);this.resetDirection();$gameSystem.replayWalkingBgm()};Game_Vehicle.prototype.setBgm=function(a){this._bgm=a};Game_Vehicle.prototype.playBgm=function(){AudioManager.playBgm(this._bgm||this.vehicle().bgm)};Game_Vehicle.prototype.syncWithPlayer=function(){this.copyPosition($gamePlayer);this.refreshBushDepth()};
Game_Vehicle.prototype.screenY=function(){return Game_Character.prototype.screenY.call(this)-this._altitude};Game_Vehicle.prototype.shadowX=function(){return this.screenX()};Game_Vehicle.prototype.shadowY=function(){return this.screenY()+this._altitude};Game_Vehicle.prototype.shadowOpacity=function(){return 255*this._altitude/this.maxAltitude()};Game_Vehicle.prototype.canMove=function(){return this.isAirship()?this.isHighest():!0};
Game_Vehicle.prototype.update=function(){Game_Character.prototype.update.call(this);this.isAirship()&&this.updateAirship()};Game_Vehicle.prototype.updateAirship=function(){this.updateAirshipAltitude();this.setStepAnime(this.isHighest());this.setPriorityType(this.isLowest()?0:2)};Game_Vehicle.prototype.updateAirshipAltitude=function(){this._driving&&!this.isHighest()&&this._altitude++;this._driving||this.isLowest()||this._altitude--};Game_Vehicle.prototype.maxAltitude=function(){return 48};
Game_Vehicle.prototype.isLowest=function(){return 0>=this._altitude};Game_Vehicle.prototype.isHighest=function(){return this._altitude>=this.maxAltitude()};Game_Vehicle.prototype.isTakeoffOk=function(){return $gamePlayer.areFollowersGathered()};
Game_Vehicle.prototype.isLandOk=function(a,b,c){if(this.isAirship()){if(!$gameMap.isAirshipLandOk(a,b)||0<$gameMap.eventsXy(a,b).length)return!1}else if(a=$gameMap.roundXWithDirection(a,c),b=$gameMap.roundYWithDirection(b,c),!$gameMap.isValid(a,b)||!$gameMap.isPassable(a,b,this.reverseDir(c))||this.isCollidedWithCharacters(a,b))return!1;return!0};function Game_Event(){this.initialize.apply(this,arguments)}Game_Event.prototype=Object.create(Game_Character.prototype);
Game_Event.prototype.constructor=Game_Event;Game_Event.prototype.initialize=function(a,b){Game_Character.prototype.initialize.call(this);this._mapId=a;this._eventId=b;this.locate(this.event().x,this.event().y);this.refresh()};Game_Event.prototype.initMembers=function(){Game_Character.prototype.initMembers.call(this);this._trigger=this._moveType=0;this._erased=this._starting=!1;this._pageIndex=-2;this._originalPattern=1;this._originalDirection=2;this._prelockDirection=0;this._locked=!1};
Game_Event.prototype.eventId=function(){return this._eventId};Game_Event.prototype.event=function(){return $dataMap.events[this._eventId]};Game_Event.prototype.page=function(){return this.event().pages[this._pageIndex]};Game_Event.prototype.list=function(){return this.page().list};Game_Event.prototype.isCollidedWithCharacters=function(a,b){return Game_Character.prototype.isCollidedWithCharacters.call(this,a,b)||this.isCollidedWithPlayerCharacters(a,b)};
Game_Event.prototype.isCollidedWithEvents=function(a,b){return 0<$gameMap.eventsXyNt(a,b).length};Game_Event.prototype.isCollidedWithPlayerCharacters=function(a,b){return this.isNormalPriority()&&$gamePlayer.isCollided(a,b)};Game_Event.prototype.lock=function(){this._locked||(this._prelockDirection=this.direction(),this.turnTowardPlayer(),this._locked=!0)};Game_Event.prototype.unlock=function(){this._locked&&(this._locked=!1,this.setDirection(this._prelockDirection))};
Game_Event.prototype.updateStop=function(){this._locked&&this.resetStopCount();Game_Character.prototype.updateStop.call(this);this.isMoveRouteForcing()||this.updateSelfMovement()};Game_Event.prototype.updateSelfMovement=function(){if(!this._locked&&this.isNearTheScreen()&&this.checkStop(this.stopCountThreshold()))switch(this._moveType){case 1:this.moveTypeRandom();break;case 2:this.moveTypeTowardPlayer();break;case 3:this.moveTypeCustom()}};
Game_Event.prototype.stopCountThreshold=function(){return 30*(5-this.moveFrequency())};Game_Event.prototype.moveTypeRandom=function(){switch(Math.randomInt(6)){case 0:case 1:this.moveRandom();break;case 2:case 3:case 4:this.moveForward();break;case 5:this.resetStopCount()}};Game_Event.prototype.moveTypeTowardPlayer=function(){if(this.isNearThePlayer())switch(Math.randomInt(6)){case 0:case 1:case 2:case 3:this.moveTowardPlayer();break;case 4:this.moveRandom();break;case 5:this.moveForward()}else this.moveRandom()};
Game_Event.prototype.isNearThePlayer=function(){var a=Math.abs(this.deltaXFrom($gamePlayer.x)),b=Math.abs(this.deltaYFrom($gamePlayer.y));return 20>a+b};Game_Event.prototype.moveTypeCustom=function(){this.updateRoutineMove()};Game_Event.prototype.isStarting=function(){return this._starting};Game_Event.prototype.clearStartingFlag=function(){this._starting=!1};Game_Event.prototype.isTriggerIn=function(a){return a.contains(this._trigger)};
Game_Event.prototype.start=function(){var a=this.list();a&&1<a.length&&(this._starting=!0,this.isTriggerIn([0,1,2])&&this.lock())};Game_Event.prototype.erase=function(){this._erased=!0;this.refresh()};Game_Event.prototype.refresh=function(){var a=this._erased?-1:this.findProperPageIndex();this._pageIndex!==a&&(this._pageIndex=a,this.setupPage())};Game_Event.prototype.findProperPageIndex=function(){for(var a=this.event().pages,b=a.length-1;0<=b;b--)if(this.meetsConditions(a[b]))return b;return-1};
Game_Event.prototype.meetsConditions=function(a){a=a.conditions;return a.switch1Valid&&!$gameSwitches.value(a.switch1Id)||a.switch2Valid&&!$gameSwitches.value(a.switch2Id)||a.variableValid&&$gameVariables.value(a.variableId)<a.variableValue||a.selfSwitchValid&&!0!==$gameSelfSwitches.value([this._mapId,this._eventId,a.selfSwitchCh])||a.itemValid&&!$gameParty.hasItem($dataItems[a.itemId])||a.actorValid&&(a=$gameActors.actor(a.actorId),!$gameParty.members().contains(a))?!1:!0};
Game_Event.prototype.setupPage=function(){0<=this._pageIndex?this.setupPageSettings():this.clearPageSettings();this.refreshBushDepth();this.clearStartingFlag();this.checkEventTriggerAuto()};Game_Event.prototype.clearPageSettings=function(){this.setImage("",0);this._moveType=0;this._interpreter=this._trigger=null;this.setThrough(!0)};
Game_Event.prototype.setupPageSettings=function(){var a=this.page(),b=a.image;0<b.tileId?this.setTileImage(b.tileId):this.setImage(b.characterName,b.characterIndex);this._originalDirection!==b.direction&&(this._originalDirection=b.direction,this._prelockDirection=0,this.setDirectionFix(!1),this.setDirection(b.direction));this._originalPattern!==b.pattern&&(this._originalPattern=b.pattern,this.setPattern(b.pattern));this.setMoveSpeed(a.moveSpeed);this.setMoveFrequency(a.moveFrequency);this.setPriorityType(a.priorityType);
this.setWalkAnime(a.walkAnime);this.setStepAnime(a.stepAnime);this.setDirectionFix(a.directionFix);this.setThrough(a.through);this.setMoveRoute(a.moveRoute);this._moveType=a.moveType;this._trigger=a.trigger;this._interpreter=4===this._trigger?new Game_Interpreter:null};Game_Event.prototype.isOriginalPattern=function(){return this.pattern()===this._originalPattern};Game_Event.prototype.resetPattern=function(){this.setPattern(this._originalPattern)};
Game_Event.prototype.checkEventTriggerTouch=function(a,b){$gameMap.isEventRunning()||2===this._trigger&&$gamePlayer.pos(a,b)&&!this.isJumping()&&this.isNormalPriority()&&this.start()};Game_Event.prototype.checkEventTriggerAuto=function(){3===this._trigger&&this.start()};Game_Event.prototype.update=function(){Game_Character.prototype.update.call(this);this.checkEventTriggerAuto();this.updateParallel()};
Game_Event.prototype.updateParallel=function(){this._interpreter&&(this._interpreter.isRunning()||this._interpreter.setup(this.list(),this._eventId),this._interpreter.update())};Game_Event.prototype.locate=function(a,b){Game_Character.prototype.locate.call(this,a,b);this._prelockDirection=0};Game_Event.prototype.forceMoveRoute=function(a){Game_Character.prototype.forceMoveRoute.call(this,a);this._prelockDirection=0};function Game_Interpreter(){this.initialize.apply(this,arguments)}
Game_Interpreter.prototype.initialize=function(a){this._depth=a||0;this.checkOverflow();this.clear();this._branch={};this._params=[];this._freezeChecker=this._frameCount=this._indent=0};Game_Interpreter.prototype.checkOverflow=function(){if(100<=this._depth)throw Error("Common event calls exceeded the limit");};
Game_Interpreter.prototype.clear=function(){this._eventId=this._mapId=0;this._list=null;this._waitCount=this._index=0;this._comments=this._waitMode="";this._childInterpreter=this._character=null};Game_Interpreter.prototype.setup=function(a,b){this.clear();this._mapId=$gameMap.mapId();this._eventId=b||0;this._list=a;Game_Interpreter.requestImages(a)};Game_Interpreter.prototype.eventId=function(){return this._eventId};Game_Interpreter.prototype.isOnCurrentMap=function(){return this._mapId===$gameMap.mapId()};
Game_Interpreter.prototype.setupReservedCommonEvent=function(){return $gameTemp.isCommonEventReserved()?(this.setup($gameTemp.reservedCommonEvent().list),$gameTemp.clearCommonEvent(),!0):!1};Game_Interpreter.prototype.isRunning=function(){return!!this._list};Game_Interpreter.prototype.update=function(){for(;this.isRunning()&&!this.updateChild()&&!this.updateWait()&&!SceneManager.isSceneChanging()&&this.executeCommand()&&!this.checkFreeze(););};
Game_Interpreter.prototype.updateChild=function(){if(this._childInterpreter){this._childInterpreter.update();if(this._childInterpreter.isRunning())return!0;this._childInterpreter=null}return!1};Game_Interpreter.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()};Game_Interpreter.prototype.updateWaitCount=function(){return 0<this._waitCount?(this._waitCount--,!0):!1};
Game_Interpreter.prototype.updateWaitMode=function(){var a=!1;switch(this._waitMode){case "message":a=$gameMessage.isBusy();break;case "transfer":a=$gamePlayer.isTransferring();break;case "scroll":a=$gameMap.isScrolling();break;case "route":a=this._character.isMoveRouteForcing();break;case "animation":a=this._character.isAnimationPlaying();break;case "balloon":a=this._character.isBalloonPlaying();break;case "gather":a=$gamePlayer.areFollowersGathering();break;case "action":a=BattleManager.isActionForced();
break;case "video":a=Graphics.isVideoPlaying();break;case "image":a=!ImageManager.isReady()}a||(this._waitMode="");return a};Game_Interpreter.prototype.setWaitMode=function(a){this._waitMode=a};Game_Interpreter.prototype.wait=function(a){this._waitCount=a};Game_Interpreter.prototype.fadeSpeed=function(){return 24};
Game_Interpreter.prototype.executeCommand=function(){var a=this.currentCommand();if(a){this._params=a.parameters;this._indent=a.indent;a="command"+a.code;if("function"===typeof this[a]&&!this[a]())return!1;this._index++}else this.terminate();return!0};Game_Interpreter.prototype.checkFreeze=function(){this._frameCount!==Graphics.frameCount&&(this._frameCount=Graphics.frameCount,this._freezeChecker=0);return 1E5<=this._freezeChecker++?!0:!1};
Game_Interpreter.prototype.terminate=function(){this._list=null;this._comments=""};Game_Interpreter.prototype.skipBranch=function(){for(;this._list[this._index+1].indent>this._indent;)this._index++};Game_Interpreter.prototype.currentCommand=function(){return this._list[this._index]};Game_Interpreter.prototype.nextEventCode=function(){var a=this._list[this._index+1];return a?a.code:0};
Game_Interpreter.prototype.iterateActorId=function(a,b){0===a?$gameParty.members().forEach(b):(a=$gameActors.actor(a))&&b(a)};Game_Interpreter.prototype.iterateActorEx=function(a,b,c){0===a?this.iterateActorId(b,c):this.iterateActorId($gameVariables.value(b),c)};Game_Interpreter.prototype.iterateActorIndex=function(a,b){0>a?$gameParty.members().forEach(b):(a=$gameParty.members()[a])&&b(a)};
Game_Interpreter.prototype.iterateEnemyIndex=function(a,b){0>a?$gameTroop.members().forEach(b):(a=$gameTroop.members()[a])&&b(a)};Game_Interpreter.prototype.iterateBattler=function(a,b,c){$gameParty.inBattle()&&(0===a?this.iterateEnemyIndex(b,c):this.iterateActorId(b,c))};Game_Interpreter.prototype.character=function(a){return $gameParty.inBattle()?null:0>a?$gamePlayer:this.isOnCurrentMap()?$gameMap.event(0<a?a:this._eventId):null};
Game_Interpreter.prototype.operateValue=function(a,b,c){b=0===b?c:$gameVariables.value(c);return 0===a?b:-b};Game_Interpreter.prototype.changeHp=function(a,b,c){a.isAlive()&&(!c&&a.hp<=-b&&(b=1-a.hp),a.gainHp(b),a.isDead()&&a.performCollapse())};
Game_Interpreter.prototype.command101=function(){if(!$gameMessage.isBusy()){$gameMessage.setFaceImage(this._params[0],this._params[1]);$gameMessage.setBackground(this._params[2]);for($gameMessage.setPositionType(this._params[3]);401===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);switch(this.nextEventCode()){case 102:this._index++;this.setupChoices(this.currentCommand().parameters);break;case 103:this._index++;this.setupNumInput(this.currentCommand().parameters);
break;case 104:this._index++,this.setupItemChoice(this.currentCommand().parameters)}this._index++;this.setWaitMode("message")}return!1};Game_Interpreter.prototype.command102=function(){$gameMessage.isBusy()||(this.setupChoices(this._params),this._index++,this.setWaitMode("message"));return!1};
Game_Interpreter.prototype.setupChoices=function(a){var b=a[0].clone(),c=a[1],d=2<a.length?a[2]:0,e=3<a.length?a[3]:2;a=4<a.length?a[4]:0;c>=b.length&&(c=-2);$gameMessage.setChoices(b,d,c);$gameMessage.setChoiceBackground(a);$gameMessage.setChoicePositionType(e);$gameMessage.setChoiceCallback(function(f){this._branch[this._indent]=f}.bind(this))};Game_Interpreter.prototype.command402=function(){this._branch[this._indent]!==this._params[0]&&this.skipBranch();return!0};
Game_Interpreter.prototype.command403=function(){0<=this._branch[this._indent]&&this.skipBranch();return!0};Game_Interpreter.prototype.command103=function(){$gameMessage.isBusy()||(this.setupNumInput(this._params),this._index++,this.setWaitMode("message"));return!1};Game_Interpreter.prototype.setupNumInput=function(a){$gameMessage.setNumberInput(a[0],a[1])};
Game_Interpreter.prototype.command104=function(){$gameMessage.isBusy()||(this.setupItemChoice(this._params),this._index++,this.setWaitMode("message"));return!1};Game_Interpreter.prototype.setupItemChoice=function(a){$gameMessage.setItemChoice(a[0],a[1]||2)};
Game_Interpreter.prototype.command105=function(){if(!$gameMessage.isBusy()){for($gameMessage.setScroll(this._params[0],this._params[1]);405===this.nextEventCode();)this._index++,$gameMessage.add(this.currentCommand().parameters[0]);this._index++;this.setWaitMode("message")}return!1};Game_Interpreter.prototype.command108=function(){for(this._comments=[this._params[0]];408===this.nextEventCode();)this._index++,this._comments.push(this.currentCommand().parameters[0]);return!0};
Game_Interpreter.prototype.command111=function(){var a=!1;switch(this._params[0]){case 0:a=$gameSwitches.value(this._params[1])===(0===this._params[2]);break;case 1:var b=$gameVariables.value(this._params[1]);var c=0===this._params[2]?this._params[3]:$gameVariables.value(this._params[3]);switch(this._params[4]){case 0:a=b===c;break;case 1:a=b>=c;break;case 2:a=b<=c;break;case 3:a=b>c;break;case 4:a=b<c;break;case 5:a=b!==c}break;case 2:0<this._eventId&&(a=$gameSelfSwitches.value([this._mapId,this._eventId,
this._params[1]])===(0===this._params[2]));break;case 3:$gameTimer.isWorking()&&(a=0===this._params[2]?$gameTimer.seconds()>=this._params[1]:$gameTimer.seconds()<=this._params[1]);break;case 4:if(b=$gameActors.actor(this._params[1]))switch(c=this._params[3],this._params[2]){case 0:a=$gameParty.members().contains(b);break;case 1:a=b.name()===c;break;case 2:a=b.isClass($dataClasses[c]);break;case 3:a=b.hasSkill(c);break;case 4:a=b.hasWeapon($dataWeapons[c]);break;case 5:a=b.hasArmor($dataArmors[c]);
break;case 6:a=b.isStateAffected(c)}break;case 5:if(b=$gameTroop.members()[this._params[1]])switch(this._params[2]){case 0:a=b.isAlive();break;case 1:a=b.isStateAffected(this._params[3])}break;case 6:(b=this.character(this._params[1]))&&(a=b.direction()===this._params[2]);break;case 7:switch(this._params[2]){case 0:a=$gameParty.gold()>=this._params[1];break;case 1:a=$gameParty.gold()<=this._params[1];break;case 2:a=$gameParty.gold()<this._params[1]}break;case 8:a=$gameParty.hasItem($dataItems[this._params[1]]);
break;case 9:a=$gameParty.hasItem($dataWeapons[this._params[1]],this._params[2]);break;case 10:a=$gameParty.hasItem($dataArmors[this._params[1]],this._params[2]);break;case 11:a=Input.isPressed(this._params[1]);break;case 12:a=!!eval(this._params[1]);break;case 13:a=$gamePlayer.vehicle()===$gameMap.vehicle(this._params[1])}this._branch[this._indent]=a;!1===this._branch[this._indent]&&this.skipBranch();return!0};
Game_Interpreter.prototype.command411=function(){!1!==this._branch[this._indent]&&this.skipBranch();return!0};Game_Interpreter.prototype.command112=function(){return!0};Game_Interpreter.prototype.command413=function(){do this._index--;while(this.currentCommand().indent!==this._indent);return!0};Game_Interpreter.prototype.command113=function(){for(var a=0;this._index<this._list.length-1;){this._index++;var b=this.currentCommand();112===b.code&&a++;if(413===b.code)if(0<a)a--;else break}return!0};
Game_Interpreter.prototype.command115=function(){this._index=this._list.length;return!0};Game_Interpreter.prototype.command117=function(){var a=$dataCommonEvents[this._params[0]];if(a){var b=this.isOnCurrentMap()?this._eventId:0;this.setupChild(a.list,b)}return!0};Game_Interpreter.prototype.setupChild=function(a,b){this._childInterpreter=new Game_Interpreter(this._depth+1);this._childInterpreter.setup(a,b)};Game_Interpreter.prototype.command118=function(){return!0};
Game_Interpreter.prototype.command119=function(){for(var a=this._params[0],b=0;b<this._list.length;b++){var c=this._list[b];if(118===c.code&&c.parameters[0]===a){this.jumpTo(b);return}}return!0};Game_Interpreter.prototype.jumpTo=function(a){var b=this._index,c=Math.max(a,b),d=this._indent;for(b=Math.min(a,b);b<=c;b++){var e=this._list[b].indent;e!==d&&(this._branch[d]=null,d=e)}this._index=a};
Game_Interpreter.prototype.command121=function(){for(var a=this._params[0];a<=this._params[1];a++)$gameSwitches.setValue(a,0===this._params[2]);return!0};
Game_Interpreter.prototype.command122=function(){var a=0;switch(this._params[3]){case 0:a=this._params[4];break;case 1:a=$gameVariables.value(this._params[4]);break;case 2:a=this._params[5]-this._params[4]+1;for(var b=this._params[0];b<=this._params[1];b++)this.operateVariable(b,this._params[2],this._params[4]+Math.randomInt(a));return!0;case 3:a=this.gameDataOperand(this._params[4],this._params[5],this._params[6]);break;case 4:a=eval(this._params[4])}for(b=this._params[0];b<=this._params[1];b++)this.operateVariable(b,
this._params[2],a);return!0};
Game_Interpreter.prototype.gameDataOperand=function(a,b,c){switch(a){case 0:return $gameParty.numItems($dataItems[b]);case 1:return $gameParty.numItems($dataWeapons[b]);case 2:return $gameParty.numItems($dataArmors[b]);case 3:if(a=$gameActors.actor(b))switch(c){case 0:return a.level;case 1:return a.currentExp();case 2:return a.hp;case 3:return a.mp;default:if(4<=c&&11>=c)return a.param(c-4)}break;case 4:if(a=$gameTroop.members()[b])switch(c){case 0:return a.hp;case 1:return a.mp;default:if(2<=c&&
9>=c)return a.param(c-2)}break;case 5:if(a=this.character(b))switch(c){case 0:return a.x;case 1:return a.y;case 2:return a.direction();case 3:return a.screenX();case 4:return a.screenY()}break;case 6:return(a=$gameParty.members()[b])?a.actorId():0;case 7:switch(b){case 0:return $gameMap.mapId();case 1:return $gameParty.size();case 2:return $gameParty.gold();case 3:return $gameParty.steps();case 4:return $gameSystem.playtime();case 5:return $gameTimer.seconds();case 6:return $gameSystem.saveCount();
case 7:return $gameSystem.battleCount();case 8:return $gameSystem.winCount();case 9:return $gameSystem.escapeCount()}}return 0};
Game_Interpreter.prototype.operateVariable=function(a,b,c){try{var d=$gameVariables.value(a);switch(b){case 0:$gameVariables.setValue(a,c);break;case 1:$gameVariables.setValue(a,d+c);break;case 2:$gameVariables.setValue(a,d-c);break;case 3:$gameVariables.setValue(a,d*c);break;case 4:$gameVariables.setValue(a,d/c);break;case 5:$gameVariables.setValue(a,d%c)}}catch(e){$gameVariables.setValue(a,0)}};
Game_Interpreter.prototype.command123=function(){0<this._eventId&&$gameSelfSwitches.setValue([this._mapId,this._eventId,this._params[0]],0===this._params[1]);return!0};Game_Interpreter.prototype.command124=function(){0===this._params[0]?$gameTimer.start(60*this._params[1]):$gameTimer.stop();return!0};Game_Interpreter.prototype.command125=function(){var a=this.operateValue(this._params[0],this._params[1],this._params[2]);$gameParty.gainGold(a);return!0};
Game_Interpreter.prototype.command126=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);$gameParty.gainItem($dataItems[this._params[0]],a);return!0};Game_Interpreter.prototype.command127=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);$gameParty.gainItem($dataWeapons[this._params[0]],a,this._params[4]);return!0};
Game_Interpreter.prototype.command128=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);$gameParty.gainItem($dataArmors[this._params[0]],a,this._params[4]);return!0};Game_Interpreter.prototype.command129=function(){$gameActors.actor(this._params[0])&&(0===this._params[1]?(this._params[2]&&$gameActors.actor(this._params[0]).setup(this._params[0]),$gameParty.addActor(this._params[0])):$gameParty.removeActor(this._params[0]));return!0};
Game_Interpreter.prototype.command132=function(){$gameSystem.setBattleBgm(this._params[0]);return!0};Game_Interpreter.prototype.command133=function(){$gameSystem.setVictoryMe(this._params[0]);return!0};Game_Interpreter.prototype.command134=function(){0===this._params[0]?$gameSystem.disableSave():$gameSystem.enableSave();return!0};Game_Interpreter.prototype.command135=function(){0===this._params[0]?$gameSystem.disableMenu():$gameSystem.enableMenu();return!0};
Game_Interpreter.prototype.command136=function(){0===this._params[0]?$gameSystem.disableEncounter():$gameSystem.enableEncounter();$gamePlayer.makeEncounterCount();return!0};Game_Interpreter.prototype.command137=function(){0===this._params[0]?$gameSystem.disableFormation():$gameSystem.enableFormation();return!0};Game_Interpreter.prototype.command138=function(){$gameSystem.setWindowTone(this._params[0]);return!0};
Game_Interpreter.prototype.command139=function(){$gameSystem.setDefeatMe(this._params[0]);return!0};Game_Interpreter.prototype.command140=function(){var a=$gameMap.vehicle(this._params[0]);a&&a.setBgm(this._params[1]);return!0};
Game_Interpreter.prototype.command201=function(){if(!$gameParty.inBattle()&&!$gameMessage.isBusy()){if(0===this._params[0]){var a=this._params[1];var b=this._params[2];var c=this._params[3]}else a=$gameVariables.value(this._params[1]),b=$gameVariables.value(this._params[2]),c=$gameVariables.value(this._params[3]);$gamePlayer.reserveTransfer(a,b,c,this._params[4],this._params[5]);this.setWaitMode("transfer");this._index++}return!1};
Game_Interpreter.prototype.command202=function(){if(0===this._params[1]){var a=this._params[2];var b=this._params[3];var c=this._params[4]}else a=$gameVariables.value(this._params[2]),b=$gameVariables.value(this._params[3]),c=$gameVariables.value(this._params[4]);var d=$gameMap.vehicle(this._params[0]);d&&d.setLocation(a,b,c);return!0};
Game_Interpreter.prototype.command203=function(){var a=this.character(this._params[0]);if(a){if(0===this._params[1])a.locate(this._params[2],this._params[3]);else if(1===this._params[1]){var b=$gameVariables.value(this._params[2]),c=$gameVariables.value(this._params[3]);a.locate(b,c)}else(b=this.character(this._params[2]))&&a.swap(b);0<this._params[4]&&a.setDirection(this._params[4])}return!0};
Game_Interpreter.prototype.command204=function(){if(!$gameParty.inBattle()){if($gameMap.isScrolling())return this.setWaitMode("scroll"),!1;$gameMap.startScroll(this._params[0],this._params[1],this._params[2])}return!0};Game_Interpreter.prototype.command205=function(){$gameMap.refreshIfNeeded();if(this._character=this.character(this._params[0]))this._character.forceMoveRoute(this._params[1]),this._params[1].wait&&this.setWaitMode("route");return!0};
Game_Interpreter.prototype.command206=function(){$gamePlayer.getOnOffVehicle();return!0};Game_Interpreter.prototype.command211=function(){$gamePlayer.setTransparent(0===this._params[0]);return!0};Game_Interpreter.prototype.command212=function(){if(this._character=this.character(this._params[0]))this._character.requestAnimation(this._params[1]),this._params[2]&&this.setWaitMode("animation");return!0};
Game_Interpreter.prototype.command213=function(){if(this._character=this.character(this._params[0]))this._character.requestBalloon(this._params[1]),this._params[2]&&this.setWaitMode("balloon");return!0};Game_Interpreter.prototype.command214=function(){this.isOnCurrentMap()&&0<this._eventId&&$gameMap.eraseEvent(this._eventId);return!0};Game_Interpreter.prototype.command216=function(){0===this._params[0]?$gamePlayer.showFollowers():$gamePlayer.hideFollowers();$gamePlayer.refresh();return!0};
Game_Interpreter.prototype.command217=function(){$gameParty.inBattle()||($gamePlayer.gatherFollowers(),this.setWaitMode("gather"));return!0};Game_Interpreter.prototype.command221=function(){$gameMessage.isBusy()||($gameScreen.startFadeOut(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++);return!1};Game_Interpreter.prototype.command222=function(){$gameMessage.isBusy()||($gameScreen.startFadeIn(this.fadeSpeed()),this.wait(this.fadeSpeed()),this._index++);return!1};
Game_Interpreter.prototype.command223=function(){$gameScreen.startTint(this._params[0],this._params[1]);this._params[2]&&this.wait(this._params[1]);return!0};Game_Interpreter.prototype.command224=function(){$gameScreen.startFlash(this._params[0],this._params[1]);this._params[2]&&this.wait(this._params[1]);return!0};Game_Interpreter.prototype.command225=function(){$gameScreen.startShake(this._params[0],this._params[1],this._params[2]);this._params[3]&&this.wait(this._params[2]);return!0};
Game_Interpreter.prototype.command230=function(){this.wait(this._params[0]);return!0};Game_Interpreter.prototype.command231=function(){if(0===this._params[3]){var a=this._params[4];var b=this._params[5]}else a=$gameVariables.value(this._params[4]),b=$gameVariables.value(this._params[5]);$gameScreen.showPicture(this._params[0],this._params[1],this._params[2],a,b,this._params[6],this._params[7],this._params[8],this._params[9]);return!0};
Game_Interpreter.prototype.command232=function(){if(0===this._params[3]){var a=this._params[4];var b=this._params[5]}else a=$gameVariables.value(this._params[4]),b=$gameVariables.value(this._params[5]);$gameScreen.movePicture(this._params[0],this._params[2],a,b,this._params[6],this._params[7],this._params[8],this._params[9],this._params[10]);this._params[11]&&this.wait(this._params[10]);return!0};
Game_Interpreter.prototype.command233=function(){$gameScreen.rotatePicture(this._params[0],this._params[1]);return!0};Game_Interpreter.prototype.command234=function(){$gameScreen.tintPicture(this._params[0],this._params[1],this._params[2]);this._params[3]&&this.wait(this._params[2]);return!0};Game_Interpreter.prototype.command235=function(){$gameScreen.erasePicture(this._params[0]);return!0};
Game_Interpreter.prototype.command236=function(){$gameParty.inBattle()||($gameScreen.changeWeather(this._params[0],this._params[1],this._params[2]),this._params[3]&&this.wait(this._params[2]));return!0};Game_Interpreter.prototype.command241=function(){AudioManager.playBgm(this._params[0]);return!0};Game_Interpreter.prototype.command242=function(){AudioManager.fadeOutBgm(this._params[0]);return!0};Game_Interpreter.prototype.command243=function(){$gameSystem.saveBgm();return!0};
Game_Interpreter.prototype.command244=function(){$gameSystem.replayBgm();return!0};Game_Interpreter.prototype.command245=function(){AudioManager.playBgs(this._params[0]);return!0};Game_Interpreter.prototype.command246=function(){AudioManager.fadeOutBgs(this._params[0]);return!0};Game_Interpreter.prototype.command249=function(){AudioManager.playMe(this._params[0]);return!0};Game_Interpreter.prototype.command250=function(){AudioManager.playSe(this._params[0]);return!0};
Game_Interpreter.prototype.command251=function(){AudioManager.stopSe();return!0};Game_Interpreter.prototype.command261=function(){if(!$gameMessage.isBusy()){var a=this._params[0];if(0<a.length){var b=this.videoFileExt();Graphics.playVideo("movies/"+a+b);this.setWaitMode("video")}this._index++}return!1};Game_Interpreter.prototype.videoFileExt=function(){return Graphics.canPlayVideoType("video/webm")&&!Utils.isMobileDevice()?".webm":".mp4"};
Game_Interpreter.prototype.command281=function(){0===this._params[0]?$gameMap.enableNameDisplay():$gameMap.disableNameDisplay();return!0};
Game_Interpreter.prototype.command282=function(){var a=$dataTilesets[this._params[0]];this._imageReservationId||(this._imageReservationId=Utils.generateRuntimeId());return a.tilesetNames.map(function(b){return ImageManager.reserveTileset(b,0,this._imageReservationId)},this).every(function(b){return b.isReady()})?($gameMap.changeTileset(this._params[0]),ImageManager.releaseReservation(this._imageReservationId),this._imageReservationId=null,!0):!1};
Game_Interpreter.prototype.command283=function(){$gameMap.changeBattleback(this._params[0],this._params[1]);return!0};Game_Interpreter.prototype.command284=function(){$gameMap.changeParallax(this._params[0],this._params[1],this._params[2],this._params[3],this._params[4]);return!0};
Game_Interpreter.prototype.command285=function(){if(0===this._params[2]){var a=this._params[3];var b=this._params[4]}else a=$gameVariables.value(this._params[3]),b=$gameVariables.value(this._params[4]);switch(this._params[1]){case 0:a=$gameMap.terrainTag(a,b);break;case 1:a=$gameMap.eventIdXy(a,b);break;case 2:case 3:case 4:case 5:a=$gameMap.tileId(a,b,this._params[1]-2);break;default:a=$gameMap.regionId(a,b)}$gameVariables.setValue(this._params[0],a);return!0};
Game_Interpreter.prototype.command301=function(){if(!$gameParty.inBattle()){var a=0===this._params[0]?this._params[1]:1===this._params[0]?$gameVariables.value(this._params[1]):$gamePlayer.makeEncounterTroopId();$dataTroops[a]&&(BattleManager.setup(a,this._params[2],this._params[3]),BattleManager.setEventCallback(function(b){this._branch[this._indent]=b}.bind(this)),$gamePlayer.makeEncounterCount(),SceneManager.push(Scene_Battle))}return!0};
Game_Interpreter.prototype.command601=function(){0!==this._branch[this._indent]&&this.skipBranch();return!0};Game_Interpreter.prototype.command602=function(){1!==this._branch[this._indent]&&this.skipBranch();return!0};Game_Interpreter.prototype.command603=function(){2!==this._branch[this._indent]&&this.skipBranch();return!0};
Game_Interpreter.prototype.command302=function(){if(!$gameParty.inBattle()){for(var a=[this._params];605===this.nextEventCode();)this._index++,a.push(this.currentCommand().parameters);SceneManager.push(Scene_Shop);SceneManager.prepareNextScene(a,this._params[4])}return!0};Game_Interpreter.prototype.command303=function(){!$gameParty.inBattle()&&$dataActors[this._params[0]]&&(SceneManager.push(Scene_Name),SceneManager.prepareNextScene(this._params[0],this._params[1]));return!0};
Game_Interpreter.prototype.command311=function(){var a=this.operateValue(this._params[2],this._params[3],this._params[4]);this.iterateActorEx(this._params[0],this._params[1],function(b){this.changeHp(b,a,this._params[5])}.bind(this));return!0};Game_Interpreter.prototype.command312=function(){var a=this.operateValue(this._params[2],this._params[3],this._params[4]);this.iterateActorEx(this._params[0],this._params[1],function(b){b.gainMp(a)}.bind(this));return!0};
Game_Interpreter.prototype.command326=function(){var a=this.operateValue(this._params[2],this._params[3],this._params[4]);this.iterateActorEx(this._params[0],this._params[1],function(b){b.gainTp(a)}.bind(this));return!0};Game_Interpreter.prototype.command313=function(){this.iterateActorEx(this._params[0],this._params[1],function(a){var b=a.isDead();0===this._params[2]?a.addState(this._params[3]):a.removeState(this._params[3]);a.isDead()&&!b&&a.performCollapse();a.clearResult()}.bind(this));return!0};
Game_Interpreter.prototype.command314=function(){this.iterateActorEx(this._params[0],this._params[1],function(a){a.recoverAll()}.bind(this));return!0};Game_Interpreter.prototype.command315=function(){var a=this.operateValue(this._params[2],this._params[3],this._params[4]);this.iterateActorEx(this._params[0],this._params[1],function(b){b.changeExp(b.currentExp()+a,this._params[5])}.bind(this));return!0};
Game_Interpreter.prototype.command316=function(){var a=this.operateValue(this._params[2],this._params[3],this._params[4]);this.iterateActorEx(this._params[0],this._params[1],function(b){b.changeLevel(b.level+a,this._params[5])}.bind(this));return!0};Game_Interpreter.prototype.command317=function(){var a=this.operateValue(this._params[3],this._params[4],this._params[5]);this.iterateActorEx(this._params[0],this._params[1],function(b){b.addParam(this._params[2],a)}.bind(this));return!0};
Game_Interpreter.prototype.command318=function(){this.iterateActorEx(this._params[0],this._params[1],function(a){0===this._params[2]?a.learnSkill(this._params[3]):a.forgetSkill(this._params[3])}.bind(this));return!0};Game_Interpreter.prototype.command319=function(){var a=$gameActors.actor(this._params[0]);a&&a.changeEquipById(this._params[1],this._params[2]);return!0};Game_Interpreter.prototype.command320=function(){var a=$gameActors.actor(this._params[0]);a&&a.setName(this._params[1]);return!0};
Game_Interpreter.prototype.command321=function(){var a=$gameActors.actor(this._params[0]);a&&$dataClasses[this._params[1]]&&a.changeClass(this._params[1],this._params[2]);return!0};Game_Interpreter.prototype.command322=function(){var a=$gameActors.actor(this._params[0]);a&&(a.setCharacterImage(this._params[1],this._params[2]),a.setFaceImage(this._params[3],this._params[4]),a.setBattlerImage(this._params[5]));$gamePlayer.refresh();return!0};
Game_Interpreter.prototype.command323=function(){var a=$gameMap.vehicle(this._params[0]);a&&a.setImage(this._params[1],this._params[2]);return!0};Game_Interpreter.prototype.command324=function(){var a=$gameActors.actor(this._params[0]);a&&a.setNickname(this._params[1]);return!0};Game_Interpreter.prototype.command325=function(){var a=$gameActors.actor(this._params[0]);a&&a.setProfile(this._params[1]);return!0};
Game_Interpreter.prototype.command331=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);this.iterateEnemyIndex(this._params[0],function(b){this.changeHp(b,a,this._params[4])}.bind(this));return!0};Game_Interpreter.prototype.command332=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);this.iterateEnemyIndex(this._params[0],function(b){b.gainMp(a)}.bind(this));return!0};
Game_Interpreter.prototype.command342=function(){var a=this.operateValue(this._params[1],this._params[2],this._params[3]);this.iterateEnemyIndex(this._params[0],function(b){b.gainTp(a)}.bind(this));return!0};Game_Interpreter.prototype.command333=function(){this.iterateEnemyIndex(this._params[0],function(a){var b=a.isDead();0===this._params[1]?a.addState(this._params[2]):a.removeState(this._params[2]);a.isDead()&&!b&&a.performCollapse();a.clearResult()}.bind(this));return!0};
Game_Interpreter.prototype.command334=function(){this.iterateEnemyIndex(this._params[0],function(a){a.recoverAll()}.bind(this));return!0};Game_Interpreter.prototype.command335=function(){this.iterateEnemyIndex(this._params[0],function(a){a.appear();$gameTroop.makeUniqueNames()}.bind(this));return!0};Game_Interpreter.prototype.command336=function(){this.iterateEnemyIndex(this._params[0],function(a){a.transform(this._params[1]);$gameTroop.makeUniqueNames()}.bind(this));return!0};
Game_Interpreter.prototype.command337=function(){1==this._params[2]?this.iterateEnemyIndex(-1,function(a){a.isAlive()&&a.startAnimation(this._params[1],!1,0)}.bind(this)):this.iterateEnemyIndex(this._params[0],function(a){a.isAlive()&&a.startAnimation(this._params[1],!1,0)}.bind(this));return!0};
Game_Interpreter.prototype.command339=function(){this.iterateBattler(this._params[0],this._params[1],function(a){a.isDeathStateAffected()||(a.forceAction(this._params[2],this._params[3]),BattleManager.forceAction(a),this.setWaitMode("action"))}.bind(this));return!0};Game_Interpreter.prototype.command340=function(){BattleManager.abort();return!0};Game_Interpreter.prototype.command351=function(){$gameParty.inBattle()||(SceneManager.push(Scene_Menu),Window_MenuCommand.initCommandPosition());return!0};
Game_Interpreter.prototype.command352=function(){$gameParty.inBattle()||SceneManager.push(Scene_Save);return!0};Game_Interpreter.prototype.command353=function(){SceneManager.goto(Scene_Gameover);return!0};Game_Interpreter.prototype.command354=function(){SceneManager.goto(Scene_Title);return!0};Game_Interpreter.prototype.command355=function(){for(var a=this.currentCommand().parameters[0]+"\n";655===this.nextEventCode();)this._index++,a+=this.currentCommand().parameters[0]+"\n";eval(a);return!0};
Game_Interpreter.prototype.command356=function(){var a=this._params[0].split(" "),b=a.shift();this.pluginCommand(b,a);return!0};Game_Interpreter.prototype.pluginCommand=function(a,b){};
Game_Interpreter.requestImages=function(a,b){a&&a.forEach(function(c){var d=c.parameters;switch(c.code){case 101:ImageManager.requestFace(d[0]);break;case 117:if(c=$dataCommonEvents[d[0]])b||=[],b.contains(d[0])||(b.push(d[0]),Game_Interpreter.requestImages(c.list,b));break;case 129:(c=$gameActors.actor(d[0]))&&0===d[1]&&(d=c.characterName(),ImageManager.requestCharacter(d));break;case 205:d[1]&&d[1].list.forEach(function(f){var g=f.parameters;f.code===Game_Character.ROUTE_CHANGE_IMAGE&&ImageManager.requestCharacter(g[0])});
break;case 212:case 337:if(d[1]){d=$dataAnimations[d[1]];c=d.animation2Name;var e=d.animation2Hue;ImageManager.requestAnimation(d.animation1Name,d.animation1Hue);ImageManager.requestAnimation(c,e)}break;case 216:0===d[0]&&$gamePlayer.followers().forEach(function(f){f=f.characterName();ImageManager.requestCharacter(f)});break;case 231:ImageManager.requestPicture(d[1]);break;case 282:$dataTilesets[d[0]].tilesetNames.forEach(function(f){ImageManager.requestTileset(f)});break;case 283:$gameParty.inBattle()&&
(ImageManager.requestBattleback1(d[0]),ImageManager.requestBattleback2(d[1]));break;case 284:$gameParty.inBattle()||ImageManager.requestParallax(d[0]);break;case 322:ImageManager.requestCharacter(d[1]);ImageManager.requestFace(d[3]);ImageManager.requestSvActor(d[5]);break;case 323:$gameMap.vehicle(d[0])&&ImageManager.requestCharacter(d[1]);break;case 336:c=$dataEnemies[d[1]],d=c.battlerName,c=c.battlerHue,$gameSystem.isSideView()?ImageManager.requestSvEnemy(d,c):ImageManager.requestEnemy(d,c)}})};function Scene_Base(){this.initialize.apply(this,arguments)}Scene_Base.prototype=Object.create(Stage.prototype);Scene_Base.prototype.constructor=Scene_Base;Scene_Base.prototype.initialize=function(){Stage.prototype.initialize.call(this);this._active=!1;this._fadeDuration=this._fadeSign=0;this._fadeSprite=null;this._imageReservationId=Utils.generateRuntimeId()};Scene_Base.prototype.attachReservation=function(){ImageManager.setDefaultReservationId(this._imageReservationId)};
Scene_Base.prototype.detachReservation=function(){ImageManager.releaseReservation(this._imageReservationId)};Scene_Base.prototype.create=function(){};Scene_Base.prototype.isActive=function(){return this._active};Scene_Base.prototype.isReady=function(){return ImageManager.isReady()};Scene_Base.prototype.start=function(){this._active=!0};Scene_Base.prototype.update=function(){this.updateFade();this.updateChildren()};Scene_Base.prototype.stop=function(){this._active=!1};
Scene_Base.prototype.isBusy=function(){return 0<this._fadeDuration};Scene_Base.prototype.terminate=function(){};Scene_Base.prototype.createWindowLayer=function(){var a=Graphics.boxWidth,b=Graphics.boxHeight,c=(Graphics.width-a)/2,d=(Graphics.height-b)/2;this._windowLayer=new WindowLayer;this._windowLayer.move(c,d,a,b);this.addChild(this._windowLayer)};Scene_Base.prototype.addWindow=function(a){this._windowLayer.addChild(a)};
Scene_Base.prototype.startFadeIn=function(a,b){this.createFadeSprite(b);this._fadeSign=1;this._fadeDuration=a||30;this._fadeSprite.opacity=255};Scene_Base.prototype.startFadeOut=function(a,b){this.createFadeSprite(b);this._fadeSign=-1;this._fadeDuration=a||30;this._fadeSprite.opacity=0};Scene_Base.prototype.createFadeSprite=function(a){this._fadeSprite||(this._fadeSprite=new ScreenSprite,this.addChild(this._fadeSprite));a?this._fadeSprite.setWhite():this._fadeSprite.setBlack()};
Scene_Base.prototype.updateFade=function(){if(0<this._fadeDuration){var a=this._fadeDuration;this._fadeSprite.opacity=0<this._fadeSign?this._fadeSprite.opacity-this._fadeSprite.opacity/a:this._fadeSprite.opacity+(255-this._fadeSprite.opacity)/a;this._fadeDuration--}};Scene_Base.prototype.updateChildren=function(){this.children.forEach(function(a){a.update&&a.update()})};Scene_Base.prototype.popScene=function(){SceneManager.pop()};
Scene_Base.prototype.checkGameover=function(){$gameParty.isAllDead()&&SceneManager.goto(Scene_Gameover)};Scene_Base.prototype.fadeOutAll=function(){var a=this.slowFadeSpeed()/60;AudioManager.fadeOutBgm(a);AudioManager.fadeOutBgs(a);AudioManager.fadeOutMe(a);this.startFadeOut(this.slowFadeSpeed())};Scene_Base.prototype.fadeSpeed=function(){return 24};Scene_Base.prototype.slowFadeSpeed=function(){return 2*this.fadeSpeed()};function Scene_Boot(){this.initialize.apply(this,arguments)}
Scene_Boot.prototype=Object.create(Scene_Base.prototype);Scene_Boot.prototype.constructor=Scene_Boot;Scene_Boot.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this);this._startDate=Date.now()};Scene_Boot.prototype.create=function(){Scene_Base.prototype.create.call(this);DataManager.loadDatabase();ConfigManager.load();this.loadSystemWindowImage()};Scene_Boot.prototype.loadSystemWindowImage=function(){ImageManager.reserveSystem("Window")};
Scene_Boot.loadSystemImages=function(){ImageManager.reserveSystem("IconSet");ImageManager.reserveSystem("Balloon");ImageManager.reserveSystem("Shadow1");ImageManager.reserveSystem("Shadow2");ImageManager.reserveSystem("Damage");ImageManager.reserveSystem("States");ImageManager.reserveSystem("Weapons1");ImageManager.reserveSystem("Weapons2");ImageManager.reserveSystem("Weapons3");ImageManager.reserveSystem("ButtonSet")};
Scene_Boot.prototype.isReady=function(){return Scene_Base.prototype.isReady.call(this)?DataManager.isDatabaseLoaded()&&this.isGameFontLoaded():!1};Scene_Boot.prototype.isGameFontLoaded=function(){if(Graphics.isFontLoaded("GameFont"))return!0;if(!Graphics.canUseCssFontLoading()&&6E4<=Date.now()-this._startDate)throw Error("Failed to load GameFont");};
Scene_Boot.prototype.start=function(){Scene_Base.prototype.start.call(this);SoundManager.preloadImportantSounds();DataManager.isBattleTest()?(DataManager.setupBattleTest(),SceneManager.goto(Scene_Battle)):DataManager.isEventTest()?(DataManager.setupEventTest(),SceneManager.goto(Scene_Map)):(this.checkPlayerLocation(),DataManager.setupNewGame(),SceneManager.goto(Scene_Title),Window_TitleCommand.initCommandPosition());this.updateDocumentTitle()};
Scene_Boot.prototype.updateDocumentTitle=function(){document.title=$dataSystem.gameTitle};Scene_Boot.prototype.checkPlayerLocation=function(){if(0===$dataSystem.startMapId)throw Error("Player's starting position is not set");};function Scene_Title(){this.initialize.apply(this,arguments)}Scene_Title.prototype=Object.create(Scene_Base.prototype);Scene_Title.prototype.constructor=Scene_Title;Scene_Title.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)};
Scene_Title.prototype.create=function(){Scene_Base.prototype.create.call(this);this.createBackground();this.createForeground();this.createWindowLayer();this.createCommandWindow()};Scene_Title.prototype.start=function(){Scene_Base.prototype.start.call(this);SceneManager.clearStack();this.centerSprite(this._backSprite1);this.centerSprite(this._backSprite2);this.playTitleMusic();this.startFadeIn(this.fadeSpeed(),!1)};Scene_Title.prototype.update=function(){this.isBusy()||this._commandWindow.open();Scene_Base.prototype.update.call(this)};
Scene_Title.prototype.isBusy=function(){return this._commandWindow.isClosing()||Scene_Base.prototype.isBusy.call(this)};Scene_Title.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this);SceneManager.snapForBackground()};Scene_Title.prototype.createBackground=function(){this._backSprite1=new Sprite(ImageManager.loadTitle1($dataSystem.title1Name));this._backSprite2=new Sprite(ImageManager.loadTitle2($dataSystem.title2Name));this.addChild(this._backSprite1);this.addChild(this._backSprite2)};
Scene_Title.prototype.createForeground=function(){this._gameTitleSprite=new Sprite(new Bitmap(Graphics.width,Graphics.height));this.addChild(this._gameTitleSprite);$dataSystem.optDrawTitle&&this.drawGameTitle()};
Scene_Title.prototype.drawGameTitle=function(){var a=Graphics.height/4,b=Graphics.width-40,c=$dataSystem.gameTitle;this._gameTitleSprite.bitmap.outlineColor="black";this._gameTitleSprite.bitmap.outlineWidth=8;this._gameTitleSprite.bitmap.fontSize=72;this._gameTitleSprite.bitmap.drawText(c,20,a,b,48,"center")};Scene_Title.prototype.centerSprite=function(a){a.x=Graphics.width/2;a.y=Graphics.height/2;a.anchor.x=.5;a.anchor.y=.5};
Scene_Title.prototype.createCommandWindow=function(){this._commandWindow=new Window_TitleCommand;this._commandWindow.setHandler("newGame",this.commandNewGame.bind(this));this._commandWindow.setHandler("continue",this.commandContinue.bind(this));this._commandWindow.setHandler("options",this.commandOptions.bind(this));this.addWindow(this._commandWindow)};Scene_Title.prototype.commandNewGame=function(){DataManager.setupNewGame();this._commandWindow.close();this.fadeOutAll();SceneManager.goto(Scene_Map)};
Scene_Title.prototype.commandContinue=function(){this._commandWindow.close();SceneManager.push(Scene_Load)};Scene_Title.prototype.commandOptions=function(){this._commandWindow.close();SceneManager.push(Scene_Options)};Scene_Title.prototype.playTitleMusic=function(){AudioManager.playBgm($dataSystem.titleBgm);AudioManager.stopBgs();AudioManager.stopMe()};function Scene_Map(){this.initialize.apply(this,arguments)}Scene_Map.prototype=Object.create(Scene_Base.prototype);
Scene_Map.prototype.constructor=Scene_Map;Scene_Map.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this);this._encounterEffectDuration=this._waitCount=0;this._mapLoaded=!1;this._touchCount=0};Scene_Map.prototype.create=function(){Scene_Base.prototype.create.call(this);var a=(this._transfer=$gamePlayer.isTransferring())?$gamePlayer.newMapId():$gameMap.mapId();DataManager.loadMapData(a)};
Scene_Map.prototype.isReady=function(){!this._mapLoaded&&DataManager.isMapLoaded()&&(this.onMapLoaded(),this._mapLoaded=!0);return this._mapLoaded&&Scene_Base.prototype.isReady.call(this)};Scene_Map.prototype.onMapLoaded=function(){this._transfer&&$gamePlayer.performTransfer();this.createDisplayObjects()};
Scene_Map.prototype.start=function(){Scene_Base.prototype.start.call(this);SceneManager.clearStack();this._transfer?(this.fadeInForTransfer(),this._mapNameWindow.open(),$gameMap.autoplay()):this.needsFadeIn()&&this.startFadeIn(this.fadeSpeed(),!1);this.menuCalling=!1};Scene_Map.prototype.update=function(){this.updateDestination();this.updateMainMultiply();this.isSceneChangeOk()?this.updateScene():SceneManager.isNextScene(Scene_Battle)&&this.updateEncounterEffect();this.updateWaitCount();Scene_Base.prototype.update.call(this)};
Scene_Map.prototype.updateMainMultiply=function(){this.updateMain();this.isFastForward()&&this.updateMain()};Scene_Map.prototype.updateMain=function(){var a=this.isActive();$gameMap.update(a);$gamePlayer.update(a);$gameTimer.update(a);$gameScreen.update()};Scene_Map.prototype.isFastForward=function(){return $gameMap.isEventRunning()&&!SceneManager.isSceneChanging()&&(Input.isLongPressed("ok")||TouchInput.isLongPressed())};
Scene_Map.prototype.stop=function(){Scene_Base.prototype.stop.call(this);$gamePlayer.straighten();this._mapNameWindow.close();this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):SceneManager.isNextScene(Scene_Map)?this.fadeOutForTransfer():SceneManager.isNextScene(Scene_Battle)&&this.launchBattle()};Scene_Map.prototype.isBusy=function(){return this._messageWindow&&this._messageWindow.isClosing()||0<this._waitCount||0<this._encounterEffectDuration||Scene_Base.prototype.isBusy.call(this)};
Scene_Map.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this);SceneManager.isNextScene(Scene_Battle)?ImageManager.clearRequest():(this._spriteset.update(),this._mapNameWindow.hide(),SceneManager.snapForBackground());SceneManager.isNextScene(Scene_Map)&&ImageManager.clearRequest();$gameScreen.clearZoom();this.removeChild(this._fadeSprite);this.removeChild(this._mapNameWindow);this.removeChild(this._windowLayer);this.removeChild(this._spriteset)};
Scene_Map.prototype.needsFadeIn=function(){return SceneManager.isPreviousScene(Scene_Battle)||SceneManager.isPreviousScene(Scene_Load)};Scene_Map.prototype.needsSlowFadeOut=function(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)};Scene_Map.prototype.updateWaitCount=function(){return 0<this._waitCount?(this._waitCount--,!0):!1};
Scene_Map.prototype.updateDestination=function(){this.isMapTouchOk()?this.processMapTouch():($gameTemp.clearDestination(),this._touchCount=0)};Scene_Map.prototype.isMapTouchOk=function(){return this.isActive()&&$gamePlayer.canMove()};
Scene_Map.prototype.processMapTouch=function(){if(TouchInput.isTriggered()||0<this._touchCount)if(TouchInput.isPressed()){if(0===this._touchCount||15<=this._touchCount){var a=$gameMap.canvasToMapX(TouchInput.x),b=$gameMap.canvasToMapY(TouchInput.y);$gameTemp.setDestination(a,b)}this._touchCount++}else this._touchCount=0};Scene_Map.prototype.isSceneChangeOk=function(){return this.isActive()&&!$gameMessage.isBusy()};
Scene_Map.prototype.updateScene=function(){this.checkGameover();SceneManager.isSceneChanging()||this.updateTransferPlayer();SceneManager.isSceneChanging()||this.updateEncounter();SceneManager.isSceneChanging()||this.updateCallMenu();SceneManager.isSceneChanging()||this.updateCallDebug()};Scene_Map.prototype.createDisplayObjects=function(){this.createSpriteset();this.createMapNameWindow();this.createWindowLayer();this.createAllWindows()};
Scene_Map.prototype.createSpriteset=function(){this._spriteset=new Spriteset_Map;this.addChild(this._spriteset)};Scene_Map.prototype.createAllWindows=function(){this.createMessageWindow();this.createScrollTextWindow()};Scene_Map.prototype.createMapNameWindow=function(){this._mapNameWindow=new Window_MapName;this.addChild(this._mapNameWindow)};
Scene_Map.prototype.createMessageWindow=function(){this._messageWindow=new Window_Message;this.addWindow(this._messageWindow);this._messageWindow.subWindows().forEach(function(a){this.addWindow(a)},this)};Scene_Map.prototype.createScrollTextWindow=function(){this._scrollTextWindow=new Window_ScrollText;this.addWindow(this._scrollTextWindow)};Scene_Map.prototype.updateTransferPlayer=function(){$gamePlayer.isTransferring()&&SceneManager.goto(Scene_Map)};
Scene_Map.prototype.updateEncounter=function(){$gamePlayer.executeEncounter()&&SceneManager.push(Scene_Battle)};Scene_Map.prototype.updateCallMenu=function(){this.isMenuEnabled()?(this.isMenuCalled()&&(this.menuCalling=!0),this.menuCalling&&!$gamePlayer.isMoving()&&this.callMenu()):this.menuCalling=!1};Scene_Map.prototype.isMenuEnabled=function(){return $gameSystem.isMenuEnabled()&&!$gameMap.isEventRunning()};Scene_Map.prototype.isMenuCalled=function(){return Input.isTriggered("menu")||TouchInput.isCancelled()};
Scene_Map.prototype.callMenu=function(){SoundManager.playOk();SceneManager.push(Scene_Menu);Window_MenuCommand.initCommandPosition();$gameTemp.clearDestination();this._mapNameWindow.hide();this._waitCount=2};Scene_Map.prototype.updateCallDebug=function(){this.isDebugCalled()&&SceneManager.push(Scene_Debug)};Scene_Map.prototype.isDebugCalled=function(){return Input.isTriggered("debug")&&$gameTemp.isPlaytest()};
Scene_Map.prototype.fadeInForTransfer=function(){var a=$gamePlayer.fadeType();switch(a){case 0:case 1:this.startFadeIn(this.fadeSpeed(),1===a)}};Scene_Map.prototype.fadeOutForTransfer=function(){var a=$gamePlayer.fadeType();switch(a){case 0:case 1:this.startFadeOut(this.fadeSpeed(),1===a)}};Scene_Map.prototype.launchBattle=function(){BattleManager.saveBgmAndBgs();this.stopAudioOnBattleStart();SoundManager.playBattleStart();this.startEncounterEffect();this._mapNameWindow.hide()};
Scene_Map.prototype.stopAudioOnBattleStart=function(){AudioManager.isCurrentBgm($gameSystem.battleBgm())||AudioManager.stopBgm();AudioManager.stopBgs();AudioManager.stopMe();AudioManager.stopSe()};Scene_Map.prototype.startEncounterEffect=function(){this._spriteset.hideCharacters();this._encounterEffectDuration=this.encounterEffectSpeed()};
Scene_Map.prototype.updateEncounterEffect=function(){if(0<this._encounterEffectDuration){this._encounterEffectDuration--;var a=this.encounterEffectSpeed(),b=a-this._encounterEffectDuration,c=b/a;c=(20*(c-1)*c+5)*c+1;var d=$gamePlayer.screenX(),e=$gamePlayer.screenY()-24;2===b&&($gameScreen.setZoom(d,e,1),this.snapForBattleBackground(),this.startFlashForEncounter(a/2));$gameScreen.setZoom(d,e,c);b===Math.floor(a/6)&&this.startFlashForEncounter(a/2);b===Math.floor(a/2)&&(BattleManager.playBattleBgm(),
this.startFadeOut(this.fadeSpeed()))}};Scene_Map.prototype.snapForBattleBackground=function(){this._windowLayer.visible=!1;SceneManager.snapForBackground();this._windowLayer.visible=!0};Scene_Map.prototype.startFlashForEncounter=function(a){$gameScreen.startFlash([255,255,255,255],a)};Scene_Map.prototype.encounterEffectSpeed=function(){return 60};function Scene_MenuBase(){this.initialize.apply(this,arguments)}Scene_MenuBase.prototype=Object.create(Scene_Base.prototype);
Scene_MenuBase.prototype.constructor=Scene_MenuBase;Scene_MenuBase.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)};Scene_MenuBase.prototype.create=function(){Scene_Base.prototype.create.call(this);this.createBackground();this.updateActor();this.createWindowLayer()};Scene_MenuBase.prototype.actor=function(){return this._actor};Scene_MenuBase.prototype.updateActor=function(){this._actor=$gameParty.menuActor()};
Scene_MenuBase.prototype.createBackground=function(){this._backgroundSprite=new Sprite;this._backgroundSprite.bitmap=SceneManager.backgroundBitmap();this.addChild(this._backgroundSprite)};Scene_MenuBase.prototype.setBackgroundOpacity=function(a){this._backgroundSprite.opacity=a};Scene_MenuBase.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help;this.addWindow(this._helpWindow)};Scene_MenuBase.prototype.nextActor=function(){$gameParty.makeMenuActorNext();this.updateActor();this.onActorChange()};
Scene_MenuBase.prototype.previousActor=function(){$gameParty.makeMenuActorPrevious();this.updateActor();this.onActorChange()};Scene_MenuBase.prototype.onActorChange=function(){};function Scene_Menu(){this.initialize.apply(this,arguments)}Scene_Menu.prototype=Object.create(Scene_MenuBase.prototype);Scene_Menu.prototype.constructor=Scene_Menu;Scene_Menu.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};
Scene_Menu.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createCommandWindow();this.createGoldWindow();this.createStatusWindow()};Scene_Menu.prototype.start=function(){Scene_MenuBase.prototype.start.call(this);this._statusWindow.refresh()};
Scene_Menu.prototype.createCommandWindow=function(){this._commandWindow=new Window_MenuCommand(0,0);this._commandWindow.setHandler("item",this.commandItem.bind(this));this._commandWindow.setHandler("skill",this.commandPersonal.bind(this));this._commandWindow.setHandler("equip",this.commandPersonal.bind(this));this._commandWindow.setHandler("status",this.commandPersonal.bind(this));this._commandWindow.setHandler("formation",this.commandFormation.bind(this));this._commandWindow.setHandler("options",
this.commandOptions.bind(this));this._commandWindow.setHandler("save",this.commandSave.bind(this));this._commandWindow.setHandler("gameEnd",this.commandGameEnd.bind(this));this._commandWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._commandWindow)};Scene_Menu.prototype.createGoldWindow=function(){this._goldWindow=new Window_Gold(0,0);this._goldWindow.y=Graphics.boxHeight-this._goldWindow.height;this.addWindow(this._goldWindow)};
Scene_Menu.prototype.createStatusWindow=function(){this._statusWindow=new Window_MenuStatus(this._commandWindow.width,0);this._statusWindow.reserveFaceImages();this.addWindow(this._statusWindow)};Scene_Menu.prototype.commandItem=function(){SceneManager.push(Scene_Item)};
Scene_Menu.prototype.commandPersonal=function(){this._statusWindow.setFormationMode(!1);this._statusWindow.selectLast();this._statusWindow.activate();this._statusWindow.setHandler("ok",this.onPersonalOk.bind(this));this._statusWindow.setHandler("cancel",this.onPersonalCancel.bind(this))};
Scene_Menu.prototype.commandFormation=function(){this._statusWindow.setFormationMode(!0);this._statusWindow.selectLast();this._statusWindow.activate();this._statusWindow.setHandler("ok",this.onFormationOk.bind(this));this._statusWindow.setHandler("cancel",this.onFormationCancel.bind(this))};Scene_Menu.prototype.commandOptions=function(){SceneManager.push(Scene_Options)};Scene_Menu.prototype.commandSave=function(){SceneManager.push(Scene_Save)};Scene_Menu.prototype.commandGameEnd=function(){SceneManager.push(Scene_GameEnd)};
Scene_Menu.prototype.onPersonalOk=function(){switch(this._commandWindow.currentSymbol()){case "skill":SceneManager.push(Scene_Skill);break;case "equip":SceneManager.push(Scene_Equip);break;case "status":SceneManager.push(Scene_Status)}};Scene_Menu.prototype.onPersonalCancel=function(){this._statusWindow.deselect();this._commandWindow.activate()};
Scene_Menu.prototype.onFormationOk=function(){var a=this._statusWindow.index();$gameParty.members();var b=this._statusWindow.pendingIndex();0<=b?($gameParty.swapOrder(a,b),this._statusWindow.setPendingIndex(-1),this._statusWindow.redrawItem(a)):this._statusWindow.setPendingIndex(a);this._statusWindow.activate()};
Scene_Menu.prototype.onFormationCancel=function(){0<=this._statusWindow.pendingIndex()?(this._statusWindow.setPendingIndex(-1),this._statusWindow.activate()):(this._statusWindow.deselect(),this._commandWindow.activate())};function Scene_ItemBase(){this.initialize.apply(this,arguments)}Scene_ItemBase.prototype=Object.create(Scene_MenuBase.prototype);Scene_ItemBase.prototype.constructor=Scene_ItemBase;Scene_ItemBase.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};
Scene_ItemBase.prototype.create=function(){Scene_MenuBase.prototype.create.call(this)};Scene_ItemBase.prototype.createActorWindow=function(){this._actorWindow=new Window_MenuActor;this._actorWindow.setHandler("ok",this.onActorOk.bind(this));this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this));this.addWindow(this._actorWindow)};Scene_ItemBase.prototype.item=function(){return this._itemWindow.item()};Scene_ItemBase.prototype.user=function(){return null};
Scene_ItemBase.prototype.isCursorLeft=function(){return 0===this._itemWindow.index()%2};Scene_ItemBase.prototype.showSubWindow=function(a){a.x=this.isCursorLeft()?Graphics.boxWidth-a.width:0;a.show();a.activate()};Scene_ItemBase.prototype.hideSubWindow=function(a){a.hide();a.deactivate();this.activateItemWindow()};Scene_ItemBase.prototype.onActorOk=function(){this.canUse()?this.useItem():SoundManager.playBuzzer()};Scene_ItemBase.prototype.onActorCancel=function(){this.hideSubWindow(this._actorWindow)};
Scene_ItemBase.prototype.determineItem=function(){var a=new Game_Action(this.user()),b=this.item();a.setItemObject(b);a.isForFriend()?(this.showSubWindow(this._actorWindow),this._actorWindow.selectForItem(this.item())):(this.useItem(),this.activateItemWindow())};Scene_ItemBase.prototype.useItem=function(){this.playSeForItem();this.user().useItem(this.item());this.applyItem();this.checkCommonEvent();this.checkGameover();this._actorWindow.refresh()};
Scene_ItemBase.prototype.activateItemWindow=function(){this._itemWindow.refresh();this._itemWindow.activate()};Scene_ItemBase.prototype.itemTargetActors=function(){var a=new Game_Action(this.user());a.setItemObject(this.item());return a.isForFriend()?a.isForAll()?$gameParty.members():[$gameParty.members()[this._actorWindow.index()]]:[]};Scene_ItemBase.prototype.canUse=function(){return this.user().canUse(this.item())&&this.isItemEffectsValid()};
Scene_ItemBase.prototype.isItemEffectsValid=function(){var a=new Game_Action(this.user());a.setItemObject(this.item());return this.itemTargetActors().some(function(b){return a.testApply(b)},this)};Scene_ItemBase.prototype.applyItem=function(){var a=new Game_Action(this.user());a.setItemObject(this.item());this.itemTargetActors().forEach(function(b){for(var c=0;c<a.numRepeats();c++)a.apply(b)},this);a.applyGlobal()};
Scene_ItemBase.prototype.checkCommonEvent=function(){$gameTemp.isCommonEventReserved()&&SceneManager.goto(Scene_Map)};function Scene_Item(){this.initialize.apply(this,arguments)}Scene_Item.prototype=Object.create(Scene_ItemBase.prototype);Scene_Item.prototype.constructor=Scene_Item;Scene_Item.prototype.initialize=function(){Scene_ItemBase.prototype.initialize.call(this)};
Scene_Item.prototype.create=function(){Scene_ItemBase.prototype.create.call(this);this.createHelpWindow();this.createCategoryWindow();this.createItemWindow();this.createActorWindow()};
Scene_Item.prototype.createCategoryWindow=function(){this._categoryWindow=new Window_ItemCategory;this._categoryWindow.setHelpWindow(this._helpWindow);this._categoryWindow.y=this._helpWindow.height;this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this));this._categoryWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._categoryWindow)};
Scene_Item.prototype.createItemWindow=function(){var a=this._categoryWindow.y+this._categoryWindow.height;this._itemWindow=new Window_ItemList(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this._itemWindow.setHelpWindow(this._helpWindow);this._itemWindow.setHandler("ok",this.onItemOk.bind(this));this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this));this.addWindow(this._itemWindow);this._categoryWindow.setItemWindow(this._itemWindow)};
Scene_Item.prototype.user=function(){for(var a=$gameParty.movableMembers(),b=a[0],c=0,d=0;d<a.length;d++)a[d].pha>c&&(c=a[d].pha,b=a[d]);return b};Scene_Item.prototype.onCategoryOk=function(){this._itemWindow.activate();this._itemWindow.selectLast()};Scene_Item.prototype.onItemOk=function(){$gameParty.setLastItem(this.item());this.determineItem()};Scene_Item.prototype.onItemCancel=function(){this._itemWindow.deselect();this._categoryWindow.activate()};Scene_Item.prototype.playSeForItem=function(){SoundManager.playUseItem()};
Scene_Item.prototype.useItem=function(){Scene_ItemBase.prototype.useItem.call(this);this._itemWindow.redrawCurrentItem()};function Scene_Skill(){this.initialize.apply(this,arguments)}Scene_Skill.prototype=Object.create(Scene_ItemBase.prototype);Scene_Skill.prototype.constructor=Scene_Skill;Scene_Skill.prototype.initialize=function(){Scene_ItemBase.prototype.initialize.call(this)};
Scene_Skill.prototype.create=function(){Scene_ItemBase.prototype.create.call(this);this.createHelpWindow();this.createSkillTypeWindow();this.createStatusWindow();this.createItemWindow();this.createActorWindow()};Scene_Skill.prototype.start=function(){Scene_ItemBase.prototype.start.call(this);this.refreshActor()};
Scene_Skill.prototype.createSkillTypeWindow=function(){this._skillTypeWindow=new Window_SkillType(0,this._helpWindow.height);this._skillTypeWindow.setHelpWindow(this._helpWindow);this._skillTypeWindow.setHandler("skill",this.commandSkill.bind(this));this._skillTypeWindow.setHandler("cancel",this.popScene.bind(this));this._skillTypeWindow.setHandler("pagedown",this.nextActor.bind(this));this._skillTypeWindow.setHandler("pageup",this.previousActor.bind(this));this.addWindow(this._skillTypeWindow)};
Scene_Skill.prototype.createStatusWindow=function(){var a=this._skillTypeWindow.width;this._statusWindow=new Window_SkillStatus(a,this._helpWindow.height,Graphics.boxWidth-a,this._skillTypeWindow.height);this._statusWindow.reserveFaceImages();this.addWindow(this._statusWindow)};
Scene_Skill.prototype.createItemWindow=function(){var a=this._statusWindow.y+this._statusWindow.height;this._itemWindow=new Window_SkillList(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this._itemWindow.setHelpWindow(this._helpWindow);this._itemWindow.setHandler("ok",this.onItemOk.bind(this));this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this));this._skillTypeWindow.setSkillWindow(this._itemWindow);this.addWindow(this._itemWindow)};
Scene_Skill.prototype.refreshActor=function(){var a=this.actor();this._skillTypeWindow.setActor(a);this._statusWindow.setActor(a);this._itemWindow.setActor(a)};Scene_Skill.prototype.user=function(){return this.actor()};Scene_Skill.prototype.commandSkill=function(){this._itemWindow.activate();this._itemWindow.selectLast()};Scene_Skill.prototype.onItemOk=function(){this.actor().setLastMenuSkill(this.item());this.determineItem()};
Scene_Skill.prototype.onItemCancel=function(){this._itemWindow.deselect();this._skillTypeWindow.activate()};Scene_Skill.prototype.playSeForItem=function(){SoundManager.playUseSkill()};Scene_Skill.prototype.useItem=function(){Scene_ItemBase.prototype.useItem.call(this);this._statusWindow.refresh();this._itemWindow.refresh()};Scene_Skill.prototype.onActorChange=function(){this.refreshActor();this._skillTypeWindow.activate()};function Scene_Equip(){this.initialize.apply(this,arguments)}
Scene_Equip.prototype=Object.create(Scene_MenuBase.prototype);Scene_Equip.prototype.constructor=Scene_Equip;Scene_Equip.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};Scene_Equip.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createHelpWindow();this.createStatusWindow();this.createCommandWindow();this.createSlotWindow();this.createItemWindow();this.refreshActor()};
Scene_Equip.prototype.createStatusWindow=function(){this._statusWindow=new Window_EquipStatus(0,this._helpWindow.height);this.addWindow(this._statusWindow)};
Scene_Equip.prototype.createCommandWindow=function(){this._commandWindow=new Window_EquipCommand(this._statusWindow.width,this._helpWindow.height,Graphics.boxWidth-this._statusWindow.width);this._commandWindow.setHelpWindow(this._helpWindow);this._commandWindow.setHandler("equip",this.commandEquip.bind(this));this._commandWindow.setHandler("optimize",this.commandOptimize.bind(this));this._commandWindow.setHandler("clear",this.commandClear.bind(this));this._commandWindow.setHandler("cancel",this.popScene.bind(this));
this._commandWindow.setHandler("pagedown",this.nextActor.bind(this));this._commandWindow.setHandler("pageup",this.previousActor.bind(this));this.addWindow(this._commandWindow)};
Scene_Equip.prototype.createSlotWindow=function(){this._slotWindow=new Window_EquipSlot(this._statusWindow.width,this._commandWindow.y+this._commandWindow.height,Graphics.boxWidth-this._statusWindow.width,this._statusWindow.height-this._commandWindow.height);this._slotWindow.setHelpWindow(this._helpWindow);this._slotWindow.setStatusWindow(this._statusWindow);this._slotWindow.setHandler("ok",this.onSlotOk.bind(this));this._slotWindow.setHandler("cancel",this.onSlotCancel.bind(this));this.addWindow(this._slotWindow)};
Scene_Equip.prototype.createItemWindow=function(){var a=this._statusWindow.y+this._statusWindow.height;this._itemWindow=new Window_EquipItem(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this._itemWindow.setHelpWindow(this._helpWindow);this._itemWindow.setStatusWindow(this._statusWindow);this._itemWindow.setHandler("ok",this.onItemOk.bind(this));this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this));this._slotWindow.setItemWindow(this._itemWindow);this.addWindow(this._itemWindow)};
Scene_Equip.prototype.refreshActor=function(){var a=this.actor();this._statusWindow.setActor(a);this._slotWindow.setActor(a);this._itemWindow.setActor(a)};Scene_Equip.prototype.commandEquip=function(){this._slotWindow.activate();this._slotWindow.select(0)};Scene_Equip.prototype.commandOptimize=function(){SoundManager.playEquip();this.actor().optimizeEquipments();this._statusWindow.refresh();this._slotWindow.refresh();this._commandWindow.activate()};
Scene_Equip.prototype.commandClear=function(){SoundManager.playEquip();this.actor().clearEquipments();this._statusWindow.refresh();this._slotWindow.refresh();this._commandWindow.activate()};Scene_Equip.prototype.onSlotOk=function(){this._itemWindow.activate();this._itemWindow.select(0)};Scene_Equip.prototype.onSlotCancel=function(){this._slotWindow.deselect();this._commandWindow.activate()};
Scene_Equip.prototype.onItemOk=function(){SoundManager.playEquip();this.actor().changeEquip(this._slotWindow.index(),this._itemWindow.item());this._slotWindow.activate();this._slotWindow.refresh();this._itemWindow.deselect();this._itemWindow.refresh();this._statusWindow.refresh()};Scene_Equip.prototype.onItemCancel=function(){this._slotWindow.activate();this._itemWindow.deselect()};Scene_Equip.prototype.onActorChange=function(){this.refreshActor();this._commandWindow.activate()};
function Scene_Status(){this.initialize.apply(this,arguments)}Scene_Status.prototype=Object.create(Scene_MenuBase.prototype);Scene_Status.prototype.constructor=Scene_Status;Scene_Status.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};
Scene_Status.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this._statusWindow=new Window_Status;this._statusWindow.setHandler("cancel",this.popScene.bind(this));this._statusWindow.setHandler("pagedown",this.nextActor.bind(this));this._statusWindow.setHandler("pageup",this.previousActor.bind(this));this._statusWindow.reserveFaceImages();this.addWindow(this._statusWindow)};Scene_Status.prototype.start=function(){Scene_MenuBase.prototype.start.call(this);this.refreshActor()};
Scene_Status.prototype.refreshActor=function(){var a=this.actor();this._statusWindow.setActor(a)};Scene_Status.prototype.onActorChange=function(){this.refreshActor();this._statusWindow.activate()};function Scene_Options(){this.initialize.apply(this,arguments)}Scene_Options.prototype=Object.create(Scene_MenuBase.prototype);Scene_Options.prototype.constructor=Scene_Options;Scene_Options.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};
Scene_Options.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createOptionsWindow()};Scene_Options.prototype.terminate=function(){Scene_MenuBase.prototype.terminate.call(this);ConfigManager.save()};Scene_Options.prototype.createOptionsWindow=function(){this._optionsWindow=new Window_Options;this._optionsWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._optionsWindow)};function Scene_File(){this.initialize.apply(this,arguments)}
Scene_File.prototype=Object.create(Scene_MenuBase.prototype);Scene_File.prototype.constructor=Scene_File;Scene_File.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};Scene_File.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);DataManager.loadAllSavefileImages();this.createHelpWindow();this.createListWindow()};Scene_File.prototype.start=function(){Scene_MenuBase.prototype.start.call(this);this._listWindow.refresh()};
Scene_File.prototype.savefileId=function(){return this._listWindow.index()+1};Scene_File.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help(1);this._helpWindow.setText(this.helpWindowText());this.addWindow(this._helpWindow)};
Scene_File.prototype.createListWindow=function(){var a=this._helpWindow.height;this._listWindow=new Window_SavefileList(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this._listWindow.setHandler("ok",this.onSavefileOk.bind(this));this._listWindow.setHandler("cancel",this.popScene.bind(this));this._listWindow.select(this.firstSavefileIndex());this._listWindow.setTopRow(this.firstSavefileIndex()-2);this._listWindow.setMode(this.mode());this._listWindow.refresh();this.addWindow(this._listWindow)};
Scene_File.prototype.mode=function(){return null};Scene_File.prototype.activateListWindow=function(){this._listWindow.activate()};Scene_File.prototype.helpWindowText=function(){return""};Scene_File.prototype.firstSavefileIndex=function(){return 0};Scene_File.prototype.onSavefileOk=function(){};function Scene_Save(){this.initialize.apply(this,arguments)}Scene_Save.prototype=Object.create(Scene_File.prototype);Scene_Save.prototype.constructor=Scene_Save;Scene_Save.prototype.initialize=function(){Scene_File.prototype.initialize.call(this)};
Scene_Save.prototype.mode=function(){return"save"};Scene_Save.prototype.helpWindowText=function(){return TextManager.saveMessage};Scene_Save.prototype.firstSavefileIndex=function(){return DataManager.lastAccessedSavefileId()-1};Scene_Save.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this);$gameSystem.onBeforeSave();if(DataManager.saveGame(this.savefileId()))this.onSaveSuccess();else this.onSaveFailure()};
Scene_Save.prototype.onSaveSuccess=function(){SoundManager.playSave();StorageManager.cleanBackup(this.savefileId());this.popScene()};Scene_Save.prototype.onSaveFailure=function(){SoundManager.playBuzzer();this.activateListWindow()};function Scene_Load(){this.initialize.apply(this,arguments)}Scene_Load.prototype=Object.create(Scene_File.prototype);Scene_Load.prototype.constructor=Scene_Load;Scene_Load.prototype.initialize=function(){Scene_File.prototype.initialize.call(this);this._loadSuccess=!1};
Scene_Load.prototype.terminate=function(){Scene_File.prototype.terminate.call(this);if(this._loadSuccess)$gameSystem.onAfterLoad()};Scene_Load.prototype.mode=function(){return"load"};Scene_Load.prototype.helpWindowText=function(){return TextManager.loadMessage};Scene_Load.prototype.firstSavefileIndex=function(){return DataManager.latestSavefileId()-1};
Scene_Load.prototype.onSavefileOk=function(){Scene_File.prototype.onSavefileOk.call(this);if(DataManager.loadGame(this.savefileId()))this.onLoadSuccess();else this.onLoadFailure()};Scene_Load.prototype.onLoadSuccess=function(){SoundManager.playLoad();this.fadeOutAll();this.reloadMapIfUpdated();SceneManager.goto(Scene_Map);this._loadSuccess=!0};Scene_Load.prototype.onLoadFailure=function(){SoundManager.playBuzzer();this.activateListWindow()};
Scene_Load.prototype.reloadMapIfUpdated=function(){$gameSystem.versionId()!==$dataSystem.versionId&&($gamePlayer.reserveTransfer($gameMap.mapId(),$gamePlayer.x,$gamePlayer.y),$gamePlayer.requestMapReload())};function Scene_GameEnd(){this.initialize.apply(this,arguments)}Scene_GameEnd.prototype=Object.create(Scene_MenuBase.prototype);Scene_GameEnd.prototype.constructor=Scene_GameEnd;Scene_GameEnd.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};
Scene_GameEnd.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createCommandWindow()};Scene_GameEnd.prototype.stop=function(){Scene_MenuBase.prototype.stop.call(this);this._commandWindow.close()};Scene_GameEnd.prototype.createBackground=function(){Scene_MenuBase.prototype.createBackground.call(this);this.setBackgroundOpacity(128)};
Scene_GameEnd.prototype.createCommandWindow=function(){this._commandWindow=new Window_GameEnd;this._commandWindow.setHandler("toTitle",this.commandToTitle.bind(this));this._commandWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._commandWindow)};Scene_GameEnd.prototype.commandToTitle=function(){this.fadeOutAll();SceneManager.goto(Scene_Title)};function Scene_Shop(){this.initialize.apply(this,arguments)}Scene_Shop.prototype=Object.create(Scene_MenuBase.prototype);
Scene_Shop.prototype.constructor=Scene_Shop;Scene_Shop.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};Scene_Shop.prototype.prepare=function(a,b){this._goods=a;this._purchaseOnly=b;this._item=null};
Scene_Shop.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createHelpWindow();this.createGoldWindow();this.createCommandWindow();this.createDummyWindow();this.createNumberWindow();this.createStatusWindow();this.createBuyWindow();this.createCategoryWindow();this.createSellWindow()};Scene_Shop.prototype.createGoldWindow=function(){this._goldWindow=new Window_Gold(0,this._helpWindow.height);this._goldWindow.x=Graphics.boxWidth-this._goldWindow.width;this.addWindow(this._goldWindow)};
Scene_Shop.prototype.createCommandWindow=function(){this._commandWindow=new Window_ShopCommand(this._goldWindow.x,this._purchaseOnly);this._commandWindow.y=this._helpWindow.height;this._commandWindow.setHandler("buy",this.commandBuy.bind(this));this._commandWindow.setHandler("sell",this.commandSell.bind(this));this._commandWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._commandWindow)};
Scene_Shop.prototype.createDummyWindow=function(){var a=this._commandWindow.y+this._commandWindow.height;this._dummyWindow=new Window_Base(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this.addWindow(this._dummyWindow)};
Scene_Shop.prototype.createNumberWindow=function(){this._numberWindow=new Window_ShopNumber(0,this._dummyWindow.y,this._dummyWindow.height);this._numberWindow.hide();this._numberWindow.setHandler("ok",this.onNumberOk.bind(this));this._numberWindow.setHandler("cancel",this.onNumberCancel.bind(this));this.addWindow(this._numberWindow)};
Scene_Shop.prototype.createStatusWindow=function(){var a=this._numberWindow.width;this._statusWindow=new Window_ShopStatus(a,this._dummyWindow.y,Graphics.boxWidth-a,this._dummyWindow.height);this._statusWindow.hide();this.addWindow(this._statusWindow)};
Scene_Shop.prototype.createBuyWindow=function(){this._buyWindow=new Window_ShopBuy(0,this._dummyWindow.y,this._dummyWindow.height,this._goods);this._buyWindow.setHelpWindow(this._helpWindow);this._buyWindow.setStatusWindow(this._statusWindow);this._buyWindow.hide();this._buyWindow.setHandler("ok",this.onBuyOk.bind(this));this._buyWindow.setHandler("cancel",this.onBuyCancel.bind(this));this.addWindow(this._buyWindow)};
Scene_Shop.prototype.createCategoryWindow=function(){this._categoryWindow=new Window_ItemCategory;this._categoryWindow.setHelpWindow(this._helpWindow);this._categoryWindow.y=this._dummyWindow.y;this._categoryWindow.hide();this._categoryWindow.deactivate();this._categoryWindow.setHandler("ok",this.onCategoryOk.bind(this));this._categoryWindow.setHandler("cancel",this.onCategoryCancel.bind(this));this.addWindow(this._categoryWindow)};
Scene_Shop.prototype.createSellWindow=function(){var a=this._categoryWindow.y+this._categoryWindow.height;this._sellWindow=new Window_ShopSell(0,a,Graphics.boxWidth,Graphics.boxHeight-a);this._sellWindow.setHelpWindow(this._helpWindow);this._sellWindow.hide();this._sellWindow.setHandler("ok",this.onSellOk.bind(this));this._sellWindow.setHandler("cancel",this.onSellCancel.bind(this));this._categoryWindow.setItemWindow(this._sellWindow);this.addWindow(this._sellWindow)};
Scene_Shop.prototype.activateBuyWindow=function(){this._buyWindow.setMoney(this.money());this._buyWindow.show();this._buyWindow.activate();this._statusWindow.show()};Scene_Shop.prototype.activateSellWindow=function(){this._categoryWindow.show();this._sellWindow.refresh();this._sellWindow.show();this._sellWindow.activate();this._statusWindow.hide()};Scene_Shop.prototype.commandBuy=function(){this._dummyWindow.hide();this.activateBuyWindow()};
Scene_Shop.prototype.commandSell=function(){this._dummyWindow.hide();this._categoryWindow.show();this._categoryWindow.activate();this._sellWindow.show();this._sellWindow.deselect();this._sellWindow.refresh()};Scene_Shop.prototype.onBuyOk=function(){this._item=this._buyWindow.item();this._buyWindow.hide();this._numberWindow.setup(this._item,this.maxBuy(),this.buyingPrice());this._numberWindow.setCurrencyUnit(this.currencyUnit());this._numberWindow.show();this._numberWindow.activate()};
Scene_Shop.prototype.onBuyCancel=function(){this._commandWindow.activate();this._dummyWindow.show();this._buyWindow.hide();this._statusWindow.hide();this._statusWindow.setItem(null);this._helpWindow.clear()};Scene_Shop.prototype.onCategoryOk=function(){this.activateSellWindow();this._sellWindow.select(0)};Scene_Shop.prototype.onCategoryCancel=function(){this._commandWindow.activate();this._dummyWindow.show();this._categoryWindow.hide();this._sellWindow.hide()};
Scene_Shop.prototype.onSellOk=function(){this._item=this._sellWindow.item();this._categoryWindow.hide();this._sellWindow.hide();this._numberWindow.setup(this._item,this.maxSell(),this.sellingPrice());this._numberWindow.setCurrencyUnit(this.currencyUnit());this._numberWindow.show();this._numberWindow.activate();this._statusWindow.setItem(this._item);this._statusWindow.show()};
Scene_Shop.prototype.onSellCancel=function(){this._sellWindow.deselect();this._categoryWindow.activate();this._statusWindow.setItem(null);this._helpWindow.clear()};Scene_Shop.prototype.onNumberOk=function(){SoundManager.playShop();switch(this._commandWindow.currentSymbol()){case "buy":this.doBuy(this._numberWindow.number());break;case "sell":this.doSell(this._numberWindow.number())}this.endNumberInput();this._goldWindow.refresh();this._statusWindow.refresh()};
Scene_Shop.prototype.onNumberCancel=function(){SoundManager.playCancel();this.endNumberInput()};Scene_Shop.prototype.doBuy=function(a){$gameParty.loseGold(a*this.buyingPrice());$gameParty.gainItem(this._item,a)};Scene_Shop.prototype.doSell=function(a){$gameParty.gainGold(a*this.sellingPrice());$gameParty.loseItem(this._item,a)};Scene_Shop.prototype.endNumberInput=function(){this._numberWindow.hide();switch(this._commandWindow.currentSymbol()){case "buy":this.activateBuyWindow();break;case "sell":this.activateSellWindow()}};
Scene_Shop.prototype.maxBuy=function(){var a=$gameParty.maxItems(this._item)-$gameParty.numItems(this._item),b=this.buyingPrice();return 0<b?Math.min(a,Math.floor(this.money()/b)):a};Scene_Shop.prototype.maxSell=function(){return $gameParty.numItems(this._item)};Scene_Shop.prototype.money=function(){return this._goldWindow.value()};Scene_Shop.prototype.currencyUnit=function(){return this._goldWindow.currencyUnit()};Scene_Shop.prototype.buyingPrice=function(){return this._buyWindow.price(this._item)};
Scene_Shop.prototype.sellingPrice=function(){return Math.floor(this._item.price/2)};function Scene_Name(){this.initialize.apply(this,arguments)}Scene_Name.prototype=Object.create(Scene_MenuBase.prototype);Scene_Name.prototype.constructor=Scene_Name;Scene_Name.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};Scene_Name.prototype.prepare=function(a,b){this._actorId=a;this._maxLength=b};
Scene_Name.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this._actor=$gameActors.actor(this._actorId);this.createEditWindow();this.createInputWindow()};Scene_Name.prototype.start=function(){Scene_MenuBase.prototype.start.call(this);this._editWindow.refresh()};Scene_Name.prototype.createEditWindow=function(){this._editWindow=new Window_NameEdit(this._actor,this._maxLength);this.addWindow(this._editWindow)};
Scene_Name.prototype.createInputWindow=function(){this._inputWindow=new Window_NameInput(this._editWindow);this._inputWindow.setHandler("ok",this.onInputOk.bind(this));this.addWindow(this._inputWindow)};Scene_Name.prototype.onInputOk=function(){this._actor.setName(this._editWindow.name());this.popScene()};function Scene_Debug(){this.initialize.apply(this,arguments)}Scene_Debug.prototype=Object.create(Scene_MenuBase.prototype);Scene_Debug.prototype.constructor=Scene_Debug;
Scene_Debug.prototype.initialize=function(){Scene_MenuBase.prototype.initialize.call(this)};Scene_Debug.prototype.create=function(){Scene_MenuBase.prototype.create.call(this);this.createRangeWindow();this.createEditWindow();this.createDebugHelpWindow()};Scene_Debug.prototype.createRangeWindow=function(){this._rangeWindow=new Window_DebugRange(0,0);this._rangeWindow.setHandler("ok",this.onRangeOk.bind(this));this._rangeWindow.setHandler("cancel",this.popScene.bind(this));this.addWindow(this._rangeWindow)};
Scene_Debug.prototype.createEditWindow=function(){var a=this._rangeWindow.width;this._editWindow=new Window_DebugEdit(a,0,Graphics.boxWidth-a);this._editWindow.setHandler("cancel",this.onEditCancel.bind(this));this._rangeWindow.setEditWindow(this._editWindow);this.addWindow(this._editWindow)};Scene_Debug.prototype.createDebugHelpWindow=function(){var a=this._editWindow.height;this._debugHelpWindow=new Window_Base(this._editWindow.x,a,this._editWindow.width,Graphics.boxHeight-a);this.addWindow(this._debugHelpWindow)};
Scene_Debug.prototype.onRangeOk=function(){this._editWindow.activate();this._editWindow.select(0);this.refreshHelpWindow()};Scene_Debug.prototype.onEditCancel=function(){this._rangeWindow.activate();this._editWindow.deselect();this.refreshHelpWindow()};Scene_Debug.prototype.refreshHelpWindow=function(){this._debugHelpWindow.contents.clear();this._editWindow.active&&this._debugHelpWindow.drawTextEx(this.helpText(),4,0)};
Scene_Debug.prototype.helpText=function(){return"switch"===this._rangeWindow.mode()?"Enter : ON / OFF":"Left     :  -1\nRight    :  +1\nPageup   : -10\nPagedown : +10"};function Scene_Battle(){this.initialize.apply(this,arguments)}Scene_Battle.prototype=Object.create(Scene_Base.prototype);Scene_Battle.prototype.constructor=Scene_Battle;Scene_Battle.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)};
Scene_Battle.prototype.create=function(){Scene_Base.prototype.create.call(this);this.createDisplayObjects()};Scene_Battle.prototype.start=function(){Scene_Base.prototype.start.call(this);this.startFadeIn(this.fadeSpeed(),!1);BattleManager.playBattleBgm();BattleManager.startBattle()};Scene_Battle.prototype.update=function(){var a=this.isActive();$gameTimer.update(a);$gameScreen.update();this.updateStatusWindow();this.updateWindowPositions();a&&!this.isBusy()&&this.updateBattleProcess();Scene_Base.prototype.update.call(this)};
Scene_Battle.prototype.updateBattleProcess=function(){if(!this.isAnyInputWindowActive()||BattleManager.isAborting()||BattleManager.isBattleEnd())BattleManager.update(),this.changeInputWindow()};Scene_Battle.prototype.isAnyInputWindowActive=function(){return this._partyCommandWindow.active||this._actorCommandWindow.active||this._skillWindow.active||this._itemWindow.active||this._actorWindow.active||this._enemyWindow.active};
Scene_Battle.prototype.changeInputWindow=function(){BattleManager.isInputting()?BattleManager.actor()?this.startActorCommandSelection():this.startPartyCommandSelection():this.endCommandSelection()};Scene_Battle.prototype.stop=function(){Scene_Base.prototype.stop.call(this);this.needsSlowFadeOut()?this.startFadeOut(this.slowFadeSpeed(),!1):this.startFadeOut(this.fadeSpeed(),!1);this._statusWindow.close();this._partyCommandWindow.close();this._actorCommandWindow.close()};
Scene_Battle.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this);$gameParty.onBattleEnd();$gameTroop.onBattleEnd();AudioManager.stopMe();ImageManager.clearRequest()};Scene_Battle.prototype.needsSlowFadeOut=function(){return SceneManager.isNextScene(Scene_Title)||SceneManager.isNextScene(Scene_Gameover)};
Scene_Battle.prototype.updateStatusWindow=function(){$gameMessage.isBusy()?(this._statusWindow.close(),this._partyCommandWindow.close(),this._actorCommandWindow.close()):this.isActive()&&!this._messageWindow.isClosing()&&this._statusWindow.open()};
Scene_Battle.prototype.updateWindowPositions=function(){var a=BattleManager.isInputting()?this._partyCommandWindow.width:this._partyCommandWindow.width/2;this._statusWindow.x<a&&(this._statusWindow.x+=16,this._statusWindow.x>a&&(this._statusWindow.x=a));this._statusWindow.x>a&&(this._statusWindow.x-=16,this._statusWindow.x<a&&(this._statusWindow.x=a))};
Scene_Battle.prototype.createDisplayObjects=function(){this.createSpriteset();this.createWindowLayer();this.createAllWindows();BattleManager.setLogWindow(this._logWindow);BattleManager.setStatusWindow(this._statusWindow);BattleManager.setSpriteset(this._spriteset);this._logWindow.setSpriteset(this._spriteset)};Scene_Battle.prototype.createSpriteset=function(){this._spriteset=new Spriteset_Battle;this.addChild(this._spriteset)};
Scene_Battle.prototype.createAllWindows=function(){this.createLogWindow();this.createStatusWindow();this.createPartyCommandWindow();this.createActorCommandWindow();this.createHelpWindow();this.createSkillWindow();this.createItemWindow();this.createActorWindow();this.createEnemyWindow();this.createMessageWindow();this.createScrollTextWindow()};Scene_Battle.prototype.createLogWindow=function(){this._logWindow=new Window_BattleLog;this.addWindow(this._logWindow)};
Scene_Battle.prototype.createStatusWindow=function(){this._statusWindow=new Window_BattleStatus;this.addWindow(this._statusWindow)};Scene_Battle.prototype.createPartyCommandWindow=function(){this._partyCommandWindow=new Window_PartyCommand;this._partyCommandWindow.setHandler("fight",this.commandFight.bind(this));this._partyCommandWindow.setHandler("escape",this.commandEscape.bind(this));this._partyCommandWindow.deselect();this.addWindow(this._partyCommandWindow)};
Scene_Battle.prototype.createActorCommandWindow=function(){this._actorCommandWindow=new Window_ActorCommand;this._actorCommandWindow.setHandler("attack",this.commandAttack.bind(this));this._actorCommandWindow.setHandler("skill",this.commandSkill.bind(this));this._actorCommandWindow.setHandler("guard",this.commandGuard.bind(this));this._actorCommandWindow.setHandler("item",this.commandItem.bind(this));this._actorCommandWindow.setHandler("cancel",this.selectPreviousCommand.bind(this));this.addWindow(this._actorCommandWindow)};
Scene_Battle.prototype.createHelpWindow=function(){this._helpWindow=new Window_Help;this._helpWindow.visible=!1;this.addWindow(this._helpWindow)};
Scene_Battle.prototype.createSkillWindow=function(){var a=this._helpWindow.y+this._helpWindow.height;this._skillWindow=new Window_BattleSkill(0,a,Graphics.boxWidth,this._statusWindow.y-a);this._skillWindow.setHelpWindow(this._helpWindow);this._skillWindow.setHandler("ok",this.onSkillOk.bind(this));this._skillWindow.setHandler("cancel",this.onSkillCancel.bind(this));this.addWindow(this._skillWindow)};
Scene_Battle.prototype.createItemWindow=function(){var a=this._helpWindow.y+this._helpWindow.height;this._itemWindow=new Window_BattleItem(0,a,Graphics.boxWidth,this._statusWindow.y-a);this._itemWindow.setHelpWindow(this._helpWindow);this._itemWindow.setHandler("ok",this.onItemOk.bind(this));this._itemWindow.setHandler("cancel",this.onItemCancel.bind(this));this.addWindow(this._itemWindow)};
Scene_Battle.prototype.createActorWindow=function(){this._actorWindow=new Window_BattleActor(0,this._statusWindow.y);this._actorWindow.setHandler("ok",this.onActorOk.bind(this));this._actorWindow.setHandler("cancel",this.onActorCancel.bind(this));this.addWindow(this._actorWindow)};
Scene_Battle.prototype.createEnemyWindow=function(){this._enemyWindow=new Window_BattleEnemy(0,this._statusWindow.y);this._enemyWindow.x=Graphics.boxWidth-this._enemyWindow.width;this._enemyWindow.setHandler("ok",this.onEnemyOk.bind(this));this._enemyWindow.setHandler("cancel",this.onEnemyCancel.bind(this));this.addWindow(this._enemyWindow)};
Scene_Battle.prototype.createMessageWindow=function(){this._messageWindow=new Window_Message;this.addWindow(this._messageWindow);this._messageWindow.subWindows().forEach(function(a){this.addWindow(a)},this)};Scene_Battle.prototype.createScrollTextWindow=function(){this._scrollTextWindow=new Window_ScrollText;this.addWindow(this._scrollTextWindow)};Scene_Battle.prototype.refreshStatus=function(){this._statusWindow.refresh()};
Scene_Battle.prototype.startPartyCommandSelection=function(){this.refreshStatus();this._statusWindow.deselect();this._statusWindow.open();this._actorCommandWindow.close();this._partyCommandWindow.setup()};Scene_Battle.prototype.commandFight=function(){this.selectNextCommand()};Scene_Battle.prototype.commandEscape=function(){BattleManager.processEscape();this.changeInputWindow()};
Scene_Battle.prototype.startActorCommandSelection=function(){this._statusWindow.select(BattleManager.actor().index());this._partyCommandWindow.close();this._actorCommandWindow.setup(BattleManager.actor())};Scene_Battle.prototype.commandAttack=function(){BattleManager.inputtingAction().setAttack();this.selectEnemySelection()};
Scene_Battle.prototype.commandSkill=function(){this._skillWindow.setActor(BattleManager.actor());this._skillWindow.setStypeId(this._actorCommandWindow.currentExt());this._skillWindow.refresh();this._skillWindow.show();this._skillWindow.activate()};Scene_Battle.prototype.commandGuard=function(){BattleManager.inputtingAction().setGuard();this.selectNextCommand()};Scene_Battle.prototype.commandItem=function(){this._itemWindow.refresh();this._itemWindow.show();this._itemWindow.activate()};
Scene_Battle.prototype.selectNextCommand=function(){BattleManager.selectNextCommand();this.changeInputWindow()};Scene_Battle.prototype.selectPreviousCommand=function(){BattleManager.selectPreviousCommand();this.changeInputWindow()};Scene_Battle.prototype.selectActorSelection=function(){this._actorWindow.refresh();this._actorWindow.show();this._actorWindow.activate()};
Scene_Battle.prototype.onActorOk=function(){BattleManager.inputtingAction().setTarget(this._actorWindow.index());this._actorWindow.hide();this._skillWindow.hide();this._itemWindow.hide();this.selectNextCommand()};Scene_Battle.prototype.onActorCancel=function(){this._actorWindow.hide();switch(this._actorCommandWindow.currentSymbol()){case "skill":this._skillWindow.show();this._skillWindow.activate();break;case "item":this._itemWindow.show(),this._itemWindow.activate()}};
Scene_Battle.prototype.selectEnemySelection=function(){this._enemyWindow.refresh();this._enemyWindow.show();this._enemyWindow.select(0);this._enemyWindow.activate()};Scene_Battle.prototype.onEnemyOk=function(){BattleManager.inputtingAction().setTarget(this._enemyWindow.enemyIndex());this._enemyWindow.hide();this._skillWindow.hide();this._itemWindow.hide();this.selectNextCommand()};
Scene_Battle.prototype.onEnemyCancel=function(){this._enemyWindow.hide();switch(this._actorCommandWindow.currentSymbol()){case "attack":this._actorCommandWindow.activate();break;case "skill":this._skillWindow.show();this._skillWindow.activate();break;case "item":this._itemWindow.show(),this._itemWindow.activate()}};Scene_Battle.prototype.onSkillOk=function(){var a=this._skillWindow.item();BattleManager.inputtingAction().setSkill(a.id);BattleManager.actor().setLastBattleSkill(a);this.onSelectAction()};
Scene_Battle.prototype.onSkillCancel=function(){this._skillWindow.hide();this._actorCommandWindow.activate()};Scene_Battle.prototype.onItemOk=function(){var a=this._itemWindow.item();BattleManager.inputtingAction().setItem(a.id);$gameParty.setLastItem(a);this.onSelectAction()};Scene_Battle.prototype.onItemCancel=function(){this._itemWindow.hide();this._actorCommandWindow.activate()};
Scene_Battle.prototype.onSelectAction=function(){var a=BattleManager.inputtingAction();this._skillWindow.hide();this._itemWindow.hide();a.needsSelection()?a.isForOpponent()?this.selectEnemySelection():this.selectActorSelection():this.selectNextCommand()};Scene_Battle.prototype.endCommandSelection=function(){this._partyCommandWindow.close();this._actorCommandWindow.close();this._statusWindow.deselect()};function Scene_Gameover(){this.initialize.apply(this,arguments)}Scene_Gameover.prototype=Object.create(Scene_Base.prototype);
Scene_Gameover.prototype.constructor=Scene_Gameover;Scene_Gameover.prototype.initialize=function(){Scene_Base.prototype.initialize.call(this)};Scene_Gameover.prototype.create=function(){Scene_Base.prototype.create.call(this);this.playGameoverMusic();this.createBackground()};Scene_Gameover.prototype.start=function(){Scene_Base.prototype.start.call(this);this.startFadeIn(this.slowFadeSpeed(),!1)};
Scene_Gameover.prototype.update=function(){this.isActive()&&!this.isBusy()&&this.isTriggered()&&this.gotoTitle();Scene_Base.prototype.update.call(this)};Scene_Gameover.prototype.stop=function(){Scene_Base.prototype.stop.call(this);this.fadeOutAll()};Scene_Gameover.prototype.terminate=function(){Scene_Base.prototype.terminate.call(this);AudioManager.stopAll()};Scene_Gameover.prototype.playGameoverMusic=function(){AudioManager.stopBgm();AudioManager.stopBgs();AudioManager.playMe($dataSystem.gameoverMe)};
Scene_Gameover.prototype.createBackground=function(){this._backSprite=new Sprite;this._backSprite.bitmap=ImageManager.loadSystem("GameOver");this.addChild(this._backSprite)};Scene_Gameover.prototype.isTriggered=function(){return Input.isTriggered("ok")||TouchInput.isTriggered()};Scene_Gameover.prototype.gotoTitle=function(){SceneManager.goto(Scene_Title)};function Sprite_Base(){this.initialize.apply(this,arguments)}Sprite_Base.prototype=Object.create(Sprite.prototype);Sprite_Base.prototype.constructor=Sprite_Base;Sprite_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this._animationSprites=[];this._effectTarget=this;this._hiding=!1};Sprite_Base.prototype.update=function(){Sprite.prototype.update.call(this);this.updateVisibility();this.updateAnimationSprites()};Sprite_Base.prototype.hide=function(){this._hiding=!0;this.updateVisibility()};
Sprite_Base.prototype.show=function(){this._hiding=!1;this.updateVisibility()};Sprite_Base.prototype.updateVisibility=function(){this.visible=!this._hiding};Sprite_Base.prototype.updateAnimationSprites=function(){if(0<this._animationSprites.length){var a=this._animationSprites.clone();this._animationSprites=[];for(var b=0;b<a.length;b++){var c=a[b];c.isPlaying()?this._animationSprites.push(c):c.remove()}}};
Sprite_Base.prototype.startAnimation=function(a,b,c){var d=new Sprite_Animation;d.setup(this._effectTarget,a,b,c);this.parent.addChild(d);this._animationSprites.push(d)};Sprite_Base.prototype.isAnimationPlaying=function(){return 0<this._animationSprites.length};function Sprite_Button(){this.initialize.apply(this,arguments)}Sprite_Button.prototype=Object.create(Sprite.prototype);Sprite_Button.prototype.constructor=Sprite_Button;
Sprite_Button.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this._touching=!1;this._clickHandler=this._hotFrame=this._coldFrame=null};Sprite_Button.prototype.update=function(){Sprite.prototype.update.call(this);this.updateFrame();this.processTouch()};Sprite_Button.prototype.updateFrame=function(){var a;(a=this._touching?this._hotFrame:this._coldFrame)&&this.setFrame(a.x,a.y,a.width,a.height)};
Sprite_Button.prototype.setColdFrame=function(a,b,c,d){this._coldFrame=new Rectangle(a,b,c,d)};Sprite_Button.prototype.setHotFrame=function(a,b,c,d){this._hotFrame=new Rectangle(a,b,c,d)};Sprite_Button.prototype.setClickHandler=function(a){this._clickHandler=a};Sprite_Button.prototype.callClickHandler=function(){this._clickHandler&&this._clickHandler()};
Sprite_Button.prototype.processTouch=function(){this.isActive()?(TouchInput.isTriggered()&&this.isButtonTouched()&&(this._touching=!0),!this._touching||!TouchInput.isReleased()&&this.isButtonTouched()||(this._touching=!1,TouchInput.isReleased()&&this.callClickHandler())):this._touching=!1};Sprite_Button.prototype.isActive=function(){for(var a=this;a;){if(!a.visible)return!1;a=a.parent}return!0};
Sprite_Button.prototype.isButtonTouched=function(){var a=this.canvasToLocalX(TouchInput.x),b=this.canvasToLocalY(TouchInput.y);return 0<=a&&0<=b&&a<this.width&&b<this.height};Sprite_Button.prototype.canvasToLocalX=function(a){for(var b=this;b;)a-=b.x,b=b.parent;return a};Sprite_Button.prototype.canvasToLocalY=function(a){for(var b=this;b;)a-=b.y,b=b.parent;return a};function Sprite_Character(){this.initialize.apply(this,arguments)}Sprite_Character.prototype=Object.create(Sprite_Base.prototype);
Sprite_Character.prototype.constructor=Sprite_Character;Sprite_Character.prototype.initialize=function(a){Sprite_Base.prototype.initialize.call(this);this.initMembers();this.setCharacter(a)};Sprite_Character.prototype.initMembers=function(){this.anchor.x=.5;this.anchor.y=1;this._character=null;this._tilesetId=this._balloonDuration=0;this._lowerBody=this._upperBody=null};Sprite_Character.prototype.setCharacter=function(a){this._character=a};
Sprite_Character.prototype.update=function(){Sprite_Base.prototype.update.call(this);this.updateBitmap();this.updateFrame();this.updatePosition();this.updateAnimation();this.updateBalloon();this.updateOther()};Sprite_Character.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this);this._character.isTransparent()&&(this.visible=!1)};Sprite_Character.prototype.isTile=function(){return 0<this._character.tileId};
Sprite_Character.prototype.tilesetBitmap=function(a){var b=$gameMap.tileset();return ImageManager.loadTileset(b.tilesetNames[5+Math.floor(a/256)])};Sprite_Character.prototype.updateBitmap=function(){this.isImageChanged()&&(this._tilesetId=$gameMap.tilesetId(),this._tileId=this._character.tileId(),this._characterName=this._character.characterName(),this._characterIndex=this._character.characterIndex(),0<this._tileId?this.setTileBitmap():this.setCharacterBitmap())};
Sprite_Character.prototype.isImageChanged=function(){return this._tilesetId!==$gameMap.tilesetId()||this._tileId!==this._character.tileId()||this._characterName!==this._character.characterName()||this._characterIndex!==this._character.characterIndex()};Sprite_Character.prototype.setTileBitmap=function(){this.bitmap=this.tilesetBitmap(this._tileId)};Sprite_Character.prototype.setCharacterBitmap=function(){this.bitmap=ImageManager.loadCharacter(this._characterName);this._isBigCharacter=ImageManager.isBigCharacter(this._characterName)};
Sprite_Character.prototype.updateFrame=function(){0<this._tileId?this.updateTileFrame():this.updateCharacterFrame()};Sprite_Character.prototype.updateTileFrame=function(){var a=this.patternWidth(),b=this.patternHeight();this.setFrame((Math.floor(this._tileId/128)%2*8+this._tileId%8)*a,Math.floor(this._tileId%256/8)%16*b,a,b)};
Sprite_Character.prototype.updateCharacterFrame=function(){var a=this.patternWidth(),b=this.patternHeight(),c=(this.characterBlockX()+this.characterPatternX())*a,d=(this.characterBlockY()+this.characterPatternY())*b;this.updateHalfBodySprites();if(0<this._bushDepth){var e=this._bushDepth;this._upperBody.setFrame(c,d,a,b-e);this._lowerBody.setFrame(c,d+b-e,a,e);this.setFrame(c,d,0,b)}else this.setFrame(c,d,a,b)};
Sprite_Character.prototype.characterBlockX=function(){return this._isBigCharacter?0:this._character.characterIndex()%4*3};Sprite_Character.prototype.characterBlockY=function(){if(this._isBigCharacter)return 0;var a=this._character.characterIndex();return 4*Math.floor(a/4)};Sprite_Character.prototype.characterPatternX=function(){return this._character.pattern()};Sprite_Character.prototype.characterPatternY=function(){return(this._character.direction()-2)/2};
Sprite_Character.prototype.patternWidth=function(){return 0<this._tileId?$gameMap.tileWidth():this._isBigCharacter?this.bitmap.width/3:this.bitmap.width/12};Sprite_Character.prototype.patternHeight=function(){return 0<this._tileId?$gameMap.tileHeight():this._isBigCharacter?this.bitmap.height/4:this.bitmap.height/8};
Sprite_Character.prototype.updateHalfBodySprites=function(){0<this._bushDepth?(this.createHalfBodySprites(),this._upperBody.bitmap=this.bitmap,this._upperBody.visible=!0,this._upperBody.y=-this._bushDepth,this._lowerBody.bitmap=this.bitmap,this._lowerBody.visible=!0,this._upperBody.setBlendColor(this.getBlendColor()),this._lowerBody.setBlendColor(this.getBlendColor()),this._upperBody.setColorTone(this.getColorTone()),this._lowerBody.setColorTone(this.getColorTone())):this._upperBody&&(this._upperBody.visible=
!1,this._lowerBody.visible=!1)};Sprite_Character.prototype.createHalfBodySprites=function(){this._upperBody||(this._upperBody=new Sprite,this._upperBody.anchor.x=.5,this._upperBody.anchor.y=1,this.addChild(this._upperBody));this._lowerBody||(this._lowerBody=new Sprite,this._lowerBody.anchor.x=.5,this._lowerBody.anchor.y=1,this._lowerBody.opacity=128,this.addChild(this._lowerBody))};
Sprite_Character.prototype.updatePosition=function(){this.x=this._character.screenX();this.y=this._character.screenY();this.z=this._character.screenZ()};Sprite_Character.prototype.updateAnimation=function(){this.setupAnimation();this.isAnimationPlaying()||this._character.endAnimation();this.isBalloonPlaying()||this._character.endBalloon()};Sprite_Character.prototype.updateOther=function(){this.opacity=this._character.opacity();this.blendMode=this._character.blendMode();this._bushDepth=this._character.bushDepth()};
Sprite_Character.prototype.setupAnimation=function(){if(0<this._character.animationId()){var a=$dataAnimations[this._character.animationId()];this.startAnimation(a,!1,0);this._character.startAnimation()}};Sprite_Character.prototype.setupBalloon=function(){0<this._character.balloonId()&&(this.startBalloon(),this._character.startBalloon())};
Sprite_Character.prototype.startBalloon=function(){this._balloonSprite||(this._balloonSprite=new Sprite_Balloon);this._balloonSprite.setup(this._character.balloonId());this.parent.addChild(this._balloonSprite)};Sprite_Character.prototype.updateBalloon=function(){this.setupBalloon();this._balloonSprite&&(this._balloonSprite.x=this.x,this._balloonSprite.y=this.y-this.height,this._balloonSprite.isPlaying()||this.endBalloon())};
Sprite_Character.prototype.endBalloon=function(){this._balloonSprite&&(this.parent.removeChild(this._balloonSprite),this._balloonSprite=null)};Sprite_Character.prototype.isBalloonPlaying=function(){return!!this._balloonSprite};function Sprite_Battler(){this.initialize.apply(this,arguments)}Sprite_Battler.prototype=Object.create(Sprite_Base.prototype);Sprite_Battler.prototype.constructor=Sprite_Battler;
Sprite_Battler.prototype.initialize=function(a){Sprite_Base.prototype.initialize.call(this);this.initMembers();this.setBattler(a)};Sprite_Battler.prototype.initMembers=function(){this.anchor.x=.5;this.anchor.y=1;this._battler=null;this._damages=[];this._offsetY=this._offsetX=this._homeY=this._homeX=0;this._targetOffsetY=this._targetOffsetX=NaN;this._selectionEffectCount=this._movementDuration=0};Sprite_Battler.prototype.setBattler=function(a){this._battler=a};
Sprite_Battler.prototype.setHome=function(a,b){this._homeX=a;this._homeY=b;this.updatePosition()};Sprite_Battler.prototype.update=function(){Sprite_Base.prototype.update.call(this);this._battler?(this.updateMain(),this.updateAnimation(),this.updateDamagePopup(),this.updateSelectionEffect()):this.bitmap=null};Sprite_Battler.prototype.updateVisibility=function(){Sprite_Base.prototype.updateVisibility.call(this);this._battler&&this._battler.isSpriteVisible()||(this.visible=!1)};
Sprite_Battler.prototype.updateMain=function(){this._battler.isSpriteVisible()&&(this.updateBitmap(),this.updateFrame());this.updateMove();this.updatePosition()};Sprite_Battler.prototype.updateBitmap=function(){};Sprite_Battler.prototype.updateFrame=function(){};
Sprite_Battler.prototype.updateMove=function(){if(0<this._movementDuration){var a=this._movementDuration;this._offsetX=(this._offsetX*(a-1)+this._targetOffsetX)/a;this._offsetY=(this._offsetY*(a-1)+this._targetOffsetY)/a;this._movementDuration--;if(0===this._movementDuration)this.onMoveEnd()}};Sprite_Battler.prototype.updatePosition=function(){this.x=this._homeX+this._offsetX;this.y=this._homeY+this._offsetY};Sprite_Battler.prototype.updateAnimation=function(){this.setupAnimation()};
Sprite_Battler.prototype.updateDamagePopup=function(){this.setupDamagePopup();if(0<this._damages.length){for(var a=0;a<this._damages.length;a++)this._damages[a].update();this._damages[0].isPlaying()||(this.parent.removeChild(this._damages[0]),this._damages.shift())}};
Sprite_Battler.prototype.updateSelectionEffect=function(){var a=this._effectTarget;this._battler.isSelected()?(this._selectionEffectCount++,15>this._selectionEffectCount%30?a.setBlendColor([255,255,255,64]):a.setBlendColor([0,0,0,0])):0<this._selectionEffectCount&&(this._selectionEffectCount=0,a.setBlendColor([0,0,0,0]))};
Sprite_Battler.prototype.setupAnimation=function(){for(;this._battler.isAnimationRequested();){var a=this._battler.shiftAnimation(),b=$dataAnimations[a.animationId];this.startAnimation(b,a.mirror,3===b.position?0:a.delay);for(a=0;a<this._animationSprites.length;a++)this._animationSprites[a].visible=this._battler.isSpriteVisible()}};
Sprite_Battler.prototype.setupDamagePopup=function(){if(this._battler.isDamagePopupRequested()){if(this._battler.isSpriteVisible()){var a=new Sprite_Damage;a.x=this.x+this.damageOffsetX();a.y=this.y+this.damageOffsetY();a.setup(this._battler);this._damages.push(a);this.parent.addChild(a)}this._battler.clearDamagePopup();this._battler.clearResult()}};Sprite_Battler.prototype.damageOffsetX=function(){return 0};Sprite_Battler.prototype.damageOffsetY=function(){return 0};
Sprite_Battler.prototype.startMove=function(a,b,c){if(this._targetOffsetX!==a||this._targetOffsetY!==b)this._targetOffsetX=a,this._targetOffsetY=b,this._movementDuration=c,0===c&&(this._offsetX=a,this._offsetY=b)};Sprite_Battler.prototype.onMoveEnd=function(){};Sprite_Battler.prototype.isEffecting=function(){return!1};Sprite_Battler.prototype.isMoving=function(){return 0<this._movementDuration};Sprite_Battler.prototype.inHomePosition=function(){return 0===this._offsetX&&0===this._offsetY};
function Sprite_Actor(){this.initialize.apply(this,arguments)}Sprite_Actor.prototype=Object.create(Sprite_Battler.prototype);Sprite_Actor.prototype.constructor=Sprite_Actor;
Sprite_Actor.MOTIONS={walk:{index:0,loop:!0},wait:{index:1,loop:!0},chant:{index:2,loop:!0},guard:{index:3,loop:!0},damage:{index:4,loop:!1},evade:{index:5,loop:!1},thrust:{index:6,loop:!1},swing:{index:7,loop:!1},missile:{index:8,loop:!1},skill:{index:9,loop:!1},spell:{index:10,loop:!1},item:{index:11,loop:!1},escape:{index:12,loop:!0},victory:{index:13,loop:!0},dying:{index:14,loop:!0},abnormal:{index:15,loop:!0},sleep:{index:16,loop:!0},dead:{index:17,loop:!0}};
Sprite_Actor.prototype.initialize=function(a){Sprite_Battler.prototype.initialize.call(this,a);this.moveToStartPosition()};Sprite_Actor.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this);this._battlerName="";this._motion=null;this._pattern=this._motionCount=0;this.createShadowSprite();this.createWeaponSprite();this.createMainSprite();this.createStateSprite()};
Sprite_Actor.prototype.createMainSprite=function(){this._mainSprite=new Sprite_Base;this._mainSprite.anchor.x=.5;this._mainSprite.anchor.y=1;this.addChild(this._mainSprite);this._effectTarget=this._mainSprite};Sprite_Actor.prototype.createShadowSprite=function(){this._shadowSprite=new Sprite;this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow2");this._shadowSprite.anchor.x=.5;this._shadowSprite.anchor.y=.5;this._shadowSprite.y=-2;this.addChild(this._shadowSprite)};
Sprite_Actor.prototype.createWeaponSprite=function(){this._weaponSprite=new Sprite_Weapon;this.addChild(this._weaponSprite)};Sprite_Actor.prototype.createStateSprite=function(){this._stateSprite=new Sprite_StateOverlay;this.addChild(this._stateSprite)};Sprite_Actor.prototype.setBattler=function(a){Sprite_Battler.prototype.setBattler.call(this,a);a!==this._actor&&((this._actor=a)&&this.setActorHome(a.index()),this.startEntryMotion(),this._stateSprite.setup(a))};
Sprite_Actor.prototype.moveToStartPosition=function(){this.startMove(300,0,0)};Sprite_Actor.prototype.setActorHome=function(a){this.setHome(600+32*a,280+48*a)};Sprite_Actor.prototype.update=function(){Sprite_Battler.prototype.update.call(this);this.updateShadow();this._actor&&this.updateMotion()};Sprite_Actor.prototype.updateShadow=function(){this._shadowSprite.visible=!!this._actor};
Sprite_Actor.prototype.updateMain=function(){Sprite_Battler.prototype.updateMain.call(this);this._actor.isSpriteVisible()&&!this.isMoving()&&this.updateTargetPosition()};Sprite_Actor.prototype.setupMotion=function(){this._actor.isMotionRequested()&&(this.startMotion(this._actor.motionType()),this._actor.clearMotion())};Sprite_Actor.prototype.setupWeaponAnimation=function(){this._actor.isWeaponAnimationRequested()&&(this._weaponSprite.setup(this._actor.weaponImageId()),this._actor.clearWeaponAnimation())};
Sprite_Actor.prototype.startMotion=function(a){a=Sprite_Actor.MOTIONS[a];this._motion!==a&&(this._motion=a,this._pattern=this._motionCount=0)};Sprite_Actor.prototype.updateTargetPosition=function(){this._actor.isInputting()||this._actor.isActing()?this.stepForward():this._actor.canMove()&&BattleManager.isEscaped()?this.retreat():this.inHomePosition()||this.stepBack()};
Sprite_Actor.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var a=this._actor.battlerName();this._battlerName!==a&&(this._battlerName=a,this._mainSprite.bitmap=ImageManager.loadSvActor(a))};
Sprite_Actor.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var a=this._mainSprite.bitmap;if(a){var b=this._motion?this._motion.index:0,c=a.width/9;a=a.height/6;this._mainSprite.setFrame((3*Math.floor(b/6)+(3>this._pattern?this._pattern:1))*c,b%6*a,c,a)}};Sprite_Actor.prototype.updateMove=function(){var a=this._mainSprite.bitmap;a&&!a.isReady()||Sprite_Battler.prototype.updateMove.call(this)};
Sprite_Actor.prototype.updateMotion=function(){this.setupMotion();this.setupWeaponAnimation();this._actor.isMotionRefreshRequested()&&(this.refreshMotion(),this._actor.clearMotion());this.updateMotionCount()};Sprite_Actor.prototype.updateMotionCount=function(){this._motion&&++this._motionCount>=this.motionSpeed()&&(this._motion.loop?this._pattern=(this._pattern+1)%4:2>this._pattern?this._pattern++:this.refreshMotion(),this._motionCount=0)};Sprite_Actor.prototype.motionSpeed=function(){return 12};
Sprite_Actor.prototype.refreshMotion=function(){var a=this._actor,b=Sprite_Actor.MOTIONS.guard;a&&(this._motion!==b||BattleManager.isInputting())&&(b=a.stateMotionIndex(),a.isInputting()||a.isActing()?this.startMotion("walk"):3===b?this.startMotion("dead"):2===b?this.startMotion("sleep"):a.isChanting()?this.startMotion("chant"):a.isGuard()||a.isGuardWaiting()?this.startMotion("guard"):1===b?this.startMotion("abnormal"):a.isDying()?this.startMotion("dying"):a.isUndecided()?this.startMotion("walk"):
this.startMotion("wait"))};Sprite_Actor.prototype.startEntryMotion=function(){this._actor&&this._actor.canMove()?(this.startMotion("walk"),this.startMove(0,0,30)):this.isMoving()||(this.refreshMotion(),this.startMove(0,0,0))};Sprite_Actor.prototype.stepForward=function(){this.startMove(-48,0,12)};Sprite_Actor.prototype.stepBack=function(){this.startMove(0,0,12)};Sprite_Actor.prototype.retreat=function(){this.startMove(300,0,30)};
Sprite_Actor.prototype.onMoveEnd=function(){Sprite_Battler.prototype.onMoveEnd.call(this);BattleManager.isBattleEnd()||this.refreshMotion()};Sprite_Actor.prototype.damageOffsetX=function(){return-32};Sprite_Actor.prototype.damageOffsetY=function(){return 0};function Sprite_Enemy(){this.initialize.apply(this,arguments)}Sprite_Enemy.prototype=Object.create(Sprite_Battler.prototype);Sprite_Enemy.prototype.constructor=Sprite_Enemy;
Sprite_Enemy.prototype.initialize=function(a){Sprite_Battler.prototype.initialize.call(this,a)};Sprite_Enemy.prototype.initMembers=function(){Sprite_Battler.prototype.initMembers.call(this);this._enemy=null;this._appeared=!1;this._battlerName="";this._battlerHue=0;this._effectType=null;this._shake=this._effectDuration=0;this.createStateIconSprite()};Sprite_Enemy.prototype.createStateIconSprite=function(){this._stateIconSprite=new Sprite_StateIcon;this.addChild(this._stateIconSprite)};
Sprite_Enemy.prototype.setBattler=function(a){Sprite_Battler.prototype.setBattler.call(this,a);this._enemy=a;this.setHome(a.screenX(),a.screenY());this._stateIconSprite.setup(a)};Sprite_Enemy.prototype.update=function(){Sprite_Battler.prototype.update.call(this);this._enemy&&(this.updateEffect(),this.updateStateSprite())};
Sprite_Enemy.prototype.updateBitmap=function(){Sprite_Battler.prototype.updateBitmap.call(this);var a=this._enemy.battlerName(),b=this._enemy.battlerHue();if(this._battlerName!==a||this._battlerHue!==b)this._battlerName=a,this._battlerHue=b,this.loadBitmap(a,b),this.initVisibility()};Sprite_Enemy.prototype.loadBitmap=function(a,b){$gameSystem.isSideView()?this.bitmap=ImageManager.loadSvEnemy(a,b):this.bitmap=ImageManager.loadEnemy(a,b)};
Sprite_Enemy.prototype.updateFrame=function(){Sprite_Battler.prototype.updateFrame.call(this);var a=this.bitmap.height;"bossCollapse"===this._effectType&&(a=this._effectDuration);this.setFrame(0,0,this.bitmap.width,a)};Sprite_Enemy.prototype.updatePosition=function(){Sprite_Battler.prototype.updatePosition.call(this);this.x+=this._shake};
Sprite_Enemy.prototype.updateStateSprite=function(){this._stateIconSprite.y=-Math.round(.9*(this.bitmap.height+40));this._stateIconSprite.y<20-this.y&&(this._stateIconSprite.y=20-this.y)};Sprite_Enemy.prototype.initVisibility=function(){this._appeared=this._enemy.isAlive();this._appeared||(this.opacity=0)};
Sprite_Enemy.prototype.setupEffect=function(){this._appeared&&this._enemy.isEffectRequested()&&(this.startEffect(this._enemy.effectType()),this._enemy.clearEffect());!this._appeared&&this._enemy.isAlive()?this.startEffect("appear"):this._appeared&&this._enemy.isHidden()&&this.startEffect("disappear")};
Sprite_Enemy.prototype.startEffect=function(a){this._effectType=a;switch(this._effectType){case "appear":this.startAppear();break;case "disappear":this.startDisappear();break;case "whiten":this.startWhiten();break;case "blink":this.startBlink();break;case "collapse":this.startCollapse();break;case "bossCollapse":this.startBossCollapse();break;case "instantCollapse":this.startInstantCollapse()}this.revertToNormal()};
Sprite_Enemy.prototype.startAppear=function(){this._effectDuration=16;this._appeared=!0};Sprite_Enemy.prototype.startDisappear=function(){this._effectDuration=32;this._appeared=!1};Sprite_Enemy.prototype.startWhiten=function(){this._effectDuration=16};Sprite_Enemy.prototype.startBlink=function(){this._effectDuration=20};Sprite_Enemy.prototype.startCollapse=function(){this._effectDuration=32;this._appeared=!1};
Sprite_Enemy.prototype.startBossCollapse=function(){this._effectDuration=this.bitmap.height;this._appeared=!1};Sprite_Enemy.prototype.startInstantCollapse=function(){this._effectDuration=16;this._appeared=!1};
Sprite_Enemy.prototype.updateEffect=function(){this.setupEffect();if(0<this._effectDuration){this._effectDuration--;switch(this._effectType){case "whiten":this.updateWhiten();break;case "blink":this.updateBlink();break;case "appear":this.updateAppear();break;case "disappear":this.updateDisappear();break;case "collapse":this.updateCollapse();break;case "bossCollapse":this.updateBossCollapse();break;case "instantCollapse":this.updateInstantCollapse()}0===this._effectDuration&&(this._effectType=null)}};
Sprite_Enemy.prototype.isEffecting=function(){return null!==this._effectType};Sprite_Enemy.prototype.revertToNormal=function(){this.blendMode=this._shake=0;this.opacity=255;this.setBlendColor([0,0,0,0])};Sprite_Enemy.prototype.updateWhiten=function(){this.setBlendColor([255,255,255,128-10*(16-this._effectDuration)])};Sprite_Enemy.prototype.updateBlink=function(){this.opacity=5>this._effectDuration%10?255:0};Sprite_Enemy.prototype.updateAppear=function(){this.opacity=16*(16-this._effectDuration)};
Sprite_Enemy.prototype.updateDisappear=function(){this.opacity=256-10*(32-this._effectDuration)};Sprite_Enemy.prototype.updateCollapse=function(){this.blendMode=Graphics.BLEND_ADD;this.setBlendColor([255,128,128,128]);this.opacity*=this._effectDuration/(this._effectDuration+1)};
Sprite_Enemy.prototype.updateBossCollapse=function(){this._shake=this._effectDuration%2*4-2;this.blendMode=Graphics.BLEND_ADD;this.opacity*=this._effectDuration/(this._effectDuration+1);this.setBlendColor([255,255,255,255-this.opacity]);19===this._effectDuration%20&&SoundManager.playBossCollapse2()};Sprite_Enemy.prototype.updateInstantCollapse=function(){this.opacity=0};Sprite_Enemy.prototype.damageOffsetX=function(){return 0};Sprite_Enemy.prototype.damageOffsetY=function(){return-8};
function Sprite_Animation(){this.initialize.apply(this,arguments)}Sprite_Animation.prototype=Object.create(Sprite.prototype);Sprite_Animation.prototype.constructor=Sprite_Animation;Sprite_Animation._checker1={};Sprite_Animation._checker2={};Sprite_Animation.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this._reduceArtifacts=!0;this.initMembers()};
Sprite_Animation.prototype.initMembers=function(){this._animation=this._target=null;this._mirror=!1;this._delay=0;this._rate=4;this._duration=0;this._flashColor=[0,0,0,0];this._hidingDuration=this._screenFlashDuration=this._flashDuration=0;this._bitmap2=this._bitmap1=null;this._cellSprites=[];this._screenFlashSprite=null;this._duplicated=!1;this.z=8};
Sprite_Animation.prototype.setup=function(a,b,c,d){this._target=a;this._animation=b;this._mirror=c;this._delay=d;this._animation&&(this.remove(),this.setupRate(),this.setupDuration(),this.loadBitmaps(),this.createSprites())};Sprite_Animation.prototype.remove=function(){this.parent&&this.parent.removeChild(this)&&(this._target.setBlendColor([0,0,0,0]),this._target.show())};Sprite_Animation.prototype.setupRate=function(){this._rate=4};
Sprite_Animation.prototype.setupDuration=function(){this._duration=this._animation.frames.length*this._rate+1};Sprite_Animation.prototype.update=function(){Sprite.prototype.update.call(this);this.updateMain();this.updateFlash();this.updateScreenFlash();this.updateHiding();Sprite_Animation._checker1={};Sprite_Animation._checker2={}};Sprite_Animation.prototype.updateFlash=function(){if(0<this._flashDuration){var a=this._flashDuration--;this._flashColor[3]*=(a-1)/a;this._target.setBlendColor(this._flashColor)}};
Sprite_Animation.prototype.updateScreenFlash=function(){if(0<this._screenFlashDuration){var a=this._screenFlashDuration--;this._screenFlashSprite&&(this._screenFlashSprite.x=-this.absoluteX(),this._screenFlashSprite.y=-this.absoluteY(),this._screenFlashSprite.opacity*=(a-1)/a,this._screenFlashSprite.visible=0<this._screenFlashDuration)}};Sprite_Animation.prototype.absoluteX=function(){for(var a=0,b=this;b;)a+=b.x,b=b.parent;return a};
Sprite_Animation.prototype.absoluteY=function(){for(var a=0,b=this;b;)a+=b.y,b=b.parent;return a};Sprite_Animation.prototype.updateHiding=function(){0<this._hidingDuration&&(this._hidingDuration--,0===this._hidingDuration&&this._target.show())};Sprite_Animation.prototype.isPlaying=function(){return 0<this._duration};
Sprite_Animation.prototype.loadBitmaps=function(){var a=this._animation.animation2Name,b=this._animation.animation2Hue;this._bitmap1=ImageManager.loadAnimation(this._animation.animation1Name,this._animation.animation1Hue);this._bitmap2=ImageManager.loadAnimation(a,b)};Sprite_Animation.prototype.isReady=function(){return this._bitmap1&&this._bitmap1.isReady()&&this._bitmap2&&this._bitmap2.isReady()};
Sprite_Animation.prototype.createSprites=function(){Sprite_Animation._checker2[this._animation]||(this.createCellSprites(),3===this._animation.position&&(Sprite_Animation._checker2[this._animation]=!0),this.createScreenFlashSprite());Sprite_Animation._checker1[this._animation]?this._duplicated=!0:(this._duplicated=!1,3===this._animation.position&&(Sprite_Animation._checker1[this._animation]=!0))};
Sprite_Animation.prototype.createCellSprites=function(){this._cellSprites=[];for(var a=0;16>a;a++){var b=new Sprite;b.anchor.x=.5;b.anchor.y=.5;this._cellSprites.push(b);this.addChild(b)}};Sprite_Animation.prototype.createScreenFlashSprite=function(){this._screenFlashSprite=new ScreenSprite;this.addChild(this._screenFlashSprite)};
Sprite_Animation.prototype.updateMain=function(){this.isPlaying()&&this.isReady()&&(0<this._delay?this._delay--:(this._duration--,this.updatePosition(),0===this._duration%this._rate&&this.updateFrame()))};
Sprite_Animation.prototype.updatePosition=function(){if(3===this._animation.position)this.x=this.parent.width/2,this.y=this.parent.height/2;else{var a=this._target.parent,b=a?a.parent:null;this.x=this._target.x;this.y=this._target.y;this.parent===b&&(this.x+=a.x,this.y+=a.y);0===this._animation.position?this.y-=this._target.height:1===this._animation.position&&(this.y-=this._target.height/2)}};
Sprite_Animation.prototype.updateFrame=function(){if(0<this._duration){var a=this.currentFrameIndex();this.updateAllCellSprites(this._animation.frames[a]);this._animation.timings.forEach(function(b){b.frame===a&&this.processTimingData(b)},this)}};Sprite_Animation.prototype.currentFrameIndex=function(){return this._animation.frames.length-Math.floor((this._duration+this._rate-1)/this._rate)};
Sprite_Animation.prototype.updateAllCellSprites=function(a){for(var b=0;b<this._cellSprites.length;b++){var c=this._cellSprites[b];b<a.length?this.updateCellSprite(c,a[b]):c.visible=!1}};
Sprite_Animation.prototype.updateCellSprite=function(a,b){var c=b[0];if(0<=c){var d=192*Math.floor(c%100/5),e=this._mirror;a.bitmap=100>c?this._bitmap1:this._bitmap2;a.setFrame(c%5*192,d,192,192);a.x=b[1];a.y=b[2];a.rotation=b[4]*Math.PI/180;a.scale.x=b[3]/100;b[5]&&(a.scale.x*=-1);e&&(a.x*=-1,a.rotation*=-1,a.scale.x*=-1);a.scale.y=b[3]/100;a.opacity=b[6];a.blendMode=b[7];a.visible=!0}else a.visible=!1};
Sprite_Animation.prototype.processTimingData=function(a){var b=a.flashDuration*this._rate;switch(a.flashScope){case 1:this.startFlash(a.flashColor,b);break;case 2:this.startScreenFlash(a.flashColor,b);break;case 3:this.startHiding(b)}!this._duplicated&&a.se&&AudioManager.playSe(a.se)};Sprite_Animation.prototype.startFlash=function(a,b){this._flashColor=a.clone();this._flashDuration=b};
Sprite_Animation.prototype.startScreenFlash=function(a,b){this._screenFlashDuration=b;this._screenFlashSprite&&(this._screenFlashSprite.setColor(a[0],a[1],a[2]),this._screenFlashSprite.opacity=a[3])};Sprite_Animation.prototype.startHiding=function(a){this._hidingDuration=a;this._target.hide()};function Sprite_Damage(){this.initialize.apply(this,arguments)}Sprite_Damage.prototype=Object.create(Sprite.prototype);Sprite_Damage.prototype.constructor=Sprite_Damage;
Sprite_Damage.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this._duration=90;this._flashColor=[0,0,0,0];this._flashDuration=0;this._damageBitmap=ImageManager.loadSystem("Damage")};Sprite_Damage.prototype.setup=function(a){var b=a.result();b.missed||b.evaded?this.createMiss():b.hpAffected?this.createDigits(0,b.hpDamage):a.isAlive()&&0!==b.mpDamage&&this.createDigits(2,b.mpDamage);b.critical&&this.setupCriticalEffect()};
Sprite_Damage.prototype.setupCriticalEffect=function(){this._flashColor=[255,0,0,160];this._flashDuration=60};Sprite_Damage.prototype.digitWidth=function(){return this._damageBitmap?this._damageBitmap.width/10:0};Sprite_Damage.prototype.digitHeight=function(){return this._damageBitmap?this._damageBitmap.height/5:0};Sprite_Damage.prototype.createMiss=function(){var a=this.digitWidth(),b=this.digitHeight(),c=this.createChildSprite();c.setFrame(0,4*b,4*a,b);c.dy=0};
Sprite_Damage.prototype.createDigits=function(a,b){var c=Math.abs(b).toString();a+=0>b?1:0;b=this.digitWidth();for(var d=this.digitHeight(),e=0;e<c.length;e++){var f=this.createChildSprite();f.setFrame(Number(c[e])*b,a*d,b,d);f.x=(e-(c.length-1)/2)*b;f.dy=-e}};Sprite_Damage.prototype.createChildSprite=function(){var a=new Sprite;a.bitmap=this._damageBitmap;a.anchor.x=.5;a.anchor.y=1;a.y=-40;a.ry=a.y;this.addChild(a);return a};
Sprite_Damage.prototype.update=function(){Sprite.prototype.update.call(this);if(0<this._duration){this._duration--;for(var a=0;a<this.children.length;a++)this.updateChild(this.children[a])}this.updateFlash();this.updateOpacity()};Sprite_Damage.prototype.updateChild=function(a){a.dy+=.5;a.ry+=a.dy;0<=a.ry&&(a.ry=0,a.dy*=-.6);a.y=Math.round(a.ry);a.setBlendColor(this._flashColor)};
Sprite_Damage.prototype.updateFlash=function(){if(0<this._flashDuration){var a=this._flashDuration--;this._flashColor[3]*=(a-1)/a}};Sprite_Damage.prototype.updateOpacity=function(){10>this._duration&&(this.opacity=255*this._duration/10)};Sprite_Damage.prototype.isPlaying=function(){return 0<this._duration};function Sprite_StateIcon(){this.initialize.apply(this,arguments)}Sprite_StateIcon.prototype=Object.create(Sprite.prototype);Sprite_StateIcon.prototype.constructor=Sprite_StateIcon;
Sprite_StateIcon.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this.initMembers();this.loadBitmap()};Sprite_StateIcon._iconWidth=32;Sprite_StateIcon._iconHeight=32;Sprite_StateIcon.prototype.initMembers=function(){this._battler=null;this._animationIndex=this._animationCount=this._iconIndex=0;this.anchor.x=.5;this.anchor.y=.5};Sprite_StateIcon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("IconSet");this.setFrame(0,0,0,0)};
Sprite_StateIcon.prototype.setup=function(a){this._battler=a};Sprite_StateIcon.prototype.update=function(){Sprite.prototype.update.call(this);this._animationCount++;this._animationCount>=this.animationWait()&&(this.updateIcon(),this.updateFrame(),this._animationCount=0)};Sprite_StateIcon.prototype.animationWait=function(){return 40};
Sprite_StateIcon.prototype.updateIcon=function(){var a=[];this._battler&&this._battler.isAlive()&&(a=this._battler.allIcons());0<a.length?(this._animationIndex++,this._animationIndex>=a.length&&(this._animationIndex=0),this._iconIndex=a[this._animationIndex]):this._iconIndex=this._animationIndex=0};Sprite_StateIcon.prototype.updateFrame=function(){var a=Sprite_StateIcon._iconWidth,b=Sprite_StateIcon._iconHeight;this.setFrame(this._iconIndex%16*a,Math.floor(this._iconIndex/16)*b,a,b)};
function Sprite_StateOverlay(){this.initialize.apply(this,arguments)}Sprite_StateOverlay.prototype=Object.create(Sprite_Base.prototype);Sprite_StateOverlay.prototype.constructor=Sprite_StateOverlay;Sprite_StateOverlay.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this);this.initMembers();this.loadBitmap()};Sprite_StateOverlay.prototype.initMembers=function(){this._battler=null;this._pattern=this._animationCount=this._overlayIndex=0;this.anchor.x=.5;this.anchor.y=1};
Sprite_StateOverlay.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("States");this.setFrame(0,0,0,0)};Sprite_StateOverlay.prototype.setup=function(a){this._battler=a};Sprite_StateOverlay.prototype.update=function(){Sprite_Base.prototype.update.call(this);this._animationCount++;this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)};Sprite_StateOverlay.prototype.animationWait=function(){return 8};
Sprite_StateOverlay.prototype.updatePattern=function(){this._pattern++;this._pattern%=8;this._battler&&(this._overlayIndex=this._battler.stateOverlayIndex())};Sprite_StateOverlay.prototype.updateFrame=function(){0<this._overlayIndex?this.setFrame(96*this._pattern,96*(this._overlayIndex-1),96,96):this.setFrame(0,0,0,0)};function Sprite_Weapon(){this.initialize.apply(this,arguments)}Sprite_Weapon.prototype=Object.create(Sprite_Base.prototype);Sprite_Weapon.prototype.constructor=Sprite_Weapon;
Sprite_Weapon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this);this.initMembers()};Sprite_Weapon.prototype.initMembers=function(){this._pattern=this._animationCount=this._weaponImageId=0;this.anchor.x=.5;this.anchor.y=1;this.x=-16};Sprite_Weapon.prototype.setup=function(a){this._weaponImageId=a;this._pattern=this._animationCount=0;this.loadBitmap();this.updateFrame()};
Sprite_Weapon.prototype.update=function(){Sprite_Base.prototype.update.call(this);this._animationCount++;this._animationCount>=this.animationWait()&&(this.updatePattern(),this.updateFrame(),this._animationCount=0)};Sprite_Weapon.prototype.animationWait=function(){return 12};Sprite_Weapon.prototype.updatePattern=function(){this._pattern++;3<=this._pattern&&(this._weaponImageId=0)};
Sprite_Weapon.prototype.loadBitmap=function(){var a=Math.floor((this._weaponImageId-1)/12)+1;this.bitmap=1<=a?ImageManager.loadSystem("Weapons"+a):ImageManager.loadSystem("")};Sprite_Weapon.prototype.updateFrame=function(){if(0<this._weaponImageId){var a=(this._weaponImageId-1)%12;this.setFrame(96*(3*Math.floor(a/6)+this._pattern),64*Math.floor(a%6),96,64)}else this.setFrame(0,0,0,0)};Sprite_Weapon.prototype.isPlaying=function(){return 0<this._weaponImageId};
function Sprite_Balloon(){this.initialize.apply(this,arguments)}Sprite_Balloon.prototype=Object.create(Sprite_Base.prototype);Sprite_Balloon.prototype.constructor=Sprite_Balloon;Sprite_Balloon.prototype.initialize=function(){Sprite_Base.prototype.initialize.call(this);this.initMembers();this.loadBitmap()};Sprite_Balloon.prototype.initMembers=function(){this._duration=this._balloonId=0;this.anchor.x=.5;this.anchor.y=1;this.z=7};
Sprite_Balloon.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadSystem("Balloon");this.setFrame(0,0,0,0)};Sprite_Balloon.prototype.setup=function(a){this._balloonId=a;this._duration=8*this.speed()+this.waitTime()};Sprite_Balloon.prototype.update=function(){Sprite_Base.prototype.update.call(this);0<this._duration&&(this._duration--,0<this._duration&&this.updateFrame())};
Sprite_Balloon.prototype.updateFrame=function(){var a=48*this.frameIndex();this.setFrame(a,48*(this._balloonId-1),48,48)};Sprite_Balloon.prototype.speed=function(){return 8};Sprite_Balloon.prototype.waitTime=function(){return 12};Sprite_Balloon.prototype.frameIndex=function(){var a=(this._duration-this.waitTime())/this.speed();return 7-Math.max(Math.floor(a),0)};Sprite_Balloon.prototype.isPlaying=function(){return 0<this._duration};function Sprite_Picture(){this.initialize.apply(this,arguments)}
Sprite_Picture.prototype=Object.create(Sprite.prototype);Sprite_Picture.prototype.constructor=Sprite_Picture;Sprite_Picture.prototype.initialize=function(a){Sprite.prototype.initialize.call(this);this._pictureId=a;this._pictureName="";this._isPicture=!0;this.update()};Sprite_Picture.prototype.picture=function(){return $gameScreen.picture(this._pictureId)};
Sprite_Picture.prototype.update=function(){Sprite.prototype.update.call(this);this.updateBitmap();this.visible&&(this.updateOrigin(),this.updatePosition(),this.updateScale(),this.updateTone(),this.updateOther())};Sprite_Picture.prototype.updateBitmap=function(){var a=this.picture();a?(a=a.name(),this._pictureName!==a&&(this._pictureName=a,this.loadBitmap()),this.visible=!0):(this._pictureName="",this.bitmap=null,this.visible=!1)};
Sprite_Picture.prototype.updateOrigin=function(){0===this.picture().origin()?(this.anchor.x=0,this.anchor.y=0):(this.anchor.x=.5,this.anchor.y=.5)};Sprite_Picture.prototype.updatePosition=function(){var a=this.picture();this.x=Math.floor(a.x());this.y=Math.floor(a.y())};Sprite_Picture.prototype.updateScale=function(){var a=this.picture();this.scale.x=a.scaleX()/100;this.scale.y=a.scaleY()/100};
Sprite_Picture.prototype.updateTone=function(){var a=this.picture();a.tone()?this.setColorTone(a.tone()):this.setColorTone([0,0,0,0])};Sprite_Picture.prototype.updateOther=function(){var a=this.picture();this.opacity=a.opacity();this.blendMode=a.blendMode();this.rotation=a.angle()*Math.PI/180};Sprite_Picture.prototype.loadBitmap=function(){this.bitmap=ImageManager.loadPicture(this._pictureName)};function Sprite_Timer(){this.initialize.apply(this,arguments)}Sprite_Timer.prototype=Object.create(Sprite.prototype);
Sprite_Timer.prototype.constructor=Sprite_Timer;Sprite_Timer.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this._seconds=0;this.createBitmap();this.update()};Sprite_Timer.prototype.createBitmap=function(){this.bitmap=new Bitmap(96,48);this.bitmap.fontSize=32};Sprite_Timer.prototype.update=function(){Sprite.prototype.update.call(this);this.updateBitmap();this.updatePosition();this.updateVisibility()};
Sprite_Timer.prototype.updateBitmap=function(){this._seconds!==$gameTimer.seconds()&&(this._seconds=$gameTimer.seconds(),this.redraw())};Sprite_Timer.prototype.redraw=function(){var a=this.timerText(),b=this.bitmap.width,c=this.bitmap.height;this.bitmap.clear();this.bitmap.drawText(a,0,0,b,c,"center")};Sprite_Timer.prototype.timerText=function(){var a=this._seconds%60;return(Math.floor(this._seconds/60)%60).padZero(2)+":"+a.padZero(2)};
Sprite_Timer.prototype.updatePosition=function(){this.x=Graphics.width-this.bitmap.width;this.y=0};Sprite_Timer.prototype.updateVisibility=function(){this.visible=$gameTimer.isWorking()};function Sprite_Destination(){this.initialize.apply(this,arguments)}Sprite_Destination.prototype=Object.create(Sprite.prototype);Sprite_Destination.prototype.constructor=Sprite_Destination;
Sprite_Destination.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this.createBitmap();this._frameCount=0};Sprite_Destination.prototype.update=function(){Sprite.prototype.update.call(this);$gameTemp.isDestinationValid()?(this.updatePosition(),this.updateAnimation(),this.visible=!0):(this._frameCount=0,this.visible=!1)};
Sprite_Destination.prototype.createBitmap=function(){var a=$gameMap.tileWidth(),b=$gameMap.tileHeight();this.bitmap=new Bitmap(a,b);this.bitmap.fillAll("white");this.anchor.x=.5;this.anchor.y=.5;this.blendMode=Graphics.BLEND_ADD};Sprite_Destination.prototype.updatePosition=function(){var a=$gameMap.tileWidth(),b=$gameMap.tileHeight(),c=$gameTemp.destinationX(),d=$gameTemp.destinationY();this.x=($gameMap.adjustX(c)+.5)*a;this.y=($gameMap.adjustY(d)+.5)*b};
Sprite_Destination.prototype.updateAnimation=function(){this._frameCount++;this._frameCount%=20;this.opacity=6*(20-this._frameCount);this.scale.x=1+this._frameCount/20;this.scale.y=this.scale.x};function Spriteset_Base(){this.initialize.apply(this,arguments)}Spriteset_Base.prototype=Object.create(Sprite.prototype);Spriteset_Base.prototype.constructor=Spriteset_Base;
Spriteset_Base.prototype.initialize=function(){Sprite.prototype.initialize.call(this);this.setFrame(0,0,Graphics.width,Graphics.height);this._tone=[0,0,0,0];this.opaque=!0;this.createLowerLayer();this.createToneChanger();this.createUpperLayer();this.update()};Spriteset_Base.prototype.createLowerLayer=function(){this.createBaseSprite()};Spriteset_Base.prototype.createUpperLayer=function(){this.createPictures();this.createTimer();this.createScreenSprites()};
Spriteset_Base.prototype.update=function(){Sprite.prototype.update.call(this);this.updateScreenSprites();this.updateToneChanger();this.updatePosition()};Spriteset_Base.prototype.createBaseSprite=function(){this._baseSprite=new Sprite;this._baseSprite.setFrame(0,0,this.width,this.height);this._blackScreen=new ScreenSprite;this._blackScreen.opacity=255;this.addChild(this._baseSprite);this._baseSprite.addChild(this._blackScreen)};
Spriteset_Base.prototype.createToneChanger=function(){Graphics.isWebGL()?this.createWebGLToneChanger():this.createCanvasToneChanger()};Spriteset_Base.prototype.createWebGLToneChanger=function(){var a=Graphics.width+96,b=Graphics.height+96;this._toneFilter=new ToneFilter;this._baseSprite.filters=[this._toneFilter];this._baseSprite.filterArea=new Rectangle(-48,-48,a,b)};Spriteset_Base.prototype.createCanvasToneChanger=function(){this._toneSprite=new ToneSprite;this.addChild(this._toneSprite)};
Spriteset_Base.prototype.createPictures=function(){var a=Graphics.boxWidth,b=Graphics.boxHeight,c=(Graphics.width-a)/2,d=(Graphics.height-b)/2;this._pictureContainer=new Sprite;this._pictureContainer.setFrame(c,d,a,b);for(a=1;a<=$gameScreen.maxPictures();a++)this._pictureContainer.addChild(new Sprite_Picture(a));this.addChild(this._pictureContainer)};Spriteset_Base.prototype.createTimer=function(){this._timerSprite=new Sprite_Timer;this.addChild(this._timerSprite)};
Spriteset_Base.prototype.createScreenSprites=function(){this._flashSprite=new ScreenSprite;this._fadeSprite=new ScreenSprite;this.addChild(this._flashSprite);this.addChild(this._fadeSprite)};Spriteset_Base.prototype.updateScreenSprites=function(){var a=$gameScreen.flashColor();this._flashSprite.setColor(a[0],a[1],a[2]);this._flashSprite.opacity=a[3];this._fadeSprite.opacity=255-$gameScreen.brightness()};
Spriteset_Base.prototype.updateToneChanger=function(){var a=$gameScreen.tone();this._tone.equals(a)||(this._tone=a.clone(),Graphics.isWebGL()?this.updateWebGLToneChanger():this.updateCanvasToneChanger())};Spriteset_Base.prototype.updateWebGLToneChanger=function(){var a=this._tone;this._toneFilter.reset();this._toneFilter.adjustTone(a[0],a[1],a[2]);this._toneFilter.adjustSaturation(-a[3])};
Spriteset_Base.prototype.updateCanvasToneChanger=function(){var a=this._tone;this._toneSprite.setTone(a[0],a[1],a[2],a[3])};Spriteset_Base.prototype.updatePosition=function(){var a=$gameScreen,b=a.zoomScale();this.scale.x=b;this.scale.y=b;this.x=Math.round(-a.zoomX()*(b-1));this.y=Math.round(-a.zoomY()*(b-1));this.x+=Math.round(a.shake())};function Spriteset_Map(){this.initialize.apply(this,arguments)}Spriteset_Map.prototype=Object.create(Spriteset_Base.prototype);
Spriteset_Map.prototype.constructor=Spriteset_Map;Spriteset_Map.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this)};Spriteset_Map.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this);this.createParallax();this.createTilemap();this.createCharacters();this.createShadow();this.createDestination();this.createWeather()};
Spriteset_Map.prototype.update=function(){Spriteset_Base.prototype.update.call(this);this.updateTileset();this.updateParallax();this.updateTilemap();this.updateShadow();this.updateWeather()};Spriteset_Map.prototype.hideCharacters=function(){for(var a=0;a<this._characterSprites.length;a++){var b=this._characterSprites[a];b.isTile()||b.hide()}};Spriteset_Map.prototype.createParallax=function(){this._parallax=new TilingSprite;this._parallax.move(0,0,Graphics.width,Graphics.height);this._baseSprite.addChild(this._parallax)};
Spriteset_Map.prototype.createTilemap=function(){Graphics.isWebGL()?this._tilemap=new ShaderTilemap:this._tilemap=new Tilemap;this._tilemap.tileWidth=$gameMap.tileWidth();this._tilemap.tileHeight=$gameMap.tileHeight();this._tilemap.setData($gameMap.width(),$gameMap.height(),$gameMap.data());this._tilemap.horizontalWrap=$gameMap.isLoopHorizontal();this._tilemap.verticalWrap=$gameMap.isLoopVertical();this.loadTileset();this._baseSprite.addChild(this._tilemap)};
Spriteset_Map.prototype.loadTileset=function(){if(this._tileset=$gameMap.tileset()){for(var a=this._tileset.tilesetNames,b=0;b<a.length;b++)this._tilemap.bitmaps[b]=ImageManager.loadTileset(a[b]);a=$gameMap.tilesetFlags();this._tilemap.refreshTileset();this._tilemap.flags.equals(a)||this._tilemap.refresh();this._tilemap.flags=a}};
Spriteset_Map.prototype.createCharacters=function(){this._characterSprites=[];$gameMap.events().forEach(function(b){this._characterSprites.push(new Sprite_Character(b))},this);$gameMap.vehicles().forEach(function(b){this._characterSprites.push(new Sprite_Character(b))},this);$gamePlayer.followers().reverseEach(function(b){this._characterSprites.push(new Sprite_Character(b))},this);this._characterSprites.push(new Sprite_Character($gamePlayer));for(var a=0;a<this._characterSprites.length;a++)this._tilemap.addChild(this._characterSprites[a])};
Spriteset_Map.prototype.createShadow=function(){this._shadowSprite=new Sprite;this._shadowSprite.bitmap=ImageManager.loadSystem("Shadow1");this._shadowSprite.anchor.x=.5;this._shadowSprite.anchor.y=1;this._shadowSprite.z=6;this._tilemap.addChild(this._shadowSprite)};Spriteset_Map.prototype.createDestination=function(){this._destinationSprite=new Sprite_Destination;this._destinationSprite.z=9;this._tilemap.addChild(this._destinationSprite)};
Spriteset_Map.prototype.createWeather=function(){this._weather=new Weather;this.addChild(this._weather)};Spriteset_Map.prototype.updateTileset=function(){this._tileset!==$gameMap.tileset()&&this.loadTileset()};
Spriteset_Map.prototype._canvasReAddParallax=function(){var a=this._baseSprite.children.indexOf(this._parallax);this._baseSprite.removeChild(this._parallax);this._parallax=new TilingSprite;this._parallax.move(0,0,Graphics.width,Graphics.height);this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName);this._baseSprite.addChildAt(this._parallax,a)};
Spriteset_Map.prototype.updateParallax=function(){this._parallaxName!==$gameMap.parallaxName()&&(this._parallaxName=$gameMap.parallaxName(),this._parallax.bitmap&&1!=Graphics.isWebGL()?this._canvasReAddParallax():this._parallax.bitmap=ImageManager.loadParallax(this._parallaxName));this._parallax.bitmap&&(this._parallax.origin.x=$gameMap.parallaxOx(),this._parallax.origin.y=$gameMap.parallaxOy())};
Spriteset_Map.prototype.updateTilemap=function(){this._tilemap.origin.x=$gameMap.displayX()*$gameMap.tileWidth();this._tilemap.origin.y=$gameMap.displayY()*$gameMap.tileHeight()};Spriteset_Map.prototype.updateShadow=function(){var a=$gameMap.airship();this._shadowSprite.x=a.shadowX();this._shadowSprite.y=a.shadowY();this._shadowSprite.opacity=a.shadowOpacity()};
Spriteset_Map.prototype.updateWeather=function(){this._weather.type=$gameScreen.weatherType();this._weather.power=$gameScreen.weatherPower();this._weather.origin.x=$gameMap.displayX()*$gameMap.tileWidth();this._weather.origin.y=$gameMap.displayY()*$gameMap.tileHeight()};function Spriteset_Battle(){this.initialize.apply(this,arguments)}Spriteset_Battle.prototype=Object.create(Spriteset_Base.prototype);Spriteset_Battle.prototype.constructor=Spriteset_Battle;
Spriteset_Battle.prototype.initialize=function(){Spriteset_Base.prototype.initialize.call(this);this._battlebackLocated=!1};Spriteset_Battle.prototype.createLowerLayer=function(){Spriteset_Base.prototype.createLowerLayer.call(this);this.createBackground();this.createBattleField();this.createBattleback();this.createEnemies();this.createActors()};Spriteset_Battle.prototype.createBackground=function(){this._backgroundSprite=new Sprite;this._backgroundSprite.bitmap=SceneManager.backgroundBitmap();this._baseSprite.addChild(this._backgroundSprite)};
Spriteset_Battle.prototype.update=function(){Spriteset_Base.prototype.update.call(this);this.updateActors();this.updateBattleback()};Spriteset_Battle.prototype.createBattleField=function(){var a=Graphics.boxWidth,b=Graphics.boxHeight,c=(Graphics.width-a)/2,d=(Graphics.height-b)/2;this._battleField=new Sprite;this._battleField.setFrame(c,d,a,b);this._battleField.x=c;this._battleField.y=d;this._baseSprite.addChild(this._battleField)};
Spriteset_Battle.prototype.createBattleback=function(){var a=-this._battleField.x-32,b=-this._battleField.y-32,c=Graphics.width+64,d=Graphics.height+64;this._back1Sprite=new TilingSprite;this._back2Sprite=new TilingSprite;this._back1Sprite.bitmap=this.battleback1Bitmap();this._back2Sprite.bitmap=this.battleback2Bitmap();this._back1Sprite.move(a,b,c,d);this._back2Sprite.move(a,b,c,d);this._battleField.addChild(this._back1Sprite);this._battleField.addChild(this._back2Sprite)};
Spriteset_Battle.prototype.updateBattleback=function(){this._battlebackLocated||(this.locateBattleback(),this._battlebackLocated=!0)};Spriteset_Battle.prototype.locateBattleback=function(){var a=this._battleField.width,b=this._battleField.height,c=this._back1Sprite,d=this._back2Sprite;c.origin.x=c.x+(c.bitmap.width-a)/2;d.origin.x=c.y+(d.bitmap.width-a)/2;$gameSystem.isSideView()&&(c.origin.y=c.x+c.bitmap.height-b,d.origin.y=c.y+d.bitmap.height-b)};Spriteset_Battle.prototype.battleback1Bitmap=function(){return ImageManager.loadBattleback1(this.battleback1Name())};
Spriteset_Battle.prototype.battleback2Bitmap=function(){return ImageManager.loadBattleback2(this.battleback2Name())};Spriteset_Battle.prototype.battleback1Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback1Name:$gameMap.battleback1Name()?$gameMap.battleback1Name():$gameMap.isOverworld()?this.overworldBattleback1Name():""};
Spriteset_Battle.prototype.battleback2Name=function(){return BattleManager.isBattleTest()?$dataSystem.battleback2Name:$gameMap.battleback2Name()?$gameMap.battleback2Name():$gameMap.isOverworld()?this.overworldBattleback2Name():""};Spriteset_Battle.prototype.overworldBattleback1Name=function(){return""===$gameMap.battleback1Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback1Name():this.normalBattleback1Name()};
Spriteset_Battle.prototype.overworldBattleback2Name=function(){return""===$gameMap.battleback2Name()?"":$gamePlayer.isInVehicle()?this.shipBattleback2Name():this.normalBattleback2Name()};Spriteset_Battle.prototype.normalBattleback1Name=function(){return this.terrainBattleback1Name(this.autotileType(1))||this.terrainBattleback1Name(this.autotileType(0))||this.defaultBattleback1Name()};
Spriteset_Battle.prototype.normalBattleback2Name=function(){return this.terrainBattleback2Name(this.autotileType(1))||this.terrainBattleback2Name(this.autotileType(0))||this.defaultBattleback2Name()};
Spriteset_Battle.prototype.terrainBattleback1Name=function(a){switch(a){case 24:case 25:return"Wasteland";case 26:case 27:return"DirtField";case 32:case 33:return"Desert";case 34:return"Lava1";case 35:return"Lava2";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp";default:return null}};
Spriteset_Battle.prototype.terrainBattleback2Name=function(a){switch(a){case 20:case 21:return"Forest";case 22:case 30:case 38:return"Cliff";case 24:case 25:case 26:case 27:return"Wasteland";case 32:case 33:return"Desert";case 34:case 35:return"Lava";case 40:case 41:return"Snowfield";case 42:return"Clouds";case 4:case 5:return"PoisonSwamp"}};Spriteset_Battle.prototype.defaultBattleback1Name=function(){return"Grassland"};Spriteset_Battle.prototype.defaultBattleback2Name=function(){return"Grassland"};
Spriteset_Battle.prototype.shipBattleback1Name=function(){return"Ship"};Spriteset_Battle.prototype.shipBattleback2Name=function(){return"Ship"};Spriteset_Battle.prototype.autotileType=function(a){return $gameMap.autotileType($gamePlayer.x,$gamePlayer.y,a)};
Spriteset_Battle.prototype.createEnemies=function(){for(var a=$gameTroop.members(),b=[],c=0;c<a.length;c++)b[c]=new Sprite_Enemy(a[c]);b.sort(this.compareEnemySprite.bind(this));for(a=0;a<b.length;a++)this._battleField.addChild(b[a]);this._enemySprites=b};Spriteset_Battle.prototype.compareEnemySprite=function(a,b){return a.y!==b.y?a.y-b.y:b.spriteId-a.spriteId};
Spriteset_Battle.prototype.createActors=function(){this._actorSprites=[];for(var a=0;a<$gameParty.maxBattleMembers();a++)this._actorSprites[a]=new Sprite_Actor,this._battleField.addChild(this._actorSprites[a])};Spriteset_Battle.prototype.updateActors=function(){for(var a=$gameParty.battleMembers(),b=0;b<this._actorSprites.length;b++)this._actorSprites[b].setBattler(a[b])};Spriteset_Battle.prototype.battlerSprites=function(){return this._enemySprites.concat(this._actorSprites)};
Spriteset_Battle.prototype.isAnimationPlaying=function(){return this.battlerSprites().some(function(a){return a.isAnimationPlaying()})};Spriteset_Battle.prototype.isEffecting=function(){return this.battlerSprites().some(function(a){return a.isEffecting()})};Spriteset_Battle.prototype.isAnyoneMoving=function(){return this.battlerSprites().some(function(a){return a.isMoving()})};Spriteset_Battle.prototype.isBusy=function(){return this.isAnimationPlaying()||this.isAnyoneMoving()};function Window_Base(){this.initialize.apply(this,arguments)}Window_Base.prototype=Object.create(Window.prototype);Window_Base.prototype.constructor=Window_Base;Window_Base.prototype.initialize=function(a,b,c,d){Window.prototype.initialize.call(this);this.loadWindowskin();this.move(a,b,c,d);this.updatePadding();this.updateBackOpacity();this.updateTone();this.createContents();this._closing=this._opening=!1;this._dimmerSprite=null};Window_Base._iconWidth=32;Window_Base._iconHeight=32;
Window_Base._faceWidth=144;Window_Base._faceHeight=144;Window_Base.prototype.lineHeight=function(){return 36};Window_Base.prototype.standardFontFace=function(){return $gameSystem.isChinese()?"SimHei, Heiti TC, sans-serif":$gameSystem.isKorean()?"Dotum, AppleGothic, sans-serif":"GameFont"};Window_Base.prototype.standardFontSize=function(){return 28};Window_Base.prototype.standardPadding=function(){return 18};Window_Base.prototype.textPadding=function(){return 6};
Window_Base.prototype.standardBackOpacity=function(){return 192};Window_Base.prototype.loadWindowskin=function(){this.windowskin=ImageManager.loadSystem("Window")};Window_Base.prototype.updatePadding=function(){this.padding=this.standardPadding()};Window_Base.prototype.updateBackOpacity=function(){this.backOpacity=this.standardBackOpacity()};Window_Base.prototype.contentsWidth=function(){return this.width-2*this.standardPadding()};
Window_Base.prototype.contentsHeight=function(){return this.height-2*this.standardPadding()};Window_Base.prototype.fittingHeight=function(a){return a*this.lineHeight()+2*this.standardPadding()};Window_Base.prototype.updateTone=function(){var a=$gameSystem.windowTone();this.setTone(a[0],a[1],a[2])};Window_Base.prototype.createContents=function(){this.contents=new Bitmap(this.contentsWidth(),this.contentsHeight());this.resetFontSettings()};
Window_Base.prototype.resetFontSettings=function(){this.contents.fontFace=this.standardFontFace();this.contents.fontSize=this.standardFontSize();this.resetTextColor()};Window_Base.prototype.resetTextColor=function(){this.changeTextColor(this.normalColor())};Window_Base.prototype.update=function(){Window.prototype.update.call(this);this.updateTone();this.updateOpen();this.updateClose();this.updateBackgroundDimmer()};
Window_Base.prototype.updateOpen=function(){this._opening&&(this.openness+=32,this.isOpen()&&(this._opening=!1))};Window_Base.prototype.updateClose=function(){this._closing&&(this.openness-=32,this.isClosed()&&(this._closing=!1))};Window_Base.prototype.open=function(){this.isOpen()||(this._opening=!0);this._closing=!1};Window_Base.prototype.close=function(){this.isClosed()||(this._closing=!0);this._opening=!1};Window_Base.prototype.isOpening=function(){return this._opening};
Window_Base.prototype.isClosing=function(){return this._closing};Window_Base.prototype.show=function(){this.visible=!0};Window_Base.prototype.hide=function(){this.visible=!1};Window_Base.prototype.activate=function(){this.active=!0};Window_Base.prototype.deactivate=function(){this.active=!1};Window_Base.prototype.textColor=function(a){return this.windowskin.getPixel(a%8*12+102,12*Math.floor(a/8)+150)};Window_Base.prototype.normalColor=function(){return this.textColor(0)};
Window_Base.prototype.systemColor=function(){return this.textColor(16)};Window_Base.prototype.crisisColor=function(){return this.textColor(17)};Window_Base.prototype.deathColor=function(){return this.textColor(18)};Window_Base.prototype.gaugeBackColor=function(){return this.textColor(19)};Window_Base.prototype.hpGaugeColor1=function(){return this.textColor(20)};Window_Base.prototype.hpGaugeColor2=function(){return this.textColor(21)};Window_Base.prototype.mpGaugeColor1=function(){return this.textColor(22)};
Window_Base.prototype.mpGaugeColor2=function(){return this.textColor(23)};Window_Base.prototype.mpCostColor=function(){return this.textColor(23)};Window_Base.prototype.powerUpColor=function(){return this.textColor(24)};Window_Base.prototype.powerDownColor=function(){return this.textColor(25)};Window_Base.prototype.tpGaugeColor1=function(){return this.textColor(28)};Window_Base.prototype.tpGaugeColor2=function(){return this.textColor(29)};Window_Base.prototype.tpCostColor=function(){return this.textColor(29)};
Window_Base.prototype.pendingColor=function(){return this.windowskin.getPixel(120,120)};Window_Base.prototype.translucentOpacity=function(){return 160};Window_Base.prototype.changeTextColor=function(a){this.contents.textColor=a};Window_Base.prototype.changePaintOpacity=function(a){this.contents.paintOpacity=a?255:this.translucentOpacity()};Window_Base.prototype.drawText=function(a,b,c,d,e){this.contents.drawText(a,b,c,d,this.lineHeight(),e)};Window_Base.prototype.textWidth=function(a){return this.contents.measureTextWidth(a)};
Window_Base.prototype.drawTextEx=function(a,b,c){if(a){c={index:0,x:b,y:c,left:b};c.text=this.convertEscapeCharacters(a);c.height=this.calcTextHeight(c,!1);for(this.resetFontSettings();c.index<c.text.length;)this.processCharacter(c);return c.x-b}return 0};
Window_Base.prototype.convertEscapeCharacters=function(a){a=a.replace(/\\/g,"\u001b");a=a.replace(/\x1b\x1b/g,"\\");a=a.replace(/\x1bV\[(\d+)\]/gi,function(b,c){return $gameVariables.value(parseInt(c))}.bind(this));a=a.replace(/\x1bV\[(\d+)\]/gi,function(b,c){return $gameVariables.value(parseInt(c))}.bind(this));a=a.replace(/\x1bN\[(\d+)\]/gi,function(b,c){return this.actorName(parseInt(c))}.bind(this));a=a.replace(/\x1bP\[(\d+)\]/gi,function(b,c){return this.partyMemberName(parseInt(c))}.bind(this));
return a=a.replace(/\x1bG/gi,TextManager.currencyUnit)};Window_Base.prototype.actorName=function(a){return(a=1<=a?$gameActors.actor(a):null)?a.name():""};Window_Base.prototype.partyMemberName=function(a){return(a=1<=a?$gameParty.members()[a-1]:null)?a.name():""};Window_Base.prototype.processCharacter=function(a){switch(a.text[a.index]){case "\n":this.processNewLine(a);break;case "\f":this.processNewPage(a);break;case "\u001b":this.processEscapeCharacter(this.obtainEscapeCode(a),a);break;default:this.processNormalCharacter(a)}};
Window_Base.prototype.processNormalCharacter=function(a){var b=a.text[a.index++],c=this.textWidth(b);this.contents.drawText(b,a.x,a.y,2*c,a.height);a.x+=c};Window_Base.prototype.processNewLine=function(a){a.x=a.left;a.y+=a.height;a.height=this.calcTextHeight(a,!1);a.index++};Window_Base.prototype.processNewPage=function(a){a.index++};
Window_Base.prototype.obtainEscapeCode=function(a){a.index++;var b=/^[\$\.\|\^!><\{\}\\]|^[A-Z]+/i.exec(a.text.slice(a.index));return b?(a.index+=b[0].length,b[0].toUpperCase()):""};Window_Base.prototype.obtainEscapeParam=function(a){var b=/^\[\d+\]/.exec(a.text.slice(a.index));return b?(a.index+=b[0].length,parseInt(b[0].slice(1))):""};
Window_Base.prototype.processEscapeCharacter=function(a,b){switch(a){case "C":this.changeTextColor(this.textColor(this.obtainEscapeParam(b)));break;case "I":this.processDrawIcon(this.obtainEscapeParam(b),b);break;case "{":this.makeFontBigger();break;case "}":this.makeFontSmaller()}};Window_Base.prototype.processDrawIcon=function(a,b){this.drawIcon(a,b.x+2,b.y+2);b.x+=Window_Base._iconWidth+4};Window_Base.prototype.makeFontBigger=function(){96>=this.contents.fontSize&&(this.contents.fontSize+=12)};
Window_Base.prototype.makeFontSmaller=function(){24<=this.contents.fontSize&&(this.contents.fontSize-=12)};
Window_Base.prototype.calcTextHeight=function(a,b){var c=this.contents.fontSize,d=0;a=a.text.slice(a.index).split("\n");b=b?a.length:1;for(var e=0;e<b;e++){for(var f=this.contents.fontSize,g=/\x1b[\{\}]/g;;){var h=g.exec(a[e]);if(h)"\u001b{"===h[0]&&this.makeFontBigger(),"\u001b}"===h[0]&&this.makeFontSmaller(),f<this.contents.fontSize&&(f=this.contents.fontSize);else break}d+=f+8}this.contents.fontSize=c;return d};
Window_Base.prototype.drawIcon=function(a,b,c){var d=ImageManager.loadSystem("IconSet"),e=Window_Base._iconWidth,f=Window_Base._iconHeight;this.contents.blt(d,a%16*e,Math.floor(a/16)*f,e,f,b,c)};
Window_Base.prototype.drawFace=function(a,b,c,d,e,f){e=e||Window_Base._faceWidth;f=f||Window_Base._faceHeight;a=ImageManager.loadFace(a);var g=Window_Base._faceWidth,h=Window_Base._faceHeight,k=Math.min(e,g),l=Math.min(f,h);this.contents.blt(a,b%4*g+(g-k)/2,Math.floor(b/4)*h+(h-l)/2,k,l,Math.floor(c+Math.max(e-g,0)/2),Math.floor(d+Math.max(f-h,0)/2))};
Window_Base.prototype.drawCharacter=function(a,b,c,d){var e=ImageManager.loadCharacter(a),f=ImageManager.isBigCharacter(a);a=e.width/(f?3:12);f=e.height/(f?4:8);this.contents.blt(e,(b%4*3+1)*a,4*Math.floor(b/4)*f,a,f,c-a/2,d-f)};Window_Base.prototype.drawGauge=function(a,b,c,d,e,f){d=Math.floor(c*d);b=b+this.lineHeight()-8;this.contents.fillRect(a,b,c,6,this.gaugeBackColor());this.contents.gradientFillRect(a,b,d,6,e,f)};
Window_Base.prototype.hpColor=function(a){return a.isDead()?this.deathColor():a.isDying()?this.crisisColor():this.normalColor()};Window_Base.prototype.mpColor=function(a){return this.normalColor()};Window_Base.prototype.tpColor=function(a){return this.normalColor()};Window_Base.prototype.drawActorCharacter=function(a,b,c){this.drawCharacter(a.characterName(),a.characterIndex(),b,c)};Window_Base.prototype.drawActorFace=function(a,b,c,d,e){this.drawFace(a.faceName(),a.faceIndex(),b,c,d,e)};
Window_Base.prototype.drawActorName=function(a,b,c,d){d=d||168;this.changeTextColor(this.hpColor(a));this.drawText(a.name(),b,c,d)};Window_Base.prototype.drawActorClass=function(a,b,c,d){d=d||168;this.resetTextColor();this.drawText(a.currentClass().name,b,c,d)};Window_Base.prototype.drawActorNickname=function(a,b,c,d){d=d||270;this.resetTextColor();this.drawText(a.nickname(),b,c,d)};
Window_Base.prototype.drawActorLevel=function(a,b,c){this.changeTextColor(this.systemColor());this.drawText(TextManager.levelA,b,c,48);this.resetTextColor();this.drawText(a.level,b+84,c,36,"right")};Window_Base.prototype.drawActorIcons=function(a,b,c,d){d=d||144;a=a.allIcons().slice(0,Math.floor(d/Window_Base._iconWidth));for(d=0;d<a.length;d++)this.drawIcon(a[d],b+Window_Base._iconWidth*d,c+2)};
Window_Base.prototype.drawCurrentAndMax=function(a,b,c,d,e,f,g){var h=this.textWidth("HP"),k=this.textWidth("0000"),l=this.textWidth("/");e=c+e-k;var m=e-l,n=m-k;n>=c+h?(this.changeTextColor(f),this.drawText(a,n,d,k,"right"),this.changeTextColor(g),this.drawText("/",m,d,l,"right"),this.drawText(b,e,d,k,"right")):(this.changeTextColor(f),this.drawText(a,e,d,k,"right"))};
Window_Base.prototype.drawActorHp=function(a,b,c,d){d=d||186;var e=this.hpGaugeColor1(),f=this.hpGaugeColor2();this.drawGauge(b,c,d,a.hpRate(),e,f);this.changeTextColor(this.systemColor());this.drawText(TextManager.hpA,b,c,44);this.drawCurrentAndMax(a.hp,a.mhp,b,c,d,this.hpColor(a),this.normalColor())};
Window_Base.prototype.drawActorMp=function(a,b,c,d){d=d||186;var e=this.mpGaugeColor1(),f=this.mpGaugeColor2();this.drawGauge(b,c,d,a.mpRate(),e,f);this.changeTextColor(this.systemColor());this.drawText(TextManager.mpA,b,c,44);this.drawCurrentAndMax(a.mp,a.mmp,b,c,d,this.mpColor(a),this.normalColor())};
Window_Base.prototype.drawActorTp=function(a,b,c,d){d=d||96;var e=this.tpGaugeColor1(),f=this.tpGaugeColor2();this.drawGauge(b,c,d,a.tpRate(),e,f);this.changeTextColor(this.systemColor());this.drawText(TextManager.tpA,b,c,44);this.changeTextColor(this.tpColor(a));this.drawText(a.tp,b+d-64,c,64,"right")};
Window_Base.prototype.drawActorSimpleStatus=function(a,b,c,d){var e=this.lineHeight(),f=b+180;d=Math.min(200,d-180-this.textPadding());this.drawActorName(a,b,c);this.drawActorLevel(a,b,c+1*e);this.drawActorIcons(a,b,c+2*e);this.drawActorClass(a,f,c);this.drawActorHp(a,f,c+1*e,d);this.drawActorMp(a,f,c+2*e,d)};Window_Base.prototype.drawItemName=function(a,b,c,d){d=d||312;if(a){var e=Window_Base._iconWidth+4;this.resetTextColor();this.drawIcon(a.iconIndex,b+2,c+2);this.drawText(a.name,b+e,c,d-e)}};
Window_Base.prototype.drawCurrencyValue=function(a,b,c,d,e){var f=Math.min(80,this.textWidth(b));this.resetTextColor();this.drawText(a,c,d,e-f-6,"right");this.changeTextColor(this.systemColor());this.drawText(b,c+e-f,d,f,"right")};Window_Base.prototype.paramchangeTextColor=function(a){return 0<a?this.powerUpColor():0>a?this.powerDownColor():this.normalColor()};Window_Base.prototype.setBackgroundType=function(a){this.opacity=0===a?255:0;1===a?this.showBackgroundDimmer():this.hideBackgroundDimmer()};
Window_Base.prototype.showBackgroundDimmer=function(){this._dimmerSprite||(this._dimmerSprite=new Sprite,this._dimmerSprite.bitmap=new Bitmap(0,0),this.addChildToBack(this._dimmerSprite));var a=this._dimmerSprite.bitmap;a.width===this.width&&a.height===this.height||this.refreshDimmerBitmap();this._dimmerSprite.visible=!0;this.updateBackgroundDimmer()};Window_Base.prototype.hideBackgroundDimmer=function(){this._dimmerSprite&&(this._dimmerSprite.visible=!1)};
Window_Base.prototype.updateBackgroundDimmer=function(){this._dimmerSprite&&(this._dimmerSprite.opacity=this.openness)};Window_Base.prototype.refreshDimmerBitmap=function(){if(this._dimmerSprite){var a=this._dimmerSprite.bitmap,b=this.width,c=this.height,d=this.padding,e=this.dimColor1(),f=this.dimColor2();a.resize(b,c);a.gradientFillRect(0,0,b,d,f,e,!0);a.fillRect(0,d,b,c-2*d,e);a.gradientFillRect(0,c-d,b,d,e,f,!0);this._dimmerSprite.setFrame(0,0,b,c)}};Window_Base.prototype.dimColor1=function(){return"rgba(0, 0, 0, 0.6)"};
Window_Base.prototype.dimColor2=function(){return"rgba(0, 0, 0, 0)"};Window_Base.prototype.canvasToLocalX=function(a){for(var b=this;b;)a-=b.x,b=b.parent;return a};Window_Base.prototype.canvasToLocalY=function(a){for(var b=this;b;)a-=b.y,b=b.parent;return a};Window_Base.prototype.reserveFaceImages=function(){$gameParty.members().forEach(function(a){ImageManager.reserveFace(a.faceName())},this)};function Window_Selectable(){this.initialize.apply(this,arguments)}Window_Selectable.prototype=Object.create(Window_Base.prototype);
Window_Selectable.prototype.constructor=Window_Selectable;Window_Selectable.prototype.initialize=function(a,b,c,d){Window_Base.prototype.initialize.call(this,a,b,c,d);this._index=-1;this._cursorAll=this._cursorFixed=!1;this._stayCount=0;this._helpWindow=null;this._handlers={};this._touching=!1;this._scrollY=this._scrollX=0;this.deactivate()};Window_Selectable.prototype.index=function(){return this._index};Window_Selectable.prototype.cursorFixed=function(){return this._cursorFixed};
Window_Selectable.prototype.setCursorFixed=function(a){this._cursorFixed=a};Window_Selectable.prototype.cursorAll=function(){return this._cursorAll};Window_Selectable.prototype.setCursorAll=function(a){this._cursorAll=a};Window_Selectable.prototype.maxCols=function(){return 1};Window_Selectable.prototype.maxItems=function(){return 0};Window_Selectable.prototype.spacing=function(){return 12};
Window_Selectable.prototype.itemWidth=function(){return Math.floor((this.width-2*this.padding+this.spacing())/this.maxCols()-this.spacing())};Window_Selectable.prototype.itemHeight=function(){return this.lineHeight()};Window_Selectable.prototype.maxRows=function(){return Math.max(Math.ceil(this.maxItems()/this.maxCols()),1)};Window_Selectable.prototype.activate=function(){Window_Base.prototype.activate.call(this);this.reselect()};
Window_Selectable.prototype.deactivate=function(){Window_Base.prototype.deactivate.call(this);this.reselect()};Window_Selectable.prototype.select=function(a){this._index=a;this._stayCount=0;this.ensureCursorVisible();this.updateCursor();this.callUpdateHelp()};Window_Selectable.prototype.deselect=function(){this.select(-1)};Window_Selectable.prototype.reselect=function(){this.select(this._index)};Window_Selectable.prototype.row=function(){return Math.floor(this.index()/this.maxCols())};
Window_Selectable.prototype.topRow=function(){return Math.floor(this._scrollY/this.itemHeight())};Window_Selectable.prototype.maxTopRow=function(){return Math.max(0,this.maxRows()-this.maxPageRows())};Window_Selectable.prototype.setTopRow=function(a){a=a.clamp(0,this.maxTopRow())*this.itemHeight();this._scrollY!==a&&(this._scrollY=a,this.refresh(),this.updateCursor())};Window_Selectable.prototype.resetScroll=function(){this.setTopRow(0)};
Window_Selectable.prototype.maxPageRows=function(){return Math.floor((this.height-2*this.padding)/this.itemHeight())};Window_Selectable.prototype.maxPageItems=function(){return this.maxPageRows()*this.maxCols()};Window_Selectable.prototype.isHorizontal=function(){return 1===this.maxPageRows()};Window_Selectable.prototype.bottomRow=function(){return Math.max(0,this.topRow()+this.maxPageRows()-1)};Window_Selectable.prototype.setBottomRow=function(a){this.setTopRow(a-(this.maxPageRows()-1))};
Window_Selectable.prototype.topIndex=function(){return this.topRow()*this.maxCols()};Window_Selectable.prototype.itemRect=function(a){var b=new Rectangle,c=this.maxCols();b.width=this.itemWidth();b.height=this.itemHeight();b.x=a%c*(b.width+this.spacing())-this._scrollX;b.y=Math.floor(a/c)*b.height-this._scrollY;return b};Window_Selectable.prototype.itemRectForText=function(a){a=this.itemRect(a);a.x+=this.textPadding();a.width-=2*this.textPadding();return a};
Window_Selectable.prototype.setHelpWindow=function(a){this._helpWindow=a;this.callUpdateHelp()};Window_Selectable.prototype.showHelpWindow=function(){this._helpWindow&&this._helpWindow.show()};Window_Selectable.prototype.hideHelpWindow=function(){this._helpWindow&&this._helpWindow.hide()};Window_Selectable.prototype.setHandler=function(a,b){this._handlers[a]=b};Window_Selectable.prototype.isHandled=function(a){return!!this._handlers[a]};Window_Selectable.prototype.callHandler=function(a){if(this.isHandled(a))this._handlers[a]()};
Window_Selectable.prototype.isOpenAndActive=function(){return this.isOpen()&&this.active};Window_Selectable.prototype.isCursorMovable=function(){return this.isOpenAndActive()&&!this._cursorFixed&&!this._cursorAll&&0<this.maxItems()};Window_Selectable.prototype.cursorDown=function(a){var b=this.index(),c=this.maxItems(),d=this.maxCols();(b<c-d||a&&1===d)&&this.select((b+d)%c)};
Window_Selectable.prototype.cursorUp=function(a){var b=this.index(),c=this.maxItems(),d=this.maxCols();(b>=d||a&&1===d)&&this.select((b-d+c)%c)};Window_Selectable.prototype.cursorRight=function(a){var b=this.index(),c=this.maxItems();2<=this.maxCols()&&(b<c-1||a&&this.isHorizontal())&&this.select((b+1)%c)};Window_Selectable.prototype.cursorLeft=function(a){var b=this.index(),c=this.maxItems();2<=this.maxCols()&&(0<b||a&&this.isHorizontal())&&this.select((b-1+c)%c)};
Window_Selectable.prototype.cursorPagedown=function(){var a=this.index(),b=this.maxItems();this.topRow()+this.maxPageRows()<this.maxRows()&&(this.setTopRow(this.topRow()+this.maxPageRows()),this.select(Math.min(a+this.maxPageItems(),b-1)))};Window_Selectable.prototype.cursorPageup=function(){var a=this.index();0<this.topRow()&&(this.setTopRow(this.topRow()-this.maxPageRows()),this.select(Math.max(a-this.maxPageItems(),0)))};
Window_Selectable.prototype.scrollDown=function(){this.topRow()+1<this.maxRows()&&this.setTopRow(this.topRow()+1)};Window_Selectable.prototype.scrollUp=function(){0<this.topRow()&&this.setTopRow(this.topRow()-1)};Window_Selectable.prototype.update=function(){Window_Base.prototype.update.call(this);this.updateArrows();this.processCursorMove();this.processHandling();this.processWheel();this.processTouch();this._stayCount++};
Window_Selectable.prototype.updateArrows=function(){var a=this.topRow(),b=this.maxTopRow();this.downArrowVisible=0<b&&a<b;this.upArrowVisible=0<a};
Window_Selectable.prototype.processCursorMove=function(){if(this.isCursorMovable()){var a=this.index();Input.isRepeated("down")&&this.cursorDown(Input.isTriggered("down"));Input.isRepeated("up")&&this.cursorUp(Input.isTriggered("up"));Input.isRepeated("right")&&this.cursorRight(Input.isTriggered("right"));Input.isRepeated("left")&&this.cursorLeft(Input.isTriggered("left"));!this.isHandled("pagedown")&&Input.isTriggered("pagedown")&&this.cursorPagedown();!this.isHandled("pageup")&&Input.isTriggered("pageup")&&
this.cursorPageup();this.index()!==a&&SoundManager.playCursor()}};Window_Selectable.prototype.processHandling=function(){this.isOpenAndActive()&&(this.isOkEnabled()&&this.isOkTriggered()?this.processOk():this.isCancelEnabled()&&this.isCancelTriggered()?this.processCancel():this.isHandled("pagedown")&&Input.isTriggered("pagedown")?this.processPagedown():this.isHandled("pageup")&&Input.isTriggered("pageup")&&this.processPageup())};
Window_Selectable.prototype.processWheel=function(){this.isOpenAndActive()&&(20<=TouchInput.wheelY&&this.scrollDown(),-20>=TouchInput.wheelY&&this.scrollUp())};
Window_Selectable.prototype.processTouch=function(){if(this.isOpenAndActive()){if(TouchInput.isTriggered()&&this.isTouchedInsideFrame()?(this._touching=!0,this.onTouch(!0)):TouchInput.isCancelled()&&this.isCancelEnabled()&&this.processCancel(),this._touching)if(TouchInput.isPressed())this.onTouch(!1);else this._touching=!1}else this._touching=!1};
Window_Selectable.prototype.isTouchedInsideFrame=function(){var a=this.canvasToLocalX(TouchInput.x),b=this.canvasToLocalY(TouchInput.y);return 0<=a&&0<=b&&a<this.width&&b<this.height};
Window_Selectable.prototype.onTouch=function(a){var b=this.index(),c=this.canvasToLocalX(TouchInput.x),d=this.canvasToLocalY(TouchInput.y);c=this.hitTest(c,d);0<=c?c===this.index()?a&&this.isTouchOkEnabled()&&this.processOk():this.isCursorMovable()&&this.select(c):10<=this._stayCount&&(d<this.padding?this.cursorUp():d>=this.height-this.padding&&this.cursorDown());this.index()!==b&&SoundManager.playCursor()};
Window_Selectable.prototype.hitTest=function(a,b){if(this.isContentsArea(a,b)){a-=this.padding;b-=this.padding;for(var c=this.topIndex(),d=0;d<this.maxPageItems();d++){var e=c+d;if(e<this.maxItems()){var f=this.itemRect(e),g=f.x+f.width,h=f.y+f.height;if(a>=f.x&&b>=f.y&&a<g&&b<h)return e}}}return-1};Window_Selectable.prototype.isContentsArea=function(a,b){var c=this.padding,d=this.width-this.padding,e=this.height-this.padding;return a>=this.padding&&b>=c&&a<d&&b<e};
Window_Selectable.prototype.isTouchOkEnabled=function(){return this.isOkEnabled()};Window_Selectable.prototype.isOkEnabled=function(){return this.isHandled("ok")};Window_Selectable.prototype.isCancelEnabled=function(){return this.isHandled("cancel")};Window_Selectable.prototype.isOkTriggered=function(){return Input.isRepeated("ok")};Window_Selectable.prototype.isCancelTriggered=function(){return Input.isRepeated("cancel")};
Window_Selectable.prototype.processOk=function(){this.isCurrentItemEnabled()?(this.playOkSound(),this.updateInputData(),this.deactivate(),this.callOkHandler()):this.playBuzzerSound()};Window_Selectable.prototype.playOkSound=function(){SoundManager.playOk()};Window_Selectable.prototype.playBuzzerSound=function(){SoundManager.playBuzzer()};Window_Selectable.prototype.callOkHandler=function(){this.callHandler("ok")};
Window_Selectable.prototype.processCancel=function(){SoundManager.playCancel();this.updateInputData();this.deactivate();this.callCancelHandler()};Window_Selectable.prototype.callCancelHandler=function(){this.callHandler("cancel")};Window_Selectable.prototype.processPageup=function(){SoundManager.playCursor();this.updateInputData();this.deactivate();this.callHandler("pageup")};
Window_Selectable.prototype.processPagedown=function(){SoundManager.playCursor();this.updateInputData();this.deactivate();this.callHandler("pagedown")};Window_Selectable.prototype.updateInputData=function(){Input.update();TouchInput.update()};
Window_Selectable.prototype.updateCursor=function(){if(this._cursorAll){var a=this.maxRows()*this.itemHeight();this.setCursorRect(0,0,this.contents.width,a);this.setTopRow(0)}else this.isCursorVisible()?(a=this.itemRect(this.index()),this.setCursorRect(a.x,a.y,a.width,a.height)):this.setCursorRect(0,0,0,0)};Window_Selectable.prototype.isCursorVisible=function(){var a=this.row();return a>=this.topRow()&&a<=this.bottomRow()};
Window_Selectable.prototype.ensureCursorVisible=function(){var a=this.row();a<this.topRow()?this.setTopRow(a):a>this.bottomRow()&&this.setBottomRow(a)};Window_Selectable.prototype.callUpdateHelp=function(){this.active&&this._helpWindow&&this.updateHelp()};Window_Selectable.prototype.updateHelp=function(){this._helpWindow.clear()};Window_Selectable.prototype.setHelpWindowItem=function(a){this._helpWindow&&this._helpWindow.setItem(a)};Window_Selectable.prototype.isCurrentItemEnabled=function(){return!0};
Window_Selectable.prototype.drawAllItems=function(){for(var a=this.topIndex(),b=0;b<this.maxPageItems();b++){var c=a+b;c<this.maxItems()&&this.drawItem(c)}};Window_Selectable.prototype.drawItem=function(a){};Window_Selectable.prototype.clearItem=function(a){a=this.itemRect(a);this.contents.clearRect(a.x,a.y,a.width,a.height)};Window_Selectable.prototype.redrawItem=function(a){0<=a&&(this.clearItem(a),this.drawItem(a))};Window_Selectable.prototype.redrawCurrentItem=function(){this.redrawItem(this.index())};
Window_Selectable.prototype.refresh=function(){this.contents&&(this.contents.clear(),this.drawAllItems())};function Window_Command(){this.initialize.apply(this,arguments)}Window_Command.prototype=Object.create(Window_Selectable.prototype);Window_Command.prototype.constructor=Window_Command;
Window_Command.prototype.initialize=function(a,b){this.clearCommandList();this.makeCommandList();var c=this.windowWidth(),d=this.windowHeight();Window_Selectable.prototype.initialize.call(this,a,b,c,d);this.refresh();this.select(0);this.activate()};Window_Command.prototype.windowWidth=function(){return 240};Window_Command.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};Window_Command.prototype.numVisibleRows=function(){return Math.ceil(this.maxItems()/this.maxCols())};
Window_Command.prototype.maxItems=function(){return this._list.length};Window_Command.prototype.clearCommandList=function(){this._list=[]};Window_Command.prototype.makeCommandList=function(){};Window_Command.prototype.addCommand=function(a,b,c,d){void 0===c&&(c=!0);void 0===d&&(d=null);this._list.push({name:a,symbol:b,enabled:c,ext:d})};Window_Command.prototype.commandName=function(a){return this._list[a].name};Window_Command.prototype.commandSymbol=function(a){return this._list[a].symbol};
Window_Command.prototype.isCommandEnabled=function(a){return this._list[a].enabled};Window_Command.prototype.currentData=function(){return 0<=this.index()?this._list[this.index()]:null};Window_Command.prototype.isCurrentItemEnabled=function(){return this.currentData()?this.currentData().enabled:!1};Window_Command.prototype.currentSymbol=function(){return this.currentData()?this.currentData().symbol:null};
Window_Command.prototype.currentExt=function(){return this.currentData()?this.currentData().ext:null};Window_Command.prototype.findSymbol=function(a){for(var b=0;b<this._list.length;b++)if(this._list[b].symbol===a)return b;return-1};Window_Command.prototype.selectSymbol=function(a){a=this.findSymbol(a);0<=a?this.select(a):this.select(0)};Window_Command.prototype.findExt=function(a){for(var b=0;b<this._list.length;b++)if(this._list[b].ext===a)return b;return-1};
Window_Command.prototype.selectExt=function(a){a=this.findExt(a);0<=a?this.select(a):this.select(0)};Window_Command.prototype.drawItem=function(a){var b=this.itemRectForText(a),c=this.itemTextAlign();this.resetTextColor();this.changePaintOpacity(this.isCommandEnabled(a));this.drawText(this.commandName(a),b.x,b.y,b.width,c)};Window_Command.prototype.itemTextAlign=function(){return"left"};Window_Command.prototype.isOkEnabled=function(){return!0};
Window_Command.prototype.callOkHandler=function(){var a=this.currentSymbol();this.isHandled(a)?this.callHandler(a):this.isHandled("ok")?Window_Selectable.prototype.callOkHandler.call(this):this.activate()};Window_Command.prototype.refresh=function(){this.clearCommandList();this.makeCommandList();this.createContents();Window_Selectable.prototype.refresh.call(this)};function Window_HorzCommand(){this.initialize.apply(this,arguments)}Window_HorzCommand.prototype=Object.create(Window_Command.prototype);
Window_HorzCommand.prototype.constructor=Window_HorzCommand;Window_HorzCommand.prototype.initialize=function(a,b){Window_Command.prototype.initialize.call(this,a,b)};Window_HorzCommand.prototype.numVisibleRows=function(){return 1};Window_HorzCommand.prototype.maxCols=function(){return 4};Window_HorzCommand.prototype.itemTextAlign=function(){return"center"};function Window_Help(){this.initialize.apply(this,arguments)}Window_Help.prototype=Object.create(Window_Base.prototype);
Window_Help.prototype.constructor=Window_Help;Window_Help.prototype.initialize=function(a){var b=Graphics.boxWidth;a=this.fittingHeight(a||2);Window_Base.prototype.initialize.call(this,0,0,b,a);this._text=""};Window_Help.prototype.setText=function(a){this._text!==a&&(this._text=a,this.refresh())};Window_Help.prototype.clear=function(){this.setText("")};Window_Help.prototype.setItem=function(a){this.setText(a?a.description:"")};
Window_Help.prototype.refresh=function(){this.contents.clear();this.drawTextEx(this._text,this.textPadding(),0)};function Window_Gold(){this.initialize.apply(this,arguments)}Window_Gold.prototype=Object.create(Window_Base.prototype);Window_Gold.prototype.constructor=Window_Gold;Window_Gold.prototype.initialize=function(a,b){var c=this.windowWidth(),d=this.windowHeight();Window_Base.prototype.initialize.call(this,a,b,c,d);this.refresh()};Window_Gold.prototype.windowWidth=function(){return 240};
Window_Gold.prototype.windowHeight=function(){return this.fittingHeight(1)};Window_Gold.prototype.refresh=function(){var a=this.textPadding(),b=this.contents.width-2*this.textPadding();this.contents.clear();this.drawCurrencyValue(this.value(),this.currencyUnit(),a,0,b)};Window_Gold.prototype.value=function(){return $gameParty.gold()};Window_Gold.prototype.currencyUnit=function(){return TextManager.currencyUnit};Window_Gold.prototype.open=function(){this.refresh();Window_Base.prototype.open.call(this)};
function Window_MenuCommand(){this.initialize.apply(this,arguments)}Window_MenuCommand.prototype=Object.create(Window_Command.prototype);Window_MenuCommand.prototype.constructor=Window_MenuCommand;Window_MenuCommand.prototype.initialize=function(a,b){Window_Command.prototype.initialize.call(this,a,b);this.selectLast()};Window_MenuCommand._lastCommandSymbol=null;Window_MenuCommand.initCommandPosition=function(){this._lastCommandSymbol=null};Window_MenuCommand.prototype.windowWidth=function(){return 240};
Window_MenuCommand.prototype.numVisibleRows=function(){return this.maxItems()};Window_MenuCommand.prototype.makeCommandList=function(){this.addMainCommands();this.addFormationCommand();this.addOriginalCommands();this.addOptionsCommand();this.addSaveCommand();this.addGameEndCommand()};
Window_MenuCommand.prototype.addMainCommands=function(){var a=this.areMainCommandsEnabled();this.needsCommand("item")&&this.addCommand(TextManager.item,"item",a);this.needsCommand("skill")&&this.addCommand(TextManager.skill,"skill",a);this.needsCommand("equip")&&this.addCommand(TextManager.equip,"equip",a);this.needsCommand("status")&&this.addCommand(TextManager.status,"status",a)};
Window_MenuCommand.prototype.addFormationCommand=function(){if(this.needsCommand("formation")){var a=this.isFormationEnabled();this.addCommand(TextManager.formation,"formation",a)}};Window_MenuCommand.prototype.addOriginalCommands=function(){};Window_MenuCommand.prototype.addOptionsCommand=function(){if(this.needsCommand("options")){var a=this.isOptionsEnabled();this.addCommand(TextManager.options,"options",a)}};
Window_MenuCommand.prototype.addSaveCommand=function(){if(this.needsCommand("save")){var a=this.isSaveEnabled();this.addCommand(TextManager.save,"save",a)}};Window_MenuCommand.prototype.addGameEndCommand=function(){var a=this.isGameEndEnabled();this.addCommand(TextManager.gameEnd,"gameEnd",a)};
Window_MenuCommand.prototype.needsCommand=function(a){var b=$dataSystem.menuCommands;if(b)switch(a){case "item":return b[0];case "skill":return b[1];case "equip":return b[2];case "status":return b[3];case "formation":return b[4];case "save":return b[5]}return!0};Window_MenuCommand.prototype.areMainCommandsEnabled=function(){return $gameParty.exists()};Window_MenuCommand.prototype.isFormationEnabled=function(){return 2<=$gameParty.size()&&$gameSystem.isFormationEnabled()};
Window_MenuCommand.prototype.isOptionsEnabled=function(){return!0};Window_MenuCommand.prototype.isSaveEnabled=function(){return!DataManager.isEventTest()&&$gameSystem.isSaveEnabled()};Window_MenuCommand.prototype.isGameEndEnabled=function(){return!0};Window_MenuCommand.prototype.processOk=function(){Window_MenuCommand._lastCommandSymbol=this.currentSymbol();Window_Command.prototype.processOk.call(this)};Window_MenuCommand.prototype.selectLast=function(){this.selectSymbol(Window_MenuCommand._lastCommandSymbol)};
function Window_MenuStatus(){this.initialize.apply(this,arguments)}Window_MenuStatus.prototype=Object.create(Window_Selectable.prototype);Window_MenuStatus.prototype.constructor=Window_MenuStatus;Window_MenuStatus.prototype.initialize=function(a,b){var c=this.windowWidth(),d=this.windowHeight();Window_Selectable.prototype.initialize.call(this,a,b,c,d);this._formationMode=!1;this._pendingIndex=-1;this.refresh()};Window_MenuStatus.prototype.windowWidth=function(){return Graphics.boxWidth-240};
Window_MenuStatus.prototype.windowHeight=function(){return Graphics.boxHeight};Window_MenuStatus.prototype.maxItems=function(){return $gameParty.size()};Window_MenuStatus.prototype.itemHeight=function(){return Math.floor((this.height-2*this.padding)/this.numVisibleRows())};Window_MenuStatus.prototype.numVisibleRows=function(){return 4};Window_MenuStatus.prototype.loadImages=function(){$gameParty.members().forEach(function(a){ImageManager.reserveFace(a.faceName())},this)};
Window_MenuStatus.prototype.drawItem=function(a){this.drawItemBackground(a);this.drawItemImage(a);this.drawItemStatus(a)};Window_MenuStatus.prototype.drawItemBackground=function(a){if(a===this._pendingIndex){a=this.itemRect(a);var b=this.pendingColor();this.changePaintOpacity(!1);this.contents.fillRect(a.x,a.y,a.width,a.height,b);this.changePaintOpacity(!0)}};
Window_MenuStatus.prototype.drawItemImage=function(a){var b=$gameParty.members()[a];a=this.itemRect(a);this.changePaintOpacity(b.isBattleMember());this.drawActorFace(b,a.x+1,a.y+1,Window_Base._faceWidth,Window_Base._faceHeight);this.changePaintOpacity(!0)};Window_MenuStatus.prototype.drawItemStatus=function(a){var b=$gameParty.members()[a],c=this.itemRect(a);a=c.x+162;var d=c.y+c.height/2-1.5*this.lineHeight();c=c.width-a-this.textPadding();this.drawActorSimpleStatus(b,a,d,c)};
Window_MenuStatus.prototype.processOk=function(){Window_Selectable.prototype.processOk.call(this);$gameParty.setMenuActor($gameParty.members()[this.index()])};Window_MenuStatus.prototype.isCurrentItemEnabled=function(){if(this._formationMode){var a=$gameParty.members()[this.index()];return a&&a.isFormationChangeOk()}return!0};Window_MenuStatus.prototype.selectLast=function(){this.select($gameParty.menuActor().index()||0)};Window_MenuStatus.prototype.formationMode=function(){return this._formationMode};
Window_MenuStatus.prototype.setFormationMode=function(a){this._formationMode=a};Window_MenuStatus.prototype.pendingIndex=function(){return this._pendingIndex};Window_MenuStatus.prototype.setPendingIndex=function(a){var b=this._pendingIndex;this._pendingIndex=a;this.redrawItem(this._pendingIndex);this.redrawItem(b)};function Window_MenuActor(){this.initialize.apply(this,arguments)}Window_MenuActor.prototype=Object.create(Window_MenuStatus.prototype);Window_MenuActor.prototype.constructor=Window_MenuActor;
Window_MenuActor.prototype.initialize=function(){Window_MenuStatus.prototype.initialize.call(this,0,0);this.hide()};Window_MenuActor.prototype.processOk=function(){this.cursorAll()||$gameParty.setTargetActor($gameParty.members()[this.index()]);this.callOkHandler()};Window_MenuActor.prototype.selectLast=function(){this.select($gameParty.targetActor().index()||0)};
Window_MenuActor.prototype.selectForItem=function(a){var b=$gameParty.menuActor(),c=new Game_Action(b);c.setItemObject(a);this.setCursorFixed(!1);this.setCursorAll(!1);c.isForUser()?DataManager.isSkill(a)?(this.setCursorFixed(!0),this.select(b.index())):this.selectLast():c.isForAll()?(this.setCursorAll(!0),this.select(0)):this.selectLast()};function Window_ItemCategory(){this.initialize.apply(this,arguments)}Window_ItemCategory.prototype=Object.create(Window_HorzCommand.prototype);
Window_ItemCategory.prototype.constructor=Window_ItemCategory;Window_ItemCategory.prototype.initialize=function(){Window_HorzCommand.prototype.initialize.call(this,0,0)};Window_ItemCategory.prototype.windowWidth=function(){return Graphics.boxWidth};Window_ItemCategory.prototype.maxCols=function(){return 4};Window_ItemCategory.prototype.update=function(){Window_HorzCommand.prototype.update.call(this);this._itemWindow&&this._itemWindow.setCategory(this.currentSymbol())};
Window_ItemCategory.prototype.makeCommandList=function(){this.addCommand(TextManager.item,"item");this.addCommand(TextManager.weapon,"weapon");this.addCommand(TextManager.armor,"armor");this.addCommand(TextManager.keyItem,"keyItem")};Window_ItemCategory.prototype.setItemWindow=function(a){this._itemWindow=a};function Window_ItemList(){this.initialize.apply(this,arguments)}Window_ItemList.prototype=Object.create(Window_Selectable.prototype);Window_ItemList.prototype.constructor=Window_ItemList;
Window_ItemList.prototype.initialize=function(a,b,c,d){Window_Selectable.prototype.initialize.call(this,a,b,c,d);this._category="none";this._data=[]};Window_ItemList.prototype.setCategory=function(a){this._category!==a&&(this._category=a,this.refresh(),this.resetScroll())};Window_ItemList.prototype.maxCols=function(){return 2};Window_ItemList.prototype.spacing=function(){return 48};Window_ItemList.prototype.maxItems=function(){return this._data?this._data.length:1};
Window_ItemList.prototype.item=function(){var a=this.index();return this._data&&0<=a?this._data[a]:null};Window_ItemList.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this.item())};Window_ItemList.prototype.includes=function(a){switch(this._category){case "item":return DataManager.isItem(a)&&1===a.itypeId;case "weapon":return DataManager.isWeapon(a);case "armor":return DataManager.isArmor(a);case "keyItem":return DataManager.isItem(a)&&2===a.itypeId;default:return!1}};
Window_ItemList.prototype.needsNumber=function(){return!0};Window_ItemList.prototype.isEnabled=function(a){return $gameParty.canUse(a)};Window_ItemList.prototype.makeItemList=function(){this._data=$gameParty.allItems().filter(function(a){return this.includes(a)},this);this.includes(null)&&this._data.push(null)};Window_ItemList.prototype.selectLast=function(){var a=this._data.indexOf($gameParty.lastItem());this.select(0<=a?a:0)};
Window_ItemList.prototype.drawItem=function(a){var b=this._data[a];if(b){var c=this.numberWidth();a=this.itemRect(a);a.width-=this.textPadding();this.changePaintOpacity(this.isEnabled(b));this.drawItemName(b,a.x,a.y,a.width-c);this.drawItemNumber(b,a.x,a.y,a.width);this.changePaintOpacity(1)}};Window_ItemList.prototype.numberWidth=function(){return this.textWidth("000")};
Window_ItemList.prototype.drawItemNumber=function(a,b,c,d){this.needsNumber()&&(this.drawText(":",b,c,d-this.textWidth("00"),"right"),this.drawText($gameParty.numItems(a),b,c,d,"right"))};Window_ItemList.prototype.updateHelp=function(){this.setHelpWindowItem(this.item())};Window_ItemList.prototype.refresh=function(){this.makeItemList();this.createContents();this.drawAllItems()};function Window_SkillType(){this.initialize.apply(this,arguments)}Window_SkillType.prototype=Object.create(Window_Command.prototype);
Window_SkillType.prototype.constructor=Window_SkillType;Window_SkillType.prototype.initialize=function(a,b){Window_Command.prototype.initialize.call(this,a,b);this._actor=null};Window_SkillType.prototype.windowWidth=function(){return 240};Window_SkillType.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh(),this.selectLast())};Window_SkillType.prototype.numVisibleRows=function(){return 4};
Window_SkillType.prototype.makeCommandList=function(){if(this._actor){var a=this._actor.addedSkillTypes();a.sort(function(b,c){return b-c});a.forEach(function(b){this.addCommand($dataSystem.skillTypes[b],"skill",!0,b)},this)}};Window_SkillType.prototype.update=function(){Window_Command.prototype.update.call(this);this._skillWindow&&this._skillWindow.setStypeId(this.currentExt())};Window_SkillType.prototype.setSkillWindow=function(a){this._skillWindow=a};
Window_SkillType.prototype.selectLast=function(){var a=this._actor.lastMenuSkill();a?this.selectExt(a.stypeId):this.select(0)};function Window_SkillStatus(){this.initialize.apply(this,arguments)}Window_SkillStatus.prototype=Object.create(Window_Base.prototype);Window_SkillStatus.prototype.constructor=Window_SkillStatus;Window_SkillStatus.prototype.initialize=function(a,b,c,d){Window_Base.prototype.initialize.call(this,a,b,c,d);this._actor=null};
Window_SkillStatus.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh())};Window_SkillStatus.prototype.refresh=function(){this.contents.clear();if(this._actor){var a=this.width-2*this.padding,b=this.height-2*this.padding,c=b/2-1.5*this.lineHeight();a=a-162-this.textPadding();this.drawActorFace(this._actor,0,0,144,b);this.drawActorSimpleStatus(this._actor,162,c,a)}};function Window_SkillList(){this.initialize.apply(this,arguments)}Window_SkillList.prototype=Object.create(Window_Selectable.prototype);
Window_SkillList.prototype.constructor=Window_SkillList;Window_SkillList.prototype.initialize=function(a,b,c,d){Window_Selectable.prototype.initialize.call(this,a,b,c,d);this._actor=null;this._stypeId=0;this._data=[]};Window_SkillList.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh(),this.resetScroll())};Window_SkillList.prototype.setStypeId=function(a){this._stypeId!==a&&(this._stypeId=a,this.refresh(),this.resetScroll())};Window_SkillList.prototype.maxCols=function(){return 2};
Window_SkillList.prototype.spacing=function(){return 48};Window_SkillList.prototype.maxItems=function(){return this._data?this._data.length:1};Window_SkillList.prototype.item=function(){return this._data&&0<=this.index()?this._data[this.index()]:null};Window_SkillList.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this._data[this.index()])};Window_SkillList.prototype.includes=function(a){return a&&a.stypeId===this._stypeId};
Window_SkillList.prototype.isEnabled=function(a){return this._actor&&this._actor.canUse(a)};Window_SkillList.prototype.makeItemList=function(){this._data=this._actor?this._actor.skills().filter(function(a){return this.includes(a)},this):[]};Window_SkillList.prototype.selectLast=function(){var a=$gameParty.inBattle()?this._actor.lastBattleSkill():this._actor.lastMenuSkill();a=this._data.indexOf(a);this.select(0<=a?a:0)};
Window_SkillList.prototype.drawItem=function(a){var b=this._data[a];if(b){var c=this.costWidth();a=this.itemRect(a);a.width-=this.textPadding();this.changePaintOpacity(this.isEnabled(b));this.drawItemName(b,a.x,a.y,a.width-c);this.drawSkillCost(b,a.x,a.y,a.width);this.changePaintOpacity(1)}};Window_SkillList.prototype.costWidth=function(){return this.textWidth("000")};
Window_SkillList.prototype.drawSkillCost=function(a,b,c,d){0<this._actor.skillTpCost(a)?(this.changeTextColor(this.tpCostColor()),this.drawText(this._actor.skillTpCost(a),b,c,d,"right")):0<this._actor.skillMpCost(a)&&(this.changeTextColor(this.mpCostColor()),this.drawText(this._actor.skillMpCost(a),b,c,d,"right"))};Window_SkillList.prototype.updateHelp=function(){this.setHelpWindowItem(this.item())};Window_SkillList.prototype.refresh=function(){this.makeItemList();this.createContents();this.drawAllItems()};
function Window_EquipStatus(){this.initialize.apply(this,arguments)}Window_EquipStatus.prototype=Object.create(Window_Base.prototype);Window_EquipStatus.prototype.constructor=Window_EquipStatus;Window_EquipStatus.prototype.initialize=function(a,b){var c=this.windowWidth(),d=this.windowHeight();Window_Base.prototype.initialize.call(this,a,b,c,d);this._tempActor=this._actor=null;this.refresh()};Window_EquipStatus.prototype.windowWidth=function(){return 312};
Window_EquipStatus.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};Window_EquipStatus.prototype.numVisibleRows=function(){return 7};Window_EquipStatus.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh())};Window_EquipStatus.prototype.refresh=function(){this.contents.clear();if(this._actor){this.drawActorName(this._actor,this.textPadding(),0);for(var a=0;6>a;a++)this.drawItem(0,this.lineHeight()*(1+a),2+a)}};
Window_EquipStatus.prototype.setTempActor=function(a){this._tempActor!==a&&(this._tempActor=a,this.refresh())};Window_EquipStatus.prototype.drawItem=function(a,b,c){this.drawParamName(a+this.textPadding(),b,c);this._actor&&this.drawCurrentParam(a+140,b,c);this.drawRightArrow(a+188,b);this._tempActor&&this.drawNewParam(a+222,b,c)};Window_EquipStatus.prototype.drawParamName=function(a,b,c){this.changeTextColor(this.systemColor());this.drawText(TextManager.param(c),a,b,120)};
Window_EquipStatus.prototype.drawCurrentParam=function(a,b,c){this.resetTextColor();this.drawText(this._actor.param(c),a,b,48,"right")};Window_EquipStatus.prototype.drawRightArrow=function(a,b){this.changeTextColor(this.systemColor());this.drawText("\u2192",a,b,32,"center")};Window_EquipStatus.prototype.drawNewParam=function(a,b,c){var d=this._tempActor.param(c);c=d-this._actor.param(c);this.changeTextColor(this.paramchangeTextColor(c));this.drawText(d,a,b,48,"right")};
function Window_EquipCommand(){this.initialize.apply(this,arguments)}Window_EquipCommand.prototype=Object.create(Window_HorzCommand.prototype);Window_EquipCommand.prototype.constructor=Window_EquipCommand;Window_EquipCommand.prototype.initialize=function(a,b,c){this._windowWidth=c;Window_HorzCommand.prototype.initialize.call(this,a,b)};Window_EquipCommand.prototype.windowWidth=function(){return this._windowWidth};Window_EquipCommand.prototype.maxCols=function(){return 3};
Window_EquipCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.equip2,"equip");this.addCommand(TextManager.optimize,"optimize");this.addCommand(TextManager.clear,"clear")};function Window_EquipSlot(){this.initialize.apply(this,arguments)}Window_EquipSlot.prototype=Object.create(Window_Selectable.prototype);Window_EquipSlot.prototype.constructor=Window_EquipSlot;
Window_EquipSlot.prototype.initialize=function(a,b,c,d){Window_Selectable.prototype.initialize.call(this,a,b,c,d);this._actor=null;this.refresh()};Window_EquipSlot.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh())};Window_EquipSlot.prototype.update=function(){Window_Selectable.prototype.update.call(this);this._itemWindow&&this._itemWindow.setSlotId(this.index())};Window_EquipSlot.prototype.maxItems=function(){return this._actor?this._actor.equipSlots().length:0};
Window_EquipSlot.prototype.item=function(){return this._actor?this._actor.equips()[this.index()]:null};Window_EquipSlot.prototype.drawItem=function(a){if(this._actor){var b=this.itemRectForText(a);this.changeTextColor(this.systemColor());this.changePaintOpacity(this.isEnabled(a));this.drawText(this.slotName(a),b.x,b.y,138,this.lineHeight());this.drawItemName(this._actor.equips()[a],b.x+138,b.y);this.changePaintOpacity(!0)}};
Window_EquipSlot.prototype.slotName=function(a){var b=this._actor.equipSlots();return this._actor?$dataSystem.equipTypes[b[a]]:""};Window_EquipSlot.prototype.isEnabled=function(a){return this._actor?this._actor.isEquipChangeOk(a):!1};Window_EquipSlot.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this.index())};Window_EquipSlot.prototype.setStatusWindow=function(a){this._statusWindow=a;this.callUpdateHelp()};Window_EquipSlot.prototype.setItemWindow=function(a){this._itemWindow=a};
Window_EquipSlot.prototype.updateHelp=function(){Window_Selectable.prototype.updateHelp.call(this);this.setHelpWindowItem(this.item());this._statusWindow&&this._statusWindow.setTempActor(null)};function Window_EquipItem(){this.initialize.apply(this,arguments)}Window_EquipItem.prototype=Object.create(Window_ItemList.prototype);Window_EquipItem.prototype.constructor=Window_EquipItem;
Window_EquipItem.prototype.initialize=function(a,b,c,d){Window_ItemList.prototype.initialize.call(this,a,b,c,d);this._actor=null;this._slotId=0};Window_EquipItem.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh(),this.resetScroll())};Window_EquipItem.prototype.setSlotId=function(a){this._slotId!==a&&(this._slotId=a,this.refresh(),this.resetScroll())};
Window_EquipItem.prototype.includes=function(a){return null===a?!0:0>this._slotId||a.etypeId!==this._actor.equipSlots()[this._slotId]?!1:this._actor.canEquip(a)};Window_EquipItem.prototype.isEnabled=function(a){return!0};Window_EquipItem.prototype.selectLast=function(){};Window_EquipItem.prototype.setStatusWindow=function(a){this._statusWindow=a;this.callUpdateHelp()};
Window_EquipItem.prototype.updateHelp=function(){Window_ItemList.prototype.updateHelp.call(this);if(this._actor&&this._statusWindow){var a=JsonEx.makeDeepCopy(this._actor);a.forceChangeEquip(this._slotId,this.item());this._statusWindow.setTempActor(a)}};Window_EquipItem.prototype.playOkSound=function(){};function Window_Status(){this.initialize.apply(this,arguments)}Window_Status.prototype=Object.create(Window_Selectable.prototype);Window_Status.prototype.constructor=Window_Status;
Window_Status.prototype.initialize=function(){Window_Selectable.prototype.initialize.call(this,0,0,Graphics.boxWidth,Graphics.boxHeight);this._actor=null;this.refresh();this.activate()};Window_Status.prototype.setActor=function(a){this._actor!==a&&(this._actor=a,this.refresh())};
Window_Status.prototype.refresh=function(){this.contents.clear();if(this._actor){var a=this.lineHeight();this.drawBlock1(0*a);this.drawHorzLine(1*a);this.drawBlock2(2*a);this.drawHorzLine(6*a);this.drawBlock3(7*a);this.drawHorzLine(13*a);this.drawBlock4(14*a)}};Window_Status.prototype.drawBlock1=function(a){this.drawActorName(this._actor,6,a);this.drawActorClass(this._actor,192,a);this.drawActorNickname(this._actor,432,a)};
Window_Status.prototype.drawBlock2=function(a){this.drawActorFace(this._actor,12,a);this.drawBasicInfo(204,a);this.drawExpInfo(456,a)};Window_Status.prototype.drawBlock3=function(a){this.drawParameters(48,a);this.drawEquipments(432,a)};Window_Status.prototype.drawBlock4=function(a){this.drawProfile(6,a)};
Window_Status.prototype.drawHorzLine=function(a){a=a+this.lineHeight()/2-1;this.contents.paintOpacity=48;this.contents.fillRect(0,a,this.contentsWidth(),2,this.lineColor());this.contents.paintOpacity=255};Window_Status.prototype.lineColor=function(){return this.normalColor()};
Window_Status.prototype.drawBasicInfo=function(a,b){var c=this.lineHeight();this.drawActorLevel(this._actor,a,b+0*c);this.drawActorIcons(this._actor,a,b+1*c);this.drawActorHp(this._actor,a,b+2*c);this.drawActorMp(this._actor,a,b+3*c)};Window_Status.prototype.drawParameters=function(a,b){for(var c=this.lineHeight(),d=0;6>d;d++){var e=d+2,f=b+c*d;this.changeTextColor(this.systemColor());this.drawText(TextManager.param(e),a,f,160);this.resetTextColor();this.drawText(this._actor.param(e),a+160,f,60,"right")}};
Window_Status.prototype.drawExpInfo=function(a,b){var c=this.lineHeight(),d=TextManager.expTotal.format(TextManager.exp),e=TextManager.expNext.format(TextManager.level),f=this._actor.currentExp(),g=this._actor.nextRequiredExp();this._actor.isMaxLevel()&&(g=f="-------");this.changeTextColor(this.systemColor());this.drawText(d,a,b+0*c,270);this.drawText(e,a,b+2*c,270);this.resetTextColor();this.drawText(f,a,b+1*c,270,"right");this.drawText(g,a,b+3*c,270,"right")};
Window_Status.prototype.drawEquipments=function(a,b){for(var c=this._actor.equips(),d=Math.min(c.length,this.maxEquipmentLines()),e=0;e<d;e++)this.drawItemName(c[e],a,b+this.lineHeight()*e)};Window_Status.prototype.drawProfile=function(a,b){this.drawTextEx(this._actor.profile(),a,b)};Window_Status.prototype.maxEquipmentLines=function(){return 6};function Window_Options(){this.initialize.apply(this,arguments)}Window_Options.prototype=Object.create(Window_Command.prototype);
Window_Options.prototype.constructor=Window_Options;Window_Options.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0);this.updatePlacement()};Window_Options.prototype.windowWidth=function(){return 400};Window_Options.prototype.windowHeight=function(){return this.fittingHeight(Math.min(this.numVisibleRows(),12))};Window_Options.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2;this.y=(Graphics.boxHeight-this.height)/2};
Window_Options.prototype.makeCommandList=function(){this.addGeneralOptions();this.addVolumeOptions()};Window_Options.prototype.addGeneralOptions=function(){this.addCommand(TextManager.alwaysDash,"alwaysDash");this.addCommand(TextManager.commandRemember,"commandRemember")};
Window_Options.prototype.addVolumeOptions=function(){this.addCommand(TextManager.bgmVolume,"bgmVolume");this.addCommand(TextManager.bgsVolume,"bgsVolume");this.addCommand(TextManager.meVolume,"meVolume");this.addCommand(TextManager.seVolume,"seVolume")};
Window_Options.prototype.drawItem=function(a){var b=this.itemRectForText(a),c=this.statusWidth(),d=b.width-c;this.resetTextColor();this.changePaintOpacity(this.isCommandEnabled(a));this.drawText(this.commandName(a),b.x,b.y,d,"left");this.drawText(this.statusText(a),d,b.y,c,"right")};Window_Options.prototype.statusWidth=function(){return 120};Window_Options.prototype.statusText=function(a){a=this.commandSymbol(a);var b=this.getConfigValue(a);return this.isVolumeSymbol(a)?this.volumeStatusText(b):this.booleanStatusText(b)};
Window_Options.prototype.isVolumeSymbol=function(a){return a.contains("Volume")};Window_Options.prototype.booleanStatusText=function(a){return a?"ON":"OFF"};Window_Options.prototype.volumeStatusText=function(a){return a+"%"};Window_Options.prototype.processOk=function(){var a=this.index();a=this.commandSymbol(a);var b=this.getConfigValue(a);this.isVolumeSymbol(a)?(b+=this.volumeOffset(),100<b&&(b=0),b=b.clamp(0,100),this.changeValue(a,b)):this.changeValue(a,!b)};
Window_Options.prototype.cursorRight=function(a){a=this.index();a=this.commandSymbol(a);var b=this.getConfigValue(a);this.isVolumeSymbol(a)?(b+=this.volumeOffset(),b=b.clamp(0,100),this.changeValue(a,b)):this.changeValue(a,!0)};Window_Options.prototype.cursorLeft=function(a){a=this.index();a=this.commandSymbol(a);var b=this.getConfigValue(a);this.isVolumeSymbol(a)?(b-=this.volumeOffset(),b=b.clamp(0,100),this.changeValue(a,b)):this.changeValue(a,!1)};Window_Options.prototype.volumeOffset=function(){return 20};
Window_Options.prototype.changeValue=function(a,b){this.getConfigValue(a)!==b&&(this.setConfigValue(a,b),this.redrawItem(this.findSymbol(a)),SoundManager.playCursor())};Window_Options.prototype.getConfigValue=function(a){return ConfigManager[a]};Window_Options.prototype.setConfigValue=function(a,b){ConfigManager[a]=b};function Window_SavefileList(){this.initialize.apply(this,arguments)}Window_SavefileList.prototype=Object.create(Window_Selectable.prototype);
Window_SavefileList.prototype.constructor=Window_SavefileList;Window_SavefileList.prototype.initialize=function(a,b,c,d){Window_Selectable.prototype.initialize.call(this,a,b,c,d);this.activate();this._mode=null};Window_SavefileList.prototype.setMode=function(a){this._mode=a};Window_SavefileList.prototype.maxItems=function(){return DataManager.maxSavefiles()};Window_SavefileList.prototype.maxVisibleItems=function(){return 5};
Window_SavefileList.prototype.itemHeight=function(){return Math.floor((this.height-2*this.padding)/this.maxVisibleItems())};Window_SavefileList.prototype.drawItem=function(a){var b=a+1,c=DataManager.isThisGameFile(b),d=DataManager.loadSavefileInfo(b);a=this.itemRectForText(a);this.resetTextColor();"load"===this._mode&&this.changePaintOpacity(c);this.drawFileId(b,a.x,a.y);d&&(this.changePaintOpacity(c),this.drawContents(d,a,c),this.changePaintOpacity(!0))};
Window_SavefileList.prototype.drawFileId=function(a,b,c){this.drawText(TextManager.file+" "+a,b,c,180)};Window_SavefileList.prototype.drawContents=function(a,b,c){var d=b.y+b.height;420<=b.width&&(this.drawGameTitle(a,b.x+192,b.y,b.width-192),c&&this.drawPartyCharacters(a,b.x+220,d-4));c=this.lineHeight();d-=c;d>=c&&this.drawPlaytime(a,b.x,d,b.width)};Window_SavefileList.prototype.drawGameTitle=function(a,b,c,d){a.title&&this.drawText(a.title,b,c,d)};
Window_SavefileList.prototype.drawPartyCharacters=function(a,b,c){if(a.characters)for(var d=0;d<a.characters.length;d++){var e=a.characters[d];this.drawCharacter(e[0],e[1],b+48*d,c)}};Window_SavefileList.prototype.drawPlaytime=function(a,b,c,d){a.playtime&&this.drawText(a.playtime,b,c,d,"right")};Window_SavefileList.prototype.playOkSound=function(){};function Window_ShopCommand(){this.initialize.apply(this,arguments)}Window_ShopCommand.prototype=Object.create(Window_HorzCommand.prototype);
Window_ShopCommand.prototype.constructor=Window_ShopCommand;Window_ShopCommand.prototype.initialize=function(a,b){this._windowWidth=a;this._purchaseOnly=b;Window_HorzCommand.prototype.initialize.call(this,0,0)};Window_ShopCommand.prototype.windowWidth=function(){return this._windowWidth};Window_ShopCommand.prototype.maxCols=function(){return 3};
Window_ShopCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.buy,"buy");this.addCommand(TextManager.sell,"sell",!this._purchaseOnly);this.addCommand(TextManager.cancel,"cancel")};function Window_ShopBuy(){this.initialize.apply(this,arguments)}Window_ShopBuy.prototype=Object.create(Window_Selectable.prototype);Window_ShopBuy.prototype.constructor=Window_ShopBuy;
Window_ShopBuy.prototype.initialize=function(a,b,c,d){var e=this.windowWidth();Window_Selectable.prototype.initialize.call(this,a,b,e,c);this._shopGoods=d;this._money=0;this.refresh();this.select(0)};Window_ShopBuy.prototype.windowWidth=function(){return 456};Window_ShopBuy.prototype.maxItems=function(){return this._data?this._data.length:1};Window_ShopBuy.prototype.item=function(){return this._data[this.index()]};Window_ShopBuy.prototype.setMoney=function(a){this._money=a;this.refresh()};
Window_ShopBuy.prototype.isCurrentItemEnabled=function(){return this.isEnabled(this._data[this.index()])};Window_ShopBuy.prototype.price=function(a){return this._price[this._data.indexOf(a)]||0};Window_ShopBuy.prototype.isEnabled=function(a){return a&&this.price(a)<=this._money&&!$gameParty.hasMaxItems(a)};Window_ShopBuy.prototype.refresh=function(){this.makeItemList();this.createContents();this.drawAllItems()};
Window_ShopBuy.prototype.makeItemList=function(){this._data=[];this._price=[];this._shopGoods.forEach(function(a){var b=null;switch(a[0]){case 0:b=$dataItems[a[1]];break;case 1:b=$dataWeapons[a[1]];break;case 2:b=$dataArmors[a[1]]}b&&(this._data.push(b),this._price.push(0===a[2]?b.price:a[3]))},this)};
Window_ShopBuy.prototype.drawItem=function(a){var b=this._data[a];a=this.itemRect(a);a.width-=this.textPadding();this.changePaintOpacity(this.isEnabled(b));this.drawItemName(b,a.x,a.y,a.width-96);this.drawText(this.price(b),a.x+a.width-96,a.y,96,"right");this.changePaintOpacity(!0)};Window_ShopBuy.prototype.setStatusWindow=function(a){this._statusWindow=a;this.callUpdateHelp()};Window_ShopBuy.prototype.updateHelp=function(){this.setHelpWindowItem(this.item());this._statusWindow&&this._statusWindow.setItem(this.item())};
function Window_ShopSell(){this.initialize.apply(this,arguments)}Window_ShopSell.prototype=Object.create(Window_ItemList.prototype);Window_ShopSell.prototype.constructor=Window_ShopSell;Window_ShopSell.prototype.initialize=function(a,b,c,d){Window_ItemList.prototype.initialize.call(this,a,b,c,d)};Window_ShopSell.prototype.isEnabled=function(a){return a&&0<a.price};function Window_ShopNumber(){this.initialize.apply(this,arguments)}Window_ShopNumber.prototype=Object.create(Window_Selectable.prototype);
Window_ShopNumber.prototype.constructor=Window_ShopNumber;Window_ShopNumber.prototype.initialize=function(a,b,c){var d=this.windowWidth();Window_Selectable.prototype.initialize.call(this,a,b,d,c);this._item=null;this._max=1;this._price=0;this._number=1;this._currencyUnit=TextManager.currencyUnit;this.createButtons()};Window_ShopNumber.prototype.windowWidth=function(){return 456};Window_ShopNumber.prototype.number=function(){return this._number};
Window_ShopNumber.prototype.setup=function(a,b,c){this._item=a;this._max=Math.floor(b);this._price=c;this._number=1;this.placeButtons();this.updateButtonsVisiblity();this.refresh()};Window_ShopNumber.prototype.setCurrencyUnit=function(a){this._currencyUnit=a;this.refresh()};
Window_ShopNumber.prototype.createButtons=function(){var a=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(var b=0;5>b;b++){var c=new Sprite_Button,d=48*b,e=48*(4===b?2:1);c.bitmap=a;c.setColdFrame(d,0,e,48);c.setHotFrame(d,48,e,48);c.visible=!1;this._buttons.push(c);this.addChild(c)}this._buttons[0].setClickHandler(this.onButtonDown2.bind(this));this._buttons[1].setClickHandler(this.onButtonDown.bind(this));this._buttons[2].setClickHandler(this.onButtonUp.bind(this));this._buttons[3].setClickHandler(this.onButtonUp2.bind(this));
this._buttons[4].setClickHandler(this.onButtonOk.bind(this))};Window_ShopNumber.prototype.placeButtons=function(){for(var a=this._buttons.length,b=-16,c=0;c<a;c++)b+=this._buttons[c].width+16;b=(this.width-b)/2;for(c=0;c<a;c++){var d=this._buttons[c];d.x=b;d.y=this.buttonY();b+=d.width+16}};Window_ShopNumber.prototype.updateButtonsVisiblity=function(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()};
Window_ShopNumber.prototype.showButtons=function(){for(var a=0;a<this._buttons.length;a++)this._buttons[a].visible=!0};Window_ShopNumber.prototype.hideButtons=function(){for(var a=0;a<this._buttons.length;a++)this._buttons[a].visible=!1};Window_ShopNumber.prototype.refresh=function(){this.contents.clear();this.drawItemName(this._item,0,this.itemY());this.drawMultiplicationSign();this.drawNumber();this.drawTotalPrice()};
Window_ShopNumber.prototype.drawMultiplicationSign=function(){var a=this.textWidth("\u00d7"),b=this.cursorX()-2*a,c=this.itemY();this.resetTextColor();this.drawText("\u00d7",b,c,a)};Window_ShopNumber.prototype.drawNumber=function(){var a=this.cursorX(),b=this.itemY(),c=this.cursorWidth()-this.textPadding();this.resetTextColor();this.drawText(this._number,a,b,c,"right")};
Window_ShopNumber.prototype.drawTotalPrice=function(){var a=this._price*this._number,b=this.contentsWidth()-this.textPadding();this.drawCurrencyValue(a,this._currencyUnit,0,this.priceY(),b)};Window_ShopNumber.prototype.itemY=function(){return Math.round(this.contentsHeight()/2-1.5*this.lineHeight())};Window_ShopNumber.prototype.priceY=function(){return Math.round(this.contentsHeight()/2+this.lineHeight()/2)};Window_ShopNumber.prototype.buttonY=function(){return Math.round(this.priceY()+2.5*this.lineHeight())};
Window_ShopNumber.prototype.cursorWidth=function(){var a=this.textWidth("0");return this.maxDigits()*a+2*this.textPadding()};Window_ShopNumber.prototype.cursorX=function(){return this.contentsWidth()-this.cursorWidth()-this.textPadding()};Window_ShopNumber.prototype.maxDigits=function(){return 2};Window_ShopNumber.prototype.update=function(){Window_Selectable.prototype.update.call(this);this.processNumberChange()};Window_ShopNumber.prototype.isOkTriggered=function(){return Input.isTriggered("ok")};
Window_ShopNumber.prototype.playOkSound=function(){};Window_ShopNumber.prototype.processNumberChange=function(){this.isOpenAndActive()&&(Input.isRepeated("right")&&this.changeNumber(1),Input.isRepeated("left")&&this.changeNumber(-1),Input.isRepeated("up")&&this.changeNumber(10),Input.isRepeated("down")&&this.changeNumber(-10))};Window_ShopNumber.prototype.changeNumber=function(a){var b=this._number;this._number=(this._number+a).clamp(1,this._max);this._number!==b&&(SoundManager.playCursor(),this.refresh())};
Window_ShopNumber.prototype.updateCursor=function(){this.setCursorRect(this.cursorX(),this.itemY(),this.cursorWidth(),this.lineHeight())};Window_ShopNumber.prototype.onButtonUp=function(){this.changeNumber(1)};Window_ShopNumber.prototype.onButtonUp2=function(){this.changeNumber(10)};Window_ShopNumber.prototype.onButtonDown=function(){this.changeNumber(-1)};Window_ShopNumber.prototype.onButtonDown2=function(){this.changeNumber(-10)};Window_ShopNumber.prototype.onButtonOk=function(){this.processOk()};
function Window_ShopStatus(){this.initialize.apply(this,arguments)}Window_ShopStatus.prototype=Object.create(Window_Base.prototype);Window_ShopStatus.prototype.constructor=Window_ShopStatus;Window_ShopStatus.prototype.initialize=function(a,b,c,d){Window_Base.prototype.initialize.call(this,a,b,c,d);this._item=null;this._pageIndex=0;this.refresh()};
Window_ShopStatus.prototype.refresh=function(){this.contents.clear();if(this._item){var a=this.textPadding();this.drawPossession(a,0);this.isEquipItem()&&this.drawEquipInfo(a,2*this.lineHeight())}};Window_ShopStatus.prototype.setItem=function(a){this._item=a;this.refresh()};Window_ShopStatus.prototype.isEquipItem=function(){return DataManager.isWeapon(this._item)||DataManager.isArmor(this._item)};
Window_ShopStatus.prototype.drawPossession=function(a,b){var c=this.contents.width-this.textPadding()-a,d=this.textWidth("0000");this.changeTextColor(this.systemColor());this.drawText(TextManager.possession,a,b,c-d);this.resetTextColor();this.drawText($gameParty.numItems(this._item),a,b,c,"right")};Window_ShopStatus.prototype.drawEquipInfo=function(a,b){for(var c=this.statusMembers(),d=0;d<c.length;d++)this.drawActorEquipInfo(a,b+2.4*this.lineHeight()*d,c[d])};
Window_ShopStatus.prototype.statusMembers=function(){var a=this._pageIndex*this.pageSize(),b=a+this.pageSize();return $gameParty.members().slice(a,b)};Window_ShopStatus.prototype.pageSize=function(){return 4};Window_ShopStatus.prototype.maxPages=function(){return Math.floor(($gameParty.size()+this.pageSize()-1)/this.pageSize())};
Window_ShopStatus.prototype.drawActorEquipInfo=function(a,b,c){var d=c.canEquip(this._item);this.changePaintOpacity(d);this.resetTextColor();this.drawText(c.name(),a,b,168);var e=this.currentEquippedItem(c,this._item.etypeId);d&&this.drawActorParamChange(a,b,c,e);this.drawItemName(e,a,b+this.lineHeight());this.changePaintOpacity(!0)};
Window_ShopStatus.prototype.drawActorParamChange=function(a,b,c,d){c=this.contents.width-this.textPadding()-a;var e=this.paramId();d=this._item.params[e]-(d?d.params[e]:0);this.changeTextColor(this.paramchangeTextColor(d));this.drawText((0<d?"+":"")+d,a,b,c,"right")};Window_ShopStatus.prototype.paramId=function(){return DataManager.isWeapon(this._item)?2:3};
Window_ShopStatus.prototype.currentEquippedItem=function(a,b){var c=[],d=a.equips();a=a.equipSlots();for(var e=0;e<a.length;e++)a[e]===b&&c.push(d[e]);b=this.paramId();d=Number.MAX_VALUE;a=null;for(e=0;e<c.length;e++)c[e]&&c[e].params[b]<d&&(d=c[e].params[b],a=c[e]);return a};Window_ShopStatus.prototype.update=function(){Window_Base.prototype.update.call(this);this.updatePage()};Window_ShopStatus.prototype.updatePage=function(){this.isPageChangeEnabled()&&this.isPageChangeRequested()&&this.changePage()};
Window_ShopStatus.prototype.isPageChangeEnabled=function(){return this.visible&&2<=this.maxPages()};Window_ShopStatus.prototype.isPageChangeRequested=function(){return Input.isTriggered("shift")||TouchInput.isTriggered()&&this.isTouchedInsideFrame()?!0:!1};Window_ShopStatus.prototype.isTouchedInsideFrame=function(){var a=this.canvasToLocalX(TouchInput.x),b=this.canvasToLocalY(TouchInput.y);return 0<=a&&0<=b&&a<this.width&&b<this.height};
Window_ShopStatus.prototype.changePage=function(){this._pageIndex=(this._pageIndex+1)%this.maxPages();this.refresh();SoundManager.playCursor()};function Window_NameEdit(){this.initialize.apply(this,arguments)}Window_NameEdit.prototype=Object.create(Window_Base.prototype);Window_NameEdit.prototype.constructor=Window_NameEdit;
Window_NameEdit.prototype.initialize=function(a,b){var c=this.windowWidth(),d=this.windowHeight(),e=(Graphics.boxWidth-c)/2,f=(Graphics.boxHeight-(d+this.fittingHeight(9)+8))/2;Window_Base.prototype.initialize.call(this,e,f,c,d);this._actor=a;this._name=a.name().slice(0,this._maxLength);this._index=this._name.length;this._maxLength=b;this._defaultName=this._name;this.deactivate();this.refresh();ImageManager.reserveFace(a.faceName())};Window_NameEdit.prototype.windowWidth=function(){return 480};
Window_NameEdit.prototype.windowHeight=function(){return this.fittingHeight(4)};Window_NameEdit.prototype.name=function(){return this._name};Window_NameEdit.prototype.restoreDefault=function(){this._name=this._defaultName;this._index=this._name.length;this.refresh();return 0<this._name.length};Window_NameEdit.prototype.add=function(a){return this._index<this._maxLength?(this._name+=a,this._index++,this.refresh(),!0):!1};
Window_NameEdit.prototype.back=function(){return 0<this._index?(this._index--,this._name=this._name.slice(0,this._index),this.refresh(),!0):!1};Window_NameEdit.prototype.faceWidth=function(){return 144};Window_NameEdit.prototype.charWidth=function(){var a=$gameSystem.isJapanese()?"\uff21":"A";return this.textWidth(a)};Window_NameEdit.prototype.left=function(){var a=(this.contentsWidth()+this.faceWidth())/2,b=(this._maxLength+1)*this.charWidth();return Math.min(a-b/2,this.contentsWidth()-b)};
Window_NameEdit.prototype.itemRect=function(a){return{x:this.left()+a*this.charWidth(),y:54,width:this.charWidth(),height:this.lineHeight()}};Window_NameEdit.prototype.underlineRect=function(a){a=this.itemRect(a);a.x++;a.y+=a.height-4;a.width-=2;a.height=2;return a};Window_NameEdit.prototype.underlineColor=function(){return this.normalColor()};
Window_NameEdit.prototype.drawUnderline=function(a){a=this.underlineRect(a);var b=this.underlineColor();this.contents.paintOpacity=48;this.contents.fillRect(a.x,a.y,a.width,a.height,b);this.contents.paintOpacity=255};Window_NameEdit.prototype.drawChar=function(a){var b=this.itemRect(a);this.resetTextColor();this.drawText(this._name[a]||"",b.x,b.y)};
Window_NameEdit.prototype.refresh=function(){this.contents.clear();this.drawActorFace(this._actor,0,0);for(var a=0;a<this._maxLength;a++)this.drawUnderline(a);for(a=0;a<this._name.length;a++)this.drawChar(a);a=this.itemRect(this._index);this.setCursorRect(a.x,a.y,a.width,a.height)};function Window_NameInput(){this.initialize.apply(this,arguments)}Window_NameInput.prototype=Object.create(Window_Selectable.prototype);Window_NameInput.prototype.constructor=Window_NameInput;Window_NameInput.LATIN1="A,B,C,D,E,a,b,c,d,e,F,G,H,I,J,f,g,h,i,j,K,L,M,N,O,k,l,m,n,o,P,Q,R,S,T,p,q,r,s,t,U,V,W,X,Y,u,v,w,x,y,Z,[,],^,_,z,{,},|,~,0,1,2,3,4,!,#,$,%,&,5,6,7,8,9,(,),*,+,-,/,=,@,<,>,:,;, ,Page,OK".split(",");
Window_NameInput.LATIN2="\u00c1;\u00c9;\u00cd;\u00d3;\u00da;\u00e1;\u00e9;\u00ed;\u00f3;\u00fa;\u00c0;\u00c8;\u00cc;\u00d2;\u00d9;\u00e0;\u00e8;\u00ec;\u00f2;\u00f9;\u00c2;\u00ca;\u00ce;\u00d4;\u00db;\u00e2;\u00ea;\u00ee;\u00f4;\u00fb;\u00c4;\u00cb;\u00cf;\u00d6;\u00dc;\u00e4;\u00eb;\u00ef;\u00f6;\u00fc;\u0100;\u0112;\u012a;\u014c;\u016a;\u0101;\u0113;\u012b;\u014d;\u016b;\u00c3;\u00c5;\u00c6;\u00c7;\u00d0;\u00e3;\u00e5;\u00e6;\u00e7;\u00f0;\u00d1;\u00d5;\u00d8;\u0160;\u0174;\u00f1;\u00f5;\u00f8;\u0161;\u0175;\u00dd;\u0176;\u0178;\u017d;\u00de;\u00fd;\u00ff;\u0177;\u017e;\u00fe;\u0132;\u0152;\u0133;\u0153;\u00df;\u00ab;\u00bb; ;Page;OK".split(";");
Window_NameInput.RUSSIA="\u0410,\u0411,\u0412,\u0413,\u0414,\u0430,\u0431,\u0432,\u0433,\u0434,\u0415,\u0401,\u0416,\u0417,\u0418,\u0435,\u0451,\u0436,\u0437,\u0438,\u0419,\u041a,\u041b,\u041c,\u041d,\u0439,\u043a,\u043b,\u043c,\u043d,\u041e,\u041f,\u0420,\u0421,\u0422,\u043e,\u043f,\u0440,\u0441,\u0442,\u0423,\u0424,\u0425,\u0426,\u0427,\u0443,\u0444,\u0445,\u0446,\u0447,\u0428,\u0429,\u042a,\u042b,\u042c,\u0448,\u0449,\u044a,\u044b,\u044c,\u042d,\u042e,\u042f,^,_,\u044d,\u044e,\u044f,%,&,0,1,2,3,4,(,),*,+,-,5,6,7,8,9,:,;, ,,OK".split(",");
Window_NameInput.JAPAN1="\u3042 \u3044 \u3046 \u3048 \u304a \u304c \u304e \u3050 \u3052 \u3054 \u304b \u304d \u304f \u3051 \u3053 \u3056 \u3058 \u305a \u305c \u305e \u3055 \u3057 \u3059 \u305b \u305d \u3060 \u3062 \u3065 \u3067 \u3069 \u305f \u3061 \u3064 \u3066 \u3068 \u3070 \u3073 \u3076 \u3079 \u307c \u306a \u306b \u306c \u306d \u306e \u3071 \u3074 \u3077 \u307a \u307d \u306f \u3072 \u3075 \u3078 \u307b \u3041 \u3043 \u3045 \u3047 \u3049 \u307e \u307f \u3080 \u3081 \u3082 \u3063 \u3083 \u3085 \u3087 \u308e \u3084 \u3086 \u3088 \u308f \u3093 \u30fc \uff5e \u30fb \uff1d \u2606 \u3089 \u308a \u308b \u308c \u308d \u3094 \u3092 \u3000 \u30ab\u30ca \u6c7a\u5b9a".split(" ");
Window_NameInput.JAPAN2="\u30a2 \u30a4 \u30a6 \u30a8 \u30aa \u30ac \u30ae \u30b0 \u30b2 \u30b4 \u30ab \u30ad \u30af \u30b1 \u30b3 \u30b6 \u30b8 \u30ba \u30bc \u30be \u30b5 \u30b7 \u30b9 \u30bb \u30bd \u30c0 \u30c2 \u30c5 \u30c7 \u30c9 \u30bf \u30c1 \u30c4 \u30c6 \u30c8 \u30d0 \u30d3 \u30d6 \u30d9 \u30dc \u30ca \u30cb \u30cc \u30cd \u30ce \u30d1 \u30d4 \u30d7 \u30da \u30dd \u30cf \u30d2 \u30d5 \u30d8 \u30db \u30a1 \u30a3 \u30a5 \u30a7 \u30a9 \u30de \u30df \u30e0 \u30e1 \u30e2 \u30c3 \u30e3 \u30e5 \u30e7 \u30ee \u30e4 \u30e6 \u30e8 \u30ef \u30f3 \u30fc \uff5e \u30fb \uff1d \u2606 \u30e9 \u30ea \u30eb \u30ec \u30ed \u30f4 \u30f2 \u3000 \u82f1\u6570 \u6c7a\u5b9a".split(" ");
Window_NameInput.JAPAN3="\uff21 \uff22 \uff23 \uff24 \uff25 \uff41 \uff42 \uff43 \uff44 \uff45 \uff26 \uff27 \uff28 \uff29 \uff2a \uff46 \uff47 \uff48 \uff49 \uff4a \uff2b \uff2c \uff2d \uff2e \uff2f \uff4b \uff4c \uff4d \uff4e \uff4f \uff30 \uff31 \uff32 \uff33 \uff34 \uff50 \uff51 \uff52 \uff53 \uff54 \uff35 \uff36 \uff37 \uff38 \uff39 \uff55 \uff56 \uff57 \uff58 \uff59 \uff3a \uff3b \uff3d \uff3e \uff3f \uff5a \uff5b \uff5d \uff5c \uff5e \uff10 \uff11 \uff12 \uff13 \uff14 \uff01 \uff03 \uff04 \uff05 \uff06 \uff15 \uff16 \uff17 \uff18 \uff19 \uff08 \uff09 \uff0a \uff0b \uff0d \uff0f \uff1d \uff20 \uff1c \uff1e \uff1a \uff1b \u3000 \u304b\u306a \u6c7a\u5b9a".split(" ");
Window_NameInput.prototype.initialize=function(a){var b=a.x,c=a.y+a.height+8,d=a.width,e=this.windowHeight();Window_Selectable.prototype.initialize.call(this,b,c,d,e);this._editWindow=a;this._index=this._page=0;this.refresh();this.updateCursor();this.activate()};Window_NameInput.prototype.windowHeight=function(){return this.fittingHeight(9)};
Window_NameInput.prototype.table=function(){return $gameSystem.isJapanese()?[Window_NameInput.JAPAN1,Window_NameInput.JAPAN2,Window_NameInput.JAPAN3]:$gameSystem.isRussian()?[Window_NameInput.RUSSIA]:[Window_NameInput.LATIN1,Window_NameInput.LATIN2]};Window_NameInput.prototype.maxCols=function(){return 10};Window_NameInput.prototype.maxItems=function(){return 90};Window_NameInput.prototype.character=function(){return 88>this._index?this.table()[this._page][this._index]:""};
Window_NameInput.prototype.isPageChange=function(){return 88===this._index};Window_NameInput.prototype.isOk=function(){return 89===this._index};Window_NameInput.prototype.itemRect=function(a){return{x:a%10*42+24*Math.floor(a%10/5),y:Math.floor(a/10)*this.lineHeight(),width:42,height:this.lineHeight()}};
Window_NameInput.prototype.refresh=function(){var a=this.table();this.contents.clear();this.resetTextColor();for(var b=0;90>b;b++){var c=this.itemRect(b);c.x+=3;c.width-=6;this.drawText(a[this._page][b],c.x,c.y,c.width,"center")}};Window_NameInput.prototype.updateCursor=function(){var a=this.itemRect(this._index);this.setCursorRect(a.x,a.y,a.width,a.height)};Window_NameInput.prototype.isCursorMovable=function(){return this.active};
Window_NameInput.prototype.cursorDown=function(a){if(80>this._index||a)this._index=(this._index+10)%90};Window_NameInput.prototype.cursorUp=function(a){if(10<=this._index||a)this._index=(this._index+80)%90};Window_NameInput.prototype.cursorRight=function(a){9>this._index%10?this._index++:a&&(this._index-=9)};Window_NameInput.prototype.cursorLeft=function(a){0<this._index%10?this._index--:a&&(this._index+=9)};
Window_NameInput.prototype.cursorPagedown=function(){this._page=(this._page+1)%this.table().length;this.refresh()};Window_NameInput.prototype.cursorPageup=function(){this._page=(this._page+this.table().length-1)%this.table().length;this.refresh()};Window_NameInput.prototype.processCursorMove=function(){var a=this._page;Window_Selectable.prototype.processCursorMove.call(this);this.updateCursor();this._page!==a&&SoundManager.playCursor()};
Window_NameInput.prototype.processHandling=function(){this.isOpen()&&this.active&&(Input.isTriggered("shift")&&this.processJump(),Input.isRepeated("cancel")&&this.processBack(),Input.isRepeated("ok")&&this.processOk())};Window_NameInput.prototype.isCancelEnabled=function(){return!0};Window_NameInput.prototype.processCancel=function(){this.processBack()};Window_NameInput.prototype.processJump=function(){89!==this._index&&(this._index=89,SoundManager.playCursor())};
Window_NameInput.prototype.processBack=function(){this._editWindow.back()&&SoundManager.playCancel()};Window_NameInput.prototype.processOk=function(){if(this.character())this.onNameAdd();else if(this.isPageChange())SoundManager.playOk(),this.cursorPagedown();else if(this.isOk())this.onNameOk()};Window_NameInput.prototype.onNameAdd=function(){this._editWindow.add(this.character())?SoundManager.playOk():SoundManager.playBuzzer()};
Window_NameInput.prototype.onNameOk=function(){""===this._editWindow.name()?this._editWindow.restoreDefault()?SoundManager.playOk():SoundManager.playBuzzer():(SoundManager.playOk(),this.callOkHandler())};function Window_ChoiceList(){this.initialize.apply(this,arguments)}Window_ChoiceList.prototype=Object.create(Window_Command.prototype);Window_ChoiceList.prototype.constructor=Window_ChoiceList;
Window_ChoiceList.prototype.initialize=function(a){this._messageWindow=a;Window_Command.prototype.initialize.call(this,0,0);this.openness=0;this.deactivate();this._background=0};Window_ChoiceList.prototype.start=function(){this.updatePlacement();this.updateBackground();this.refresh();this.selectDefault();this.open();this.activate()};Window_ChoiceList.prototype.selectDefault=function(){this.select($gameMessage.choiceDefaultType())};
Window_ChoiceList.prototype.updatePlacement=function(){var a=$gameMessage.choicePositionType(),b=this._messageWindow.y;this.width=this.windowWidth();this.height=this.windowHeight();switch(a){case 0:this.x=0;break;case 1:this.x=(Graphics.boxWidth-this.width)/2;break;case 2:this.x=Graphics.boxWidth-this.width}this.y=b>=Graphics.boxHeight/2?b-this.height:b+this._messageWindow.height};Window_ChoiceList.prototype.updateBackground=function(){this._background=$gameMessage.choiceBackground();this.setBackgroundType(this._background)};
Window_ChoiceList.prototype.windowWidth=function(){var a=this.maxChoiceWidth()+2*this.padding;return Math.min(a,Graphics.boxWidth)};Window_ChoiceList.prototype.numVisibleRows=function(){var a=this._messageWindow.y,b=this._messageWindow.height,c=Graphics.boxHeight/2,d=$gameMessage.choices().length,e=8;a<c&&a+b>c&&(e=4);d>e&&(d=e);return d};
Window_ChoiceList.prototype.maxChoiceWidth=function(){for(var a=96,b=$gameMessage.choices(),c=0;c<b.length;c++){var d=this.textWidthEx(b[c])+2*this.textPadding();a<d&&(a=d)}return a};Window_ChoiceList.prototype.textWidthEx=function(a){return this.drawTextEx(a,0,this.contents.height)};Window_ChoiceList.prototype.contentsHeight=function(){return this.maxItems()*this.itemHeight()};
Window_ChoiceList.prototype.makeCommandList=function(){for(var a=$gameMessage.choices(),b=0;b<a.length;b++)this.addCommand(a[b],"choice")};Window_ChoiceList.prototype.drawItem=function(a){var b=this.itemRectForText(a);this.drawTextEx(this.commandName(a),b.x,b.y)};Window_ChoiceList.prototype.isCancelEnabled=function(){return-1!==$gameMessage.choiceCancelType()};Window_ChoiceList.prototype.isOkTriggered=function(){return Input.isTriggered("ok")};
Window_ChoiceList.prototype.callOkHandler=function(){$gameMessage.onChoice(this.index());this._messageWindow.terminateMessage();this.close()};Window_ChoiceList.prototype.callCancelHandler=function(){$gameMessage.onChoice($gameMessage.choiceCancelType());this._messageWindow.terminateMessage();this.close()};function Window_NumberInput(){this.initialize.apply(this,arguments)}Window_NumberInput.prototype=Object.create(Window_Selectable.prototype);Window_NumberInput.prototype.constructor=Window_NumberInput;
Window_NumberInput.prototype.initialize=function(a){this._messageWindow=a;Window_Selectable.prototype.initialize.call(this,0,0,0,0);this._number=0;this._maxDigits=1;this.openness=0;this.createButtons();this.deactivate()};
Window_NumberInput.prototype.start=function(){this._maxDigits=$gameMessage.numInputMaxDigits();this._number=$gameVariables.value($gameMessage.numInputVariableId());this._number=this._number.clamp(0,Math.pow(10,this._maxDigits)-1);this.updatePlacement();this.placeButtons();this.updateButtonsVisiblity();this.createContents();this.refresh();this.open();this.activate();this.select(0)};
Window_NumberInput.prototype.updatePlacement=function(){var a=this._messageWindow.y;this.width=this.windowWidth();this.height=this.windowHeight();this.x=(Graphics.boxWidth-this.width)/2;this.y=a>=Graphics.boxHeight/2?a-this.height-8:a+this._messageWindow.height+8};Window_NumberInput.prototype.windowWidth=function(){return this.maxCols()*this.itemWidth()+2*this.padding};Window_NumberInput.prototype.windowHeight=function(){return this.fittingHeight(1)};Window_NumberInput.prototype.maxCols=function(){return this._maxDigits};
Window_NumberInput.prototype.maxItems=function(){return this._maxDigits};Window_NumberInput.prototype.spacing=function(){return 0};Window_NumberInput.prototype.itemWidth=function(){return 32};
Window_NumberInput.prototype.createButtons=function(){var a=ImageManager.loadSystem("ButtonSet");this._buttons=[];for(var b=0;3>b;b++){var c=new Sprite_Button,d=48*[1,2,4][b],e=48*(2===b?2:1);c.bitmap=a;c.setColdFrame(d,0,e,48);c.setHotFrame(d,48,e,48);c.visible=!1;this._buttons.push(c);this.addChild(c)}this._buttons[0].setClickHandler(this.onButtonDown.bind(this));this._buttons[1].setClickHandler(this.onButtonUp.bind(this));this._buttons[2].setClickHandler(this.onButtonOk.bind(this))};
Window_NumberInput.prototype.placeButtons=function(){for(var a=this._buttons.length,b=-16,c=0;c<a;c++)b+=this._buttons[c].width+16;b=(this.width-b)/2;for(c=0;c<a;c++){var d=this._buttons[c];d.x=b;d.y=this.buttonY();b+=d.width+16}};Window_NumberInput.prototype.updateButtonsVisiblity=function(){TouchInput.date>Input.date?this.showButtons():this.hideButtons()};Window_NumberInput.prototype.showButtons=function(){for(var a=0;a<this._buttons.length;a++)this._buttons[a].visible=!0};
Window_NumberInput.prototype.hideButtons=function(){for(var a=0;a<this._buttons.length;a++)this._buttons[a].visible=!1};Window_NumberInput.prototype.buttonY=function(){return this._messageWindow.y>=Graphics.boxHeight/2?0-this._buttons[0].height-8:this.height+8};Window_NumberInput.prototype.update=function(){Window_Selectable.prototype.update.call(this);this.processDigitChange()};
Window_NumberInput.prototype.processDigitChange=function(){this.isOpenAndActive()&&(Input.isRepeated("up")?this.changeDigit(!0):Input.isRepeated("down")&&this.changeDigit(!1))};Window_NumberInput.prototype.changeDigit=function(a){var b=this.index();b=Math.pow(10,this._maxDigits-1-b);var c=Math.floor(this._number/b)%10;this._number-=c*b;this._number+=(a?(c+1)%10:(c+9)%10)*b;this.refresh();SoundManager.playCursor()};Window_NumberInput.prototype.isTouchOkEnabled=function(){return!1};
Window_NumberInput.prototype.isOkEnabled=function(){return!0};Window_NumberInput.prototype.isCancelEnabled=function(){return!1};Window_NumberInput.prototype.isOkTriggered=function(){return Input.isTriggered("ok")};Window_NumberInput.prototype.processOk=function(){SoundManager.playOk();$gameVariables.setValue($gameMessage.numInputVariableId(),this._number);this._messageWindow.terminateMessage();this.updateInputData();this.deactivate();this.close()};
Window_NumberInput.prototype.drawItem=function(a){var b=this.itemRect(a);a=this._number.padZero(this._maxDigits).slice(a,a+1);this.resetTextColor();this.drawText(a,b.x,b.y,b.width,"center")};Window_NumberInput.prototype.onButtonUp=function(){this.changeDigit(!0)};Window_NumberInput.prototype.onButtonDown=function(){this.changeDigit(!1)};Window_NumberInput.prototype.onButtonOk=function(){this.processOk();this.hideButtons()};function Window_EventItem(){this.initialize.apply(this,arguments)}
Window_EventItem.prototype=Object.create(Window_ItemList.prototype);Window_EventItem.prototype.constructor=Window_EventItem;Window_EventItem.prototype.initialize=function(a){this._messageWindow=a;a=Graphics.boxWidth;var b=this.windowHeight();Window_ItemList.prototype.initialize.call(this,0,0,a,b);this.openness=0;this.deactivate();this.setHandler("ok",this.onOk.bind(this));this.setHandler("cancel",this.onCancel.bind(this))};Window_EventItem.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};
Window_EventItem.prototype.numVisibleRows=function(){return 4};Window_EventItem.prototype.start=function(){this.refresh();this.updatePlacement();this.select(0);this.open();this.activate()};Window_EventItem.prototype.updatePlacement=function(){this.y=this._messageWindow.y>=Graphics.boxHeight/2?0:Graphics.boxHeight-this.height};Window_EventItem.prototype.includes=function(a){var b=$gameMessage.itemChoiceItypeId();return DataManager.isItem(a)&&a.itypeId===b};Window_EventItem.prototype.isEnabled=function(a){return!0};
Window_EventItem.prototype.onOk=function(){var a=this.item();a=a?a.id:0;$gameVariables.setValue($gameMessage.itemChoiceVariableId(),a);this._messageWindow.terminateMessage();this.close()};Window_EventItem.prototype.onCancel=function(){$gameVariables.setValue($gameMessage.itemChoiceVariableId(),0);this._messageWindow.terminateMessage();this.close()};function Window_Message(){this.initialize.apply(this,arguments)}Window_Message.prototype=Object.create(Window_Base.prototype);
Window_Message.prototype.constructor=Window_Message;Window_Message.prototype.initialize=function(){var a=this.windowWidth(),b=this.windowHeight();Window_Base.prototype.initialize.call(this,(Graphics.boxWidth-a)/2,0,a,b);this.openness=0;this.initMembers();this.createSubWindows();this.updatePlacement()};Window_Message.prototype.initMembers=function(){this._imageReservationId=Utils.generateRuntimeId();this._background=0;this._positionType=2;this._waitCount=0;this._textState=this._faceBitmap=null;this.clearFlags()};
Window_Message.prototype.subWindows=function(){return[this._goldWindow,this._choiceWindow,this._numberWindow,this._itemWindow]};Window_Message.prototype.createSubWindows=function(){this._goldWindow=new Window_Gold(0,0);this._goldWindow.x=Graphics.boxWidth-this._goldWindow.width;this._goldWindow.openness=0;this._choiceWindow=new Window_ChoiceList(this);this._numberWindow=new Window_NumberInput(this);this._itemWindow=new Window_EventItem(this)};Window_Message.prototype.windowWidth=function(){return Graphics.boxWidth};
Window_Message.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};Window_Message.prototype.clearFlags=function(){this._pauseSkip=this._lineShowFast=this._showFast=!1};Window_Message.prototype.numVisibleRows=function(){return 4};
Window_Message.prototype.update=function(){this.checkToNotClose();for(Window_Base.prototype.update.call(this);!(this.isOpening()||this.isClosing()||this.updateWait()||this.updateLoading()||this.updateInput()||this.updateMessage());)if(this.canStart())this.startMessage();else{this.startInput();break}};Window_Message.prototype.checkToNotClose=function(){this.isClosing()&&this.isOpen()&&this.doesContinue()&&this.open()};Window_Message.prototype.canStart=function(){return $gameMessage.hasText()&&!$gameMessage.scrollMode()};
Window_Message.prototype.startMessage=function(){this._textState={};this._textState.index=0;this._textState.text=this.convertEscapeCharacters($gameMessage.allText());this.newPage(this._textState);this.updatePlacement();this.updateBackground();this.open()};Window_Message.prototype.updatePlacement=function(){this._positionType=$gameMessage.positionType();this.y=this._positionType*(Graphics.boxHeight-this.height)/2;this._goldWindow.y=0<this.y?0:Graphics.boxHeight-this._goldWindow.height};
Window_Message.prototype.updateBackground=function(){this._background=$gameMessage.background();this.setBackgroundType(this._background)};Window_Message.prototype.terminateMessage=function(){this.close();this._goldWindow.close();$gameMessage.clear()};Window_Message.prototype.updateWait=function(){return 0<this._waitCount?(this._waitCount--,!0):!1};
Window_Message.prototype.updateLoading=function(){return this._faceBitmap?this._faceBitmap.isReady()?(this.drawMessageFace(),this._faceBitmap=null,!1):!0:!1};Window_Message.prototype.updateInput=function(){return this.isAnySubWindowActive()?!0:this.pause?(this.isTriggered()&&(Input.update(),this.pause=!1,this._textState||this.terminateMessage()),!0):!1};Window_Message.prototype.isAnySubWindowActive=function(){return this._choiceWindow.active||this._numberWindow.active||this._itemWindow.active};
Window_Message.prototype.updateMessage=function(){if(this._textState){for(;!this.isEndOfText(this._textState);){this.needsNewPage(this._textState)&&this.newPage(this._textState);this.updateShowFast();this.processCharacter(this._textState);if(!this._showFast&&!this._lineShowFast)break;if(this.pause||0<this._waitCount)break}if(this.isEndOfText(this._textState))this.onEndOfText();return!0}return!1};
Window_Message.prototype.onEndOfText=function(){this.startInput()||(this._pauseSkip?this.terminateMessage():this.startPause());this._textState=null};Window_Message.prototype.startInput=function(){return $gameMessage.isChoice()?(this._choiceWindow.start(),!0):$gameMessage.isNumberInput()?(this._numberWindow.start(),!0):$gameMessage.isItemChoice()?(this._itemWindow.start(),!0):!1};Window_Message.prototype.isTriggered=function(){return Input.isRepeated("ok")||Input.isRepeated("cancel")||TouchInput.isRepeated()};
Window_Message.prototype.doesContinue=function(){return $gameMessage.hasText()&&!$gameMessage.scrollMode()&&!this.areSettingsChanged()};Window_Message.prototype.areSettingsChanged=function(){return this._background!==$gameMessage.background()||this._positionType!==$gameMessage.positionType()};Window_Message.prototype.updateShowFast=function(){this.isTriggered()&&(this._showFast=!0)};
Window_Message.prototype.newPage=function(a){this.contents.clear();this.resetFontSettings();this.clearFlags();this.loadMessageFace();a.x=this.newLineX();a.y=0;a.left=this.newLineX();a.height=this.calcTextHeight(a,!1)};Window_Message.prototype.loadMessageFace=function(){this._faceBitmap=ImageManager.reserveFace($gameMessage.faceName(),0,this._imageReservationId)};Window_Message.prototype.drawMessageFace=function(){this.drawFace($gameMessage.faceName(),$gameMessage.faceIndex(),0,0);ImageManager.releaseReservation(this._imageReservationId)};
Window_Message.prototype.newLineX=function(){return""===$gameMessage.faceName()?0:168};Window_Message.prototype.processNewLine=function(a){this._lineShowFast=!1;Window_Base.prototype.processNewLine.call(this,a);this.needsNewPage(a)&&this.startPause()};Window_Message.prototype.processNewPage=function(a){Window_Base.prototype.processNewPage.call(this,a);"\n"===a.text[a.index]&&a.index++;a.y=this.contents.height;this.startPause()};Window_Message.prototype.isEndOfText=function(a){return a.index>=a.text.length};
Window_Message.prototype.needsNewPage=function(a){return!this.isEndOfText(a)&&a.y+a.height>this.contents.height};Window_Message.prototype.processEscapeCharacter=function(a,b){switch(a){case "$":this._goldWindow.open();break;case ".":this.startWait(15);break;case "|":this.startWait(60);break;case "!":this.startPause();break;case ">":this._lineShowFast=!0;break;case "<":this._lineShowFast=!1;break;case "^":this._pauseSkip=!0;break;default:Window_Base.prototype.processEscapeCharacter.call(this,a,b)}};
Window_Message.prototype.startWait=function(a){this._waitCount=a};Window_Message.prototype.startPause=function(){this.startWait(10);this.pause=!0};function Window_ScrollText(){this.initialize.apply(this,arguments)}Window_ScrollText.prototype=Object.create(Window_Base.prototype);Window_ScrollText.prototype.constructor=Window_ScrollText;
Window_ScrollText.prototype.initialize=function(){Window_Base.prototype.initialize.call(this,0,0,Graphics.boxWidth,Graphics.boxHeight);this.opacity=0;this.hide();this._text="";this._allTextHeight=0};Window_ScrollText.prototype.update=function(){Window_Base.prototype.update.call(this);$gameMessage.scrollMode()&&(this._text&&this.updateMessage(),!this._text&&$gameMessage.hasText()&&this.startMessage())};
Window_ScrollText.prototype.startMessage=function(){this._text=$gameMessage.allText();this.refresh();this.show()};Window_ScrollText.prototype.refresh=function(){var a={index:0};a.text=this.convertEscapeCharacters(this._text);this.resetFontSettings();this._allTextHeight=this.calcTextHeight(a,!0);this.createContents();this.origin.y=-this.height;this.drawTextEx(this._text,this.textPadding(),1)};Window_ScrollText.prototype.contentsHeight=function(){return Math.max(this._allTextHeight,1)};
Window_ScrollText.prototype.updateMessage=function(){this.origin.y+=this.scrollSpeed();this.origin.y>=this.contents.height&&this.terminateMessage()};Window_ScrollText.prototype.scrollSpeed=function(){var a=$gameMessage.scrollSpeed()/2;this.isFastForward()&&(a*=this.fastForwardRate());return a};Window_ScrollText.prototype.isFastForward=function(){return $gameMessage.scrollNoFast()?!1:Input.isPressed("ok")||Input.isPressed("shift")||TouchInput.isPressed()};
Window_ScrollText.prototype.fastForwardRate=function(){return 3};Window_ScrollText.prototype.terminateMessage=function(){this._text=null;$gameMessage.clear();this.hide()};function Window_MapName(){this.initialize.apply(this,arguments)}Window_MapName.prototype=Object.create(Window_Base.prototype);Window_MapName.prototype.constructor=Window_MapName;
Window_MapName.prototype.initialize=function(){var a=this.windowWidth(),b=this.windowHeight();Window_Base.prototype.initialize.call(this,0,0,a,b);this._showCount=this.contentsOpacity=this.opacity=0;this.refresh()};Window_MapName.prototype.windowWidth=function(){return 360};Window_MapName.prototype.windowHeight=function(){return this.fittingHeight(1)};
Window_MapName.prototype.update=function(){Window_Base.prototype.update.call(this);0<this._showCount&&$gameMap.isNameDisplayEnabled()?(this.updateFadeIn(),this._showCount--):this.updateFadeOut()};Window_MapName.prototype.updateFadeIn=function(){this.contentsOpacity+=16};Window_MapName.prototype.updateFadeOut=function(){this.contentsOpacity-=16};Window_MapName.prototype.open=function(){this.refresh();this._showCount=150};Window_MapName.prototype.close=function(){this._showCount=0};
Window_MapName.prototype.refresh=function(){this.contents.clear();if($gameMap.displayName()){var a=this.contentsWidth();this.drawBackground(0,0,a,this.lineHeight());this.drawText($gameMap.displayName(),0,0,a,"center")}};Window_MapName.prototype.drawBackground=function(a,b,c,d){var e=this.dimColor1(),f=this.dimColor2();this.contents.gradientFillRect(a,b,c/2,d,f,e);this.contents.gradientFillRect(a+c/2,b,c/2,d,e,f)};function Window_BattleLog(){this.initialize.apply(this,arguments)}
Window_BattleLog.prototype=Object.create(Window_Selectable.prototype);Window_BattleLog.prototype.constructor=Window_BattleLog;Window_BattleLog.prototype.initialize=function(){var a=this.windowWidth(),b=this.windowHeight();Window_Selectable.prototype.initialize.call(this,0,0,a,b);this.opacity=0;this._lines=[];this._methods=[];this._waitCount=0;this._waitMode="";this._baseLineStack=[];this._spriteset=null;this.createBackBitmap();this.createBackSprite();this.refresh()};
Window_BattleLog.prototype.setSpriteset=function(a){this._spriteset=a};Window_BattleLog.prototype.windowWidth=function(){return Graphics.boxWidth};Window_BattleLog.prototype.windowHeight=function(){return this.fittingHeight(this.maxLines())};Window_BattleLog.prototype.maxLines=function(){return 10};Window_BattleLog.prototype.createBackBitmap=function(){this._backBitmap=new Bitmap(this.width,this.height)};
Window_BattleLog.prototype.createBackSprite=function(){this._backSprite=new Sprite;this._backSprite.bitmap=this._backBitmap;this._backSprite.y=this.y;this.addChildToBack(this._backSprite)};Window_BattleLog.prototype.numLines=function(){return this._lines.length};Window_BattleLog.prototype.messageSpeed=function(){return 16};Window_BattleLog.prototype.isBusy=function(){return 0<this._waitCount||this._waitMode||0<this._methods.length};Window_BattleLog.prototype.update=function(){this.updateWait()||this.callNextMethod()};
Window_BattleLog.prototype.updateWait=function(){return this.updateWaitCount()||this.updateWaitMode()};Window_BattleLog.prototype.updateWaitCount=function(){return 0<this._waitCount?(this._waitCount-=this.isFastForward()?3:1,0>this._waitCount&&(this._waitCount=0),!0):!1};Window_BattleLog.prototype.updateWaitMode=function(){var a=!1;switch(this._waitMode){case "effect":a=this._spriteset.isEffecting();break;case "movement":a=this._spriteset.isAnyoneMoving()}a||(this._waitMode="");return a};
Window_BattleLog.prototype.setWaitMode=function(a){this._waitMode=a};Window_BattleLog.prototype.callNextMethod=function(){if(0<this._methods.length){var a=this._methods.shift();if(a.name&&this[a.name])this[a.name].apply(this,a.params);else throw Error("Method not found: "+a.name);}};Window_BattleLog.prototype.isFastForward=function(){return Input.isLongPressed("ok")||Input.isPressed("shift")||TouchInput.isLongPressed()};
Window_BattleLog.prototype.push=function(a){var b=Array.prototype.slice.call(arguments,1);this._methods.push({name:a,params:b})};Window_BattleLog.prototype.clear=function(){this._lines=[];this._baseLineStack=[];this.refresh()};Window_BattleLog.prototype.wait=function(){this._waitCount=this.messageSpeed()};Window_BattleLog.prototype.waitForEffect=function(){this.setWaitMode("effect")};Window_BattleLog.prototype.waitForMovement=function(){this.setWaitMode("movement")};
Window_BattleLog.prototype.addText=function(a){this._lines.push(a);this.refresh();this.wait()};Window_BattleLog.prototype.pushBaseLine=function(){this._baseLineStack.push(this._lines.length)};Window_BattleLog.prototype.popBaseLine=function(){for(var a=this._baseLineStack.pop();this._lines.length>a;)this._lines.pop()};Window_BattleLog.prototype.waitForNewLine=function(){var a=0;0<this._baseLineStack.length&&(a=this._baseLineStack[this._baseLineStack.length-1]);this._lines.length>a&&this.wait()};
Window_BattleLog.prototype.popupDamage=function(a){a.startDamagePopup()};Window_BattleLog.prototype.performActionStart=function(a,b){a.performActionStart(b)};Window_BattleLog.prototype.performAction=function(a,b){a.performAction(b)};Window_BattleLog.prototype.performActionEnd=function(a){a.performActionEnd()};Window_BattleLog.prototype.performDamage=function(a){a.performDamage()};Window_BattleLog.prototype.performMiss=function(a){a.performMiss()};Window_BattleLog.prototype.performRecovery=function(a){a.performRecovery()};
Window_BattleLog.prototype.performEvasion=function(a){a.performEvasion()};Window_BattleLog.prototype.performMagicEvasion=function(a){a.performMagicEvasion()};Window_BattleLog.prototype.performCounter=function(a){a.performCounter()};Window_BattleLog.prototype.performReflection=function(a){a.performReflection()};Window_BattleLog.prototype.performSubstitute=function(a,b){a.performSubstitute(b)};Window_BattleLog.prototype.performCollapse=function(a){a.performCollapse()};
Window_BattleLog.prototype.showAnimation=function(a,b,c){0>c?this.showAttackAnimation(a,b):this.showNormalAnimation(b,c)};Window_BattleLog.prototype.showAttackAnimation=function(a,b){a.isActor()?this.showActorAttackAnimation(a,b):this.showEnemyAttackAnimation(a,b)};Window_BattleLog.prototype.showActorAttackAnimation=function(a,b){this.showNormalAnimation(b,a.attackAnimationId1(),!1);this.showNormalAnimation(b,a.attackAnimationId2(),!0)};
Window_BattleLog.prototype.showEnemyAttackAnimation=function(a,b){SoundManager.playEnemyAttack()};Window_BattleLog.prototype.showNormalAnimation=function(a,b,c){if($dataAnimations[b]){var d=this.animationBaseDelay(),e=this.animationNextDelay();a.forEach(function(f){f.startAnimation(b,c,d);d+=e})}};Window_BattleLog.prototype.animationBaseDelay=function(){return 8};Window_BattleLog.prototype.animationNextDelay=function(){return 12};
Window_BattleLog.prototype.refresh=function(){this.drawBackground();this.contents.clear();for(var a=0;a<this._lines.length;a++)this.drawLineText(a)};Window_BattleLog.prototype.drawBackground=function(){var a=this.backRect(),b=this.backColor();this._backBitmap.clear();this._backBitmap.paintOpacity=this.backPaintOpacity();this._backBitmap.fillRect(a.x,a.y,a.width,a.height,b);this._backBitmap.paintOpacity=255};
Window_BattleLog.prototype.backRect=function(){return{x:0,y:this.padding,width:this.width,height:this.numLines()*this.lineHeight()}};Window_BattleLog.prototype.backColor=function(){return"#000000"};Window_BattleLog.prototype.backPaintOpacity=function(){return 64};Window_BattleLog.prototype.drawLineText=function(a){var b=this.itemRectForText(a);this.contents.clearRect(b.x,b.y,b.width,b.height);this.drawTextEx(this._lines[a],b.x,b.y,b.width)};Window_BattleLog.prototype.startTurn=function(){this.push("wait")};
Window_BattleLog.prototype.startAction=function(a,b,c){var d=b.item();this.push("performActionStart",a,b);this.push("waitForMovement");this.push("performAction",a,b);this.push("showAnimation",a,c.clone(),d.animationId);this.displayAction(a,d)};Window_BattleLog.prototype.endAction=function(a){this.push("waitForNewLine");this.push("clear");this.push("performActionEnd",a)};
Window_BattleLog.prototype.displayCurrentState=function(a){var b=a.mostImportantStateText();b&&(this.push("addText",a.name()+b),this.push("wait"),this.push("clear"))};Window_BattleLog.prototype.displayRegeneration=function(a){this.push("popupDamage",a)};
Window_BattleLog.prototype.displayAction=function(a,b){var c=this._methods.length;DataManager.isSkill(b)?(b.message1&&this.push("addText",a.name()+b.message1.format(b.name)),b.message2&&this.push("addText",b.message2.format(b.name))):this.push("addText",TextManager.useItem.format(a.name(),b.name));this._methods.length===c&&this.push("wait")};Window_BattleLog.prototype.displayCounter=function(a){this.push("performCounter",a);this.push("addText",TextManager.counterAttack.format(a.name()))};
Window_BattleLog.prototype.displayReflection=function(a){this.push("performReflection",a);this.push("addText",TextManager.magicReflection.format(a.name()))};Window_BattleLog.prototype.displaySubstitute=function(a,b){var c=a.name();this.push("performSubstitute",a,b);this.push("addText",TextManager.substitute.format(c,b.name()))};
Window_BattleLog.prototype.displayActionResults=function(a,b){b.result().used&&(this.push("pushBaseLine"),this.displayCritical(b),this.push("popupDamage",b),this.push("popupDamage",a),this.displayDamage(b),this.displayAffectedStatus(b),this.displayFailure(b),this.push("waitForNewLine"),this.push("popBaseLine"))};Window_BattleLog.prototype.displayFailure=function(a){a.result().isHit()&&!a.result().success&&this.push("addText",TextManager.actionFailure.format(a.name()))};
Window_BattleLog.prototype.displayCritical=function(a){a.result().critical&&(a.isActor()?this.push("addText",TextManager.criticalToActor):this.push("addText",TextManager.criticalToEnemy))};Window_BattleLog.prototype.displayDamage=function(a){a.result().missed?this.displayMiss(a):a.result().evaded?this.displayEvasion(a):(this.displayHpDamage(a),this.displayMpDamage(a),this.displayTpDamage(a))};
Window_BattleLog.prototype.displayMiss=function(a){if(a.result().physical){var b=a.isActor()?TextManager.actorNoHit:TextManager.enemyNoHit;this.push("performMiss",a)}else b=TextManager.actionFailure;this.push("addText",b.format(a.name()))};Window_BattleLog.prototype.displayEvasion=function(a){if(a.result().physical){var b=TextManager.evasion;this.push("performEvasion",a)}else b=TextManager.magicEvasion,this.push("performMagicEvasion",a);this.push("addText",b.format(a.name()))};
Window_BattleLog.prototype.displayHpDamage=function(a){a.result().hpAffected&&(0<a.result().hpDamage&&!a.result().drain&&this.push("performDamage",a),0>a.result().hpDamage&&this.push("performRecovery",a),this.push("addText",this.makeHpDamageText(a)))};Window_BattleLog.prototype.displayMpDamage=function(a){a.isAlive()&&0!==a.result().mpDamage&&(0>a.result().mpDamage&&this.push("performRecovery",a),this.push("addText",this.makeMpDamageText(a)))};
Window_BattleLog.prototype.displayTpDamage=function(a){a.isAlive()&&0!==a.result().tpDamage&&(0>a.result().tpDamage&&this.push("performRecovery",a),this.push("addText",this.makeTpDamageText(a)))};Window_BattleLog.prototype.displayAffectedStatus=function(a){a.result().isStatusAffected()&&(this.push("pushBaseLine"),this.displayChangedStates(a),this.displayChangedBuffs(a),this.push("waitForNewLine"),this.push("popBaseLine"))};
Window_BattleLog.prototype.displayAutoAffectedStatus=function(a){a.result().isStatusAffected()&&(this.displayAffectedStatus(a,null),this.push("clear"))};Window_BattleLog.prototype.displayChangedStates=function(a){this.displayAddedStates(a);this.displayRemovedStates(a)};
Window_BattleLog.prototype.displayAddedStates=function(a){a.result().addedStateObjects().forEach(function(b){var c=a.isActor()?b.message1:b.message2;b.id===a.deathStateId()&&this.push("performCollapse",a);c&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",a.name()+c),this.push("waitForEffect"))},this)};
Window_BattleLog.prototype.displayRemovedStates=function(a){a.result().removedStateObjects().forEach(function(b){b.message4&&(this.push("popBaseLine"),this.push("pushBaseLine"),this.push("addText",a.name()+b.message4))},this)};Window_BattleLog.prototype.displayChangedBuffs=function(a){var b=a.result();this.displayBuffs(a,b.addedBuffs,TextManager.buffAdd);this.displayBuffs(a,b.addedDebuffs,TextManager.debuffAdd);this.displayBuffs(a,b.removedBuffs,TextManager.buffRemove)};
Window_BattleLog.prototype.displayBuffs=function(a,b,c){b.forEach(function(d){this.push("popBaseLine");this.push("pushBaseLine");this.push("addText",c.format(a.name(),TextManager.param(d)))},this)};
Window_BattleLog.prototype.makeHpDamageText=function(a){var b=a.result(),c=b.hpDamage,d=a.isActor();if(0<c&&b.drain)return b=d?TextManager.actorDrain:TextManager.enemyDrain,b.format(a.name(),TextManager.hp,c);if(0<c)return b=d?TextManager.actorDamage:TextManager.enemyDamage,b.format(a.name(),c);if(0>c)return b=d?TextManager.actorRecovery:TextManager.enemyRecovery,b.format(a.name(),TextManager.hp,-c);b=d?TextManager.actorNoDamage:TextManager.enemyNoDamage;return b.format(a.name())};
Window_BattleLog.prototype.makeMpDamageText=function(a){var b=a.result(),c=b.mpDamage,d=a.isActor();return 0<c&&b.drain?(b=d?TextManager.actorDrain:TextManager.enemyDrain,b.format(a.name(),TextManager.mp,c)):0<c?(b=d?TextManager.actorLoss:TextManager.enemyLoss,b.format(a.name(),TextManager.mp,c)):0>c?(b=d?TextManager.actorRecovery:TextManager.enemyRecovery,b.format(a.name(),TextManager.mp,-c)):""};
Window_BattleLog.prototype.makeTpDamageText=function(a){var b=a.result().tpDamage,c=a.isActor();return 0<b?(c=c?TextManager.actorLoss:TextManager.enemyLoss,c.format(a.name(),TextManager.tp,b)):0>b?(c=c?TextManager.actorGain:TextManager.enemyGain,c.format(a.name(),TextManager.tp,-b)):""};function Window_PartyCommand(){this.initialize.apply(this,arguments)}Window_PartyCommand.prototype=Object.create(Window_Command.prototype);Window_PartyCommand.prototype.constructor=Window_PartyCommand;
Window_PartyCommand.prototype.initialize=function(){var a=Graphics.boxHeight-this.windowHeight();Window_Command.prototype.initialize.call(this,0,a);this.openness=0;this.deactivate()};Window_PartyCommand.prototype.windowWidth=function(){return 192};Window_PartyCommand.prototype.numVisibleRows=function(){return 4};Window_PartyCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.fight,"fight");this.addCommand(TextManager.escape,"escape",BattleManager.canEscape())};
Window_PartyCommand.prototype.setup=function(){this.clearCommandList();this.makeCommandList();this.refresh();this.select(0);this.activate();this.open()};function Window_ActorCommand(){this.initialize.apply(this,arguments)}Window_ActorCommand.prototype=Object.create(Window_Command.prototype);Window_ActorCommand.prototype.constructor=Window_ActorCommand;
Window_ActorCommand.prototype.initialize=function(){var a=Graphics.boxHeight-this.windowHeight();Window_Command.prototype.initialize.call(this,0,a);this.openness=0;this.deactivate();this._actor=null};Window_ActorCommand.prototype.windowWidth=function(){return 192};Window_ActorCommand.prototype.numVisibleRows=function(){return 4};Window_ActorCommand.prototype.makeCommandList=function(){this._actor&&(this.addAttackCommand(),this.addSkillCommands(),this.addGuardCommand(),this.addItemCommand())};
Window_ActorCommand.prototype.addAttackCommand=function(){this.addCommand(TextManager.attack,"attack",this._actor.canAttack())};Window_ActorCommand.prototype.addSkillCommands=function(){var a=this._actor.addedSkillTypes();a.sort(function(b,c){return b-c});a.forEach(function(b){this.addCommand($dataSystem.skillTypes[b],"skill",!0,b)},this)};Window_ActorCommand.prototype.addGuardCommand=function(){this.addCommand(TextManager.guard,"guard",this._actor.canGuard())};
Window_ActorCommand.prototype.addItemCommand=function(){this.addCommand(TextManager.item,"item")};Window_ActorCommand.prototype.setup=function(a){this._actor=a;this.clearCommandList();this.makeCommandList();this.refresh();this.selectLast();this.activate();this.open()};Window_ActorCommand.prototype.processOk=function(){this._actor&&(ConfigManager.commandRemember?this._actor.setLastCommandSymbol(this.currentSymbol()):this._actor.setLastCommandSymbol(""));Window_Command.prototype.processOk.call(this)};
Window_ActorCommand.prototype.selectLast=function(){this.select(0);if(this._actor&&ConfigManager.commandRemember){var a=this._actor.lastCommandSymbol();this.selectSymbol(a);"skill"===a&&(a=this._actor.lastBattleSkill())&&this.selectExt(a.stypeId)}};function Window_BattleStatus(){this.initialize.apply(this,arguments)}Window_BattleStatus.prototype=Object.create(Window_Selectable.prototype);Window_BattleStatus.prototype.constructor=Window_BattleStatus;
Window_BattleStatus.prototype.initialize=function(){var a=this.windowWidth(),b=this.windowHeight();Window_Selectable.prototype.initialize.call(this,Graphics.boxWidth-a,Graphics.boxHeight-b,a,b);this.refresh();this.openness=0};Window_BattleStatus.prototype.windowWidth=function(){return Graphics.boxWidth-192};Window_BattleStatus.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};Window_BattleStatus.prototype.numVisibleRows=function(){return 4};
Window_BattleStatus.prototype.maxItems=function(){return $gameParty.battleMembers().length};Window_BattleStatus.prototype.refresh=function(){this.contents.clear();this.drawAllItems()};Window_BattleStatus.prototype.drawItem=function(a){var b=$gameParty.battleMembers()[a];this.drawBasicArea(this.basicAreaRect(a),b);this.drawGaugeArea(this.gaugeAreaRect(a),b)};Window_BattleStatus.prototype.basicAreaRect=function(a){a=this.itemRectForText(a);a.width-=this.gaugeAreaWidth()+15;return a};
Window_BattleStatus.prototype.gaugeAreaRect=function(a){a=this.itemRectForText(a);a.x+=a.width-this.gaugeAreaWidth();a.width=this.gaugeAreaWidth();return a};Window_BattleStatus.prototype.gaugeAreaWidth=function(){return 330};Window_BattleStatus.prototype.drawBasicArea=function(a,b){this.drawActorName(b,a.x+0,a.y,150);this.drawActorIcons(b,a.x+156,a.y,a.width-156)};
Window_BattleStatus.prototype.drawGaugeArea=function(a,b){$dataSystem.optDisplayTp?this.drawGaugeAreaWithTp(a,b):this.drawGaugeAreaWithoutTp(a,b)};Window_BattleStatus.prototype.drawGaugeAreaWithTp=function(a,b){this.drawActorHp(b,a.x+0,a.y,108);this.drawActorMp(b,a.x+123,a.y,96);this.drawActorTp(b,a.x+234,a.y,96)};Window_BattleStatus.prototype.drawGaugeAreaWithoutTp=function(a,b){this.drawActorHp(b,a.x+0,a.y,201);this.drawActorMp(b,a.x+216,a.y,114)};
function Window_BattleActor(){this.initialize.apply(this,arguments)}Window_BattleActor.prototype=Object.create(Window_BattleStatus.prototype);Window_BattleActor.prototype.constructor=Window_BattleActor;Window_BattleActor.prototype.initialize=function(a,b){Window_BattleStatus.prototype.initialize.call(this);this.x=a;this.y=b;this.openness=255;this.hide()};Window_BattleActor.prototype.show=function(){this.select(0);Window_BattleStatus.prototype.show.call(this)};
Window_BattleActor.prototype.hide=function(){Window_BattleStatus.prototype.hide.call(this);$gameParty.select(null)};Window_BattleActor.prototype.select=function(a){Window_BattleStatus.prototype.select.call(this,a);$gameParty.select(this.actor())};Window_BattleActor.prototype.actor=function(){return $gameParty.members()[this.index()]};function Window_BattleEnemy(){this.initialize.apply(this,arguments)}Window_BattleEnemy.prototype=Object.create(Window_Selectable.prototype);
Window_BattleEnemy.prototype.constructor=Window_BattleEnemy;Window_BattleEnemy.prototype.initialize=function(a,b){this._enemies=[];var c=this.windowWidth(),d=this.windowHeight();Window_Selectable.prototype.initialize.call(this,a,b,c,d);this.refresh();this.hide()};Window_BattleEnemy.prototype.windowWidth=function(){return Graphics.boxWidth-192};Window_BattleEnemy.prototype.windowHeight=function(){return this.fittingHeight(this.numVisibleRows())};Window_BattleEnemy.prototype.numVisibleRows=function(){return 4};
Window_BattleEnemy.prototype.maxCols=function(){return 2};Window_BattleEnemy.prototype.maxItems=function(){return this._enemies.length};Window_BattleEnemy.prototype.enemy=function(){return this._enemies[this.index()]};Window_BattleEnemy.prototype.enemyIndex=function(){var a=this.enemy();return a?a.index():-1};Window_BattleEnemy.prototype.drawItem=function(a){this.resetTextColor();var b=this._enemies[a].name();a=this.itemRectForText(a);this.drawText(b,a.x,a.y,a.width)};
Window_BattleEnemy.prototype.show=function(){this.refresh();this.select(0);Window_Selectable.prototype.show.call(this)};Window_BattleEnemy.prototype.hide=function(){Window_Selectable.prototype.hide.call(this);$gameTroop.select(null)};Window_BattleEnemy.prototype.refresh=function(){this._enemies=$gameTroop.aliveMembers();Window_Selectable.prototype.refresh.call(this)};Window_BattleEnemy.prototype.select=function(a){Window_Selectable.prototype.select.call(this,a);$gameTroop.select(this.enemy())};
function Window_BattleSkill(){this.initialize.apply(this,arguments)}Window_BattleSkill.prototype=Object.create(Window_SkillList.prototype);Window_BattleSkill.prototype.constructor=Window_BattleSkill;Window_BattleSkill.prototype.initialize=function(a,b,c,d){Window_SkillList.prototype.initialize.call(this,a,b,c,d);this.hide()};Window_BattleSkill.prototype.show=function(){this.selectLast();this.showHelpWindow();Window_SkillList.prototype.show.call(this)};
Window_BattleSkill.prototype.hide=function(){this.hideHelpWindow();Window_SkillList.prototype.hide.call(this)};function Window_BattleItem(){this.initialize.apply(this,arguments)}Window_BattleItem.prototype=Object.create(Window_ItemList.prototype);Window_BattleItem.prototype.constructor=Window_BattleItem;Window_BattleItem.prototype.initialize=function(a,b,c,d){Window_ItemList.prototype.initialize.call(this,a,b,c,d);this.hide()};Window_BattleItem.prototype.includes=function(a){return $gameParty.canUse(a)};
Window_BattleItem.prototype.show=function(){this.selectLast();this.showHelpWindow();Window_ItemList.prototype.show.call(this)};Window_BattleItem.prototype.hide=function(){this.hideHelpWindow();Window_ItemList.prototype.hide.call(this)};function Window_TitleCommand(){this.initialize.apply(this,arguments)}Window_TitleCommand.prototype=Object.create(Window_Command.prototype);Window_TitleCommand.prototype.constructor=Window_TitleCommand;
Window_TitleCommand.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0);this.updatePlacement();this.openness=0;this.selectLast()};Window_TitleCommand._lastCommandSymbol=null;Window_TitleCommand.initCommandPosition=function(){this._lastCommandSymbol=null};Window_TitleCommand.prototype.windowWidth=function(){return 240};Window_TitleCommand.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2;this.y=Graphics.boxHeight-this.height-96};
Window_TitleCommand.prototype.makeCommandList=function(){this.addCommand(TextManager.newGame,"newGame");this.addCommand(TextManager.continue_,"continue",this.isContinueEnabled());this.addCommand(TextManager.options,"options")};Window_TitleCommand.prototype.isContinueEnabled=function(){return DataManager.isAnySavefileExists()};Window_TitleCommand.prototype.processOk=function(){Window_TitleCommand._lastCommandSymbol=this.currentSymbol();Window_Command.prototype.processOk.call(this)};
Window_TitleCommand.prototype.selectLast=function(){Window_TitleCommand._lastCommandSymbol?this.selectSymbol(Window_TitleCommand._lastCommandSymbol):this.isContinueEnabled()&&this.selectSymbol("continue")};function Window_GameEnd(){this.initialize.apply(this,arguments)}Window_GameEnd.prototype=Object.create(Window_Command.prototype);Window_GameEnd.prototype.constructor=Window_GameEnd;
Window_GameEnd.prototype.initialize=function(){Window_Command.prototype.initialize.call(this,0,0);this.updatePlacement();this.openness=0;this.open()};Window_GameEnd.prototype.windowWidth=function(){return 240};Window_GameEnd.prototype.updatePlacement=function(){this.x=(Graphics.boxWidth-this.width)/2;this.y=(Graphics.boxHeight-this.height)/2};Window_GameEnd.prototype.makeCommandList=function(){this.addCommand(TextManager.toTitle,"toTitle");this.addCommand(TextManager.cancel,"cancel")};
function Window_DebugRange(){this.initialize.apply(this,arguments)}Window_DebugRange.prototype=Object.create(Window_Selectable.prototype);Window_DebugRange.prototype.constructor=Window_DebugRange;Window_DebugRange.lastTopRow=0;Window_DebugRange.lastIndex=0;
Window_DebugRange.prototype.initialize=function(a,b){this._maxSwitches=Math.ceil(($dataSystem.switches.length-1)/10);this._maxVariables=Math.ceil(($dataSystem.variables.length-1)/10);var c=this.windowWidth(),d=this.windowHeight();Window_Selectable.prototype.initialize.call(this,a,b,c,d);this.refresh();this.setTopRow(Window_DebugRange.lastTopRow);this.select(Window_DebugRange.lastIndex);this.activate()};Window_DebugRange.prototype.windowWidth=function(){return 246};
Window_DebugRange.prototype.windowHeight=function(){return Graphics.boxHeight};Window_DebugRange.prototype.maxItems=function(){return this._maxSwitches+this._maxVariables};Window_DebugRange.prototype.update=function(){Window_Selectable.prototype.update.call(this);this._editWindow&&(this._editWindow.setMode(this.mode()),this._editWindow.setTopId(this.topId()))};Window_DebugRange.prototype.mode=function(){return this.index()<this._maxSwitches?"switch":"variable"};
Window_DebugRange.prototype.topId=function(){var a=this.index();return a<this._maxSwitches?10*a+1:10*(a-this._maxSwitches)+1};Window_DebugRange.prototype.refresh=function(){this.createContents();this.drawAllItems()};Window_DebugRange.prototype.drawItem=function(a){var b=this.itemRectForText(a);if(a<this._maxSwitches){a=10*a+1;var c="S"}else a=10*(a-this._maxSwitches)+1,c="V";var d=a+9;c+=" ["+a.padZero(4)+"-"+d.padZero(4)+"]";this.drawText(c,b.x,b.y,b.width)};
Window_DebugRange.prototype.isCancelTriggered=function(){return Window_Selectable.prototype.isCancelTriggered()||Input.isTriggered("debug")};Window_DebugRange.prototype.processCancel=function(){Window_Selectable.prototype.processCancel.call(this);Window_DebugRange.lastTopRow=this.topRow();Window_DebugRange.lastIndex=this.index()};Window_DebugRange.prototype.setEditWindow=function(a){this._editWindow=a};function Window_DebugEdit(){this.initialize.apply(this,arguments)}Window_DebugEdit.prototype=Object.create(Window_Selectable.prototype);
Window_DebugEdit.prototype.constructor=Window_DebugEdit;Window_DebugEdit.prototype.initialize=function(a,b,c){var d=this.fittingHeight(10);Window_Selectable.prototype.initialize.call(this,a,b,c,d);this._mode="switch";this._topId=1;this.refresh()};Window_DebugEdit.prototype.maxItems=function(){return 10};Window_DebugEdit.prototype.refresh=function(){this.contents.clear();this.drawAllItems()};
Window_DebugEdit.prototype.drawItem=function(a){var b=this._topId+a,c=b.padZero(4)+":",d=this.textWidth(c),e=this.textWidth("-00000000"),f=this.itemName(b);b=this.itemStatus(b);a=this.itemRectForText(a);this.resetTextColor();this.drawText(c,a.x,a.y,a.width);a.x+=d;a.width-=d+e;this.drawText(f,a.x,a.y,a.width);this.drawText(b,a.x+a.width,a.y,e,"right")};Window_DebugEdit.prototype.itemName=function(a){return"switch"===this._mode?$dataSystem.switches[a]:$dataSystem.variables[a]};
Window_DebugEdit.prototype.itemStatus=function(a){return"switch"===this._mode?$gameSwitches.value(a)?"[ON]":"[OFF]":String($gameVariables.value(a))};Window_DebugEdit.prototype.setMode=function(a){this._mode!==a&&(this._mode=a,this.refresh())};Window_DebugEdit.prototype.setTopId=function(a){this._topId!==a&&(this._topId=a,this.refresh())};Window_DebugEdit.prototype.currentId=function(){return this._topId+this.index()};
Window_DebugEdit.prototype.update=function(){Window_Selectable.prototype.update.call(this);this.active&&("switch"===this._mode?this.updateSwitch():this.updateVariable())};Window_DebugEdit.prototype.updateSwitch=function(){if(Input.isRepeated("ok")){var a=this.currentId();SoundManager.playCursor();$gameSwitches.setValue(a,!$gameSwitches.value(a));this.redrawCurrentItem()}};
Window_DebugEdit.prototype.updateVariable=function(){var a=this.currentId(),b=$gameVariables.value(a);"number"===typeof b&&(Input.isRepeated("right")&&b++,Input.isRepeated("left")&&b--,Input.isRepeated("pagedown")&&(b+=10),Input.isRepeated("pageup")&&(b-=10),$gameVariables.value(a)!==b&&($gameVariables.setValue(a,b),SoundManager.playCursor(),this.redrawCurrentItem()))};
